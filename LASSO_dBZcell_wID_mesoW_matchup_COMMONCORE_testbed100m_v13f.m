

% THis script loads the orographic swath data from each case (processed
% with
% .../PROJECTS/ICLASS/LASSO_stuff/LASSO_TESTBED3_500m_WswathThermo_COMMONCORE.m),
% tabulate them all into one set of arrays ("..._ALLCASES"). ALso loads
% environmental data fro each cell that JNM calculates with other matlab
% code. Also calculates null-swath properties.


% merged w-core, env-param, conv-swath analysis
%
% v7: adds in loading/colating vars for wID analysis, swathLFCasl and swathLFCagl, swathtopagl. - have spot checked new additions but not deeply tested things (have not rerun all cases with prior mat code yet)
% v8: switching from clear-air swath detection to full field swath detection with depth that is cut at the LFC. NOTE: MAKE ALL SWATH DEPTH ANALYSIS RELATIVE TO LFC HEIGHT!!!!
% v8_1: a bit more clear-air to full swath conversion, in processing code and figure codes, added wid-mesoWswath match up code
% v9: now adds in wID info that's in the new format that was developed for 100m grids
% v9c:  adds capability for lag-correlations by adding t-Xmin records of
% mesoscale swath and env metrics along the swath adjacent to each updraft
% prior to the current updraft time. 
% v9d: adds lin a little more diagnostics and info about dist-cell-to-swath
% and dist_wID_to_swath

%v10a - adds in Uboxes that go throughout the full period to tag to cells
%v10b - changed the JIM-sounding-based parameter set to the deeper
%        background ASL met
%v10c -- some work improving a few analysis and on my laptop while traveling (e.g., MORE consistently filtering wIDs > X dist from swath)
%v10d: added lasso_cell - TFCbox matchups for more upslope measurement vars

%v11: added probably important new var to swath properites for udprafts:
%"_mesoWalongsubupfract_". This will look at the projected span of the swath
%for each wID and determine the fraction of jpoints within it that have the
%w obj 

%v11b: Changed how serach area for wID swath vars are done. Formerly it
%      projected a shadow sized +/- 1 circ equiv radius from the centroid
%      of each wID onto the swath object and tagged the mean of each metrci
%      to the wid. Now, it looks over a wider +/- (radius * shadowbloat) or
%      fixed window
%      shadow area and finds the max/min. This is to compensate for the
%      possibility (liklihood?) that cloudy updraft might be offset in the N-S direction 
%      from the part of the swath through which cloud base tracjectories pass (e.g., when there is a net N'ly or S'ly flow in the area) 
%  also added max/min of several swath metrics

% v11c: does all methods from 11b instead of just 1 per code run. This is done as a new index added to the wid_swath paramters 

%v12b: changed named to match new swath detection code version (LFCceiling
%fixed, all ASL fields, ?) - run at a variety of w smoothings and wmag
%outermost contours. Now going to use the Sm0 swath metrics (previously sm2, except for swath cent lat/on, oops) because of raw w getting smoothed a lot by it, but w1p26/w2p16 barely being touched becaues they're already similarly smoothed.
% Also adding (after post processing, before analysis): cutting of wIDs outside of 2 new final
%swath dtection time limits: Also shirinking dist from swath cener to wID center to 3 km. 
% ALSO: 4Dec now only swath detects from 13-1730 UTC,
%and 25 Jan from 13-1630utc. NaN'ing WIDs and env's happening at the input
%stage for wIDs

%12c: added in along-swath smoothing of swath metrics that were once
%performed in the swath detection code that you run on NERSC, ut I am doing
%it here on the sm0 fields so you can control the aftermarket amount of
%smoothing. 

%13a - adds in convergence & moisture conv new vars from {LASSO_SWATHidthermobox_wswath_100m5min_TerrcutAsl_v13a_DATE.m}

%13b - adds QV swathbox aloft done just like RH, the wid hovmoller plot
%arrays now are filtered by distance from swath during their generation stage. 

%13c: during processing - culls wid prof arrays where you manually culled the swath and makes a mask f(j,t,r) of culled indices that you can reference later 

%13d: added alongsdc wDSD for cloudtopASL

%13e: added RH & Qv box style mesurements that are vertically achored to
%(+/-) LFC height (uses
%SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_v13c_d4*.mat, made by
%NERSC:/global/homes/j/jmarquis/ICLASS/LASSO_SWATHidthermobox_wswath_100m5min_TerrcutAsl_v13c*.m

%13f:  added in dz above terrain U meets certain criteria (from nersc: /global/cfs/projectdirs/m1657/jmarquis/LASSO/matlab/LASSO_boxFIELDSforCELLS_100m5min_v13c_t13mean_DATE.m)


clear all

%{
%load specific WID-mask example:
run = '/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/20190125_eda07_base__d4/widmasks/wID_ObjectOutput_NSj_100m5min_qcld0.0001_dbz10_tt034_154500_25Jan100m_20190125_eda07_base_les_subset_d4.mat';
load(run,'wIDprofs_2d_masks','Terr','Lat','Lon')
wmask_lat = Lat;   wmask_lon = Lon;      wmask_terr = Terr; 

load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/20190125_eda07_base__d4/SwathIDthermoOutput_100m_rhcamod_wID_qcldicesnow0.0001_dbz10_run_25Jan100m_20190125_eda07_base_les_subset_d4.mat','Conv_object','W_object')
J25_ex_convobj = Conv_object;
J25_ex_wobj    = W_object;
J25_ex_convobj = permute(J25_ex_convobj,[4 1 2 3]);
J25_ex_wobj    = permute(J25_ex_wobj,[4 1 2 3]);
size(J25_ex_wobj)
%}

%rootdir = '/Volumes/LaCie/LASSO_runs/cacti/lasso/les/';
rootdir =  '/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/';

imout = '/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/images/';
%'/Users/marq789/Documents/PROJECTS/Confs_Workshops_Meetings/2023confs/MESO';


%  load allprocessed3b_allcases_checkpoint.mat
%  load allprocessed3b_allcases_checkpointa.mat

% parameters for along-sdc smoothing of some read in swath metrics:
AlongSwath_Jsmooth_pass   = 1;    %number of passes. set to 0 if want no smoothing. up to 2 supported
AlongSwath_Jsmooth_window = 5;    %j-window size (grid points): 11 = 1 km @ dx=100m

Vadjusted_swath_window = 0 ;
%if 1, offset the cell's projection along the span of swath according to an estimated cloud-rel V (mean over a depth within the 'swathbox' subdomain)
%if 0, will just look at horizontal (along-lat) 'shadow" of the cell projected onto the swath to tag to each cell's swath metrics
%%%% after some playing, I'm not super fond of the =1 results.

dx_model = 100; % meters

distswathwid_thresh = 3.0 ;  % km max distance you'll allow a wid centroid to be from adjacent swath centroid


% RUNS = ['20181204/gefs18/base/d3/';
%         '20181205/gefs01/base/d3/';
%         '20181219/eda09/base/d3//';
%         '20190122/gefs01/base/d3/';
%         '20190123/eda07/morr/d3//';
%         '20190208/eda03/morr/d3//';
%         '20190125/eda07/morr/d3//'];

% RUNS = ['20181129_gefs09_base_d4';
%     '20190122_gefs18_base_d4';
%     '20190125_eda07_base__d4';
%     '20190129_gefs11_base_d4'];

RUNS = ['20181129_gefs09_base_d4';
        '20181204_gefs19_base_d4';
        '20190122_gefs18_base_d4';
        '20190123_gefs18_base_d4';
        '20190125_eda07_base__d4';
        '20190129_gefs11_base_d4';
        '20190208_eda08__base_d4'];

%RUNS = ['20190123_gefs18_base_d4'];

[ar br] = size( RUNS ) ;

%  ar = 1;

%%%  wID updraft stats dim info (from wID in LASSO analyses;  NOT FLXTRKR)
numwid  = 1200;  %taking a stab at max number of updrafts ID'ed per case
profdepth = 38;  %taking a stab at what I will want the updraft wID profile heights agl to be
alltimes  = 75;  %taking a stab at max num of times

%%%% swath stats dim info:
sdclength = 1600;  %this should be at least as long as the portion of the SDC swath you're looking at from the previous mat script.
alltimes = 75;   %this should be at least as long as the period of the simulations you are looking at.
%numcelltimes = 60;
boxz = 16;
aslz = 49;

%%% cell stats info  (from flextrkr)
maxsizes = 2000;  %this should be at least as long as the largest number of cells tracked in a case.
sdclength = 1600;  %this should be at least as long as the portion of the SDC swath you're looking at from the previous mat script.
alltimes = 75;   %this should be at least as long as the period of the simulations you are looking at.
numcelltimes = 200; %this should be at least as long as the number of cell times in stats file.
envtimes = 13;   %from Zhe's 3denv files for tracks

%Lat/Lon limits of the "SDC box" in which you will analyze CI related to the swath and calculate bulk env characteristics related to orographic forcing:
lonEast = -64.674;
lonWest = -64.982;
latNorth = -31.25;   %-31.501;
latSouth = -32.9;  %-32.806;

timelaglookback = 7 ;   %number of time indices in swath metrics to look back in time at each time for lasso-domain metrics

celltrack_hr = [12:5/60:24];

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% initiate vars we care about for all cases:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

HHMMSS_all_ALLCASES = char(zeros(alltimes,6,ar));

% % meso swath properties (kinematic & thermo) for portions of SDC without
% cells - mean along the whole SDC
mesoWwidth_nullmean_ALLCASES = zeros(alltimes,ar);          mesoWwidth_nullmean_ALLCASES(:) = NaN;
mesoWdepth_nullmean_ALLCASES = zeros(alltimes,ar);          mesoWdepth_nullmean_ALLCASES(:) = NaN;
mesoWstrength_nullmean_ALLCASES = zeros(alltimes,ar);       mesoWstrength_nullmean_ALLCASES(:) = NaN;
mesoWvmf_nullmean_ALLCASES = zeros(alltimes,ar);            mesoWvmf_nullmean_ALLCASES(:) = NaN;
mesoWqvap_nullmean_ALLCASES = zeros(alltimes,ar);           mesoWqvap_nullmean_ALLCASES(:) = NaN;
mesoWtheta_nullmean_ALLCASES = zeros(alltimes,ar);          mesoWtheta_nullmean_ALLCASES(:) = NaN;
mesoWthetae_nullmean_ALLCASES = zeros(alltimes,ar);         mesoWthetae_nullmean_ALLCASES(:) = NaN;

mesoCwidth_nullmean_ALLCASES = zeros(alltimes,ar);          mesoCwidth_nullmean_ALLCASES(:) = NaN;
mesoCdepth_nullmean_ALLCASES = zeros(alltimes,ar);          mesoCdepth_nullmean_ALLCASES(:) = NaN;
mesoCstrength_nullmean_ALLCASES = zeros(alltimes,ar);       mesoCstrength_nullmean_ALLCASES(:) = NaN;
mesoCMFCmean_nullmean_ALLCASES = zeros(alltimes,ar);        mesoCMFCmean_nullmean_ALLCASES(:) = NaN;
mesoCMCqadvmean_nullmean_ALLCASES = zeros(alltimes,ar);     mesoCMCqadvmean_nullmean_ALLCASES(:) = NaN;
mesoCMCqconvmean_nullmean_ALLCASES = zeros(alltimes,ar);    mesoCMCqconvmean_nullmean_ALLCASES(:) = NaN;
mesoCMFCmax_nullmean_ALLCASES = zeros(alltimes,ar);         mesoCMFCmax_nullmean_ALLCASES(:) = NaN;
mesoCMCqadvmax_nullmean_ALLCASES = zeros(alltimes,ar);      mesoCMCqadvmax_nullmean_ALLCASES(:) = NaN;
mesoCMCqconvmax_nullmean_ALLCASES = zeros(alltimes,ar);     mesoCMCqconvmax_nullmean_ALLCASES(:) = NaN;


%same but not the along-SDC mean of the null property (keeps the whole swath)
mesoWwidth_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);          mesoWwidth_nullfullsdc_ALLCASES(:) = NaN;
mesoWdepth_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);          mesoWdepth_nullfullsdc_ALLCASES(:) = NaN;
mesoWstrength_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);       mesoWstrength_nullfullsdc_ALLCASES(:) = NaN;
mesoWvmf_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);            mesoWvmf_nullfullsdc_ALLCASES(:) = NaN;
mesoWlfcagl_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);         mesoWlfcagl_nullfullsdc_ALLCASES(:) = NaN;
mesoWlfcasl_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);         mesoWlfcasl_nullfullsdc_ALLCASES(:) = NaN;
mesoWcape_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);           mesoWcape_nullfullsdc_ALLCASES(:) = NaN;
mesoWcin_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);            mesoWcin_nullfullsdc_ALLCASES(:) = NaN;
mesoWtopasl_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);         mesoWtopasl_nullfullsdc_ALLCASES(:) = NaN;
mesoWtopagl_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);         mesoWtopagl_nullfullsdc_ALLCASES(:) = NaN;
mesoWqvap_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);           mesoWqvap_nullfullsdc_ALLCASES(:) = NaN;
mesoWtheta_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);          mesoWtheta_nullfullsdc_ALLCASES(:) = NaN;
mesoWthetae_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);         mesoWthetae_nullfullsdc_ALLCASES(:) = NaN;
mesoWtoplfcasl_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);      mesoWtoplfcasl_nullfullsdc_ALLCASES(:) = NaN;
mesoWtoplfcagl_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);      mesoWtoplfcagl_nullfullsdc_ALLCASES(:) = NaN;

mesoCwidth_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);           mesoCwidth_nullfullsdc_ALLCASES(:) = NaN;
mesoCdepth_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);           mesoCdepth_nullfullsdc_ALLCASES(:) = NaN;
mesoCstrength_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);        mesoCstrength_nullfullsdc_ALLCASES(:) = NaN;
mesoCMFCmean_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);         mesoCMFCmean_nullfullsdc_ALLCASES(:) = NaN;
mesoCMCqadvmean_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);      mesoCMCqadvmean_nullfullsdc_ALLCASES(:) = NaN;
mesoCMCqconvmean_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);     mesoCMCqconvmean_nullfullsdc_ALLCASES(:) = NaN;
mesoCMFCmax_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);          mesoCMFCmax_nullfullsdc_ALLCASES(:) = NaN;
mesoCMCqadvmax_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);       mesoCMCqadvmax_nullfullsdc_ALLCASES(:) = NaN;
mesoCMCqconvmax_nullfullsdc_ALLCASES = zeros(sdclength,alltimes,ar);      mesoCMCqconvmax_nullfullsdc_ALLCASES(:) = NaN;

%%%%%%%%%% meso swath properties (kinematic & thermo & sounding metrics) for portions of SDC with cells
%%%% +4 is for later when you do 4 pre-CI times (hardcoded later to CI-15,-30-45-60min
prepost_timehr_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);             prepost_timehr_ALLCASES(:) = NaN;
prepost_timerelCI_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);          prepost_timerelCI_ALLCASES(:) = NaN;
prepost_mesoWwidth_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);         prepost_mesoWwidth_ALLCASES(:) = NaN;
prepost_mesoWdepth_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);         prepost_mesoWdepth_ALLCASES(:) = NaN;
prepost_mesoWstrength_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWstrength_ALLCASES(:) = NaN;
prepost_mesoWvmf_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);           prepost_mesoWvmf_ALLCASES(:) = NaN;
prepost_mesoWtopasl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_mesoWtopasl_ALLCASES(:) = NaN;
prepost_mesoWtopagl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_mesoWtopagl_ALLCASES(:) = NaN;
prepost_mesoWlfcagl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_mesoWlfcagl_ALLCASES(:) = NaN;
prepost_mesoWlfcasl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_mesoWlfcasl_ALLCASES(:) = NaN;
prepost_mesoWcape_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);          prepost_mesoWcape_ALLCASES(:) = NaN;
prepost_mesoWcin_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);           prepost_mesoWcin_ALLCASES(:) = NaN;
prepost_mesoWqvap_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);          prepost_mesoWqvap_ALLCASES(:) = NaN;
prepost_mesoWtheta_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);         prepost_mesoWtheta_ALLCASES(:) = NaN;
prepost_mesoWthetae_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_mesoWthetae_ALLCASES(:) = NaN;
prepost_mesoWtoplfcasl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);     prepost_mesoWtoplfcasl_ALLCASES(:) = NaN;
prepost_mesoWtoplfcagl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);     prepost_mesoWtoplfcagl_ALLCASES(:) = NaN;

prepost_mesoCwidth_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);         prepost_mesoCwidth_ALLCASES(:) = NaN;
prepost_mesoCdepth_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);         prepost_mesoCdepth_ALLCASES(:) = NaN;
prepost_mesoCstrength_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoCstrength_ALLCASES(:) = NaN;
prepost_mesoCMFCmean_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);       prepost_mesoCMFCmean_ALLCASES(:) = NaN;
prepost_mesoCMCqadvmean_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);    prepost_mesoCMCqadvmean_ALLCASES(:) = NaN;
prepost_mesoCMCqconvmean_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);   prepost_mesoCMCqconvmean_ALLCASES(:) = NaN;
prepost_mesoCMFCmax_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_mesoCMFCmax_ALLCASES(:) = NaN;
prepost_mesoCMCqadvmax_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);     prepost_mesoCMCqadvmax_ALLCASES(:) = NaN;
prepost_mesoCMCqconvmax_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);    prepost_mesoCMCqconvmax_ALLCASES(:) = NaN;

%new format for cells from 13-2000 utc
prepost_mesoWTFCbox_eastupslopedepth_ALLCASES               =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastupslopedepth_ALLCASES(:) = NaN;
%more upslope flow box vars
prepost_mesoWTFCbox_eastupslopemean_ALLCASES                =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastupslopemean_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_eastupslopedepthfract_ALLCASES          =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastupslopedepthfract_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_eastupslopetophtasl_ALLCASES            =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastupslopetophtasl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_eastupslopedepthfract2500masl_ALLCASES  =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastupslopedepthfract2500masl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_eastupslopemean2500masl_ALLCASES        =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastupslopemean2500masl_ALLCASES(:) = NaN; 
prepost_mesoWTFCbox_eastupslopedepthfract1500magl_ALLCASES  =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastupslopedepthfract1500magl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_eastupslopemean1500magl_ALLCASES        =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastupslopemean1500magl_ALLCASES(:) = NaN; 
prepost_mesoWTFCbox_eastUmean3to4kmasl_ALLCASES             =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastUmean3to4kmasl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_eastUmean4to5kmasl_ALLCASES             =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastUmean4to5kmasl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_eastUmean5to6kmasl_ALLCASES             =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_eastUmean5to6kmasl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_westupslopedepthfract_ALLCASES          =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_westupslopedepthfract_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_westupslopetophtasl_ALLCASES            =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_westupslopetophtasl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_westupslopedepthfract2500masl_ALLCASES  =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_westupslopedepthfract2500masl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_westupslopemean2500masl_ALLCASES        =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_westupslopemean2500masl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_westupslopedepthfract1500magl_ALLCASES  =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_westupslopedepthfract1500magl_ALLCASES(:) = NaN;
prepost_mesoWTFCbox_westupslopemean1500magl_ALLCASES        =  zeros(numcelltimes+4,maxsizes,ar);      prepost_mesoWTFCbox_westupslopemean1500magl_ALLCASES(:) = NaN;


% meso swath properties (kinematic & thermo % sounding) for NULL portions of SDC (local portion neighboring active cells )
prepost_localnull_mesoWwidth_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_localnull_mesoWwidth_ALLCASES(:) = NaN;
prepost_localnull_mesoWdepth_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_localnull_mesoWdepth_ALLCASES(:) = NaN;
prepost_localnull_mesoWstrength_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);     prepost_localnull_mesoWstrength_ALLCASES(:) = NaN;
prepost_localnull_mesoWvmf_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);          prepost_localnull_mesoWvmf_ALLCASES(:) = NaN;
prepost_localnull_mesoWlfcagl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);       prepost_localnull_mesoWlfcagl_ALLCASES(:) = NaN;
prepost_localnull_mesoWlfcasl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);       prepost_localnull_mesoWlfcasl_ALLCASES(:) = NaN;
prepost_localnull_mesoWcape_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);         prepost_localnull_mesoWcape_ALLCASES(:) = NaN;
prepost_localnull_mesoWcin_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);          prepost_localnull_mesoWcin_ALLCASES(:) = NaN;
prepost_localnull_mesoWtopasl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);       prepost_localnull_mesoWtopasl_ALLCASES(:) = NaN;
prepost_localnull_mesoWtopagl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);       prepost_localnull_mesoWtopagl_ALLCASES(:) = NaN;
prepost_localnull_mesoWqvap_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);         prepost_localnull_mesoWqvap_ALLCASES(:) = NaN;
prepost_localnull_mesoWtheta_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_localnull_mesoWtheta_ALLCASES(:) = NaN;
prepost_localnull_mesoWthetae_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);       prepost_localnull_mesoWthetae_ALLCASES(:) = NaN;
prepost_localnull_mesoWtoplfcasl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);    prepost_localnull_mesoWtoplfcasl_ALLCASES(:) = NaN;
prepost_localnull_mesoWtoplfcagl_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);    prepost_localnull_mesoWtoplfcagl_ALLCASES(:) = NaN;

prepost_localnull_mesoCwidth_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_localnull_mesoCwidth_ALLCASES(:) = NaN;
prepost_localnull_mesoCdepth_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_localnull_mesoCdepth_ALLCASES(:) = NaN;
prepost_localnull_mesoCstrength_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);     prepost_localnull_mesoCstrength_ALLCASES(:) = NaN;
prepost_localnull_mesoCMFCmean_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_localnull_mesoCMFCmean_ALLCASES(:) = NaN;
prepost_localnull_mesoCMCqadvmean_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);     prepost_localnull_mesoCMCqadvmean_ALLCASES(:) = NaN;
prepost_localnull_mesoCMCqconvmean_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);    prepost_localnull_mesoCMCqconvmean_ALLCASES(:) = NaN;
prepost_localnull_mesoCMFCmax_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);        prepost_localnull_mesoCMFCmax_ALLCASES(:) = NaN;
prepost_localnull_mesoCMCqadvmax_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);     prepost_localnull_mesoCMCqadvmax_ALLCASES(:) = NaN;
prepost_localnull_mesoCMCqconvmax_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);    prepost_localnull_mesoCMCqconvmax_ALLCASES(:) = NaN;


%new format for cells from 13-2000 utc
prepost_localnull_mesoWTFCbox_eastupslopedepth_ALLCASES = zeros(numcelltimes+4,maxsizes,ar);    prepost_localnull_mesoWTFCbox_eastupslopedepth_ALLCASES(:) = NaN;


% cell properties only during CI period:
cellkeeper_mask_ALLCASES = zeros(maxsizes,ar);              cellkeeper_mask_ALLCASES(:) = NaN;
cellCI_maxETH10_ALLCASES = zeros(maxsizes,ar);              cellCI_maxETH10_ALLCASES(:) = NaN;
cellCI_maxdbz_ALLCASES = zeros(maxsizes,ar);                cellCI_maxdbz_ALLCASES(:) = NaN;
cellCI_cellarea_ALLCASES = zeros(maxsizes,ar);              cellCI_cellarea_ALLCASES(:) = NaN;
cellCI_corearea_ALLCASES = zeros(maxsizes,ar);              cellCI_corearea_ALLCASES(:) = NaN;
cellCI_cell_motion_x_ALLCASES = zeros(maxsizes,ar);         cellCI_cell_motion_x_ALLCASES(:) = NaN;
cellCI_cell_motion_y_ALLCASES = zeros(maxsizes,ar);         cellCI_cell_motion_y_ALLCASES(:) = NaN;
% cell max properties only during CI period:
cellfull_maxETH10_ALLCASES = zeros(maxsizes,ar);             cellfull_maxETH10_ALLCASES(:) = NaN;
cellfull_maxdbz_ALLCASES   = zeros(maxsizes,ar);             cellfull_maxdbz_ALLCASES(:)   = NaN;
cellfull_cellarea_ALLCASES = zeros(maxsizes,ar);             cellfull_cellarea_ALLCASES(:) = NaN;
cellfull_corearea_ALLCASES = zeros(maxsizes,ar);             cellfull_corearea_ALLCASES(:) = NaN;
cellfull_duration_ALLCASES = zeros(maxsizes,ar);             cellfull_duration_ALLCASES(:) = NaN;

cellCI_meanlon_ALLCASES = zeros(maxsizes,ar);              cellCI_meanlon_ALLCASES(:) = NaN;
cellCI_meanlat_ALLCASES = zeros(maxsizes,ar);              cellCI_meanlat_ALLCASES(:) = NaN;
cellfull_endmergestatus_ALLCASES = zeros(maxsizes,ar);       cellfull_endmergestatus_ALLCASES(:) = NaN;
cellfull_startsplitstatus_ALLCASES = zeros(maxsizes,ar);     cellfull_startsplitstatus_ALLCASES(:) = NaN;

hour_cell_ALLCASES = zeros(numcelltimes,maxsizes,ar);       hour_cell_ALLCASES(:) = NaN;

%cell thermo (from Env params flextrkr)
preCIandCI_ucrel_acbl_ALLCASES = zeros(envtimes,maxsizes,ar);          preCIandCI_ucrel_acbl_ALLCASES(:) = NaN;
preCIandCI_rh_acbl_ALLCASES = zeros(envtimes,maxsizes,ar);             preCIandCI_rh_acbl_ALLCASES(:) = NaN;
preCIandCI_thetae_acbl_ALLCASES = zeros(envtimes,maxsizes,ar);         preCIandCI_thetae_acbl_ALLCASES(:) = NaN;
preCIandCI_cape_acbl_ALLCASES = zeros(envtimes,maxsizes,ar);           preCIandCI_cape_acbl_ALLCASES(:) = NaN;
preCIandCI_cape_deep_ALLCASES = zeros(envtimes,maxsizes,ar);           preCIandCI_cape_acbl_ALLCASES(:) = NaN;
preCIandCI_mucin_ALLCASES = zeros(envtimes,maxsizes,ar);               preCIandCI_mucin_ALLCASES(:) = NaN;
preCIandCI_shear03_ALLCASES = zeros(envtimes,maxsizes,ar);             preCIandCI_shear03_ALLCASES(:) = NaN;
preCIandCI_shear06_ALLCASES = zeros(envtimes,maxsizes,ar);             preCIandCI_shear06_ALLCASES(:) = NaN;
preCIandCI_shear09_ALLCASES = zeros(envtimes,maxsizes,ar);             preCIandCI_shear09_ALLCASES(:) = NaN;
preCIandCI_mulcl_ALLCASES = zeros(envtimes,maxsizes,ar);               preCIandCI_mulcl_ALLCASES(:) = NaN;
preCIandCI_mulfc_ALLCASES = zeros(envtimes,maxsizes,ar);               preCIandCI_mulfc_ALLCASES(:) = NaN;
preCIandCI_muel_ALLCASES = zeros(envtimes,maxsizes,ar);                preCIandCI_muel_ALLCASES(:) = NaN;
preCIandCI_ucrel_mu_ALLCASES = zeros(envtimes,maxsizes,ar);            preCIandCI_ucrel_mu_ALLCASES(:) = NaN;
preCIandCI_vcrel_mu_ALLCASES = zeros(envtimes,maxsizes,ar);            preCIandCI_vcrel_mu_ALLCASES(:) = NaN;
preCIandCI_upslopemax_ALLCASES = zeros(envtimes,maxsizes,ar);            preCIandCI_upslopemax_ALLCASES(:) = NaN;
preCIandCI_upslopemean_ALLCASES = zeros(envtimes,maxsizes,ar);            preCIandCI_upslopemean_ALLCASES(:) = NaN;
preCIandCI_upslopefract_ALLCASES = zeros(envtimes,maxsizes,ar);            preCIandCI_upslopefract_ALLCASES(:) = NaN;
preCIandCI_upslopedepth_ALLCASES = zeros(envtimes,maxsizes,ar);            preCIandCI_upslopedepth_ALLCASES(:) = NaN;



%  % meso swath properties in time (in swath y-t frame, not cell or null frame)
FullSDC_mesoWwidth_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_mesoWwidth_ALLCASES(:) = NaN;
FullSDC_mesoWdepth_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_mesoWdepth_ALLCASES(:) = NaN;
FullSDC_mesoWstrength_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_mesoWstrength_ALLCASES(:) = NaN;
FullSDC_VMfluxSum_ALLCASES = zeros(sdclength,alltimes,ar);          FullSDC_VMfluxSum_ALLCASES(:) = NaN;
FullSDC_swathmucin_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_swathmucin_ALLCASES(:) = NaN;
FullSDC_swathmucape_ALLCASES = zeros(sdclength,alltimes,ar);        FullSDC_swathmucape_ALLCASES(:) = NaN;
FullSDC_swathmulfcagl_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_swathmulfcagl_ALLCASES(:) = NaN;
FullSDC_swathmulfcasl_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_swathmulfcasl_ALLCASES(:) = NaN;
FullSDC_swathqvap_ALLCASES = zeros(sdclength,alltimes,ar);          FullSDC_swathqvap_ALLCASES(:) = NaN;
FullSDC_swathtopasl_ALLCASES = zeros(sdclength,alltimes,ar);        FullSDC_swathtopasl_ALLCASES(:) = NaN;
FullSDC_swathtopagl_ALLCASES = zeros(sdclength,alltimes,ar);        FullSDC_swathtopagl_ALLCASES(:) = NaN;
FullSDC_swathbotasl_ALLCASES = zeros(sdclength,alltimes,ar);        FullSDC_swathbotasl_ALLCASES(:) = NaN;
FullSDC_swathbotagl_ALLCASES = zeros(sdclength,alltimes,ar);        FullSDC_swathbotagl_ALLCASES(:) = NaN;
FullSDC_swathtoplfcasl_ALLCASES = zeros(sdclength,alltimes,ar);        FullSDC_swathtoplfcasl_ALLCASES(:) = NaN;
FullSDC_swathtoplfcagl_ALLCASES = zeros(sdclength,alltimes,ar);        FullSDC_swathtoplfcagl_ALLCASES(:) = NaN;
FullSDC_swaththetamean_ALLCASES = zeros(sdclength,alltimes,ar);        FullSDC_swaththetamean_ALLCASES(:) = NaN;
FullSDC_swaththetaemean_ALLCASES = zeros(sdclength,alltimes,ar);       FullSDC_swaththetaemean_ALLCASES(:) = NaN;

FullSDC_mesoCwidth_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_mesoCwidth_ALLCASES(:) = NaN;
FullSDC_mesoCdepth_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_mesoCdepth_ALLCASES(:) = NaN;
FullSDC_mesoCstrength_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_mesoCstrength_ALLCASES(:) = NaN;
FullSDC_mesoCMFCmean_ALLCASES = zeros(sdclength,alltimes,ar);       FullSDC_mesoCMFCmean_ALLCASES(:) = NaN;
FullSDC_mesoCMCqadvmean_ALLCASES = zeros(sdclength,alltimes,ar);    FullSDC_mesoCMCqadvmean_ALLCASES(:) = NaN;
FullSDC_mesoCMCqconvmean_ALLCASES = zeros(sdclength,alltimes,ar);   FullSDC_mesoCMCqconvmean_ALLCASES(:) = NaN;
FullSDC_mesoCMFCmax_ALLCASES = zeros(sdclength,alltimes,ar);        FullSDC_mesoCMFCmax_ALLCASES(:) = NaN;
FullSDC_mesoCMCqadvmax_ALLCASES = zeros(sdclength,alltimes,ar);     FullSDC_mesoCMCqadvmax_ALLCASES(:) = NaN;
FullSDC_mesoCMCqconvmax_ALLCASES = zeros(sdclength,alltimes,ar);    FullSDC_mesoCMCqconvmax_ALLCASES(:) = NaN;


%%%%%%%%%%%%%%%%%%%%%
%%%  updraft stats (in-cell from flextrkr)
%%%%%%%%%%%%%%%%%%%%%
updraftbaseZ_ALLCASES = zeros(numcelltimes,maxsizes,ar);                   updraftbaseZ_ALLCASES(:) = NaN;
% tabulated in lowest 1 km of part of cells with cores detected:
totalwarea_cldbase_ALLCASES = zeros(numcelltimes,maxsizes,ar);             totalwarea_cldbase_ALLCASES(:) = NaN;
maxwarea_cldbase_ALLCASES = zeros(numcelltimes,maxsizes,ar);               maxwarea_cldbase_ALLCASES(:) = NaN;
maxw_cldbase_ALLCASES = zeros(numcelltimes,maxsizes,ar);                   maxw_cldbase_ALLCASES(:) = NaN;
maxnumwcores_cldbase_ALLCASES = zeros(numcelltimes,maxsizes,ar);           maxnumwcores_cldbase_ALLCASES(:) = NaN;
% tabulated throughout cell depth:
totalwarea_fullcld_ALLCASES = zeros(numcelltimes,maxsizes,ar);             totalwarea_fullcld_ALLCASES(:) = NaN;
maxwarea_fullcld_ALLCASES = zeros(numcelltimes,maxsizes,ar);               maxwarea_fullcld_ALLCASES(:) = NaN;
maxw_fullcld_ALLCASES = zeros(numcelltimes,maxsizes,ar);                   maxw_fullcld_ALLCASES(:) = NaN;
maxnumwcores_fullcld_ALLCASES = zeros(numcelltimes,maxsizes,ar);           maxnumwcores_fullcld_ALLCASES(:) = NaN;


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% NEW_FORMAT_TRANSPLANTS (Feb 2024)
%
% % swathbox properties
%swathboxaloft_RH_ALLCASES = zeros(sdclength,83,alltimes,ar);   swathboxaloft_RH_ALLCASES(:) = NaN;
FullSDC_swathboxaloftRH_ALLCASES = zeros(sdclength,boxz,alltimes,ar);         FullSDC_swathboxaloftRH_ALLCASES(:) = NaN;
FullSDC_swathboxaloftQV_ALLCASES = zeros(sdclength,boxz,alltimes,ar);         FullSDC_swathboxaloftQV_ALLCASES(:) = NaN;
FullSDC_swathboxaloftRHlfcrel_ALLCASES = zeros(sdclength,aslz,alltimes,ar);         FullSDC_swathboxaloftRHlfcrel_ALLCASES(:) = NaN;
FullSDC_swathboxaloftQVlfcrel_ALLCASES = zeros(sdclength,aslz,alltimes,ar);         FullSDC_swathboxaloftQVlfcrel_ALLCASES(:) = NaN;
FullSDC_eastU_ALLCASES = zeros(sdclength,aslz,alltimes,ar);         FullSDC_eastU_ALLCASES(:) = NaN;
FullSDC_eastV_ALLCASES = zeros(sdclength,aslz,alltimes,ar);         FullSDC_eastV_ALLCASES(:) = NaN;
FullSDC_westU_ALLCASES = zeros(sdclength,aslz,alltimes,ar);         FullSDC_westU_ALLCASES(:) = NaN;
FullSDC_westV_ALLCASES = zeros(sdclength,aslz,alltimes,ar);         FullSDC_westV_ALLCASES(:) = NaN;
FullSDC_eastV1to5kmasl_bulkshear_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastV1to5kmasl_bulkshear_ALLCASES(:) = NaN;
FullSDC_eastU1to5kmasl_bulkshear_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastU1to5kmasl_bulkshear_ALLCASES(:) = NaN;
FullSDC_eastV1to9kmasl_bulkshear_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastV1to9kmasl_bulkshear_ALLCASES(:) = NaN;
FullSDC_eastU1to9kmasl_bulkshear_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastU1to9kmasl_bulkshear_ALLCASES(:) = NaN;
FullSDC_eastupslopedepthfract_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastupslopedepthfract_ALLCASES(:) = NaN;
FullSDC_westupslopedepthfract_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_westupslopedepthfract_ALLCASES(:) = NaN;
FullSDC_eastupslopedepthfract2500masl_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastupslopedepthfract2500masl_ALLCASES(:) = NaN;
FullSDC_westupslopedepthfract2500masl_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_westupslopedepthfract2500masl_ALLCASES(:) = NaN;
FullSDC_eastupslopemean2500masl_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastupslopemean2500masl_ALLCASES(:) = NaN;
FullSDC_westupslopemean2500masl_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_westupslopemean2500masl_ALLCASES(:) = NaN;
FullSDC_eastupslopemean_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastupslopemean_ALLCASES(:) = NaN;
FullSDC_westupslopemean_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_westupslopemean_ALLCASES(:) = NaN;
FullSDC_swathcentlat_ALLCASES = zeros(sdclength,alltimes,ar);            FullSDC_swathcentlat_ALLCASES(:) = NaN;
FullSDC_swathcentlon_ALLCASES = zeros(sdclength,alltimes,ar);            FullSDC_swathcentlon_ALLCASES(:) = NaN;
FullSDC_eastUmean3to4kmasl_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_eastUmean3to4kmasl_ALLCASES(:) = NaN;
FullSDC_eastUmean4to5kmasl_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_eastUmean4to5kmasl_ALLCASES(:) = NaN;
FullSDC_eastUmean5to6kmasl_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_eastUmean5to6kmasl_ALLCASES(:) = NaN;

FullSDC_eastupslopetophtasl_ALLCASES = zeros(sdclength,alltimes,ar);     FullSDC_eastupslopetophtasl_ALLCASES(:) = NaN;
FullSDC_westupslopetophtasl_ALLCASES = zeros(sdclength,alltimes,ar);     FullSDC_westupslopetophtasl_ALLCASES(:) = NaN;
FullSDC_eastupslopedepth_ALLCASES = zeros(sdclength,alltimes,ar);     FullSDC_eastupslopedepth_ALLCASES(:) = NaN;
FullSDC_westupslopedepth_ALLCASES = zeros(sdclength,alltimes,ar);     FullSDC_westupslopedepth_ALLCASES(:) = NaN;

FullSDC_eastupslopedepthfract1500magl_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastupslopedepthfract1500magl_ALLCASES(:) = NaN;
FullSDC_westupslopedepthfract1500magl_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_westupslopedepthfract1500magl_ALLCASES(:) = NaN;
FullSDC_eastupslopemean1500magl_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_eastupslopemean1500magl_ALLCASES(:) = NaN;
FullSDC_westupslopemean1500magl_ALLCASES = zeros(sdclength,alltimes,ar);         FullSDC_westupslopemean1500magl_ALLCASES(:) = NaN;

FullSDC_upeakDZ5_eastU_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_upeakDZ5_eastU_ALLCASES(:) =  NaN; 
FullSDC_upeakZ5_eastU_ALLCASES = zeros(sdclength,alltimes,ar);       FullSDC_upeakZ5_eastU_ALLCASES(:) =  NaN; 
FullSDC_upeakDZ8_eastU_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_upeakDZ8_eastU_ALLCASES(:) =  NaN; 
FullSDC_upeakZ8_eastU_ALLCASES = zeros(sdclength,alltimes,ar);       FullSDC_upeakZ8_eastU_ALLCASES(:) =  NaN; 
FullSDC_upeakDZ10_eastU_ALLCASES = zeros(sdclength,alltimes,ar);     FullSDC_upeakDZ10_eastU_ALLCASES(:) =  NaN; 
FullSDC_upeakZ10_eastU_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_upeakZ10_eastU_ALLCASES(:) =  NaN; 
FullSDC_upeakDZ15_eastU_ALLCASES = zeros(sdclength,alltimes,ar);     FullSDC_upeakDZ15_eastU_ALLCASES(:) =  NaN; 
FullSDC_upeakZ15_eastU_ALLCASES = zeros(sdclength,alltimes,ar);      FullSDC_upeakZ15_eastU_ALLCASES(:) =  NaN; 



%new input var/format as of 13Sep2024:  the new U/V SDC terrain-following cell boxes used for
%linking upslope vars to cells
CELLTIMES20 = 85;  %this ranges from 13-20 UTC, prescribed by predecessor codes.
FullSDC_TFCbox_eastupslopedepth_ALLCASES = zeros(sdclength,CELLTIMES20,ar);     FullSDC_TFCbox_eastupslopedepth_ALLCASES(:) = NaN;
FullSDC_TFCbox_westupslopedepth_ALLCASES = zeros(sdclength,CELLTIMES20,ar);     FullSDC_TFCbox_westupslopedepth_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastupslopemean_ALLCASES = zeros(sdclength,CELLTIMES20,ar);      FullSDC_TFCbox_eastupslopemean_ALLCASES(:) = NaN;
FullSDC_TFCbox_westupslopemean_ALLCASES = zeros(sdclength,CELLTIMES20,ar);      FullSDC_TFCbox_westupslopemean_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastU_ALLCASES = zeros(sdclength,aslz,CELLTIMES20,ar);           FullSDC_TFCbox_eastU_ALLCASES(:) =  NaN; 
FullSDC_TFCbox_westU_ALLCASES = zeros(sdclength,aslz,CELLTIMES20,ar);           FullSDC_TFCbox_westU_ALLCASES(:) =  NaN;  

FullSDC_TFCbox_eastupslopedepthfract_ALLCASES = zeros(sdclength,CELLTIMES20,ar);               FullSDC_TFCbox_eastupslopedepthfract_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastupslopedepthfract2500masl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);       FullSDC_TFCbox_eastupslopedepthfract2500masl_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastupslopemean2500masl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);             FullSDC_TFCbox_eastupslopemean2500masl_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);                  FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);                  FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastUmean5to6kmasl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);                  FullSDC_TFCbox_eastUmean5to6kmasl_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastupslopetophtasl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);                 FullSDC_TFCbox_eastupslopetophtasl_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastupslopedepthfract1500magl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);       FullSDC_TFCbox_eastupslopedepthfract1500magl_ALLCASES(:) = NaN;
FullSDC_TFCbox_eastupslopemean1500magl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);             FullSDC_TFCbox_eastupslopemean1500magl_ALLCASES(:) = NaN;
FullSDC_TFCbox_westupslopedepthfract_ALLCASES = zeros(sdclength,CELLTIMES20,ar);               FullSDC_TFCbox_westupslopedepthfract_ALLCASES(:) = NaN;
FullSDC_TFCbox_westupslopedepthfract2500masl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);       FullSDC_TFCbox_westupslopedepthfract2500masl_ALLCASES(:) = NaN;
FullSDC_TFCbox_westupslopemean2500masl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);             FullSDC_TFCbox_westupslopemean2500masl_ALLCASES(:) = NaN;
FullSDC_TFCbox_westupslopetophtasl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);                 FullSDC_TFCbox_westupslopetophtasl_ALLCASES(:) = NaN;
FullSDC_TFCbox_westupslopedepthfract1500magl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);       FullSDC_TFCbox_westupslopedepthfract1500magl_ALLCASES(:) = NaN;
FullSDC_TFCbox_westupslopemean1500magl_ALLCASES = zeros(sdclength,CELLTIMES20,ar);             FullSDC_TFCbox_westupslopemean1500magl_ALLCASES(:) = NaN;



% %%%%%%%%%%%%%%%%%%%%%
% %%%  wID updraft stats (from wID in LASSO analyses;  NOT FLXTRKR)
% %%%%%%%%%%%%%%%%%%%%%
%wID input stats
wid_profs_area_ALLCASES = zeros(numwid,profdepth,alltimes,ar);             wid_profs_area_ALLCASES(:) = NaN;
wid_profs_maxmag_ALLCASES = zeros(numwid,profdepth,alltimes,ar);           wid_profs_maxmag_ALLCASES(:) = NaN;
wid_profs_massflux_ALLCASES = zeros(numwid,profdepth,alltimes,ar);         wid_profs_massflux_ALLCASES(:) = NaN;
wid_profs_centlat_ALLCASES = zeros(numwid,profdepth,alltimes,ar);          wid_profs_centlat_ALLCASES(:) = NaN;
wid_profs_centlon_ALLCASES = zeros(numwid,profdepth,alltimes,ar);          wid_profs_centlon_ALLCASES(:) = NaN;
wid_profs_centHTagl_ALLCASES = zeros(numwid,profdepth,alltimes,ar);        wid_profs_centHTagl_ALLCASES(:) = NaN;
wid_profs_centHTasl_ALLCASES = zeros(numwid,profdepth,alltimes,ar);        wid_profs_centHTasl_ALLCASES(:) = NaN;
wid_profs_klfcagl_ALLCASES = zeros(numwid,alltimes,ar);                    wid_profs_klfcagl_ALLCASES(:) = NaN;
wid_profs_numij_ALLCASES = zeros(numwid,profdepth,alltimes,ar);            wid_profs_numij_ALLCASES(:) = NaN;
wid_profs_northj_ALLCASES = zeros(numwid,profdepth,alltimes,ar);           wid_profs_northj_ALLCASES(:) = NaN;
wid_profs_southj_ALLCASES = zeros(numwid,profdepth,alltimes,ar);           wid_profs_southj_ALLCASES(:) = NaN;


% %after market analyses: swath values corresponding to wid projected on it
% wid_mesoWstrength_ALLCASES = zeros(numwid,alltimes,ar);             wid_mesoWstrength_ALLCASES(:) = NaN;
% wid_mesoWvmsum_ALLCASES = zeros(numwid,alltimes,ar);                wid_mesoWvmsum_ALLCASES(:) = NaN;
% wid_mesoWwidth_ALLCASES = zeros(numwid,alltimes,ar);                wid_mesoWwidth_ALLCASES(:) = NaN;
% wid_mesoWtopagl_ALLCASES = zeros(numwid,alltimes,ar);               wid_mesoWtopagl_ALLCASES(:) = NaN;
% wid_mesoWtopasl_ALLCASES = zeros(numwid,alltimes,ar);               wid_mesoWtopasl_ALLCASES(:) = NaN;
% wid_mesoWcape_ALLCASES = zeros(numwid,alltimes,ar);                 wid_mesoWcape_ALLCASES(:) = NaN;
% wid_mesoWcin_ALLCASES = zeros(numwid,alltimes,ar);                  wid_mesoWcin_ALLCASES(:) = NaN;
% wid_mesoWqvap_ALLCASES = zeros(numwid,alltimes,ar);                 wid_mesoWqvap_ALLCASES(:) = NaN;
% wid_mesoWlfcasl_ALLCASES = zeros(numwid,alltimes,ar);               wid_mesoWlfcasl_ALLCASES(:) = NaN;
% wid_mesoWlfcagl_ALLCASES = zeros(numwid,alltimes,ar);               wid_mesoWlfcagl_ALLCASES(:) = NaN;
% wid_mesoWtheta_ALLCASES = zeros(numwid,alltimes,ar);                wid_mesoWtheta_ALLCASES(:) = NaN;
% wid_mesoWthetae_ALLCASES = zeros(numwid,alltimes,ar);               wid_mesoWthetae_ALLCASES(:) = NaN;
% wid_mesoWdepth_ALLCASES = zeros(numwid,alltimes,ar);                wid_mesoWdepth_ALLCASES(:) = NaN;

%after market lasso domaoin analyses: swath values corresponding to wid projected on it, with prior corresponding times withTIMELAG

nummatchmethods = 3;
methrad_log = zeros(numwid,alltimes,ar,nummatchmethods+1);       methrad_log(:) = NaN;  % +1 in last index so I can stare a raw cloud radius for comparison

wid_mesoWstrength_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);             wid_mesoWstrength_ALLCASES(:) = NaN;
wid_mesoWvmsum_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                wid_mesoWvmsum_ALLCASES(:) = NaN;
wid_mesoWvmsumHSUM_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);            wid_mesoWvmsumHSUM_ALLCASES(:) = NaN;
wid_mesoWalongsubupfract_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);      wid_mesoWalongsubupfract_ALLCASES(:) = NaN;
wid_mesoWwidth_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                wid_mesoWwidth_ALLCASES(:) = NaN;
wid_mesoWtopagl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);               wid_mesoWtopagl_ALLCASES(:) = NaN;
wid_mesoWtopasl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);               wid_mesoWtopasl_ALLCASES(:) = NaN;
wid_mesoWcape_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                 wid_mesoWcape_ALLCASES(:) = NaN;
wid_mesoWcin_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                  wid_mesoWcin_ALLCASES(:) = NaN;
wid_mesoWqvap_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                 wid_mesoWqvap_ALLCASES(:) = NaN;
wid_mesoWlfcasl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);               wid_mesoWlfcasl_ALLCASES(:) = NaN;
wid_mesoWlfcagl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);               wid_mesoWlfcagl_ALLCASES(:) = NaN;
wid_mesoWtheta_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                wid_mesoWtheta_ALLCASES(:) = NaN;
wid_mesoWthetae_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);               wid_mesoWthetae_ALLCASES(:) = NaN;
wid_mesoWdepth_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                wid_mesoWdepth_ALLCASES(:) = NaN;
wid_mesoWtoplfcaglRAT_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);         wid_mesoWtoplfcaglRAT_ALLCASES(:) = NaN;
wid_mesoWtoplfcaslRAT_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);         wid_mesoWtoplfcaslRAT_ALLCASES(:) = NaN;

wid_mesoWstrengthMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);          wid_mesoWstrengthMAX_ALLCASES(:) = NaN;
wid_mesoWwidthMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);             wid_mesoWwidthMAX_ALLCASES(:) = NaN;
wid_mesoWtopaglMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);            wid_mesoWtopaglMAX_ALLCASES(:) = NaN;
wid_mesoWtopaslMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);            wid_mesoWtopaslMAX_ALLCASES(:) = NaN;
wid_mesoWcapeMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);              wid_mesoWcapeMAX_ALLCASES(:) = NaN;
wid_mesoWcinMIN_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);               wid_mesoWcinMIN_ALLCASES(:) = NaN;
wid_mesoWqvapMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);              wid_mesoWqvapMAX_ALLCASES(:) = NaN;
wid_mesoWlfcaslMIN_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);            wid_mesoWlfcaslMIN_ALLCASES(:) = NaN;
wid_mesoWlfcaglMIN_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);            wid_mesoWlfcaglMIN_ALLCASES(:) = NaN;
wid_mesoWthetaMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);             wid_mesoWthetaMAX_ALLCASES(:) = NaN;
wid_mesoWthetaeMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);            wid_mesoWthetaeMAX_ALLCASES(:) = NaN;
wid_mesoWdepthMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);             wid_mesoWdepthMAX_ALLCASES(:) = NaN;
wid_mesoWvmsumMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);             wid_mesoWvmsumMAX_ALLCASES(:) = NaN;
wid_mesoWtoplfcaglRATMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);      wid_mesoWtoplfcaglRATMAX_ALLCASES(:) = NaN;
wid_mesoWtoplfcaslRATMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);      wid_mesoWtoplfcaslRATMAX_ALLCASES(:) = NaN;

wid_mesoCstrength_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);             wid_mesoCstrength_ALLCASES(:) = NaN;
wid_mesoCwidth_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                wid_mesoCwidth_ALLCASES(:) = NaN;
wid_mesoCdepth_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                wid_mesoCdepth_ALLCASES(:) = NaN;
wid_mesoCMFCmean_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);              wid_mesoCMFCmean_ALLCASES(:) = NaN;
wid_mesoCMCqadvmean_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_mesoCMCqadvmean_ALLCASES(:) = NaN;
wid_mesoCMCqconvmean_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);          wid_mesoCMCqconvmean_ALLCASES(:) = NaN;
wid_mesoCMFCmax_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);               wid_mesoCMFCmax_ALLCASES(:) = NaN;
wid_mesoCMCqadvmax_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);            wid_mesoCMCqadvmax_ALLCASES(:) = NaN;
wid_mesoCMCqconvmax_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_mesoCMCqconvmax_ALLCASES(:) = NaN;

wid_mesoCstrengthMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);             wid_mesoCstrengthMAX_ALLCASES(:) = NaN;
wid_mesoCwidthMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                wid_mesoCwidthMAX_ALLCASES(:) = NaN;
wid_mesoCdepthMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);                wid_mesoCdepthMAX_ALLCASES(:) = NaN;
wid_mesoCMFCmeanMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);              wid_mesoCMFCmeanMAX_ALLCASES(:) = NaN;
wid_mesoCMCqadvmeanMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_mesoCMCqadvmeanMAX_ALLCASES(:) = NaN;
wid_mesoCMCqconvmeanMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);          wid_mesoCMCqconvmeanMAX_ALLCASES(:) = NaN;
wid_mesoCMFCmaxMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);               wid_mesoCMFCmaxMAX_ALLCASES(:) = NaN;
wid_mesoCMCqadvmaxMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);            wid_mesoCMCqadvmaxMAX_ALLCASES(:) = NaN;
wid_mesoCMCqconvmaxMAX_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_mesoCMCqconvmaxMAX_ALLCASES(:) = NaN;


wid_mesoWeast1to5aslUshear_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);    wid_mesoWeast1to5aslUshear_ALLCASES(:) = NaN;
wid_mesoWeast1to5aslVshear_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);    wid_mesoWeast1to5aslVshear_ALLCASES(:) = NaN;
wid_mesoWeast1to9aslUshear_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);    wid_mesoWeast1to9aslUshear_ALLCASES(:) = NaN;
wid_mesoWeast1to9aslVshear_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);    wid_mesoWeast1to9aslVshear_ALLCASES(:) = NaN;
wid_eastupslopedepthfract_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);     wid_eastupslopedepthfract_ALLCASES(:) = NaN;
wid_westupslopedepthfract_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);     wid_westupslopedepthfract_ALLCASES(:) = NaN;
wid_eastupslopedepthfract2500masl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);     wid_eastupslopedepthfract2500masl_ALLCASES(:) = NaN;
wid_westupslopedepthfract2500masl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);     wid_westupslopedepthfract2500masl_ALLCASES(:) = NaN;
wid_eastupslopemean2500masl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_eastupslopemean2500masl_ALLCASES(:) = NaN;
wid_westupslopemean2500masl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_westupslopemean2500masl_ALLCASES(:) = NaN;
wid_eastupslopedepthfract1500magl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);     wid_eastupslopedepthfract1500magl_ALLCASES(:) = NaN;
wid_westupslopedepthfract1500magl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);     wid_westupslopedepthfract1500magl_ALLCASES(:) = NaN;
wid_eastupslopemean1500magl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_eastupslopemean1500magl_ALLCASES(:) = NaN;
wid_westupslopemean1500magl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_westupslopemean1500magl_ALLCASES(:) = NaN;
wid_eastupslopemean_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_eastupslopemean_ALLCASES(:) = NaN;
wid_westupslopemean_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_westupslopemean_ALLCASES(:) = NaN;
wid_eastUmean3to4kmasl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_eastUmean3to4kmasl_ALLCASES(:) = NaN;
wid_eastUmean4to5kmasl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_eastUmean4to5kmasl_ALLCASES(:) = NaN;
wid_eastUmean5to6kmasl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);           wid_eastUmean5to6kmasl_ALLCASES(:) = NaN;
wid_eastupslopedepth_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);        wid_eastupslopedepth_ALLCASES(:) = NaN;
wid_westupslopedepth_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);        wid_westupslopedepth_ALLCASES(:) = NaN;
wid_eastupslopetophtasl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);        wid_eastupslopetophtasl_ALLCASES(:) = NaN;
wid_westupslopetophtasl_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);        wid_westupslopetophtasl_ALLCASES(:) = NaN;
wid_mesoWmeanRHboxaloft_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);       wid_mesoWmeanRHboxaloft_ALLCASES(:) = NaN;
wid_mesoWmeanQVboxaloft_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);       wid_mesoWmeanQVboxaloft_ALLCASES(:) = NaN;
wid_mesoWmeanRHboxaloftlfcrel_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);       wid_mesoWmeanRHboxaloftlfcrel_ALLCASES(:) = NaN;
wid_mesoWmeanQVboxaloftlfcrel_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);       wid_mesoWmeanQVboxaloftlfcrel_ALLCASES(:) = NaN;
wid_meanUprof_ALLCASES = zeros(numwid,aslz,alltimes,timelaglookback,ar,nummatchmethods);            wid_meanUprof_ALLCASES(:) = NaN;
wid_meanVprof_ALLCASES = zeros(numwid,aslz,alltimes,timelaglookback,ar,nummatchmethods);            wid_meanVprof_ALLCASES(:) = NaN;
wid_mesoWdepthrat_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar,nummatchmethods);             wid_mesoWdepthrat_ALLCASES(:) = NaN;
% wid_bulkUshearinupdraft_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar);       wid_bulkUshearinupdraft_ALLCASES(:) = NaN;
% wid_bulkVshearinupdraft_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar);       wid_bulkVshearinupdraft_ALLCASES(:) = NaN;

dist_wid_and_swath_ALLCASES = zeros(numwid,alltimes,timelaglookback,ar);                     dist_wid_and_swath_ALLCASES(:) = NaN;


%%%%%  other sounding parameters calcualted for each wID with my sounding code - currently looking back in time 15 min:
FwID_MUCAPE_ALLCASES = zeros(numwid,alltimes,ar);                       FwID_MUCAPE_ALLCASES(:) = NaN;
FwID_MUCIN_ALLCASES = zeros(numwid,alltimes,ar);                        FwID_MUCIN_ALLCASES(:) = NaN;
FwID_MULFC_ALLCASES = zeros(numwid,alltimes,ar);                        FwID_MULFC_ALLCASES(:) = NaN;
FwID_MULCL_ALLCASES = zeros(numwid,alltimes,ar);                        FwID_MULCL_ALLCASES(:) = NaN;
FwID_MUEL_ALLCASES = zeros(numwid,alltimes,ar);                         FwID_MUEL_ALLCASES(:) = NaN;
FwID_MUvap_ALLCASES = zeros(numwid,alltimes,ar);                        FwID_MUvap_ALLCASES(:) = NaN;
FwID_MUtheta_ALLCASES = zeros(numwid,alltimes,ar);                      FwID_MUtheta_ALLCASES(:) = NaN;
FwID_MUthetae_ALLCASES = zeros(numwid,alltimes,ar);                     FwID_MUthetae_ALLCASES(:) = NaN;
FwID_MUACBLCAPE_ALLCASES = zeros(numwid,alltimes,ar);                   FwID_MUACBLCAPE_ALLCASES(:) = NaN;
FwID_RH_mean_ACBL_ALLCASES = zeros(numwid,alltimes,ar);                 FwID_RH_mean_ACBL_ALLCASES(:) = NaN;
FwID_RH_500mb_ALLCASES = zeros(numwid,alltimes,ar);                     FwID_RH_500mb_ALLCASES(:) = NaN;
FwID_RH_600mb_ALLCASES = zeros(numwid,alltimes,ar);                     FwID_RH_600mb_ALLCASES(:) = NaN;
FwID_RH_5kmasl_ALLCASES = zeros(numwid,alltimes,ar);                    FwID_RH_5kmasl_ALLCASES(:) = NaN;
FwID_RH_6kmasl_ALLCASES = zeros(numwid,alltimes,ar);                    FwID_RH_6kmasl_ALLCASES(:) = NaN;
FwID_thetae_mean_ACBL_mu_ALLCASES = zeros(numwid,alltimes,ar);          FwID_thetae_mean_ACBL_mu_ALLCASES(:) = NaN;
FwID_shear_mag_bulk_FT_mu_ALLCASES = zeros(numwid,alltimes,ar);         FwID_shear_mag_bulk_FT_mu_ALLCASES(:) = NaN;
FwID_shear_mag_bulk_ACBL_mu_ALLCASES = zeros(numwid,alltimes,ar);       FwID_shear_mag_bulk_ACBL_mu_ALLCASES(:) = NaN;
FwID_shear_mag_bulk_0to1km_ALLCASES = zeros(numwid,alltimes,ar);        FwID_shear_mag_bulk_0to1km_ALLCASES(:) = NaN;
FwID_shear_mag_bulk_0to3km_ALLCASES = zeros(numwid,alltimes,ar);        FwID_shear_mag_bulk_0to3km_ALLCASES(:) = NaN;
FwID_shear_mag_bulk_0to6km_ALLCASES = zeros(numwid,alltimes,ar);        FwID_shear_mag_bulk_0to6km_ALLCASES(:) = NaN;
FwID_shear_mag_bulk_0to9km_ALLCASES = zeros(numwid,alltimes,ar);        FwID_shear_mag_bulk_0to9km_ALLCASES(:) = NaN;
FwID_upslope_mean_ALLCASES = zeros(numwid,alltimes,ar);                 FwID_upslope_mean_ALLCASES(:) = NaN;
FwID_upslope_max_ALLCASES = zeros(numwid,alltimes,ar);                  FwID_upslope_max_ALLCASES(:) = NaN;
FwID_upslope_depth_ALLCASES = zeros(numwid,alltimes,ar);                FwID_upslope_depth_ALLCASES(:) = NaN;
FwID_upslope_fract_ALLCASES = zeros(numwid,alltimes,ar);                FwID_upslope_fract_ALLCASES(:) = NaN;



%%%% this tracks as f(j,t,r) where you manually killed the swath
%%%% measurements in the LASSO_SWATHidthermobox_wswath_100m5min_TerrcutAsl_v13+....m 
ManSwathCull_keptMask = zeros(sdclength,alltimes,ar);  ManSwathCull_keptMask(:) = 1;  % zero where you manually killed, 1 for the lats you keep


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%
%%%%    loop thru R to load wID stats and swath stats
%%%%
%%%%   loop thru wIDs at each LASSO time, then look upstream at the
%%%%   swath to log a swath property for each updraft
%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% ar = 1;


%%%%%%%%%%%%%%%%%%%%
maxtime_ALLCASES = [];
maxwid_ALLCASES = [];

for R = 1 : ar


    %     R = 1 ;

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %load/catalog wID stats:
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


    %made with .../ICLASS/LASSO_stuff/WID_andEnvparams_appendouts.m
    %wID_file = ['wID_merged_deepmetB_',RUNS(R,:),'.mat'];

    %NOTE !!!!!  THERE's ANOTHER REFERENCE TO LOADING THIS FILE ABOUT 3000 lines
    %down from here. 
    wID_file = ['wID_merged_deepmetB3R_newtimes_',RUNS(R,:),'.mat'];  
    load([rootdir,'/', RUNS(R,:) ,'/',wID_file]);

    [aa bb cc]  = size(FwIDprofs_centlat);

    maxtime_ALLCASES =   vertcat(maxtime_ALLCASES,cc)  ;
    maxwid_ALLCASES  =   vertcat(maxwid_ALLCASES,aa)  ;

    wid_profs_area_ALLCASES(1:aa,1:bb,1:cc,R)      = FwIDprofs_equivarea;
    wid_profs_maxmag_ALLCASES(1:aa,1:bb,1:cc,R)    = FwIDprofs_maxmag;
    wid_profs_massflux_ALLCASES(1:aa,1:bb,1:cc,R)  = FwIDprofs_massflux;
    wid_profs_centlat_ALLCASES(1:aa,1:bb,1:cc,R)   = FwIDprofs_centlat;
    wid_profs_centlon_ALLCASES(1:aa,1:bb,1:cc,R)   = FwIDprofs_centlon;
    wid_profs_centHTagl_ALLCASES(1:aa,1:bb,1:cc,R) = FwIDprofs_centHTagl;
    wid_profs_centHTasl_ALLCASES(1:aa,1:bb,1:cc,R) = FwIDprofs_centHTasl;
    wid_profs_klfcagl_ALLCASES(1:aa,1:cc,R)        = FwIDprofs_klfcagl;
    wid_profs_numij_ALLCASES(1:aa,1:bb,1:cc,R)     = FwIDprofs_numij;
    wid_profs_northj_ALLCASES(1:aa,1:bb,1:cc,R)    = FwIDprofs_northj;
    wid_profs_southj_ALLCASES(1:aa,1:bb,1:cc,R)    = FwIDprofs_southj;

    clear FwIDprofs_equivarea FwIDprofs_maxmag FwIDprofs_massflux FwIDprofs_centlat FwIDprofs_centlon...
        FwIDprofs_centHTagl FwIDprofs_centHTasl FwIDprofs_klfcagl FwIDprofs_numij FwIDprofs_northj FwIDprofs_southj


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % %  assign WID sounding code output
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    FwID_MUCAPE_ALLCASES(1:aa,1:cc,R)                   =   FwID_MUCAPE ;
    FwID_MUCIN_ALLCASES(1:aa,1:cc,R)                    =   FwID_MUCIN;
    FwID_MULFC_ALLCASES(1:aa,1:cc,R)                    =   FwID_MULFC;
    FwID_MULCL_ALLCASES(1:aa,1:cc,R)                    =   FwID_MULCL;
    FwID_MUEL_ALLCASES(1:aa,1:cc,R)                     =   FwID_MUEL;
    FwID_MUvap_ALLCASES(1:aa,1:cc,R)                    =   FwID_MUvap;
    FwID_MUtheta_ALLCASES(1:aa,1:cc,R)                  =   FwID_MUtheta;
    FwID_MUthetae_ALLCASES(1:aa,1:cc,R)                 =   FwID_MUthetae;
    FwID_MUACBLCAPE_ALLCASES(1:aa,1:cc,R)               =   FwID_MUACBLCAPE;
    FwID_RH_mean_ACBL_ALLCASES(1:aa,1:cc,R)             =   FwID_RH_mean_ACBL;
    FwID_RH_500mb_ALLCASES(1:aa,1:cc,R)                 =   FwID_RH_500mb;
    FwID_RH_600mb_ALLCASES(1:aa,1:cc,R)                 =   FwID_RH_600mb;
    FwID_RH_5kmasl_ALLCASES(1:aa,1:cc,R)                =   FwID_RH_5kmasl;
    FwID_RH_6kmasl_ALLCASES(1:aa,1:cc,R)                =   FwID_RH_6kmasl;
    FwID_thetae_mean_ACBL_mu_ALLCASES(1:aa,1:cc,R)      =   FwID_thetae_mean_ACBL_mu;
    FwID_shear_mag_bulk_FT_mu_ALLCASES(1:aa,1:cc,R)     =   FwID_shear_mag_bulk_FT_mu;
    FwID_shear_mag_bulk_ACBL_mu_ALLCASES(1:aa,1:cc,R)   =   FwID_shear_mag_bulk_ACBL_mu;
    FwID_shear_mag_bulk_0to1km_ALLCASES(1:aa,1:cc,R)    =   FwID_shear_mag_bulk_0to1km;
    FwID_shear_mag_bulk_0to3km_ALLCASES(1:aa,1:cc,R)    =   FwID_shear_mag_bulk_0to3km;
    FwID_shear_mag_bulk_0to6km_ALLCASES(1:aa,1:cc,R)    =   FwID_shear_mag_bulk_0to6km;
    FwID_shear_mag_bulk_0to9km_ALLCASES(1:aa,1:cc,R)    =   FwID_shear_mag_bulk_0to9km;
    FwID_upslope_mean_ALLCASES(1:aa,1:cc,R)             =   FwID_upslope_mean;
    FwID_upslope_max_ALLCASES(1:aa,1:cc,R)              =   FwID_upslope_max;
    FwID_upslope_depth_ALLCASES(1:aa,1:cc,R)            =   FwID_upslope_depth;
    FwID_upslope_fract_ALLCASES(1:aa,1:cc,R)            =   FwID_upslope_fract;

    clear FwID_shear_mag_bulk_0to1km FwID_shear_mag_bulk_0to3km FwID_shear_mag_bulk_0to6km FwID_shear_mag_bulk_0to9km ...
        FwID_thetae_mean_ACBL_mu FwID_shear_mag_bulk_FT_mu FwID_shear_mag_bulk_ACBL_mu FwID_RH_mean_ACBL FwID_MUACBLCAPE ...
        FwID_MUCAPE FwID_MUCIN FwID_MULFC FwID_MULCL FwID_MUEL FwID_MUvap FwID_upslope_mean FwID_upslope_max FwID_upslope_depth FwID_upslope_fract...
        FwID_MUvap FwID_MUtheta FwID_MUthetae FwID_RH_500mb FwID_RH_600mb FwID_RH_5kmasl FwID_RH_6kmasl




    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %load/catalog swath stats:
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    disp('    ')
    disp(' loading swath mat file for ')
    disp( RUNS(R,:) )
    disp('    ')
    tic

    %   R  =  5

    %  obsolete:
    % swathmatfilein = [rootdir,'/', RUNS(R,:) ,'/SwathIDthermoOutput_100m_rhcamod_wID_qcldicesnow0.0001_dbz10_run_',RUNS(R,:),'.mat']
    % swathmatfilein = [rootdir,'/', RUNS(R,:) ,'/SwathIDthermoOutput_c1p11_wraw_wmag025_dirtfix_d4_run_',RUNS(R,:),'.mat']
    %swathmatfilein = [rootdir,'/', RUNS(R,:) ,'/SwathIDthermoOutput_c1p11_w2p16_wmag025_post2p9_d4_',RUNS(R,:),'.mat']

    % % %new swath detection results:
    %swathmatfilein = [rootdir,'/', RUNS(R,:) ,'/SwathIDthermoOutput_c1p11h1p13t_w1p16_wmag025_v12_d4_',RUNS(R,:),'.mat']
    %swathmatfilein = [rootdir,'/', RUNS(R,:) ,'/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag100_v12_d4_',RUNS(R,:),'.mat']
    swathmatfilein = [rootdir,'/', RUNS(R,:) ,'/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_v13c_d4_',RUNS(R,:),'.mat']

    load(char(swathmatfilein),'Conv_object','W_object',...
        'Yvcsa','Xvcsa','Zvcsa','Tvcsa','A_Ht_asl_vcs','yasl','Terr','dx','HHMMSS_all','YYMMDD_all','newz_asl','Lon','Lat',...
        ...
        'Wswath_maxmag_sm0','Wswath_width_sm0','Wswath_depth_sm0','Wswath_VMsum_sm0',...
        'Wswath_thetamean_sm0','Wswath_thetaemean_sm0','Wswath_vapormean_sm0',...
        'Wswath_centlon_sm2', 'Wswath_centlat_sm2', 'Wswath_top_asl', 'Wswath_top_agl',...    %mental note, "toplfcagl/asl = the mulfc at the exact i,j point where the swath is its tallest
        'Wswath_bot_asl', 'Wswath_bot_agl',...
        ...
        'Cswath_MFC_mean_sm0','Cswath_MCqadv_mean_sm0','Cswath_MCqconv_mean_sm0',...
        'Cswath_MFC_max_sm0','Cswath_MCqadv_max_sm0','Cswath_MCqconv_max_sm0',...
        'Cswath_width_sm0','Cswath_depth_sm0','Cswath_maxmag_sm0',...
        ...
        'Wswath_mulfcasl','Wswath_mulfcagl', 'Wswath_mucin', 'Wswath_mucape', ...
        'Wswathboxaloft_RH','Wswathboxaloft_QV','Wswathboxaloft_Zasl','Wswathbox_Uswathdepth','Wswathbox_Vswathdepth',...
        'Wswathboxaloft_RHlfcrel','Wswathboxaloft_QVlfcrel','Wswathboxaloft_Zasllfcrel',...
        'Wswath_toplfcasl','Wswath_toplfcagl',...
        'westSDCbox_Uprofs','westSDCbox_Vprofs','eastSDCbox_Uprofs','eastSDCbox_Vprofs','newz_asl');

    %  figure; contourf(Wswathboxaloft_RHlfcrel(:,:,20),20)
    %  figure; contourf(Wswathboxaloft_RH(:,:,20),20)
    %   size(Wswathboxaloft_RHlfcrel)
    %   size(Wswathboxaloft_RH)
    %   size(Wswathboxaloft_QVlfcrel)
    %   size(Wswathboxaloft_QV)

    westSDCbox_Uprofs(westSDCbox_Uprofs==-999) = NaN;
    westSDCbox_Vprofs(westSDCbox_Vprofs==-999) = NaN;
    eastSDCbox_Uprofs(eastSDCbox_Uprofs==-999) = NaN;
    eastSDCbox_Vprofs(eastSDCbox_Vprofs==-999) = NaN;

    %UVcellboxmatfilein = [rootdir,'/', RUNS(R,:) ,'/UVboxesterrainfollowing_Output_100m_qcldicesnow0.0001_dbz10_run_',RUNS(R,:),'.mat']
    UVcellboxmatfilein = [rootdir,'/', RUNS(R,:) ,'/UVboxesterrainfollowing_Output_100m_qcldicesnow0.0001_dbz10_v13c_run_',RUNS(R,:),'.mat']
    load(char(UVcellboxmatfilein),...
        'Yvcsa','Xvcsa','Zvcsa','Tvcsa','A_Ht_asl_vcs','yasl','Terr','dx','newz_asl','Lon','Lat',...
        'terrfollow_westSDCbox_Uprofs','terrfollow_westSDCbox_Vprofs','terrfollow_eastSDCbox_Uprofs','terrfollow_eastSDCbox_Vprofs','newz_asl',...
        'dzpeakU5_vent','dzpeakU8_vent','dzpeakU10_vent','dzpeakU15_vent','dzpeakU20_vent',...
        'Z5_vent','Z8_vent','Z10_vent','Z15_vent','Z20_vent');

    terrfollow_westSDCbox_Uprofs(terrfollow_westSDCbox_Uprofs==-999) = NaN;
    terrfollow_westSDCbox_Vprofs(terrfollow_westSDCbox_Vprofs==-999) = NaN;
    terrfollow_eastSDCbox_Uprofs(terrfollow_eastSDCbox_Uprofs==-999) = NaN;
    terrfollow_eastSDCbox_Vprofs(terrfollow_eastSDCbox_Vprofs==-999) = NaN;


    [ju tu] = size(Z5_vent)  ;
    FullSDC_upeakDZ5_eastU_ALLCASES(:,1:tu,R) = dzpeakU5_vent;         
    FullSDC_upeakZ5_eastU_ALLCASES(:,1:tu,R)  = Z5_vent;   
    FullSDC_upeakDZ8_eastU_ALLCASES(:,1:tu,R) = dzpeakU8_vent;         
    FullSDC_upeakZ8_eastU_ALLCASES(:,1:tu,R)  = Z8_vent;   
    FullSDC_upeakDZ10_eastU_ALLCASES(:,1:tu,R) = dzpeakU10_vent;         
    FullSDC_upeakZ10_eastU_ALLCASES(:,1:tu,R)  = Z10_vent;
    FullSDC_upeakDZ15_eastU_ALLCASES(:,1:tu,R) = dzpeakU15_vent;         
    FullSDC_upeakZ15_eastU_ALLCASES(:,1:tu,R)  = Z15_vent;   



    [jm tm] = size(Wswath_width_sm0) ;
    killwin = find( isnan(Wswath_width_sm0)  ) ;
    %along swath smoothing: 
    if( AlongSwath_Jsmooth_pass == 0 )                          
        Wswath_maxmag_sm       =  Wswath_maxmag_sm0;
        Wswath_width_sm        =  Wswath_width_sm0;
        Wswath_depth_sm        =  Wswath_depth_sm0;
        Wswath_VMsum_sm        =  Wswath_VMsum_sm0;
        Wswath_thetamean_sm    =  Wswath_thetamean_sm0;
        Wswath_thetaemean_sm   =  Wswath_thetaemean_sm0;
        Wswath_vapormean_sm    =  Wswath_vapormean_sm0;

        Cswath_maxmag_sm       =  Cswath_maxmag_sm0;
        Cswath_width_sm        =  Cswath_width_sm0;
        Cswath_depth_sm        =  Cswath_depth_sm0;     
        Cswath_MFC_mean_sm         = Cswath_MFC_mean_sm0;
        Cswath_MCqadv_mean_sm      = Cswath_MCqadv_mean_sm0;
        Cswath_MCqconv_mean_sm     = Cswath_MCqconv_mean_sm0;
        Cswath_MFC_max_sm          = Cswath_MFC_max_sm0;
        Cswath_MCqadv_max_sm       = Cswath_MCqadv_max_sm0;
        Cswath_MCqconv_max_sm      = Cswath_MCqconv_max_sm0;
        
    end
    if( AlongSwath_Jsmooth_pass > 0 )
                                   %movmean(A_Conv_vcs_unsmoothed,11,4,'omitnan');
        Wswath_maxmag_sm       =  movmean(Wswath_maxmag_sm0,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_width_sm        =  movmean(Wswath_width_sm0,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_depth_sm        =  movmean(Wswath_depth_sm0,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_VMsum_sm        =  movmean(Wswath_VMsum_sm0,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_thetamean_sm    =  movmean(Wswath_thetamean_sm0,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_thetaemean_sm   =  movmean(Wswath_thetaemean_sm0,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_vapormean_sm    =  movmean(Wswath_vapormean_sm0,AlongSwath_Jsmooth_window,1,'omitnan');

        Cswath_maxmag_sm       =  movmean(Cswath_maxmag_sm0,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_width_sm        =  movmean(Cswath_width_sm0,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_depth_sm        =  movmean(Cswath_depth_sm0,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MFC_mean_sm         = movmean(Cswath_MFC_mean_sm0,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MCqadv_mean_sm      = movmean(Cswath_MCqadv_mean_sm0,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MCqconv_mean_sm     = movmean(Cswath_MCqconv_mean_sm0,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MFC_max_sm          = movmean(Cswath_MFC_max_sm0,AlongSwath_Jsmooth_window,1,'omitnan');
        Cswath_MCqadv_max_sm       = movmean(Cswath_MCqadv_max_sm0,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MCqconv_max_sm      = movmean(Cswath_MCqconv_max_sm0,AlongSwath_Jsmooth_window,1,'omitnan'); 

    end
    if( AlongSwath_Jsmooth_pass == 2)
                                   %movmean(A_Conv_vcs_unsmoothed,11,4,'omitnan');
        Wswath_maxmag_sm       =  movmean(Wswath_maxmag_sm,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_width_sm        =  movmean(Wswath_width_sm,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_depth_sm        =  movmean(Wswath_depth_sm,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_VMsum_sm        =  movmean(Wswath_VMsum_sm,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_thetamean_sm    =  movmean(Wswath_thetamean_sm,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_thetaemean_sm   =  movmean(Wswath_thetaemean_sm,AlongSwath_Jsmooth_window,1,'omitnan');
        Wswath_vapormean_sm    =  movmean(Wswath_vapormean_sm,AlongSwath_Jsmooth_window,1,'omitnan');

        Cswath_maxmag_sm       =  movmean(Cswath_maxmag_sm,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_width_sm        =  movmean(Cswath_width_sm,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_depth_sm        =  movmean(Cswath_depth_sm,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MFC_mean_sm         = movmean(Cswath_MFC_mean_sm,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MCqadv_mean_sm      = movmean(Cswath_MCqadv_mean_sm,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MCqconv_mean_sm     = movmean(Cswath_MCqconv_mean_sm,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MFC_max_sm          = movmean(Cswath_MFC_max_sm,AlongSwath_Jsmooth_window,1,'omitnan');
        Cswath_MCqadv_max_sm       = movmean(Cswath_MCqadv_max_sm,AlongSwath_Jsmooth_window,1,'omitnan'); 
        Cswath_MCqconv_max_sm      = movmean(Cswath_MCqconv_max_sm,AlongSwath_Jsmooth_window,1,'omitnan'); 

    end
    %re-nan the smoothed fields
    Wswath_maxmag_sm(killwin)        =  NaN ;     
    Wswath_width_sm(killwin)         =  NaN ; 
    Wswath_depth_sm(killwin)         =  NaN ; 
    Wswath_VMsum_sm(killwin)         =  NaN ; 
    Wswath_thetamean_sm(killwin)     =  NaN ; 
    Wswath_thetaemean_sm(killwin)    =  NaN ; 
    Wswath_vapormean_sm(killwin)     =  NaN ; 

    Cswath_maxmag_sm(killwin)     =  NaN ; 
    Cswath_width_sm(killwin)     =  NaN ; 
    Cswath_depth_sm(killwin)     =  NaN ; 
    Cswath_MFC_mean_sm(killwin)     =  NaN ; 
    Cswath_MCqadv_mean_sm(killwin)     =  NaN ; 
    Cswath_MCqconv_mean_sm(killwin)     =  NaN ; 
    Cswath_MFC_max_sm(killwin)     =  NaN ; 
    Cswath_MCqadv_max_sm(killwin)     =  NaN ; 
    Cswath_MCqconv_max_sm(killwin)     =  NaN ; 


    % figure; plot(Wswath_width_sm0(:,20),'k'); hold on; plot(Wswath_width_sm(:,20),'b');  plot(Wswath_width_sm(:,20),'r')

    %catalog values
    HHMMSS_all_ALLCASES(1:tm,1:6,R) = char(HHMMSS_all) ;

    FullSDC_mesoWwidth_ALLCASES(1:jm,1:tm,R)        = Wswath_width_sm;
    FullSDC_mesoWdepth_ALLCASES(1:jm,1:tm,R)        = Wswath_depth_sm;
    FullSDC_mesoWstrength_ALLCASES(1:jm,1:tm,R)     = Wswath_maxmag_sm;
    FullSDC_VMfluxSum_ALLCASES(1:jm,1:tm,R)         = Wswath_VMsum_sm;
    FullSDC_swathmucin_ALLCASES(1:jm,1:tm,R)        = Wswath_mucin;
    FullSDC_swathmucape_ALLCASES(1:jm,1:tm,R)       = Wswath_mucape;
    FullSDC_swathmulfcagl_ALLCASES(1:jm,1:tm,R)     = Wswath_mulfcagl;
    FullSDC_swathmulfcasl_ALLCASES(1:jm,1:tm,R)     = Wswath_mulfcasl;
    FullSDC_swathqvap_ALLCASES(1:jm,1:tm,R)         = Wswath_vapormean_sm;
    FullSDC_swaththetamean_ALLCASES(1:jm,1:tm,R)    = Wswath_thetamean_sm;
    FullSDC_swaththetaemean_ALLCASES(1:jm,1:tm,R)   = Wswath_thetaemean_sm;
    FullSDC_swathtopasl_ALLCASES(1:jm,1:tm,R)       = Wswath_top_asl;
    FullSDC_swathtopagl_ALLCASES(1:jm,1:tm,R)       = Wswath_top_agl;
    FullSDC_swathbotasl_ALLCASES(1:jm,1:tm,R)       = Wswath_bot_asl;
    FullSDC_swathbotagl_ALLCASES(1:jm,1:tm,R)       = Wswath_bot_agl;
    FullSDC_swathtoplfcasl_ALLCASES(1:jm,1:tm,R)    = Wswath_toplfcasl;
    FullSDC_swathtoplfcagl_ALLCASES(1:jm,1:tm,R)    = Wswath_toplfcagl;
    FullSDC_swathcentlat_ALLCASES(1:jm,1:tm,R)      = Wswath_centlat_sm2;
    FullSDC_swathcentlon_ALLCASES(1:jm,1:tm,R)      = Wswath_centlon_sm2;

    FullSDC_mesoCwidth_ALLCASES(1:jm,1:tm,R)        = Cswath_width_sm;
    FullSDC_mesoCdepth_ALLCASES(1:jm,1:tm,R)        = Cswath_depth_sm;
    FullSDC_mesoCstrength_ALLCASES(1:jm,1:tm,R)     = Cswath_maxmag_sm;
    FullSDC_mesoCMFCmean_ALLCASES(1:jm,1:tm,R)      = Cswath_MFC_mean_sm;
    FullSDC_mesoCMCqadvmean_ALLCASES(1:jm,1:tm,R)   = Cswath_MCqadv_mean_sm;   
    FullSDC_mesoCMCqconvmean_ALLCASES(1:jm,1:tm,R)  = Cswath_MCqconv_mean_sm;
    FullSDC_mesoCMFCmax_ALLCASES(1:jm,1:tm,R)       = Cswath_MFC_max_sm;
    FullSDC_mesoCMCqadvmax_ALLCASES(1:jm,1:tm,R)    = Cswath_MCqadv_max_sm;   
    FullSDC_mesoCMCqconvmax_ALLCASES(1:jm,1:tm,R)   = Cswath_MCqconv_max_sm;   

    FullSDC_eastV_ALLCASES(1:jm,1:aslz,1:tm,R)           = eastSDCbox_Vprofs;
    FullSDC_westV_ALLCASES(1:jm,1:aslz,1:tm,R)           = westSDCbox_Vprofs;
    FullSDC_eastU_ALLCASES(1:jm,1:aslz,1:tm,R)           = eastSDCbox_Uprofs;
    FullSDC_westU_ALLCASES(1:jm,1:aslz,1:tm,R)           = westSDCbox_Uprofs;
    FullSDC_swathboxaloftRH_ALLCASES(1:jm,1:boxz,1:tm,R) = Wswathboxaloft_RH;
    FullSDC_swathboxaloftQV_ALLCASES(1:jm,1:boxz,1:tm,R) = Wswathboxaloft_QV;
    FullSDC_swathboxaloftRHlfcrel_ALLCASES(1:jm,1:aslz,1:tm,R) = Wswathboxaloft_RHlfcrel;
    FullSDC_swathboxaloftQVlfcrel_ALLCASES(1:jm,1:aslz,1:tm,R) = Wswathboxaloft_QVlfcrel;

    [jmm zmm tmm] = size(terrfollow_eastSDCbox_Uprofs) ;
    FullSDC_TFCbox_eastU_ALLCASES(1:jm,1:aslz,1:tmm,R)           = terrfollow_eastSDCbox_Uprofs;
    FullSDC_TFCbox_westU_ALLCASES(1:jm,1:aslz,1:tmm,R)           = terrfollow_westSDCbox_Uprofs;


    ktop=44;   kbot=8; % keep these as is - corespond to ~1km and 5 km asl in "newz_asl"
    FullSDC_eastU1to5kmasl_bulkshear_ALLCASES(1:jm,1:tm,R)  =  permute( eastSDCbox_Uprofs(:,ktop,:) - eastSDCbox_Uprofs(:,kbot,:) , [1,3,2] ) ;
    FullSDC_eastV1to5kmasl_bulkshear_ALLCASES(1:jm,1:tm,R)  =  permute( eastSDCbox_Vprofs(:,ktop,:) - eastSDCbox_Vprofs(:,kbot,:) , [1,3,2] ) ;

    ktop=48;   kbot=8; % keep these as is - corespond to ~1km and 9 km asl in "newz_asl"
    FullSDC_eastU1to9kmasl_bulkshear_ALLCASES(1:jm,1:tm,R)  =  permute( eastSDCbox_Uprofs(:,ktop,:) - eastSDCbox_Uprofs(:,kbot,:) , [1,3,2] ) ;
    FullSDC_eastV1to9kmasl_bulkshear_ALLCASES(1:jm,1:tm,R)  =  permute( eastSDCbox_Vprofs(:,ktop,:) - eastSDCbox_Vprofs(:,kbot,:) , [1,3,2] ) ;

    % log upslope flow quantities (fraction of depth up to SDC top and mean mag in that depth)
    Eupdepth = zeros( sdclength , alltimes );
    for t = 1:cc
        for j = 1:sdclength
            %  t = 10; j = 400

            if( length( find( isnan(FullSDC_eastU_ALLCASES(j,:,t,R)) )   )   < aslz   )  %catch if I manually Nan'ed certain J ranges.

                %%%%%%% east side

                %rel to local j terrain
                localpeak = max(Terr(:,j) ) ;  %ridge elevation at this j
                kto  =  find( abs(newz_asl-localpeak)  ==  min(abs(newz_asl-localpeak),[],'omitnan')  ) ;          %approx newz_asl ht of local terrain peak
                %kbo = 8;   %kto = 25;  % (1100m, 2800m asl) -- 2800 ~ SDC top,  1100m ~ lowest common height above terrain
                kbo = find( isnan( FullSDC_eastU_ALLCASES(j,:,t,R) )==0  ) ;    kbo = kbo(1);% bottommost pt in profile with data
                upE = find( eastSDCbox_Uprofs(j,kbo:kto,t) < 0.0 )  ;
                fract = length( upE ) / (kto - kbo + 1)  ;
                upE = upE + kbo - 1; % reset k indices to full asl frame
                FullSDC_eastupslopedepthfract_ALLCASES(j,t,R) =  fract ;
                FullSDC_eastupslopemean_ALLCASES(j,t,R) =  mean( eastSDCbox_Uprofs(j,upE,t),'omitnan') ;

                %rel to highest terrain level asl anywhere along ridge
                k2500asl  =  find( abs(newz_asl-2500)  ==  min(abs(newz_asl-2500),[],'omitnan')  ) ;
                upE = find( eastSDCbox_Uprofs(j,kbo:k2500asl,t) < 0.0 )  ;
                fract = length( upE ) / (k2500asl - kbo + 1)  ;
                upE = upE + kbo - 1; % reset k indices to full asl frame
                FullSDC_eastupslopedepthfract2500masl_ALLCASES(j,t,R) = fract ;
                FullSDC_eastupslopemean2500masl_ALLCASES(j,t,R) =  mean( eastSDCbox_Uprofs(j,upE,t),'omitnan') ;

                % z = 3-4, 4-5, 5-6 km asl mean U (east side):
                k3asl  =  find( abs(newz_asl-3000)  ==  min(abs(newz_asl-3000),[],'omitnan')  ) ;
                k4asl  =  find( abs(newz_asl-4000)  ==  min(abs(newz_asl-4000),[],'omitnan')  ) ;
                k5asl  =  find( abs(newz_asl-5000)  ==  min(abs(newz_asl-5000),[],'omitnan')  ) ;
                k6asl  =  find( abs(newz_asl-6000)  ==  min(abs(newz_asl-6000),[],'omitnan')  ) ;
                FullSDC_eastUmean3to4kmasl_ALLCASES(j,t,R) =  mean( eastSDCbox_Uprofs(j,k3asl:k4asl,t),'omitnan') ;
                FullSDC_eastUmean4to5kmasl_ALLCASES(j,t,R) =  mean( eastSDCbox_Uprofs(j,k4asl:k5asl,t),'omitnan') ;
                FullSDC_eastUmean5to6kmasl_ALLCASES(j,t,R) =  mean( eastSDCbox_Uprofs(j,k5asl:k6asl,t),'omitnan') ;

                % raw DEPTH (top-bot) or tophtasl of upslope flow (search limited to under 3500m asl)
                [rt ryz ru ri] = size(FullSDC_eastU_ALLCASES);
                k3500asl  =  find( abs(newz_asl-3500)  ==  min(abs(newz_asl-3500),[],'omitnan')  ) ;
                upE = find( eastSDCbox_Uprofs(j,kbo:k3500asl,t) < 0.0 ) ;
                upE = upE + kbo - 1; % reset k indices to full asl frame
                if( isempty(upE)==0 )
                    FullSDC_eastupslopedepth_ALLCASES(j,t,R)  =  newz_asl(upE(end))- newz_asl(upE(1)) ;
                    FullSDC_eastupslopetophtasl_ALLCASES(j,t,R)  =  newz_asl(upE(end)) ;
                end

                %depth fract rel to  1.5km AGL peak, which is what I think I did for obs (1140 -> 2600km peak  ~ 1.5 km agl).
                kbott = find( isnan( FullSDC_eastU_ALLCASES(j,:,t,R) )==0  ) ;    kbott = kbott(1);% bottommost pt in profile with data
                newz_aglish = newz_asl - newz_asl(kbott) ;
                ktopp = find(  abs(newz_aglish - 1500) ==  min(abs(newz_aglish - 1500)) ) ;
                upE = find( eastSDCbox_Uprofs(j,kbott:ktopp,t) < 0.0 )  ;
                fract = length( upE ) / (ktopp - kbott + 1)  ;
                upE = upE + kbott - 1; % reset k indices to full asl frame
                FullSDC_eastupslopedepthfract1500magl_ALLCASES(j,t,R) =  fract ;
                FullSDC_eastupslopemean1500magl_ALLCASES(j,t,R) =  mean( eastSDCbox_Uprofs(j,upE,t),'omitnan') ;


                %%%%%%%   west side

                %rel to local j terrain
                %kbo = 8;   %kto = 25;  % (1100m, 2800m asl) -- 2800 ~ SDC top,  1100m ~ lowest common height above terrain
                kbo = find( isnan( FullSDC_westU_ALLCASES(j,:,t,R) )==0  ) ;    kbo = kbo(1);
                upW = find( westSDCbox_Uprofs(j,kbo:kto,t) > 0.0 )  ;
                fract = length( upW ) / (kto - kbo + 1)  ;
                upW = upW + kbo - 1; % reset k indices to full asl frame
                FullSDC_westupslopedepthfract_ALLCASES(j,t,R) =  fract ;
                FullSDC_westupslopemean_ALLCASES(j,t,R) =  mean( westSDCbox_Uprofs(j,upW,t),'omitnan') ;

                %rel to highest terrain
                k2500asl  =  find( abs(newz_asl-2500)  ==  min(abs(newz_asl-2500),[],'omitnan')  ) ;
                upW = find( westSDCbox_Uprofs(j,kbo:k2500asl,t) > 0.0 )  ;
                fract = length( upW ) / (k2500asl - kbo + 1)  ;
                FullSDC_westupslopedepthfract2500masl_ALLCASES(j,t,R) =  fract ;
                upW = upW + kbo - 1; % reset k indices to full asl frame
                FullSDC_westupslopemean2500masl_ALLCASES(j,t,R) =  mean( westSDCbox_Uprofs(j,upW,t),'omitnan') ;

                % raw DEPTH (top-bot) or tophtasl of upslope flow (search limited to under 3500m asl)
                [rt ryz ru ri] = size(FullSDC_westU_ALLCASES);
                k3500asl  =  find( abs(newz_asl-3500)  ==  min(abs(newz_asl-3500),[],'omitnan')  ) ;
                upW = find( westSDCbox_Uprofs(j,kbo:k3500asl,t) > 0.0 ) ;
                upW = upW + kbo - 1; % reset k indices to full asl frame
                if( isempty(upW)==0 )
                    FullSDC_westupslopedepth_ALLCASES(j,t,R)  =  newz_asl(upW(end)) - newz_asl(upW(1));
                    FullSDC_westupslopetophtasl_ALLCASES(j,t,R)  =  newz_asl(upW(end))  ;
                end

                %depth fract rel to  1.5km agl peak, which is what I think I did for obs (1140 -> 2600km peak  ~ 1.5 km agl).
                kbott = find( isnan( FullSDC_westU_ALLCASES(j,:,t,R) )==0  ) ;    kbott = kbott(1);
                newz_aglish = newz_asl - newz_asl(kbott) ;
                ktopp = find(  abs(newz_aglish - 1500) ==  min(abs(newz_aglish - 1500)) ) ;
                upW = find( westSDCbox_Uprofs(j,kbott:ktopp,t) > 0.0 )  ;
                fract = length( upW ) / (ktopp - kbott + 1)  ;
                upW = upW + kbo - 1; % reset k indices to full asl frame
                %upE = upE + kbott - 1; % reset k indices to full asl frame
                FullSDC_westupslopedepthfract1500magl_ALLCASES(j,t,R) =  fract ;
                FullSDC_westupslopemean1500magl_ALLCASES(j,t,R) =  mean( westSDCbox_Uprofs(j,upW,t),'omitnan') ;

            end % j nan catch

        end
    end



    %%%%%
    % repeat for the terrain-following cell-based U/V box profiles:
    %%%%%
    % log upslope flow quantities (fraction of depth up to SDC top and mean mag in that depth)
    Eupdepth = zeros( sdclength , CELLTIMES20 );
    for t = 1:cc
        for j = 1:sdclength
            %  j = 400

            if( length( find( isnan(FullSDC_TFCbox_eastU_ALLCASES(j,:,t,R)) )   )   < aslz   )  %catch if I manually Nan'ed certain J ranges.

                %%%%%%% east side

                %rel to local j terrain
                localpeak = max(Terr(:,j) ) ;  %ridge elevation at this j
                kto  =  find( abs(newz_asl-localpeak)  ==  min(abs(newz_asl-localpeak),[],'omitnan')  ) ;          %approx newz_asl ht of local terrain peak
                %kbo = 8;   %kto = 25;  % (1100m, 2800m asl) -- 2800 ~ SDC top,  1100m ~ lowest common height above terrain
                kbo = find( isnan( FullSDC_TFCbox_eastU_ALLCASES(j,:,t,R) )==0  ) ;    kbo = kbo(1);% bottommost pt in profile with data
                upE = find( terrfollow_eastSDCbox_Uprofs(j,kbo:kto,t) < 0.0 )  ;
                fract = length( upE ) / (kto - kbo + 1)  ;
                upE = upE + kbo - 1; % reset k indices to full asl frame
                FullSDC_TFCbox_eastupslopedepthfract_ALLCASES(j,t,R) =  fract ;
                FullSDC_TFCbox_eastupslopemean_ALLCASES(j,t,R) =  mean( terrfollow_eastSDCbox_Uprofs(j,upE,t),'omitnan') ;

                %rel to highest terrain level asl anywhere along ridge
                k2500asl  =  find( abs(newz_asl-2500)  ==  min(abs(newz_asl-2500),[],'omitnan')  ) ;
                upE = find( terrfollow_eastSDCbox_Uprofs(j,kbo:k2500asl,t) < 0.0 )  ;
                fract = length( upE ) / (k2500asl - kbo + 1)  ;
                upE = upE + kbo - 1; % reset k indices to full asl frame
                FullSDC_TFCbox_eastupslopedepthfract2500masl_ALLCASES(j,t,R) = fract ;
                FullSDC_TFCbox_eastupslopemean2500masl_ALLCASES(j,t,R) =  mean( terrfollow_eastSDCbox_Uprofs(j,upE,t),'omitnan') ;

                % z = 3-4, 4-5, 5-6 km asl mean U (east side):
                k3asl  =  find( abs(newz_asl-3000)  ==  min(abs(newz_asl-3000),[],'omitnan')  ) ;
                k4asl  =  find( abs(newz_asl-4000)  ==  min(abs(newz_asl-4000),[],'omitnan')  ) ;
                k5asl  =  find( abs(newz_asl-5000)  ==  min(abs(newz_asl-5000),[],'omitnan')  ) ;
                k6asl  =  find( abs(newz_asl-6000)  ==  min(abs(newz_asl-6000),[],'omitnan')  ) ;
                FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES(j,t,R) =  mean( terrfollow_eastSDCbox_Uprofs(j,k3asl:k4asl,t),'omitnan') ;
                FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES(j,t,R) =  mean( terrfollow_eastSDCbox_Uprofs(j,k4asl:k5asl,t),'omitnan') ;
                FullSDC_TFCbox_eastUmean5to6kmasl_ALLCASES(j,t,R) =  mean( terrfollow_eastSDCbox_Uprofs(j,k5asl:k6asl,t),'omitnan') ;

                % raw DEPTH (top-bot) or tophtasl of upslope flow (search limited to under 3500m asl)
                [rt ryz ru ri] = size(FullSDC_TFCbox_eastU_ALLCASES);
                k3500asl  =  find( abs(newz_asl-3500)  ==  min(abs(newz_asl-3500),[],'omitnan')  ) ;
                upE = find( terrfollow_eastSDCbox_Uprofs(j,kbo:k3500asl,t) < 0.0 ) ;
                upE = upE + kbo - 1; % reset k indices to full asl frame
                if( isempty(upE)==0 )
                    FullSDC_TFCbox_eastupslopedepth_ALLCASES(j,t,R)  =  newz_asl(upE(end))- newz_asl(upE(1)) ;
                    FullSDC_TFCbox_eastupslopetophtasl_ALLCASES(j,t,R)  =  newz_asl(upE(end)) ;
                end

                %depth fract rel to  1.5km AGL peak, which is what I think I did for obs (1140 -> 2600km peak  ~ 1.5 km agl).
                kbott = find( isnan( FullSDC_TFCbox_eastU_ALLCASES(j,:,t,R) )==0  ) ;    kbott = kbott(1);% bottommost pt in profile with data
                newz_aglish = newz_asl - newz_asl(kbott) ;
                ktopp = find(  abs(newz_aglish - 1500) ==  min(abs(newz_aglish - 1500)) ) ;
                upE = find( terrfollow_eastSDCbox_Uprofs(j,kbott:ktopp,t) < 0.0 )  ;
                fract = length( upE ) / (ktopp - kbott + 1)  ;
                upE = upE + kbott - 1; % reset k indices to full asl frame
                FullSDC_TFCbox_eastupslopedepthfract1500magl_ALLCASES(j,t,R) =  fract ;
                FullSDC_TFCbox_eastupslopemean1500magl_ALLCASES(j,t,R) =  mean( terrfollow_eastSDCbox_Uprofs(j,upE,t),'omitnan') ;


                %%%%%%%   west side

                %rel to local j terrain
                %kbo = 8;   %kto = 25;  % (1100m, 2800m asl) -- 2800 ~ SDC top,  1100m ~ lowest common height above terrain
                kbo = find( isnan( FullSDC_TFCbox_westU_ALLCASES(j,:,t,R) )==0  ) ;    kbo = kbo(1);
                upW = find( terrfollow_westSDCbox_Uprofs(j,kbo:kto,t) > 0.0 )  ;
                fract = length( upW ) / (kto - kbo + 1)  ;
                upW = upW + kbo - 1; % reset k indices to full asl frame
                FullSDC_TFCbox_westupslopedepthfract_ALLCASES(j,t,R) =  fract ;
                FullSDC_TFCbox_westupslopemean_ALLCASES(j,t,R) =  mean( terrfollow_westSDCbox_Uprofs(j,upW,t),'omitnan') ;

                %rel to highest terrain
                k2500asl  =  find( abs(newz_asl-2500)  ==  min(abs(newz_asl-2500),[],'omitnan')  ) ;
                upW = find( terrfollow_westSDCbox_Uprofs(j,kbo:k2500asl,t) > 0.0 )  ;
                fract = length( upW ) / (k2500asl - kbo + 1)  ;
                upW = upW + kbo - 1; % reset k indices to full asl frame
                FullSDC_TFCbox_westupslopedepthfract2500masl_ALLCASES(j,t,R) =  fract ;
                FullSDC_TFCbox_westupslopemean2500masl_ALLCASES(j,t,R) =  mean( terrfollow_westSDCbox_Uprofs(j,upW,t),'omitnan') ;

                % raw DEPTH (top-bot) or tophtasl of upslope flow (search limited to under 3500m asl)
                [rt ryz ru ri] = size(FullSDC_TFCbox_westU_ALLCASES);
                k3500asl  =  find( abs(newz_asl-3500)  ==  min(abs(newz_asl-3500),[],'omitnan')  ) ;
                upW = find( terrfollow_westSDCbox_Uprofs(j,kbo:k3500asl,t) > 0.0 ) ;
                upW = upW + kbo - 1; % reset k indices to full asl frame
                if( isempty(upW)==0 )
                    FullSDC_TFCbox_westupslopedepth_ALLCASES(j,t,R)  =  newz_asl(upW(end)) - newz_asl(upW(1));
                    FullSDC_TFCbox_westupslopetophtasl_ALLCASES(j,t,R)  =  newz_asl(upW(end))  ;
                end

                %depth fract rel to  1.5km agl peak, which is what I think I did for obs (1140 -> 2600km peak  ~ 1.5 km agl).
                kbott = find( isnan( FullSDC_TFCbox_westU_ALLCASES(j,:,t,R) )==0  ) ;    kbott = kbott(1);
                newz_aglish = newz_asl - newz_asl(kbott) ;
                ktopp = find(  abs(newz_aglish - 1500) ==  min(abs(newz_aglish - 1500)) ) ;
                upW = find( terrfollow_westSDCbox_Uprofs(j,kbott:ktopp,t) > 0.0 )  ;
                fract = length( upW ) / (ktopp - kbott + 1)  ;
                upW = upW + kbo - 1; % reset k indices to full asl frame
                %upE = upE + kbott - 1; % reset k indices to full asl frame
                FullSDC_TFCbox_westupslopedepthfract1500magl_ALLCASES(j,t,R) =  fract ;
                FullSDC_TFCbox_westupslopemean1500magl_ALLCASES(j,t,R) =  mean( terrfollow_westSDCbox_Uprofs(j,upW,t),'omitnan') ;

            end % j nan catch

        end
    end

    % end  %test R

    %    % log upslope flow quantities (fraction of depth up to SDC top - hardcoded, not local peak - and mean mag in that depth)
    %     Eupdepth = zeros( sdclength , alltimes );
    %     for t = 1:cc
    %         for j = 1:sdclength
    %
    %             kbo = 8;   kto = 25;  % (1100m, 2800m asl) -- 2800 ~ SDC top,  1100m ~ lowest common height above terrain
    %             upE = find( eastSDCbox_Uprofs(j,kbo:kto,t) < 0.0 )  ;
    %             fract = length( upE ) / (kto - kbo + 1)  ;
    %             upE = upE + kbo - 1; % reset k indices to full ask frame
    %             FullSDC_eastupslopedepthfract_ALLCASES(j,t,R) =  fract ;
    %             FullSDC_eastupslopemean_ALLCASES(j,t,R) =  mean( eastSDCbox_Uprofs(j,upE,t),'omitnan') ;
    %
    %             kbo = 8;   kto = 25;  % (1100m, 2800m asl) -- 2800 ~ SDC top,  1100m ~ lowest common height above terrain
    %             upW = find( westSDCbox_Uprofs(j,kbo:kto,t) > 0.0 )  ;
    %             fract = length( upW ) / (kto - kbo + 1)  ;
    %             upW = upW + kbo - 1; % reset k indices to full ask frame
    %             FullSDC_westupslopedepthfract_ALLCASES(j,t,R) =  fract ;
    %             FullSDC_westupslopemean_ALLCASES(j,t,R) =  mean( westSDCbox_Uprofs(j,upW,t),'omitnan') ;
    %
    %         end
    %     end


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%% calculate distance from wID to swath here:
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %     for n = 1:numwid
    %         for t = 1:alltimes
    %             %  n = 5; t = 30;
    %
    %             %  find closest swath j (lat) to wIDs central j:
    %             wlon  =  mean(wid_profs_centlon_ALLCASES(n,:,t,R),2,'omitnan')   ;
    %             wlat  =  mean(wid_profs_centlat_ALLCASES(n,:,t,R),2,'omitnan')   ;
    %             swathj  =  find(  abs(FullSDC_swathcentlat_ALLCASES(:,t,R) - wlat)  ==   min(abs(FullSDC_swathcentlat_ALLCASES(:,t,R) - wlat))   )  ;
    %             if( isnan(wlat)==0 & isnan(swathj)==0 & isempty(wlat)==0 & isempty(swathj)==0 )
    %                 %  diff between cell central lon and the along-swath lon field at the wID's time:
    %                 slon = FullSDC_swathcentlon_ALLCASES(swathj,t,R) ;
    %                 dLon = wlon(1) - slon(1) ;  % should be positive if cell is EAST of swath (neg if cell is west of it). sometimes there are multiple that fit. I'm randomly picking item 1
    %                 lontodist = 95/1 ;  %estimate 95 km per 1 deg lon in SDC region
    %                 dist_wid_and_swath(n,t,R) = dLon .* lontodist ;
    %             end
    %         end
    %     end

    % factor of how much you want to artificially expand the updraft's radius. set to
    % 1 if you want no artifical expansion (i.e., just using the updrafts +/- area circ equiv radius as a swath search window)
    shadow_bloatN = 1;  % expansion factor for radius in N dir
    shadow_bloatS = 1;  %    in S dir


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %  filter out the wIDs occurring within 
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %    manually kill the wid prof measurements & env metrics where you
    %    manually killed the swath
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %%%% make mask to log keeper/killed latitudes
    
    if(R==1)
        % 29nov - no special culls
        ManSwathCull_keptMask(:,cc+1:end,R)  = NaN;
    elseif(R==2)
        % 4 dec:
        ManSwathCull_keptMask(1:400,:,R)  = 0;
        ManSwathCull_keptMask(:,cc+1:end,R)  = NaN;
    elseif(R==3)
        % 22 jan:
        ManSwathCull_keptMask(1400:end,31:end,R)  = 0;
        ManSwathCull_keptMask(1:200,49:end,R)  = 0;
        ManSwathCull_keptMask(:,cc+1:end,R)  = NaN;
    elseif(R==4)
        % 23 jan:
        ManSwathCull_keptMask(1:200,:,R)  = 0;
        ManSwathCull_keptMask(1400:end,:,R)  = 0;
        ManSwathCull_keptMask(1025:1100,23:end,R)  = 0;
        ManSwathCull_keptMask(:,cc+1:end,R)  = NaN;
    elseif(R==5)
        % 25 jan:
        ManSwathCull_keptMask(1:100,1:29,R)  = 0;
        ManSwathCull_keptMask(1200:end,:,R)  = 0;
        ManSwathCull_keptMask(:,cc+1:end,R)  = NaN;
    elseif(R==6)
        % 29 jan:
        ManSwathCull_keptMask(1:175,1:13,R)  = 0;
        ManSwathCull_keptMask(1:150,1:25,R)  = 0;
        ManSwathCull_keptMask(1200:end,:,R)  = 0;
        ManSwathCull_keptMask(:,cc+1:end,R)  = NaN;
    elseif(R==7)
        % 8 feb:
        ManSwathCull_keptMask(1:200,29:end,R)  = 0;
        ManSwathCull_keptMask(1:400,49:end,R)  = 0;
        ManSwathCull_keptMask(:,cc+1:end,R)  = NaN;
    end
    
    lat_alongSDC = Lat(200,:);

    % NaN the wID fields that are north/south of the N/S bounds of the cull
    % mask; have to do this by wID centroid lat/lon because you didn't save the j's for
    % each wID

    wid_profs_centlat_ALLCASES_preserve = wid_profs_centlat_ALLCASES;

    for tT = 1:cc
        %   tT = 20;

        clear swathgood
        swathgood = find( ManSwathCull_keptMask(:,tT,R) == 1  ) ;

        Sbnd = lat_alongSDC(  swathgood(1)    ) ;
        Nbnd = lat_alongSDC(  swathgood(end)  ) ;

        for nn = 1:aa
            %  tT = 20; nn = 20  ;
            wcentlat = mean( wid_profs_centlat_ALLCASES_preserve(nn,:,tT,R), 2, 'omitnan' ) ;  %ht mean cent lat

            if( wcentlat < Sbnd  | wcentlat > Nbnd  )

                %%%%%%%%% kill out of bounds wid_ vars here
                wid_profs_area_ALLCASES(nn,:,tT,R)      = NaN;
                wid_profs_maxmag_ALLCASES(nn,:,tT,R)      = NaN;
                wid_profs_massflux_ALLCASES(nn,:,tT,R)      = NaN;
                wid_profs_centlat_ALLCASES(nn,:,tT,R)      = NaN;
                wid_profs_centlon_ALLCASES(nn,:,tT,R)      = NaN;
                wid_profs_centHTagl_ALLCASES(nn,:,tT,R)      = NaN;
                wid_profs_centHTasl_ALLCASES(nn,:,tT,R)      = NaN;
                wid_profs_klfcagl_ALLCASES(nn,tT,R)        = NaN;
                wid_profs_numij_ALLCASES(nn,:,tT,R)      = NaN;
                wid_profs_northj_ALLCASES(nn,:,tT,R)      = NaN;
                wid_profs_southj_ALLCASES(nn,:,tT,R)      = NaN;

                FwID_MUCAPE_ALLCASES(nn,tT,R)        = NaN;
                FwID_MUCIN_ALLCASES(nn,tT,R)        = NaN;
                FwID_MULFC_ALLCASES(nn,tT,R)        = NaN;
                FwID_MULCL_ALLCASES(nn,tT,R)        = NaN;
                FwID_MUEL_ALLCASES(nn,tT,R)        = NaN;
                FwID_MUvap_ALLCASES(nn,tT,R)        = NaN;
                FwID_MUtheta_ALLCASES(nn,tT,R)        = NaN;
                FwID_MUthetae_ALLCASES(nn,tT,R)        = NaN;
                FwID_MUACBLCAPE_ALLCASES(nn,tT,R)        = NaN;
                FwID_RH_mean_ACBL_ALLCASES(nn,tT,R)        = NaN;
                FwID_RH_500mb_ALLCASES(nn,tT,R)        = NaN;
                FwID_RH_600mb_ALLCASES(nn,tT,R)        = NaN;
                FwID_RH_5kmasl_ALLCASES(nn,tT,R)        = NaN;
                FwID_RH_6kmasl_ALLCASES(nn,tT,R)        = NaN;
                FwID_thetae_mean_ACBL_mu_ALLCASES(nn,tT,R)        = NaN;
                FwID_shear_mag_bulk_FT_mu_ALLCASES(nn,tT,R)        = NaN;
                FwID_shear_mag_bulk_ACBL_mu_ALLCASES(nn,tT,R)        = NaN;
                FwID_shear_mag_bulk_0to1km_ALLCASES(nn,tT,R)        = NaN;
                FwID_shear_mag_bulk_0to3km_ALLCASES(nn,tT,R)        = NaN;
                FwID_shear_mag_bulk_0to6km_ALLCASES(nn,tT,R)        = NaN;
                FwID_shear_mag_bulk_0to9km_ALLCASES(nn,tT,R)        = NaN;
                FwID_upslope_mean_ALLCASES(nn,tT,R)        = NaN;
                FwID_upslope_max_ALLCASES(nn,tT,R)        = NaN;
                FwID_upslope_depth_ALLCASES(nn,tT,R)        = NaN;
                FwID_upslope_fract_ALLCASES(nn,tT,R)        = NaN;

            end %N/Sbnd if
        end %nn
    end %tT


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%   wID - swath matchup analysis
    %%%%   loop thru wIDs at each LASSO time, then look upstream at the
    %%%%   swath to log a swath property for each wID updraft
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    disp(' wid - swath matching;  multi-method style ')

    for meth = 1:nummatchmethods

        meth
        tic

        for n = 1:numwid
            for t = 1:alltimes

                %  n = 40;   t = 20;  R = 4;

                if(  t < cc   &   n < aa  )
                    %  find closest cell lat to swath lat:
                    wlat  =  mean(wid_profs_centlat_ALLCASES(n,:,t,R),2,'omitnan')   ;

                    if( isnan(wlat)==0 )

                        %  find swath j closest to centroid of wid - min in diff between cell central lon and the along-swath lon field at the cell's time:
                        w_cent_swathj  =  find(  abs(Wswath_centlat_sm2(:,t) - wlat)  ==   min(abs(Wswath_centlat_sm2(:,t) - wlat))   )  ;
                        w_cent_swathj = w_cent_swathj(end);

                        % define N-S wid span using equiv circ radii (plus 1 j as buffer)
                        warea = wid_profs_area_ALLCASES(n,:,t,R) ;
                        w_radN   =  (   max(warea',[],'omitnan')  / 3.14159) .^ 0.5 ;  % result in meters
                        w_radS = w_radN;

                        methrad_log(n,t,R,1) =  w_radN;

                        if( meth == 1 )
                            shadow_bloatN = 1;
                            shadow_bloatS = 1;
                        elseif( meth == 2 )
                            shadow_bloatN = 3;
                            shadow_bloatS = 3;
                        end

                        %bloat it
                        w_radN = w_radN * shadow_bloatN;
                        w_radS = w_radS * shadow_bloatS;

                        if( meth == 3 )
                            %hack to look at const updraft shadow area
                            w_radN = 2250.0;
                            w_radS = 2250.0;
                        end

                        methrad_log(n,t,R,meth+1) =  w_radN;             %(numwid,alltimes,ar,nummatchmethods);

                        jN =  round( (w_cent_swathj + w_radN / dx_model) + 1 ) ;
                        jS =  round( (w_cent_swathj - w_radS / dx_model) - 1 ) ;

                        %fix if the j's spill out of domain
                        if(jN > Yvcsa)
                            jN = Yvcsa ;
                        end
                        if(jS < 1)
                            jS = 1 ;
                        end

                        %%% catalog wID-swath matchup stats  (withTIMELAG)

                        %wobj = max(W_object(:,:,t,:),[],2,'omitnan') ;   wobj = max(wobj,[],1,'omitnan');   wobj = permute(wobj,[4 1 2 3]);
                        %   figure; plot(wobj,'ok')

                        for p = 1 : timelaglookback+1    % +1 because starts at 1 = current time
                            timl = t - (p-1) ;           % -1 because we want to include current time : timl = t
                            %index 1 = t.  2 = t-1, ...
                            if( timl > 0 )  % should keep NAN values for lag times prior to the LASSO analysis time period

                                %   n = 2;   t = 20;   R = 1;

                                %%%% first calc distance between wID and swath:
                                %  find closest swath j (lat) to wIDs central j at lowest height:
                                whts = find( isnan(wid_profs_centlon_ALLCASES(n,:,t,R))==0 )  ;
                                if( isempty(whts)==0 )
                                    wlon  =  mean(wid_profs_centlon_ALLCASES(n,whts(1),t,R),2,'omitnan')   ;
                                    wlat  =  mean(wid_profs_centlat_ALLCASES(n,whts(1),t,R),2,'omitnan')   ;
                                    swathj  =  find(  abs(FullSDC_swathcentlat_ALLCASES(:,timl,R) - wlat)  ==   min(abs(FullSDC_swathcentlat_ALLCASES(:,timl,R) - wlat))   )  ;
                                    if( isnan(wlat)==0 & isnan(swathj)==0 & isempty(wlat)==0 & isempty(swathj)==0 )
                                        %  diff between cell central lon and the along-swath lon field at the wID's time:
                                        slon = FullSDC_swathcentlon_ALLCASES(swathj,timl,R) ;
                                        dLon = wlon(1) - slon(1) ;  % should be positive if cell is EAST of swath (neg if cell is west of it). sometimes there are multiple that fit. I'm randomly picking item 1
                                        lontodist = 95/1 ;  %estimate 95 km per 1 deg lon in SDC region
                                        dist_wid_and_swath_ALLCASES(n,t,p,R) = dLon .* lontodist ;
                                    end
                                end

                                %raw w_object
                                wobj = max(W_object(:,:,timl,:),[],2,'omitnan') ;   wobj = max(wobj,[],1,'omitnan');   wobj = permute(wobj,[4 1 2 3]);
                                wspan = (jN - jS) + 1 ;
                                wposspan = length( find( wobj(jS:jN)==1 ) ) ;

                                %means of swath metrics
                                wid_mesoWstrength_ALLCASES(n,t,p,R,meth)     = mean(  Wswath_maxmag_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWwidth_ALLCASES(n,t,p,R,meth)        = mean(  Wswath_width_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWtopagl_ALLCASES(n,t,p,R,meth)       = mean(  Wswath_top_agl( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWtopasl_ALLCASES(n,t,p,R,meth)       = mean(  Wswath_top_asl( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWcape_ALLCASES(n,t,p,R,meth)         = mean(  Wswath_mucape( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWcin_ALLCASES(n,t,p,R,meth)          = mean(  Wswath_mucin( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWqvap_ALLCASES(n,t,p,R,meth)         = mean(  Wswath_vapormean_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWlfcasl_ALLCASES(n,t,p,R,meth)       = mean(  Wswath_mulfcasl( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWlfcagl_ALLCASES(n,t,p,R,meth)       = mean(  Wswath_mulfcagl( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWtheta_ALLCASES(n,t,p,R,meth)        = mean(  Wswath_thetamean_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWthetae_ALLCASES(n,t,p,R,meth)       = mean(  Wswath_thetaemean_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWdepth_ALLCASES(n,t,p,R,meth)        = mean(  Wswath_depth_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWvmsum_ALLCASES(n,t,p,R,meth)        = mean(  Wswath_VMsum_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoWvmsumHSUM_ALLCASES(n,t,p,R,meth)    = sum(  Wswath_VMsum_sm( jS:jN, timl ), 'omitnan' ) ;  %hoping that this accounts for a wid can have blank spots inthe w_object

                                wid_mesoCstrength_ALLCASES(n,t,p,R,meth)     = mean(  Cswath_maxmag_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoCwidth_ALLCASES(n,t,p,R,meth)        = mean(  Cswath_width_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoCdepth_ALLCASES(n,t,p,R,meth)        = mean(  Cswath_depth_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoCMFCmean_ALLCASES(n,t,p,R,meth)      = mean(  Cswath_MFC_mean_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoCMCqadvmean_ALLCASES(n,t,p,R,meth)   = mean(  Cswath_MCqadv_mean_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoCMCqconvmean_ALLCASES(n,t,p,R,meth)  = mean(  Cswath_MCqconv_mean_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoCMFCmax_ALLCASES(n,t,p,R,meth)       = mean(  Cswath_MFC_max_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoCMCqadvmax_ALLCASES(n,t,p,R,meth)    = mean(  Cswath_MCqadv_max_sm( jS:jN, timl ), 'omitnan' ) ;
                                wid_mesoCMCqconvmax_ALLCASES(n,t,p,R,meth)   = mean(  Cswath_MCqconv_max_sm( jS:jN, timl ), 'omitnan' ) ;

                                wid_mesoWalongsubupfract_ALLCASES(n,t,p,R,meth)  =  wposspan ./ wspan ;   %fraction of j points along w area that have a swath W_object
                                wid_mesoWtoplfcaglRAT_ALLCASES(n,t,p,R,meth)   =  mean(  Wswath_top_agl( jS:jN, timl ) ./ ( Wswath_toplfcagl( jS:jN, timl ) /1000) , 'omitnan' );
                                wid_mesoWtoplfcaslRAT_ALLCASES(n,t,p,R,meth)   =  mean(  Wswath_top_asl( jS:jN, timl ) ./ ( Wswath_toplfcasl( jS:jN, timl ) /1000) , 'omitnan' );

                                %the 'good' for cloud extremma
                                wid_mesoWstrengthMAX_ALLCASES(n,t,p,R,meth)     = max(  Wswath_maxmag_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWwidthMAX_ALLCASES(n,t,p,R,meth)        = max(  Wswath_width_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWtopaglMAX_ALLCASES(n,t,p,R,meth)       = max(  Wswath_top_agl( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWtopaslMAX_ALLCASES(n,t,p,R,meth)       = max(  Wswath_top_asl( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWcapeMAX_ALLCASES(n,t,p,R,meth)         = max(  Wswath_mucape( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWcinMIN_ALLCASES(n,t,p,R,meth)          = min(  Wswath_mucin( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWqvapMAX_ALLCASES(n,t,p,R,meth)         = max(  Wswath_vapormean_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWlfcaslMIN_ALLCASES(n,t,p,R,meth)       = min(  Wswath_mulfcasl( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWlfcaglMIN_ALLCASES(n,t,p,R,meth)       = min(  Wswath_mulfcagl( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWthetaMAX_ALLCASES(n,t,p,R,meth)        = max(  Wswath_thetamean_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWthetaeMAX_ALLCASES(n,t,p,R,meth)       = max(  Wswath_thetaemean_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWdepthMAX_ALLCASES(n,t,p,R,meth)        = max(  Wswath_depth_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoWvmsumMAX_ALLCASES(n,t,p,R,meth)        = max(  Wswath_VMsum_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                %wid_mesoWvmsumHSUM_ALLCASES(n,t,p,R,meth)    = sum(  Wswath_VMsum_sm( jS:jN, timl ), 'omitnan' ) ;  %hoping that this accounts for a wid can have blank spots inthe w_object
                                %wid_mesoWalongsubupfract_ALLCASES(n,t,p,R,meth)  =  wposspan ./ wspan ;   %fraction of j points along w area that have a swath W_object
                                wid_mesoWtoplfcaglRATMAX_ALLCASES(n,t,p,R,meth)   =  max(  Wswath_top_agl( jS:jN, timl ) ./ ( Wswath_toplfcagl( jS:jN, timl ) /1000),[],1, 'omitnan' ) ;
                                wid_mesoWtoplfcaslRATMAX_ALLCASES(n,t,p,R,meth)   =  max(  Wswath_top_asl( jS:jN, timl ) ./ ( Wswath_toplfcasl( jS:jN, timl ) /1000),[],1, 'omitnan' ) ;

                                wid_mesoCstrengthMAX_ALLCASES(n,t,p,R,meth)     = max(  Cswath_maxmag_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoCwidthMAX_ALLCASES(n,t,p,R,meth)        = max(  Cswath_width_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoCdepthMAX_ALLCASES(n,t,p,R,meth)        = max(  Cswath_depth_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoCMFCmeanMAX_ALLCASES(n,t,p,R,meth)      = max(  Cswath_MFC_mean_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoCMCqadvmeanMAX_ALLCASES(n,t,p,R,meth)   = max(  Cswath_MCqadv_mean_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoCMCqconvmeanMAX_ALLCASES(n,t,p,R,meth)  = max(  Cswath_MCqconv_mean_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoCMFCmaxMAX_ALLCASES(n,t,p,R,meth)       = max(  Cswath_MFC_max_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoCMCqadvmaxMAX_ALLCASES(n,t,p,R,meth)    = max(  Cswath_MCqadv_max_sm( jS:jN, timl ),[],1, 'omitnan' ) ;
                                wid_mesoCMCqconvmaxMAX_ALLCASES(n,t,p,R,meth)   = max(  Cswath_MCqconv_max_sm( jS:jN, timl ),[],1, 'omitnan' ) ;


                                % % shear east of SDC, where most updrafts/cells are, upslope vars:
                                wid_mesoWeast1to5aslUshear_ALLCASES(n,t,p,R,meth)  =  mean( FullSDC_eastU1to5kmasl_bulkshear_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_mesoWeast1to5aslVshear_ALLCASES(n,t,p,R,meth)  =  mean( FullSDC_eastV1to5kmasl_bulkshear_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_mesoWeast1to9aslUshear_ALLCASES(n,t,p,R,meth)  =  mean( FullSDC_eastU1to9kmasl_bulkshear_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_mesoWeast1to9aslVshear_ALLCASES(n,t,p,R,meth)  =  mean( FullSDC_eastV1to9kmasl_bulkshear_ALLCASES(jS:jN,timl,R), 'omitnan' );

                                wid_eastupslopedepthfract_ALLCASES(n,t,p,R,meth)   =  mean( FullSDC_eastupslopedepthfract_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_westupslopedepthfract_ALLCASES(n,t,p,R,meth)   =  mean( FullSDC_westupslopedepthfract_ALLCASES(jS:jN,timl,R), 'omitnan' );

                                wid_eastupslopedepthfract2500masl_ALLCASES(n,t,p,R,meth)   =  mean( FullSDC_eastupslopedepthfract2500masl_ALLCASES(jS:jN,timl,R), 'omitnan' ) ;
                                wid_westupslopedepthfract2500masl_ALLCASES(n,t,p,R,meth)   =  mean( FullSDC_westupslopedepthfract2500masl_ALLCASES(jS:jN,timl,R), 'omitnan' ) ;
                                wid_eastupslopemean2500masl_ALLCASES(n,t,p,R,meth)         =  mean( FullSDC_eastupslopemean2500masl_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_westupslopemean2500masl_ALLCASES(n,t,p,R,meth)         =  mean( FullSDC_westupslopemean2500masl_ALLCASES(jS:jN,timl,R), 'omitnan' );

                                wid_eastupslopedepthfract1500magl_ALLCASES(n,t,p,R,meth)   =  mean( FullSDC_eastupslopedepthfract1500magl_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_westupslopedepthfract1500magl_ALLCASES(n,t,p,R,meth)   =  mean( FullSDC_westupslopedepthfract1500magl_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_eastupslopemean1500magl_ALLCASES(n,t,p,R,meth)         =  mean( FullSDC_eastupslopemean1500magl_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_westupslopemean1500magl_ALLCASES(n,t,p,R,meth)         =  mean( FullSDC_westupslopemean1500magl_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_eastupslopemean_ALLCASES(n,t,p,R,meth)         =  mean( FullSDC_eastupslopemean_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_westupslopemean_ALLCASES(n,t,p,R,meth)         =  mean( FullSDC_westupslopemean_ALLCASES(jS:jN,timl,R), 'omitnan' );

                                wid_eastUmean3to4kmasl_ALLCASES(n,t,p,R,meth)    =  mean( FullSDC_eastUmean3to4kmasl_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_eastUmean4to5kmasl_ALLCASES(n,t,p,R,meth)    =  mean( FullSDC_eastUmean4to5kmasl_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_eastUmean5to6kmasl_ALLCASES(n,t,p,R,meth)    =  mean( FullSDC_eastUmean5to6kmasl_ALLCASES(jS:jN,timl,R), 'omitnan' );

                                wid_eastupslopedepth_ALLCASES(n,t,p,R,meth)       =  mean( FullSDC_eastupslopedepth_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_eastupslopetophtasl_ALLCASES(n,t,p,R,meth)    =  mean( FullSDC_eastupslopetophtasl_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_westupslopedepth_ALLCASES(n,t,p,R,meth)       =  mean( FullSDC_westupslopedepth_ALLCASES(jS:jN,timl,R), 'omitnan' );
                                wid_westupslopetophtasl_ALLCASES(n,t,p,R,meth)    =  mean( FullSDC_westupslopetophtasl_ALLCASES(jS:jN,timl,R), 'omitnan' );


                                %
                                zmeanRH                                   =  mean(Wswathboxaloft_RH,2,'omitnan') ;      zmeanRH = permute(zmeanRH,[1 3 2]);
                                wid_mesoWmeanRHboxaloft_ALLCASES(n,t,p,R,meth) =  mean(  zmeanRH( jS:jN, timl ), 'omitnan' ) ;
                                zmeanQV                                   =  mean(Wswathboxaloft_QV,2,'omitnan') ;      zmeanQV = permute(zmeanQV,[1 3 2]);
                                wid_mesoWmeanQVboxaloft_ALLCASES(n,t,p,R,meth) =  mean(  zmeanQV( jS:jN, timl ), 'omitnan' ) ;

                                zmeanRHlfcrel                                   =  mean(Wswathboxaloft_RHlfcrel,2,'omitnan') ;      zmeanRHlfcrel = permute(zmeanRHlfcrel,[1 3 2]);
                                wid_mesoWmeanRHboxaloftlfcrel_ALLCASES(n,t,p,R,meth) =  mean(  zmeanRHlfcrel( jS:jN, timl ), 'omitnan' ) ;
                                zmeanQVlfcrel                                   =  mean(Wswathboxaloft_QVlfcrel,2,'omitnan') ;      zmeanQVlfcrel = permute(zmeanQVlfcrel,[1 3 2]);
                                wid_mesoWmeanQVboxaloftlfcrel_ALLCASES(n,t,p,R,meth) =  mean(  zmeanQVlfcrel( jS:jN, timl ), 'omitnan' ) ;

                                wid_meanUprof_ALLCASES(n,:,t,p,R,meth)    =   mean( FullSDC_eastU_ALLCASES(jS:jN,:,timl,R), 1, 'omitnan')  ;
                                wid_meanVprof_ALLCASES(n,:,t,p,R,meth)    =   mean( FullSDC_eastV_ALLCASES(jS:jN,:,timl,R), 1, 'omitnan')  ;

                            end
                        end

                        clear jN jS
                    end
                end  %t/n nan check
            end %t
        end %n
    
    toc

    end %methods   
    %  save('disposible_test.mat')


%   save('jan23test_disposible.mat','-v7.3')

end %  R

wid_mesoWeast1to5aslTOTMAGshear_ALLCASES = ( wid_mesoWeast1to5aslUshear_ALLCASES.^2   +   wid_mesoWeast1to5aslVshear_ALLCASES.^2 ).^0.5  ;
wid_mesoWeast1to9aslTOTMAGshear_ALLCASES = ( wid_mesoWeast1to9aslUshear_ALLCASES.^2   +   wid_mesoWeast1to9aslVshear_ALLCASES.^2 ).^0.5  ;

% %just mean along x to have one profile per j
% FullSDC_eastSDCboxUmeanprof_ALLCASES  =   mean(FullSDC_eastU_ALLCASES,2,'omitnan');
% FullSDC_eastSDCboxVmeanprof_ALLCASES  =   mean(FullSDC_eastV_ALLCASES,2,'omitnan');
% FullSDC_eastSDCboxUmeanprof_ALLCASES = permute(FullSDC_eastSDCboxUmeanprof_ALLCASES,[1 3 4 2]);
% FullSDC_eastSDCboxVmeanprof_ALLCASES = permute(FullSDC_eastSDCboxVmeanprof_ALLCASES,[1 3 4 2]);




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%     load pyflextrkr cell tracks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%just grab a random stats file from any old case to see how many cell track times Zhe used:
statsfile = '/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/20181129_gefs09_base_d4/trackstats_20181129.1200_20181130.0000.nc' ;  % ncdisp(statsfile)
meanlat_cell = ncread(statsfile,'core_meanlat');
[celltimes cellnum] = size(meanlat_cell) ;
clear meanlat_cell cellnum


%admin vars
date_ALLCASES = char(zeros(ar,8));
run_ALLCASES = char(zeros(ar,br));
num_cells_ALLCASES = zeros(ar,1) ;

% distance between cell centroid and swath (in e-w direction) - f(cell stats, only during full cell lifetime) [negative = west of swath, positive = east of swath]:
dist_cell_and_swath = zeros(numcelltimes,maxsizes,ar) ;      dist_cell_and_swath(:) = NaN;

% % cell population density along SDC
% CumCellPopAlongSDC_ALLCASES = zeros(sdclength,alltimes,ar);    CellPopAlongSDC_ALLCASES(:) = NaN;
% %cell ID population per time
% CellPopEachTime_ALLCASES = zeros(30,alltimes,ar);     CellPopEachTime_ALLCASES(:) = NaN;

% cell population density along SDC
CumCellPopAlongSDC_ALLCASES = zeros(sdclength,length(celltrack_hr),ar);    CumCellPopAlongSDC_ALLCASES(:) = NaN;
%cell ID population per time
CellPopEachTime_ALLCASES = zeros(30,length(celltrack_hr),ar);     CellPopEachTime_ALLCASES(:) = NaN;
%Cellstats in alongSDC frame
CellmaxdbxPopAlongSDC_ALLCASES  = zeros(sdclength,length(celltrack_hr),ar);    CellmaxdbxPopAlongSDC_ALLCASES(:) = NaN;
Celleth10PopAlongSDC_ALLCASES   = zeros(sdclength,length(celltrack_hr),ar);    Celleth10PopAlongSDC_ALLCASES(:) = NaN;
CellareaPopAlongSDC_ALLCASES    = zeros(sdclength,length(celltrack_hr),ar);    CellareaPopAlongSDC_ALLCASES(:) = NaN;
CellDistswathAlongSDC_ALLCASES = zeros(sdclength,length(celltrack_hr),ar);     CellDistswathAlongSDC_ALLCASES(:) = NaN;

eth10_fullcellrecord_ALLCASES    = zeros(numcelltimes,maxsizes,ar);    eth10_fullcellrecord_ALLCASES(:) = NaN;
maxdbz_fullcellrecord_ALLCASES   = zeros(numcelltimes,maxsizes,ar);    maxdbz_fullcellrecord_ALLCASES(:) = NaN;
basetime_fullcellrecord_ALLCASES = zeros(numcelltimes,maxsizes,ar);    basetime_fullcellrecord_ALLCASES(:) = NaN;

%loop through ensemble member runs:

for R = 1:ar

    
%   R = 1

    clearvars -except rootdir RUNS ar R Vadjusted_swath_window dx_model numwid alltimes Lat Lon Terr celltrack_hr newz_asl timelaglookback...
        dist_cell_and_swath CellPopAlongSDC_ALLCASES CellPopEachTime_ALLCASES maxtime_ALLCASES A_Ht_asl_vcs HHMMSS_all_ALLCASES Wswathboxaloft_Zasl Wswathboxaloft_Zasllfcrel xtracellrad ...
        AlongSwath_Jsmooth_pass AlongSwath_Jsmooth_window distswathwid_thresh ManSwathCull_keptMask...    
        ...
        mesoWwidth_nullmean_ALLCASES mesoWdepth_nullmean_ALLCASES mesoWstrength_nullmean_ALLCASES mesoWvmf_nullmean_ALLCASES...
        mesoWqvap_nullmean_ALLCASES mesoWtheta_nullmean_ALLCASES mesoWthetae_nullmean_ALLCASES ...   mesoWqvapca_nullmean_ALLCASES mesoWthetaca_nullmean_ALLCASES mesoWthetaeca_nullmean_ALLCASES ...
        mesoCwidth_nullmean_ALLCASES mesoCdepth_nullmean_ALLCASES mesoCstrength_nullmean_ALLCASES  ...
        mesoCMFCmean_nullmean_ALLCASES mesoCMCqadvmean_nullmean_ALLCASES mesoCMCqconvmean_nullmean_ALLCASES  ...
        mesoCMFCmax_nullmean_ALLCASES mesoCMCqadvmax_nullmean_ALLCASES mesoCMCqconvmax_nullmean_ALLCASES  ...
        ...
        mesoWwidth_nullfullsdc_ALLCASES mesoWdepth_nullfullsdc_ALLCASES mesoWstrength_nullfullsdc_ALLCASES mesoWvmf_nullfullsdc_ALLCASES...
        mesoWqvap_nullfullsdc_ALLCASES mesoWtheta_nullfullsdc_ALLCASES mesoWthetae_nullfullsdc_ALLCASES ...   % mesoWqvapca_nullfullsdc_ALLCASES mesoWthetaca_nullfullsdc_ALLCASES mesoWthetaeca_nullfullsdc_ALLCASES ...
        mesoWlfcasl_nullfullsdc_ALLCASES mesoWlfcagl_nullfullsdc_ALLCASES mesoWcape_nullfullsdc_ALLCASES ...
        mesoWcin_nullfullsdc_ALLCASES mesoWtopasl_nullfullsdc_ALLCASES mesoWtopagl_nullfullsdc_ALLCASES...
        mesoCwidth_nullfullsdc_ALLCASES mesoCdepth_nullfullsdc_ALLCASES mesoCstrength_nullfullsdc_ALLCASES ...
        mesoCMFCmean_nullfullsdc_ALLCASES mesoCMCqadvmean_nullfullsdc_ALLCASES mesoCMCqconvmean_nullfullsdc_ALLCASES ...
        mesoCMFCmax_nullfullsdc_ALLCASES mesoCMCqadvmax_nullfullsdc_ALLCASES mesoCMCqconvmax_nullfullsdc_ALLCASES ...
        ...
        prepost_timehr_ALLCASES prepost_timerelCI_ALLCASES prepost_mesoWwidth_ALLCASES prepost_mesoWdepth_ALLCASES prepost_mesoWstrength_ALLCASES prepost_mesoWvmf_ALLCASES ...
        prepost_mesoWqvap_ALLCASES prepost_mesoWtheta_ALLCASES prepost_mesoWthetae_ALLCASES ...    %prepost_mesoWqvapca_ALLCASES prepost_mesoWthetaca_ALLCASES prepost_mesoWthetaeca_ALLCASES ...
        prepost_mesoWlfcasl_ALLCASES prepost_mesoWlfcagl_ALLCASES prepost_mesoWcape_ALLCASES prepost_mesoWcin_ALLCASES ...
        prepost_mesoWtopasl_ALLCASES prepost_mesoWtopagl_ALLCASES prepost_mesoWtoplfcasl_ALLCASES prepost_mesoWtoplfcagl_ALLCASES  ...
        prepost_mesoCwidth_ALLCASES prepost_mesoCdepth_ALLCASES prepost_mesoCstrength_ALLCASES...
        prepost_mesoCMFCmean_ALLCASES prepost_mesoCMCqadvmean_ALLCASES prepost_mesoCMCqconvmean_ALLCASES...
        prepost_mesoCMFCmax_ALLCASES prepost_mesoCMCqadvmax_ALLCASES prepost_mesoCMCqconvmax_ALLCASES...
        ...
        prepost_localnull_mesoWwidth_ALLCASES prepost_localnull_mesoWdepth_ALLCASES prepost_localnull_mesoWstrength_ALLCASES  prepost_localnull_mesoWvmf_ALLCASES...
        prepost_localnull_mesoWqvap_ALLCASES prepost_localnull_mesoWtheta_ALLCASES prepost_localnull_mesoWthetae_ALLCASES ...   % prepost_localnull_mesoWqvapca_ALLCASES prepost_localnull_mesoWthetaca_ALLCASES prepost_localnull_mesoWthetaeca_ALLCASES ...
        prepost_localnull_mesoWlfcagl_ALLCASES  prepost_localnull_mesoWlfcasl_ALLCASES prepost_localnull_mesoWcape_ALLCASES prepost_localnull_mesoWcin_ALLCASES ...
        prepost_localnull_mesoWtopasl_ALLCASES prepost_localnull_mesoWtopagl_ALLCASES prepost_localnull_mesoWtoplfcasl_ALLCASES prepost_localnull_mesoWtoplfcagl_ALLCASES ...
        prepost_localnull_mesoCwidth_ALLCASES prepost_localnull_mesoCdepth_ALLCASES prepost_localnull_mesoCstrength_ALLCASES...
        prepost_localnull_mesoCMFCmean_ALLCASES prepost_localnull_mesoCMCqadvmean_ALLCASES prepost_localnull_mesoCMCqconvmean_ALLCASES...
        prepost_localnull_mesoCMFCmax_ALLCASES prepost_localnull_mesoCMCqadvmax_ALLCASES prepost_localnull_mesoCMCqconvmax_ALLCASES...
        ...
        cellCI_maxETH10_ALLCASES cellCI_maxdbz_ALLCASES cellCI_cellarea_ALLCASES cellCI_corearea_ALLCASES cellCI_cell_motion_x_ALLCASES cellCI_cell_motion_y_ALLCASES ...
        cellfull_maxETH10_ALLCASES cellfull_maxdbz_ALLCASES cellfull_cellarea_ALLCASES cellfull_corearea_ALLCASES cellfull_duration_ALLCASES dist_wid_and_swath_ALLCASES ...
        cellCI_meanlon_ALLCASES cellCI_meanlat_ALLCASES cellfull_endmergestatus_ALLCASES cellfull_startsplitstatus_ALLCASES ...
        ...
        preCIandCI_ucrel_acbl_ALLCASES preCIandCI_rh_acbl_ALLCASES preCIandCI_thetae_acbl_ALLCASES preCIandCI_cape_acbl_ALLCASES preCIandCI_cape_deep_ALLCASES ...
        preCIandCI_mucin_ALLCASES preCIandCI_shear03_ALLCASES preCIandCI_shear06_ALLCASES preCIandCI_shear09_ALLCASES preCIandCI_mulcl_ALLCASES preCIandCI_muel_ALLCASES preCIandCI_mulfc_ALLCASES preCIandCI_ucrel_mu_ALLCASES ...
        preCIandCI_vcrel_mu_ALLCASES preCIandCI_upslopemax_ALLCASES preCIandCI_upslopemean_ALLCASES preCIandCI_upslopefract_ALLCASES preCIandCI_upslopedepth_ALLCASES...
        ...
        date_ALLCASES run_ALLCASES num_cells_ALLCASES imout xtracellrad dist_cell_and_swath cellkeeper_mask_ALLCASES lonEast lonWest latNorth latSouth ...
        HHMMSS_all_ALLCASES YYMMDD_all alltimes sdclength CumCellPopAlongSDC_ALLCASES  CellPopEachTime_ALLCASES CellmaxdbxPopAlongSDC_ALLCASES ...
        Celleth10PopAlongSDC_ALLCASES CellareaPopAlongSDC_ALLCASES CellDistswathAlongSDC_ALLCASES ... 
        ...
        FullSDC_mesoWwidth_ALLCASES FullSDC_mesoWdepth_ALLCASES FullSDC_mesoWstrength_ALLCASES ...
        FullSDC_VMfluxSum_ALLCASES FullSDC_swathmucin_ALLCASES FullSDC_swathmucape_ALLCASES FullSDC_swathmulfcasl_ALLCASES FullSDC_swathmulfcagl_ALLCASES ...
        FullSDC_swathqvap_ALLCASES FullSDC_swathtopasl_ALLCASES  FullSDC_swathtopagl_ALLCASES FullSDC_swathbotasl_ALLCASES  FullSDC_swathbotagl_ALLCASES FullSDC_swathtoplfcasl_ALLCASES FullSDC_swathtoplfcagl_ALLCASES  ...
        FullSDC_eastU_ALLCASES FullSDC_eastV_ALLCASES FullSDC_westU_ALLCASES FullSDC_westV_ALLCASES FullSDC_eastV1to5kmasl_bulkshear_ALLCASES FullSDC_eastU1to5kmasl_bulkshear_ALLCASES ...
        FullSDC_eastV1to9kmasl_bulkshear_ALLCASES FullSDC_eastU1to9kmasl_bulkshear_ALLCASES ...
        FullSDC_eastupslopedepthfract_ALLCASES FullSDC_westupslopedepthfract_ALLCASES FullSDC_eastupslopemean_ALLCASES FullSDC_westupslopemean_ALLCASES ...
        FullSDC_swathcentlat_ALLCASES FullSDC_swathcentlon_ALLCASES FullSDC_swaththetamean_ALLCASES FullSDC_swaththetaemean_ALLCASES FullSDC_swathboxaloftRH_ALLCASES FullSDC_swathboxaloftQV_ALLCASES...
        FullSDC_eastupslopedepthfract2500masl_ALLCASES FullSDC_westupslopedepthfract2500masl_ALLCASES FullSDC_eastupslopemean2500masl_ALLCASES FullSDC_westupslopemean2500masl_ALLCASES ...
        FullSDC_eastupslopedepthfract1500magl_ALLCASES FullSDC_westupslopedepthfract1500magl_ALLCASES FullSDC_eastupslopemean1500magl_ALLCASES FullSDC_westupslopemean1500magl_ALLCASES ... 
        FullSDC_eastUmean3to4kmasl_ALLCASES  FullSDC_eastUmean4to5kmasl_ALLCASES FullSDC_eastUmean5to6kmasl_ALLCASES wid_eastUmean3to4kmasl_ALLCASES wid_eastUmean4to5kmasl_ALLCASES wid_eastUmean5to6kmasl_ALLCASES  ...
        FullSDC_swathboxaloftRHlfcrel_ALLCASES FullSDC_swathboxaloftQVlfcrel_ALLCASES...
        ...
        FullSDC_mesoCwidth_ALLCASES FullSDC_mesoCdepth_ALLCASES FullSDC_mesoCstrength_ALLCASES FullSDC_mesoCMFCmean_ALLCASES FullSDC_mesoCMCqadvmean_ALLCASES ...  
        FullSDC_mesoCMCqconvmean_ALLCASES FullSDC_mesoCMFCmax_ALLCASES FullSDC_mesoCMCqadvmax_ALLCASES FullSDC_mesoCMCqconvmax_ALLCASES  ...
        ...
        updraftbaseZ_ALLCASES totalwarea_cldbase_ALLCASES  maxwarea_cldbase_ALLCASES maxw_cldbase_ALLCASES ...
        maxnumwcores_cldbase_ALLCASES totalwarea_fullcld_ALLCASES maxwarea_fullcld_ALLCASES maxw_fullcld_ALLCASES maxnumwcores_fullcld_ALLCASES swathboxaloft_RH_ALLCASES  ...
        ...
        wid_profs_area_ALLCASES wid_profs_maxmag_ALLCASES wid_profs_massflux_ALLCASES wid_profs_centlat_ALLCASES wid_profs_centlon_ALLCASES wid_profs_centHTagl_ALLCASES wid_profs_centHTasl_ALLCASES ...
        wid_profs_northj_ALLCASES wid_profs_southj_ALLCASES wid_profs_centlat_ALLCASES_preserve...
        ...
        wid_mesoWstrength_ALLCASES wid_mesoWwidth_ALLCASES wid_mesoWtopagl_ALLCASES wid_mesoWtopasl_ALLCASES wid_mesoWvmsum_ALLCASES ...
        wid_mesoWcape_ALLCASES wid_mesoWcin_ALLCASES wid_mesoWqvap_ALLCASES wid_mesoWlfcasl_ALLCASES wid_mesoWlfcagl_ALLCASES...
        wid_mesoWtheta_ALLCASES wid_mesoWthetae_ALLCASES wid_mesoWdepth_ALLCASES wid_mesoWdepthrat_ALLCASES wid_profs_klfcagl_ALLCASES...
        wid_mesoWtoplfcaglRAT_ALLCASES wid_mesoWtoplfcaslRAT_ALLCASES wid_mesoWalongsubupfract_ALLCASES wid_mesoWvmsumHSUM_ALLCASES ...
        wid_mesoWeast1to5aslUshear_ALLCASES wid_mesoWeast1to5aslVshear_ALLCASES wid_mesoWeast1to9aslUshear_ALLCASES wid_mesoWeast1to9aslVshear_ALLCASES wid_eastupslopedepthfract_ALLCASES wid_westupslopedepthfract_ALLCASES...
        wid_eastupslopemean_ALLCASES wid_westupslopemean_ALLCASES wid_mesoWeast1to5aslTOTMAGshear_ALLCASES  wid_mesoWeast1to9aslTOTMAGshear_ALLCASES wid_mesoWmeanRHboxaloft_ALLCASES wid_mesoWmeanQVboxaloft_ALLCASES...
        wid_meanUprof_ALLCASES wid_meanVprof_ALLCASES wid_bulkUshearinupdraft_ALLCASES wid_bulkVshearinupdraft_ALLCASES wid_eastupslopedepthfract2500masl_ALLCASES wid_westupslopedepthfract2500masl_ALLCASES...
        wid_eastupslopemean2500masl_ALLCASES wid_westupslopemean2500masl_ALLCASES wid_eastUmean3to4kmasl_ALLCASES wid_eastUmean4to5kmasl_ALLCASES wid_eastUmean5to6kmasl_ALLCASES...
        FullSDC_eastupslopedepth_ALLCASES wid_eastupslopedepth_ALLCASES FullSDC_eastupslopetophtasl_ALLCASES wid_eastupslopetophtasl_ALLCASES...
        FullSDC_westupslopedepth_ALLCASES wid_westupslopedepth_ALLCASES FullSDC_westupslopetophtasl_ALLCASES wid_westupslopetophtasl_ALLCASES ...
        wid_eastupslopedepthfract1500magl_ALLCASES wid_westupslopedepthfract1500magl_ALLCASES wid_eastupslopemean1500magl_ALLCASES wid_westupslopemean1500magl_ALLCASES ...
        wid_mesoWstrengthMAX_ALLCASES wid_mesoWwidthMAX_ALLCASES wid_mesoWtopaglMAX_ALLCASES wid_mesoWtopaslMAX_ALLCASES wid_mesoWcapeMAX_ALLCASES ...
        wid_mesoWcinMIN_ALLCASES wid_mesoWqvapMAX_ALLCASES wid_mesoWlfcaslMIN_ALLCASES wid_mesoWlfcaglMIN_ALLCASES wid_mesoWthetaMAX_ALLCASES ...
        wid_mesoWthetaeMAX_ALLCASES wid_mesoWdepthMAX_ALLCASES wid_mesoWvmsumMAX_ALLCASES wid_mesoWtoplfcaglRATMAX_ALLCASES wid_mesoWtoplfcaslRATMAX_ALLCASES methrad_log ...
        wid_mesoCstrength_ALLCASES wid_mesoCwidth_ALLCASES wid_mesoCdepth_ALLCASES...
        wid_mesoCMFCmean_ALLCASES wid_mesoCMCqadvmean_ALLCASES wid_mesoCMCqconvmean_ALLCASES...
        wid_mesoCMFCmax_ALLCASES wid_mesoCMCqadvmax_ALLCASES wid_mesoCMCqconvmax_ALLCASES...
        wid_mesoCstrengthMAX_ALLCASES wid_mesoCwidthMAX_ALLCASES wid_mesoCdepthMAX_ALLCASES...
        wid_mesoCMFCmeanMAX_ALLCASES wid_mesoCMCqadvmeanMAX_ALLCASES wid_mesoCMCqconvmeanMAX_ALLCASES...
        wid_mesoCMFCmaxMAX_ALLCASES wid_mesoCMCqadvmaxMAX_ALLCASES wid_mesoCMCqconvmaxMAX_ALLCASES...
        ...
        FwID_MUCAPE_ALLCASES FwID_MUCIN_ALLCASES FwID_MULFC_ALLCASES FwID_MULCL_ALLCASES FwID_MUEL_ALLCASES FwID_MUvap_ALLCASES FwID_MUACBLCAPE_ALLCASES ...
        FwID_RH_mean_ACBL_ALLCASES FwID_thetae_mean_ACBL_mu_ALLCASES FwID_shear_mag_bulk_FT_mu_ALLCASES FwID_shear_mag_bulk_ACBL_mu_ALLCASES...
        FwID_shear_mag_bulk_0to1km_ALLCASES FwID_shear_mag_bulk_0to3km_ALLCASES FwID_shear_mag_bulk_0to6km_ALLCASES FwID_shear_mag_bulk_0to9km_ALLCASES...
        FwID_upslope_mean_ALLCASES FwID_upslope_max_ALLCASES FwID_upslope_depth_ALLCASES FwID_upslope_fract_ALLCASES FwID_MUtheta_ALLCASES FwID_MUthetae_ALLCASES...
        FwID_RH_500mb_ALLCASES FwID_RH_600mb_ALLCASES FwID_RH_5kmasl_ALLCASES FwID_RH_6kmasl_ALLCASES...
        ...
        eth10_fullcellrecord_ALLCASES maxdbz_fullcellrecord_ALLCASES basetime_fullcellrecord_ALLCASES...
        ...
        FullSDC_TFCbox_eastupslopedepth_ALLCASES FullSDC_TFCbox_westupslopedepth_ALLCASES FullSDC_TFCbox_eastupslopemean_ALLCASES FullSDC_TFCbox_westupslopemean_ALLCASES ...
        FullSDC_TFCbox_eastU_ALLCASES FullSDC_TFCbox_westU_ALLCASES FullSDC_TFCbox_eastupslopedepthfract_ALLCASES FullSDC_TFCbox_eastupslopemean_ALLCASES...
        FullSDC_TFCbox_eastupslopedepthfract2500masl_ALLCASES FullSDC_TFCbox_eastupslopemean2500masl_ALLCASES FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES...
        FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES FullSDC_TFCbox_eastUmean5to6kmasl_ALLCASES FullSDC_TFCbox_eastupslopedepth_ALLCASES FullSDC_TFCbox_eastupslopetophtasl_ALLCASES...
        FullSDC_TFCbox_eastupslopedepthfract1500magl_ALLCASES FullSDC_TFCbox_eastupslopemean1500magl_ALLCASES FullSDC_TFCbox_westupslopedepthfract_ALLCASES ...
        FullSDC_TFCbox_westupslopemean_ALLCASES FullSDC_TFCbox_westupslopedepthfract2500masl_ALLCASES FullSDC_TFCbox_westupslopemean2500masl_ALLCASES ...
        FullSDC_TFCbox_westupslopedepth_ALLCASES FullSDC_TFCbox_westupslopetophtasl_ALLCASES FullSDC_TFCbox_westupslopedepthfract1500magl_ALLCASES FullSDC_TFCbox_westupslopemean1500magl_ALLCASES...
        prepost_mesoWTFCbox_eastupslopedepth_ALLCASES prepost_localnull_mesoWTFCbox_eastupslopedepth_ALLCASES...
        prepost_mesoWTFCbox_eastupslopedepthfract_ALLCASES prepost_mesoWTFCbox_eastupslopemean_ALLCASES prepost_mesoWTFCbox_eastupslopetophtasl_ALLCASES prepost_mesoWTFCbox_eastupslopedepthfract2500masl_ALLCASES ...  
        prepost_mesoWTFCbox_eastupslopemean2500masl_ALLCASES  prepost_mesoWTFCbox_eastupslopedepthfract1500magl_ALLCASES  prepost_mesoWTFCbox_eastupslopemean1500magl_ALLCASES ...       
        prepost_mesoWTFCbox_eastUmean3to4kmasl_ALLCASES prepost_mesoWTFCbox_eastUmean4to5kmasl_ALLCASES  prepost_mesoWTFCbox_eastUmean5to6kmasl_ALLCASES...            
        prepost_mesoWTFCbox_westupslopedepthfract_ALLCASES prepost_mesoWTFCbox_westupslopetophtasl_ALLCASES  prepost_mesoWTFCbox_westupslopedepthfract2500masl_ALLCASES ...  
        prepost_mesoWTFCbox_westupslopemean2500masl_ALLCASES prepost_mesoWTFCbox_westupslopedepthfract1500magl_ALLCASES  prepost_mesoWTFCbox_westupslopemean1500magl_ALLCASES       


    
    dire = strcat(rootdir, RUNS(R,:),'/' )  ;
    %dir = strcat(rootdir, RUNS(R,:),'/subsample/' )  ;

    %somewhat hardcoded lable for output
    wherethe2at = find(dire == '2') ;
    wherethe3at = find(dire == '4') ;
    runlab = dire(wherethe2at(1):wherethe3at(end))   ;
    runlab(runlab == '/') = '_'  ;

    date = runlab(1:8) ;




    %     disp('   ')
    %     disp( ' Starting work on case: ' )
    %     disp( runlab )
    %     disp('   ')

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%% load cell stats:
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%


    file = strcat('trackstats_', date, '.1200_',num2str( str2num(date) + 1), '.0000.nc')  ;
    % file = 'trackstats_20190129.1200_20190130.0000.nc';


    %statsfile = strcat(dir,'/old/',file);  % ncdisp(statsfile)
    statsfile = strcat(dire,file) ;  % ncdisp(statsfile)


    meanlat_cell = ncread(statsfile,'core_meanlat');
    meanlon_cell = ncread(statsfile,'core_meanlon');
    corearea_cell = ncread(statsfile,'core_area');
    cellarea_cell = ncread(statsfile,'cell_area');
    basetime_cell = ncread(statsfile,'base_time');
    cloudnum_cell = ncread(statsfile,'cloudnumber');
    maxdbz_cell = ncread(statsfile,'max_dbz');
    ETH10_cell = ncread(statsfile,'maxETH_10dbz');
    startstatus_cell = ncread(statsfile,'start_status') ;  %
    endstatus_cell = ncread(statsfile,'end_status') ;
    endmergecloudnumber_cell = ncread(statsfile,'end_merge_cloudnumber') ;
    startsplitcloudnumber_cell = ncread(statsfile,'start_split_cloudnumber') ;
    duration_cell = ncread(statsfile,'track_duration');
    fullstatus_cell = ncread(statsfile,'track_status');

    [ac bc] = size(ETH10_cell);
    eth10_fullcellrecord_ALLCASES(1:ac,1:bc,R)    = ETH10_cell;
    maxdbz_fullcellrecord_ALLCASES(1:ac,1:bc,R)   = maxdbz_cell;
    basetime_fullcellrecord_ALLCASES(1:ac,1:bc,R) = basetime_cell;

    num_cells_ALLCASES(R) = length(duration_cell);

    hhmmss_cell = datetime(basetime_cell, 'convertfrom','posixtime','Format','HHmmss') ;
    hhmmss_cell = string(hhmmss_cell);

    % convert cell time to hour.decimal
    [ia ib] = size(hhmmss_cell);
    hour_cell = zeros(ia,ib); hour_cell(:) = NaN;
    for ii = 1:ia
        for jj = 1:ib
            %disp(hhmmss_cell(ii,jj))
            if(ismissing(hhmmss_cell(ii,jj)) == 0)
                blah = char(hhmmss_cell(ii,jj));
                hour_cell(ii,jj) = str2num(blah(1:2)) + str2num(blah(3:4))/60 ;
            end
        end
    end

    %initialize cell stats dummy array in cellstats format for meso W swath metrics, env param metrics:
    dummy = ETH10_cell; dummy(:) = NaN;

    hour_cell(hour_cell==0) = 24;
    hour_cell_ALLCASES(1:ia,1:ib,R) = hour_cell;



    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%% load updraft stats for flextrkr cells:      
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    %{

    file = strcat('stats_3d_w_', date, '.1200_',num2str( str2num(date) + 1), '.0000.nc')  ;
    updraftstatsfile = strcat(dire,file) ;  %   ncdisp(updraftstatsfile)
    area_updraft = ncread(updraftstatsfile,'CoreArea_up');
    max_updraft = ncread(updraftstatsfile,'CoreMaxW_up');
    numcores_updraft = ncread(updraftstatsfile,'nCore_up');
    massflux_updraft = ncread(updraftstatsfile,'CoreMassFlux_up');
    numc_updraft = ncread(updraftstatsfile,'core');
    Zmsl_updraft = ncread(updraftstatsfile,'z');
    times_updraft = ncread(updraftstatsfile,'times');
    [ncore_updraft nz_updraft ntimes_updraft ntracks_updraft] = size(area_updraft) ;
    %}

    %convert meso time to hour.decimal
    mesoCIhh = HHMMSS_all_ALLCASES(:,1:2,R) ;
    mesoCImm = HHMMSS_all_ALLCASES(:,3:4,R) ;
    HOUR_all = str2num(mesoCIhh) + str2num(mesoCImm)/60 ;
    %the N-S latitude profile for the SDC ridgeline
    lat_alongSDC = Lat(200,:);
    %  figure; contourf(Lon,Lat,Terr);   figure; contourf(Terr')
    


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%% load pyflextrkr cell tracks:
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
    disp('    ')
    disp(' loading cell tracks for: ')
    disp( RUNS(R,:) )
    disp('    ')
    
    tracklist = ls( horzcat(dire, 'celltracks*nc') ) ; 
    tracklist = split(tracklist) ;    tracklist(end,:) = [];
    [ta tb] = size(tracklist) ; clear tb ;
    blah = ncread(char(tracklist(1)),'tracknumber'); [tta ttb] = size(blah) ; clear blah
    track_lon = ncread(char(tracklist(1)),'longitude');
    track_lat = ncread(char(tracklist(1)),'latitude');
    % catalog them :
    for tt = 1:1:ta
        trackfile = char(tracklist(tt));
        celltrack_all(:,:,tt) = ncread(trackfile,'cloudtracknumber');
        celltrack_basetime(:,:,tt) = ncread(trackfile,'time');
    end
    %    celltrack_basetime_hhmmss  =  datetime(celltrack_basetime,'convertfrom','posixtime','Format','HHmmss') ;    %diagnostic



    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%% load environmental parameters corresponding to flextrkrcell(stats) tracks:
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    cellsparamfile = ls( horzcat(dire, 'EnvMetrics_*nc') )   ;
    cellsparamfile = split(cellsparamfile)  ;
    cellsparamfile = char(cellsparamfile(1,:)) ;

    % ncdisp(cellsparamfile)

    ucrel_mean_acbl = ncread(cellsparamfile,'Ucrel_mean_ACBL_mu');
    rh_mean_acbl = ncread(cellsparamfile,'RH_mean_ACBL');
    thetae_mean_acbl = ncread(cellsparamfile,'thetae_mean_ACBL_mu');
    cape_acbl = ncread(cellsparamfile,'CAPEacbl_mu');
    mulfc = ncread(cellsparamfile,'LFC_height_mu');
    mulcl = ncread(cellsparamfile,'LCL_height_mu');
    muel = ncread(cellsparamfile,'EL_height_mu');
    mucin = ncread(cellsparamfile,'CIN_mu');
    shear03 = ncread(cellsparamfile,'shear_mag_bulk_0to3km');
    shear06 = ncread(cellsparamfile,'shear_mag_bulk_0to6km');
    shear09 = ncread(cellsparamfile,'shear_mag_bulk_0to9km');
    cape_deep = ncread(cellsparamfile,'CAPE_mu');
    ucrel_mu = ncread(cellsparamfile,'Ucrel_mu');
    vcrel_mu = ncread(cellsparamfile,'Vcrel_mu');
    cell_motion_x = ncread(cellsparamfile,'cell_motion_x');
    cell_motion_y = ncread(cellsparamfile,'cell_motion_y');
    upslopemax = ncread(cellsparamfile,'upslope_max');
    upslopemean = ncread(cellsparamfile,'upslope_mean');
    upslopefract = ncread(cellsparamfile,'upslope_fract');
    upslopedepth = ncread(cellsparamfile,'upslope_depth');


    % to distill down to a single value, I will need to define an averaging(or
    % other operator) annulus for the CI time

    [ei ej et en] = size(rh_mean_acbl) ;

    %initialize cell stats near-cloud env param arrays at the 13 times before/at CI time for Zhe's new cell track 3denv format:
    preCIandCI_ucrel_acbl = zeros(en,et) ;    preCIandCI_ucrel_acbl(:) = NaN;
    preCIandCI_rh_acbl = zeros(en,et) ;      preCIandCI_rh_acbl(:) = NaN;
    preCIandCI_thetae_acbl = zeros(en,et) ;  preCIandCI_thetae_acbl(:) = NaN;
    preCIandCI_cape_acbl = zeros(en,et) ;    preCIandCI_cape_acbl(:) = NaN;
    preCIandCI_cape_deep = zeros(en,et) ;     preCIandCI_cape_deep(:) = NaN;
    preCIandCI_mucin = zeros(en,et) ;         preCIandCI_mucin(:) = NaN;
    preCIandCI_shear03 = zeros(en,et) ;       preCIandCI_shear03(:) = NaN;
    preCIandCI_shear06 = zeros(en,et) ;       preCIandCI_shear06(:) = NaN;
    preCIandCI_shear09 = zeros(en,et) ;       preCIandCI_shear09(:) = NaN;
    preCIandCI_mulcl = zeros(en,et) ;        preCIandCI_mulcl(:) = NaN;
    preCIandCI_muel = zeros(en,et) ;         preCIandCI_muel(:) = NaN;
    preCIandCI_mulfc = zeros(en,et) ;         preCIandCI_mulfc(:) = NaN;
    preCIandCI_ucrel_mu = zeros(en,et) ;     preCIandCI_ucrel_mu(:) = NaN;
    preCIandCI_vcrel_mu = zeros(en,et) ;      preCIandCI_vcrel_mu(:) = NaN;
    preCIandCI_upslopemax = zeros(en,et) ;    preCIandCI_upslopemax(:) = NaN;
    preCIandCI_upslopemean = zeros(en,et) ;   preCIandCI_upslopemean(:) = NaN;
    preCIandCI_upslopefract = zeros(en,et) ;  preCIandCI_upslopefract(:) = NaN;
    preCIandCI_upslopedepth = zeros(en,et) ;  preCIandCI_upslopedepth(:) = NaN;


    %%%%%%%%%%%%%%%%%%%
    %%%  calculate environmental metrics for each flextrkr cell
    %%%%%%%%%%%%%%%%%%

    % define a reference distance field (from centroid of cell) to be used for targeting an averaging annulus:
    %this chunk can later be depricated when I read in dbz and cell masks
    %from stats_3d_env_ file


    disp('    ')
    disp(' calculating env metrics per flextrkr cell for ')
    disp( RUNS(R,:) )
    disp('    ')
    tic

    %%%%  no longer doing the annulus thing because env paraameters now preceed CI (except for last time)
    %     dx_env = 1.0;   % dx of 3d_env_stats file
    %     xcell = [-30:dx_env:30];
    %     ycell = [-30:dx_env:30];
    %     [xc yc] = meshgrid(xcell, ycell);
    %     dist_km = (xc.*xc + yc.*yc).^0.5;
    %     buffer_in = 1; % just a buffer distance
    %     annulus_thickness = 10 ; % width of opperator annulus (from Rinner), km

    for t = 1:et  % pre-CI + CI:  [t = 1-5]
        % this *should be* just following along with the stats_3d_env
        % timing, which is t = 1(CI - 60 min), 2(CI - 45 min), 3(CI - 30 min), 4(CI - 15 min), 5(CI)

        for n = 1:en
            %             % inner and outer operator annulus (km):
            %             Rinner = (cellarea_cell(1,n) / 3.14159 ).^0.5  +  buffer_in ;  %based on equivaltent circular area's radius (+ buffer)
            %             Router = Rinner + annulus_thickness;   %
            %             %averaging annulus:
            %             annulus = find(dist_km > Rinner & dist_km < Router);
            %             var = rh_mean_acbl(:,:,t,n) ;
            %             preCIandCI_rh_acbl(t,n) = mean(mean( var(annulus),'omitnan'));
            %             clear var

            %populate the environmental stats files in pre-CI + CI format:
            preCIandCI_ucrel_acbl(n,t) = mean(mean( ucrel_mean_acbl(:,:,t,n),'omitnan'));
            preCIandCI_rh_acbl(n,t) = mean(mean( rh_mean_acbl(:,:,t,n),'omitnan'));
            preCIandCI_thetae_acbl(n,t) = mean(mean( thetae_mean_acbl(:,:,t,n),'omitnan'));
            preCIandCI_cape_acbl(n,t) = mean(mean( cape_acbl(:,:,t,n),'omitnan'));
            preCIandCI_cape_deep(n,t) = mean(mean( cape_deep(:,:,t,n),'omitnan'));
            preCIandCI_mucin(n,t) = mean(mean( mucin(:,:,t,n),'omitnan'));
            preCIandCI_shear03(n,t) = mean(mean( shear03(:,:,t,n),'omitnan'));
            preCIandCI_shear06(n,t) = mean(mean( shear06(:,:,t,n),'omitnan'));
            preCIandCI_shear09(n,t) = mean(mean( shear09(:,:,t,n),'omitnan'));
            preCIandCI_mulfc(n,t) = mean(mean( mulfc(:,:,t,n),'omitnan'));
            preCIandCI_mulcl(n,t) = mean(mean( mulcl(:,:,t,n) ,'omitnan'));
            preCIandCI_muel(n,t) = mean(mean( muel(:,:,t,n) ,'omitnan'));
            preCIandCI_ucrel_mu(n,t) = mean(mean( ucrel_mu(:,:,t,n) ,'omitnan'));
            preCIandCI_vcrel_mu(n,t) = mean(mean( vcrel_mu(:,:,t,n),'omitnan'));

            preCIandCI_upslopemax(n,t) = mean(mean(   upslopemax(:,:,t,n) ,'omitnan')); 
            preCIandCI_upslopemean(n,t) = mean(mean(   upslopemean(:,:,t,n) ,'omitnan')); 
            preCIandCI_upslopefract(n,t) = mean(mean(   upslopefract(:,:,t,n) ,'omitnan')); 
            preCIandCI_upslopedepth(n,t) = mean(mean(   upslopedepth(:,:,t,n) ,'omitnan')); 

            %clear var annulus Rinner Router
        end
    end

    clear ucrel_mean_acbl rh_mean_acbl thetae_mean_acbl cape_acbl cape_deep muel
    clear mucin mulfc mulcl ucrel_mu vcrel_mu upslopemax upslopemean upslopefract upslopedepth

    toc
    disp('   ')
    

    disp('    ')
    disp(' populate swath metrics ')
    disp( RUNS(R,:) )
    disp('    ')                       

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%% populate mesosale w-swath metric arrays in cell-stats frame
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    %kinematics in w-swath adjacent with cells
    mesoWwidth_cell = dummy;
    mesoWdepth_cell = dummy;
    mesoWstrength_cell = dummy;
    mesoWvmf_cell = dummy;
    mesoWtopasl_cell = dummy;
    mesoWtopagl_cell = dummy;
    mesoWtoplfcasl_cell = dummy;
    mesoWtoplfcagl_cell = dummy;
    mesoWqvap_cell = dummy;
    mesoWtheta_cell = dummy;
    mesoWthetae_cell = dummy;
    mesoWlfcagl_cell = dummy;
    mesoWlfcasl_cell = dummy;
    mesoWcape_cell = dummy;
    mesoWcin_cell = dummy;

    mesoCwidth_cell  = dummy;
    mesoCdepth_cell  = dummy;
    mesoCstrength_cell  = dummy;
    mesoCMFCmean_cell  = dummy;
    mesoCMCqadvmean_cell  = dummy;
    mesoCMCqconvmean_cell  = dummy;
    mesoCMFCmax_cell  = dummy;
    mesoCMCqadvmax_cell  = dummy;
    mesoCMCqconvmax_cell  = dummy;


    mesoW_TFCbox_eastupslopedepth_cell = dummy;
    mesoW_TFCbox_eastupslopemean_cell = dummy;
    mesoW_TFCbox_eastupslopedepthfract_cell = dummy;
    mesoW_TFCbox_eastupslopetophtasl_cell = dummy;
    mesoW_TFCbox_eastupslopedepthfract2500masl_cell = dummy;
    mesoW_TFCbox_eastupslopemean2500masl_cell = dummy;
    mesoW_TFCbox_eastupslopedepthfract1500magl_cell = dummy;
    mesoW_TFCbox_eastupslopemean1500magl_cell = dummy;
    mesoW_TFCbox_eastUmean3to4kmasl_cell = dummy;
    mesoW_TFCbox_eastUmean4to5kmasl_cell = dummy; 
    mesoW_TFCbox_eastUmean5to6kmasl_cell = dummy;
    mesoW_TFCbox_westupslopedepthfract_cell = dummy;
    mesoW_TFCbox_westupslopetophtasl_cell = dummy;
    mesoW_TFCbox_westupslopedepthfract2500masl_cell = dummy;
    mesoW_TFCbox_westupslopemean2500masl_cell = dummy;
    mesoW_TFCbox_westupslopedepthfract1500magl_cell = dummy;
    mesoW_TFCbox_westupslopemean1500magl_cell = dummy;

    %null kinematics in w-swath neighboring cell:
    nulllocalcell_mesoWwidth = dummy;
    nulllocalcell_mesoWdepth = dummy;
    nulllocalcell_mesoWstrength = dummy;
    nulllocalcell_mesoWvmf = dummy;
    nulllocalcell_mesoWtopasl = dummy;
    nulllocalcell_mesoWtopagl = dummy;
    nulllocalcell_mesoWqvap = dummy;
    nulllocalcell_mesoWtheta = dummy;
    nulllocalcell_mesoWthetae = dummy;
    nulllocalcell_mesoWlfcagl = dummy;
    nulllocalcell_mesoWlfcasl = dummy;
    nulllocalcell_mesoWcape = dummy;
    nulllocalcell_mesoWcin = dummy;
    nulllocalcell_mesoWtoplfcagl = dummy;
    nulllocalcell_mesoWtoplfcasl = dummy;

    nulllocalcell_mesoCwidth = dummy;
    nulllocalcell_mesoCdepth = dummy;
    nulllocalcell_mesoCstrength = dummy;
    nulllocalcell_mesoCMFCmean = dummy;
    nulllocalcell_mesoCMCqadvmean = dummy;
    nulllocalcell_mesoCMCqconvmean = dummy;
    nulllocalcell_mesoCMFCmax = dummy;
    nulllocalcell_mesoCMCqadvmax = dummy;
    nulllocalcell_mesoCMCqconvmax = dummy;


    nulllocalcell_mesoWTFCbox_eastupslopedepth = dummy;
    

    %initialize cell stats for aloft box metrics:
    dummy = ETH10_cell; dummy(:) = NaN;
    [as bs] = size(dummy)  ;
    

    disp('    ')
    disp(' populate swath metrics prior to CI ')
    disp( RUNS(R,:) )
    disp('    ') 


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%% Now catalog the mesoscale swath metrics for the times prior to cell tracks (for CI -15min, -30min, -45min, -60 min):
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    % swath properties for Cells:
    %kinematic records in w-swath:
    mesoWwidth_preCI = zeros(bs ,4)    ; mesoWwidth_preCI(:) = NaN;
    mesoWdepth_preCI = zeros(bs,4)    ; mesoWdepth_preCI(:) = NaN;
    mesoWstrength_preCI = zeros(bs,4) ; mesoWstrength_preCI(:) = NaN;
    mesoWvmf_preCI = zeros(bs,4) ;     mesoWvmf_preCI(:) = NaN;
    mesoWtopasl_preCI = zeros(bs,4) ; mesoWtopasl_preCI(:) = NaN;
    mesoWtopagl_preCI = zeros(bs,4) ; mesoWtopagl_preCI(:) = NaN;
    mesoWtoplfcasl_preCI = zeros(bs,4) ; mesoWtoplfcasl_preCI(:) = NaN;
    mesoWtoplfcagl_preCI = zeros(bs,4) ; mesoWtoplfcagl_preCI(:) = NaN;
    %time record:
    timehr_preCI = zeros(bs,4)        ; timehr_preCI(:) = NaN;
    %thermo records in w-swath:
    mesoWqvap_preCI = zeros(bs,4)     ; mesoWqvap_preCI(:) = NaN;
    mesoWtheta_preCI = zeros(bs,4)    ; mesoWtheta_preCI(:) = NaN;
    mesoWthetae_preCI = zeros(bs,4)   ; mesoWthetae_preCI(:) = NaN;
    %sounding records in w-swath:
    mesoWlfcagl_preCI = zeros(bs,4)     ; mesoWlfcagl_preCI(:) = NaN;
    mesoWlfcasl_preCI = zeros(bs,4)     ; mesoWlfcasl_preCI(:) = NaN;
    mesoWcape_preCI = zeros(bs,4)    ; mesoWcape_preCI(:) = NaN;
    mesoWcin_preCI = zeros(bs,4)     ; mesoWcin_preCI(:) = NaN;

    mesoCwidth_preCI = zeros(bs,4)    ;         mesoCwidth_preCI(:) = NaN;
    mesoCdepth_preCI = zeros(bs,4)    ;         mesoCdepth_preCI(:) = NaN;
    mesoCstrength_preCI = zeros(bs,4) ;         mesoCstrength_preCI(:) = NaN;
    mesoCMFCmean_preCI = zeros(bs ,4)    ;      mesoCMFCmean_preCI(:) = NaN;
    mesoCMCqadvmean_preCI = zeros(bs,4)    ;    mesoCMCqadvmean_preCI(:) = NaN;
    mesoCMCqconvmean_preCI = zeros(bs,4) ;      mesoCMCqconvmean_preCI(:) = NaN;
    mesoCMFCmax_preCI = zeros(bs ,4)    ;       mesoCMFCmax_preCI(:) = NaN;
    mesoCMCqadvmax_preCI = zeros(bs,4)    ;     mesoCMCqadvmax_preCI(:) = NaN;
    mesoCMCqconvmax_preCI = zeros(bs,4) ;       mesoCMCqconvmax_preCI(:) = NaN;
    

    mesoWTFCbox_eastupslopedepth_preCI = zeros(bs,4) ;               mesoWTFCbox_eastupslopedepth_preCI(:) = NaN;
    mesoWTFCbox_eastupslopemean_preCI = zeros(bs,4) ;                mesoWTFCbox_eastupslopemean_preCI(:) = NaN;
    mesoWTFCbox_eastupslopedepthfract_preCI = zeros(bs,4) ;          mesoWTFCbox_eastupslopedepthfract_preCI(:) = NaN;
    mesoWTFCbox_eastupslopetophtasl_preCI = zeros(bs,4) ;            mesoWTFCbox_eastupslopetophtasl_preCI(:) = NaN;
    mesoWTFCbox_eastupslopedepthfract2500masl_preCI = zeros(bs,4) ;  mesoWTFCbox_eastupslopedepthfract2500masl_preCI(:) = NaN;
    mesoWTFCbox_eastupslopemean2500masl_preCI = zeros(bs,4) ;        mesoWTFCbox_eastupslopemean2500masl_preCI(:) = NaN; 
    mesoWTFCbox_eastupslopedepthfract1500magl_preCI = zeros(bs,4) ;  mesoWTFCbox_eastupslopedepthfract1500magl_preCI(:) = NaN;
    mesoWTFCbox_eastupslopemean1500magl_preCI = zeros(bs,4) ;        mesoWTFCbox_eastupslopemean1500magl_preCI(:) = NaN;
    mesoWTFCbox_eastUmean3to4kmasl_preCI = zeros(bs,4) ;             mesoWTFCbox_eastUmean3to4kmasl_preCI(:) = NaN;
    mesoWTFCbox_eastUmean4to5kmasl_preCI = zeros(bs,4) ;             mesoWTFCbox_eastUmean4to5kmasl_preCI(:) = NaN; 
    mesoWTFCbox_eastUmean5to6kmasl_preCI = zeros(bs,4) ;             mesoWTFCbox_eastUmean5to6kmasl_preCI(:) = NaN;
    mesoWTFCbox_westupslopedepthfract_preCI = zeros(bs,4) ;          mesoWTFCbox_westupslopedepthfract_preCI(:) = NaN;
    mesoWTFCbox_westupslopetophtasl_preCI = zeros(bs,4) ;            mesoWTFCbox_westupslopetophtasl_preCI(:) = NaN; 
    mesoWTFCbox_westupslopedepthfract2500masl_preCI = zeros(bs,4) ;  mesoWTFCbox_westupslopedepthfract2500masl_preCI(:) = NaN;
    mesoWTFCbox_westupslopemean2500masl_preCI = zeros(bs,4) ;        mesoWTFCbox_westupslopemean2500masl_preCI(:) = NaN;
    mesoWTFCbox_westupslopedepthfract1500magl_preCI = zeros(bs,4) ;  mesoWTFCbox_westupslopedepthfract1500magl_preCI(:) = NaN;
    mesoWTFCbox_westupslopemean1500magl_preCI = zeros(bs,4) ;        mesoWTFCbox_westupslopemean1500magl_preCI(:) = NaN; 

    % local null (neighboring cell) swath characteristics:
    %kinematics:
    localnull_mesoWwidth_preCI = zeros(bs,4) ;              localnull_mesoWwidth_preCI(:) = NaN;
    localnull_mesoWdepth_preCI = zeros(bs,4) ;              localnull_mesoWdepth_preCI(:) = NaN;
    localnull_mesoWstrength_preCI = zeros(bs,4) ;           localnull_mesoWstrength_preCI(:) = NaN;
    localnull_mesoWvmf_preCI = zeros(bs,4) ;                localnull_mesoWvmf_preCI(:) = NaN;
    localnull_mesoWtopasl_preCI = zeros(bs,4) ;             localnull_mesoWtopasl_preCI(:) = NaN;
    localnull_mesoWtopagl_preCI = zeros(bs,4) ;             localnull_mesoWtopagl_preCI(:) = NaN;
    localnull_mesoWtoplfcasl_preCI = zeros(bs,4) ;          localnull_mesoWtoplfcasl_preCI(:) = NaN;
    localnull_mesoWtoplfcagl_preCI = zeros(bs,4) ;          localnull_mesoWtoplfcagl_preCI(:) = NaN;
    %thermo:
    localnull_mesoWqvap_preCI = zeros(bs,4) ;        localnull_mesoWqvap_preCI(:) = NaN;
    localnull_mesoWtheta_preCI = zeros(bs,4) ;       localnull_mesoWtheta_preCI(:) = NaN;
    localnull_mesoWthetae_preCI = zeros(bs,4) ;      localnull_mesoWthetae_preCI(:) = NaN;
    %soundings:
    localnull_mesoWlfcagl_preCI = zeros(bs,4) ;     localnull_mesoWlfcagl_preCI(:) = NaN;
    localnull_mesoWlfcasl_preCI = zeros(bs,4) ;     localnull_mesoWlfcasl_preCI(:) = NaN;
    localnull_mesoWcape_preCI = zeros(bs,4) ;      localnull_mesoWcape_preCI(:) = NaN;
    localnull_mesoWcin_preCI = zeros(bs,4) ;       localnull_mesoWcin_preCI(:) = NaN;

    localnull_mesoCwidth_preCI = zeros(bs,4) ;         localnull_mesoCwidth_preCI(:) = NaN;
    localnull_mesoCdepth_preCI = zeros(bs,4) ;         localnull_mesoCdepth_preCI(:) = NaN;
    localnull_mesoCstrength_preCI = zeros(bs,4) ;      localnull_mesoCstrength_preCI(:) = NaN;
    localnull_mesoCMFCmean_preCI = zeros(bs,4) ;       localnull_mesoCMFCmean_preCI(:) = NaN;
    localnull_mesoCMCqadvmean_preCI = zeros(bs,4) ;    localnull_mesoCMCqadvmean_preCI(:) = NaN;
    localnull_mesoCMCqconvmean_preCI = zeros(bs,4) ;   localnull_mesoCMCqconvmean_preCI(:) = NaN;
    localnull_mesoCMFCmax_preCI = zeros(bs,4) ;        localnull_mesoCMFCmax_preCI(:) = NaN;
    localnull_mesoCMCqadvmax_preCI = zeros(bs,4) ;     localnull_mesoCMCqadvmax_preCI(:) = NaN;
    localnull_mesoCMCqconvmax_preCI = zeros(bs,4) ;    localnull_mesoCMCqconvmax_preCI(:) = NaN;
 
    localnull_mesoWTFCbox_eastupslopedepth_preCI = zeros(bs,4) ;       localnull_mesoWTFCbox_eastupslopedepth_preCI(:) = NaN;    

    %[my mt] = size(Wswath_maxmag_sm) ;
    mt  =  maxtime_ALLCASES(R)  ;
    my  =  sdclength  ;

    %%%% "NULL" meso w swath characteristics  (i.e., at each time, the portions
    %%%% of the mesoscale swath where there are not cells along and/or not immediately parallel to it
    % make a mask in the mesoscale swath format that is 1 where there is NOT a
    % cell shadow at each time. Will nan them out in the loop below
    Null_swath_mask = zeros(my,mt);   Null_swath_mask(:) = 1;
    
    disp('    ')
    disp(' calculating non-null w-swath metrics for ')
    disp( RUNS(R,:) )
    disp('    ')
    tic
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% catalog the in-swath metrics during cell track lifetime:
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    curr_kmasl = A_Ht_asl_vcs(1,:,1)/1000 ;

    [as bs] = size(hhmmss_cell)  ;

    for i = 1:as  %loop through cell track time steps
        for j = 1:bs  %loop through cells

            clear currmesotime_ind currtime
            clear fillU fillV curr_celltop good goo fillgood nsgood curr_u curr_v ...
                curr_top_k curr_ucrel curr_vcrel dy_spanshift dj_spanshift curr_celltop

            %debugery
            curr_ucrel = NaN;
            curr_vcrel = NaN;
            dj_spanshift = NaN;
            dy_spanshift = NaN;
            curr_celltop= NaN;

            % current cell's time
            currtime =  str2num( hhmmss_cell(i,j) ) ;

            %if(currtime <= 200000 & currtime ~= 000000 )  %limit to looking at 20UTC or less
            if(currtime <= 200000 & currtime ~= 000000 & isempty(currtime)==0)  %limit to looking at 20UTC or less    
                %if(currtime <= 143000 & currtime ~= 000000 )  %limit to looking at XXUTC or less

                % meso swath time index correpsonding to current cell's time
                currmesotime_ind = find( str2num(HHMMSS_all_ALLCASES(:,:,R)) == currtime ) ;

                %if( isempty(currmesotime_ind)==0 )

                %%%%%%%% calc distance between cell centroid and swath at it's latitude:

                %  find closest cell lat to swath lat:
                clat  =  meanlat_cell(i,j)   ;
                clon  =  meanlon_cell(i,j)   ;
                swathj  =  find(  abs(FullSDC_swathcentlat_ALLCASES(:,currmesotime_ind,R) - clat)  ==   min(abs(FullSDC_swathcentlat_ALLCASES(:,currmesotime_ind,R) - clat))   )  ;

                if( isempty(swathj) == 0 )
                    slon = FullSDC_swathcentlon_ALLCASES(swathj,currmesotime_ind,R) ;
                    %  diff between cell central lon and the along-swath lon field at the cell's time:
                    dLon = clon(1) - slon(1) ;  % should be positive if cell is EAST of swath (neg if cell is west of it). sometimes there are multiple that fit. I'm randomly picking item 1
                    lontodist = 95/1 ;  %estimate 95 km per 1 deg lon in SDC region
                    dist_cell_and_swath(i,j,R) = dLon .* lontodist ;

                    %%%%%%%%%
                    %%%%%%%%% Cell discrimination set ONE. This applies to all
                    %%%%%%%%% cell analysis and to the definition of the Null
                    %%%%%%%%% potions of the swath
                    %%%%%%%%%

                    % if you just want a prescribed lat but anchor E-W in terms of distance from swath (+ is east, - is west) cell search box:
                    if(   dist_cell_and_swath(i,j,R) > -8     &     dist_cell_and_swath(i,j,R) < 22     &  meanlat_cell(i,j) < latNorth    &     meanlat_cell(i,j) > latSouth & ...
                            duration_cell(j) > 1     )

                        %%%%%%%%%
                        %%%%%%%%%   NOTE: there is a second set of cell
                        %%%%%%%%%   discrimination after the null swath mask is
                        %%%%%%%%%   defined (look a handful of lines below)
                        %%%%%%%%%

                        %pull out the in-swath metrics at current cell's time:
                        %kinematics
                        curr_swath_width      = FullSDC_mesoWwidth_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_depth      = FullSDC_mesoWdepth_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_stren      = FullSDC_mesoWstrength_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_vmf        = FullSDC_VMfluxSum_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_wtopasl    = FullSDC_swathtopasl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_wtopagl    = FullSDC_swathtopagl_ALLCASES(:,currmesotime_ind,R) ;  
                        curr_swath_wtoplfcasl = FullSDC_swathtoplfcasl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_wtoplfcagl = FullSDC_swathtoplfcagl_ALLCASES(:,currmesotime_ind,R) ;

                        %thermo
                        curr_swath_qvap   = FullSDC_swathqvap_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_theta  = FullSDC_swaththetamean_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_thetae = FullSDC_swaththetaemean_ALLCASES(:,currmesotime_ind,R) ;
                        %thermo
                        curr_swath_lfcagl   = FullSDC_swathmulfcagl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_lfcasl   = FullSDC_swathmulfcasl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_cape  = FullSDC_swathmucape_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_cin   = FullSDC_swathmucin_ALLCASES(:,currmesotime_ind,R) ;

                        %conv stuff
                        curr_Cswath_width       = FullSDC_mesoCwidth_ALLCASES(:,currmesotime_ind,R) ;
                        curr_Cswath_depth       = FullSDC_mesoCdepth_ALLCASES(:,currmesotime_ind,R) ;
                        curr_Cswath_stren       = FullSDC_mesoCstrength_ALLCASES(:,currmesotime_ind,R) ;
                        curr_Cswath_MFCmean     = FullSDC_mesoCMFCmean_ALLCASES(:,currmesotime_ind,R) ;
                        curr_Cswath_MCqadvmean  = FullSDC_mesoCMCqadvmean_ALLCASES(:,currmesotime_ind,R) ;
                        curr_Cswath_MCqconvmean = FullSDC_mesoCMCqconvmean_ALLCASES(:,currmesotime_ind,R) ;
                        curr_Cswath_MFCmax      = FullSDC_mesoCMFCmax_ALLCASES(:,currmesotime_ind,R) ;
                        curr_Cswath_MCqadvmax   = FullSDC_mesoCMCqadvmax_ALLCASES(:,currmesotime_ind,R) ;
                        curr_Cswath_MCqconvmax  = FullSDC_mesoCMCqconvmax_ALLCASES(:,currmesotime_ind,R) ;

                        %far E/W env stuff
                        curr_swath_TFCbox_eastupslopedepth = FullSDC_TFCbox_eastupslopedepth_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastupslopemean  = FullSDC_TFCbox_eastupslopemean_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastupslopedepthfract         = FullSDC_TFCbox_eastupslopedepthfract_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastupslopetophtasl           = FullSDC_TFCbox_eastupslopetophtasl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastupslopedepthfract2500masl = FullSDC_TFCbox_eastupslopedepthfract2500masl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastupslopemean2500masl       = FullSDC_TFCbox_eastupslopemean2500masl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastupslopedepthfract1500magl = FullSDC_TFCbox_eastupslopedepthfract1500magl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastupslopemean1500magl       = FullSDC_TFCbox_eastupslopemean1500magl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastUmean3to4kmasl            = FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastUmean4to5kmasl            = FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_eastUmean5to6kmasl            = FullSDC_TFCbox_eastUmean5to6kmasl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_westupslopedepthfract         = FullSDC_TFCbox_westupslopedepthfract_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_westupslopetophtasl           = FullSDC_TFCbox_westupslopetophtasl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_westupslopedepthfract2500masl = FullSDC_TFCbox_westupslopedepthfract2500masl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_westupslopemean2500masl       = FullSDC_TFCbox_westupslopemean2500masl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_westupslopedepthfract1500magl = FullSDC_TFCbox_westupslopedepthfract1500magl_ALLCASES(:,currmesotime_ind,R) ;
                        curr_swath_TFCbox_westupslopemean1500magl       = FullSDC_TFCbox_westupslopemean1500magl_ALLCASES(:,currmesotime_ind,R) ;


                        %define the indices of the N-S span of the SDC to reference:
                        curr_cell_rad   =  (cellarea_cell(i,j) / 3.14159) .^ 0.5 ;
                        radtolat = 1/110; %1 deg lat / 110 km

                        xtracellrad = 1; %km;  a little extra buffer to bloat the cell radius

                        %this cell's correpsonding cross section along the w-swath:
                        southlat = meanlat_cell(i,j) - ( curr_cell_rad*radtolat + xtracellrad*radtolat);  %northern end of cell cross section + 1 km (a little extra buffer)
                        northlat = meanlat_cell(i,j) + ( curr_cell_rad*radtolat + xtracellrad*radtolat);  %southern end of cell cross section + 1 km (a little extra buffer)
                        curr_cell_jspan =  [  find(abs(southlat - lat_alongSDC) == min(abs(southlat - lat_alongSDC)))  : ...
                            find(abs(northlat - lat_alongSDC) == min(abs(northlat - lat_alongSDC))) ]  ;

                        kill_swath = 0; %jnm_vadj

%                         % if prescribed, offset the cell's projection N-S along the span of swath according to an estimated
%                         %   cloud-rel V (mean over a depth within the
%                         'swathbox' subdomain) I DONT REALLY RECOMMEND USING THIS
%                        
%                         if( Vadjusted_swath_window == 1 )    %prescribed at top of script
%                              you've sense abandonded this effort, but if
%                              you copy it from a previous version (v11c or
%                              earlier), but it here and another place
%                              below
%                         end %jnm_vadj --- generally dont recommend using this loop


                        % % nan-out these cells' projections in the Null_swath_index (lasso y-time space) so that later you will have a mask that only includes null parts of the swath.
                        if(kill_swath == 0) %jnm_vadj
                            Null_swath_mask(curr_cell_jspan,currmesotime_ind) = NaN;
                        end

                        %%%%%%%%%
                        %%%%%%%%% Cell discrimination set TWO. Additional
                        %%%%%%%%% subsampling for cell analysis now that the null mask has been
                        %%%%%%%%% applied
                        %%%%%%%%%

                        %%%% Note to self: If I have the lat/lon box and
                        %%%% duration criteria in set ONE (above) which are used to define the Swaths' Null mask and add in the split/merger stuff here in set TWO, it means
                        %%%% that I am letting the splits & mergers NaN-out the
                        %%%% Null masks (i.e., the swath thinks there is a cell
                        %%%% and wont consider it a Null portion. Then placing
                        %%%% the split/merger criteria here prohibit them from
                        %%%% the impending mesoswath analysis:


                        nomergekeep = 0;
                        if( isnan(endmergecloudnumber_cell(j)) & duration_cell(j) < 5 ) % I think this method still might allow mergers where the dominant cell continues on, which we might not want if we just want to look at what the swath is doing ot individual cells?
                            nomergekeep = 1; % preserves cell if does not end in merger within 1 hr of CI)
                        end

                        if( nomergekeep == 1 & isnan(startsplitcloudnumber_cell(j)) & kill_swath == 0 )  %process the cell if no split-starts and no merger-endings within 1 hr from CI
                            %jnm_vadj

                            %log the cell as a keeper if it meets both sets of criteria:
                            cellkeeper_mask_ALLCASES(j,R) = 1;

                            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                            % Now populate the metric array at radar-detected cell times, mean of each metrics along swath within the cell's projected shadow:
                            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

                            %kinematics
                            mesoWwidth_cell(i,j)    =   mean(  mean( curr_swath_width(curr_cell_jspan) ,'omitnan') );
                            mesoWdepth_cell(i,j)    =   mean(  mean( curr_swath_depth(curr_cell_jspan) ,'omitnan') );
                            mesoWstrength_cell(i,j) =   mean(  mean( curr_swath_stren(curr_cell_jspan) ,'omitnan') );
                            mesoWvmf_cell(i,j)      =   mean(  mean( curr_swath_vmf(curr_cell_jspan) ,'omitnan') );
                            mesoWtopasl_cell(i,j)    =   mean(  mean( curr_swath_wtopasl(curr_cell_jspan) ,'omitnan') );
                            mesoWtopagl_cell(i,j)    =   mean(  mean( curr_swath_wtopagl(curr_cell_jspan) ,'omitnan') );
                            mesoWtoplfcasl_cell(i,j)    =   mean(  mean( curr_swath_wtoplfcasl(curr_cell_jspan) ,'omitnan') );
                            mesoWtoplfcagl_cell(i,j)    =   mean(  mean( curr_swath_wtoplfcagl(curr_cell_jspan) ,'omitnan') );

                            mesoCwidth_cell(i,j)    =   mean(  mean( curr_Cswath_width(curr_cell_jspan) ,'omitnan') );
                            mesoCdepth_cell(i,j)    =   mean(  mean( curr_Cswath_depth(curr_cell_jspan) ,'omitnan') );
                            mesoCstrength_cell(i,j) =   mean(  mean( curr_Cswath_stren(curr_cell_jspan) ,'omitnan') );
                            mesoCMFCmean_cell(i,j)      =   mean(  mean( curr_Cswath_MFCmean(curr_cell_jspan) ,'omitnan') );
                            mesoCMCqadvmean_cell(i,j)   =   mean(  mean( curr_Cswath_MCqadvmean(curr_cell_jspan) ,'omitnan') );
                            mesoCMCqconvmean_cell(i,j)  =   mean(  mean( curr_Cswath_MCqconvmean(curr_cell_jspan) ,'omitnan') );
                            mesoCMFCmax_cell(i,j)      =   mean(  mean( curr_Cswath_MFCmax(curr_cell_jspan) ,'omitnan') );
                            mesoCMCqadvmax_cell(i,j)   =   mean(  mean( curr_Cswath_MCqadvmax(curr_cell_jspan) ,'omitnan') );
                            mesoCMCqconvmax_cell(i,j)  =   mean(  mean( curr_Cswath_MCqconvmax(curr_cell_jspan) ,'omitnan') );

                            %thermo
                            mesoWqvap_cell(i,j)   =   mean(  mean( curr_swath_qvap(curr_cell_jspan) ,'omitnan') );
                            mesoWtheta_cell(i,j)  =   mean(  mean( curr_swath_theta(curr_cell_jspan) ,'omitnan') );
                            mesoWthetae_cell(i,j) =   mean(  mean( curr_swath_thetae(curr_cell_jspan) ,'omitnan') );
                            %sounding
                            mesoWlfcagl_cell(i,j)   =   mean(  mean( curr_swath_lfcagl(curr_cell_jspan) ,'omitnan') );
                            mesoWlfcasl_cell(i,j)   =   mean(  mean( curr_swath_lfcasl(curr_cell_jspan) ,'omitnan') );
                            mesoWcape_cell(i,j)  =   mean(  mean( curr_swath_cape(curr_cell_jspan) ,'omitnan') );
                            mesoWcin_cell(i,j) =   mean(  mean( curr_swath_cin(curr_cell_jspan) ,'omitnan') );

                            mesoW_TFCbox_eastupslopedepth_cell(i,j) =   mean(  mean( curr_swath_TFCbox_eastupslopedepth(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastupslopemean_cell(i,j)  =   mean(  mean( curr_swath_TFCbox_eastupslopemean(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastupslopedepthfract_cell(i,j)            =   mean(  mean( curr_swath_TFCbox_eastupslopedepthfract(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastupslopetophtasl_cell(i,j)              =   mean(  mean( curr_swath_TFCbox_eastupslopetophtasl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastupslopedepthfract2500masl_cell(i,j)    =   mean(  mean( curr_swath_TFCbox_eastupslopedepthfract2500masl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastupslopemean2500masl_cell(i,j)          =   mean(  mean( curr_swath_TFCbox_eastupslopemean2500masl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastupslopedepthfract1500magl_cell(i,j)    =   mean(  mean( curr_swath_TFCbox_eastupslopedepthfract1500magl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastupslopemean1500magl_cell(i,j)          =   mean(  mean( curr_swath_TFCbox_eastupslopemean1500magl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastUmean3to4kmasl_cell(i,j)               =   mean(  mean( curr_swath_TFCbox_eastUmean3to4kmasl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastUmean4to5kmasl_cell(i,j)               =   mean(  mean( curr_swath_TFCbox_eastUmean4to5kmasl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_eastUmean5to6kmasl_cell(i,j)               =   mean(  mean( curr_swath_TFCbox_eastUmean5to6kmasl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_westupslopedepthfract_cell(i,j)            =   mean(  mean( curr_swath_TFCbox_westupslopedepthfract(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_westupslopetophtasl_cell(i,j)              =   mean(  mean( curr_swath_TFCbox_westupslopetophtasl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_westupslopedepthfract2500masl_cell(i,j)    =   mean(  mean( curr_swath_TFCbox_westupslopedepthfract2500masl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_westupslopemean2500masl_cell(i,j)          =   mean(  mean( curr_swath_TFCbox_westupslopemean2500masl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_westupslopedepthfract1500magl_cell(i,j)    =   mean(  mean( curr_swath_TFCbox_westupslopedepthfract1500magl(curr_cell_jspan) ,'omitnan') );
                            mesoW_TFCbox_westupslopemean1500magl_cell(i,j)          =   mean(  mean( curr_swath_TFCbox_westupslopemean1500magl(curr_cell_jspan) ,'omitnan') );
                                                                                                                    

                            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                            %%%%%% NOW CATALOG SWATH METRICS BACKWARD IN TIME (PRIOR TO CELL TRACK): @ CI -15min, -30min, -45min, -60min
                            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

                            % current cell's CI time (first time in radar track):
                            CellCItime = char(hhmmss_cell(1,j)) ;
                            CellCIhh = CellCItime(1:2) ;
                            CellCImm = CellCItime(3:4) ;
                            CellCIhr = str2num(CellCIhh) + str2num(CellCImm)/60;  %converted to decimal hour time of day

                            %find time indices in meso swath reference frame corresponding to times preceeding each cell's CI (@ -15min intervals)
                            % note: this should be independent of dt (5 or 15min) of data set
                            CIm15_ind = find( HOUR_all   ==   CellCIhr - 0.25  )  ;
                            CIm30_ind = find( HOUR_all   ==   CellCIhr - 0.5   )  ;
                            CIm45_ind = find( HOUR_all   ==   CellCIhr - 0.75  )  ;
                            CIm60_ind = find( HOUR_all   ==   CellCIhr - 1.0   )  ;


                            %populate the pre-CI metric arrays:
                            %T = 1, 2, 3, 4  => CI-15min, CI-30min, CI-45min, CI-60min

                            if( CIm15_ind > 0)
                                %cell portions of swath:
                                %kinematic
                                %mesoWwidth_preCI(j,1)       =   mean(  mean( Wswath_width_sm(curr_cell_jspan,CIm15_ind) ,'omitnan') );
                                mesoWwidth_preCI(j,1)       =   mean(  mean( FullSDC_mesoWwidth_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWdepth_preCI(j,1)       =   mean(  mean( FullSDC_mesoWdepth_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWstrength_preCI(j,1)    =   mean(  mean( FullSDC_mesoWstrength_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWvmf_preCI(j,1)         =   mean(  mean( FullSDC_VMfluxSum_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWtopasl_preCI(j,1)      =   mean(  mean( FullSDC_swathtopasl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWtopagl_preCI(j,1)      =   mean(  mean( FullSDC_swathtopagl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
%                                 mesoWtoplfcasl_cell(i,1)    =   mean(  mean( FullSDC_swathtoplfcasl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
%                                 mesoWtoplfcagl_cell(i,1)    =   mean(  mean( FullSDC_swathtoplfcagl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') ); 
                                mesoWtoplfcasl_preCI(j,1)    =   mean(  mean( FullSDC_swathtoplfcasl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWtoplfcagl_preCI(j,1)    =   mean(  mean( FullSDC_swathtoplfcagl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') ); 
                                %time
                                timehr_preCI(j,1)        = CellCIhr - 0.25;
                                %thermo
                                mesoWqvap_preCI(j,1)    = mean(  mean( FullSDC_swathqvap_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWtheta_preCI(j,1)   = mean(  mean( FullSDC_swaththetamean_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWthetae_preCI(j,1)  = mean(  mean( FullSDC_swaththetaemean_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                %sounding
                                mesoWlfcasl_preCI(j,1)    = mean(  mean( FullSDC_swathmulfcasl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWlfcagl_preCI(j,1)    = mean(  mean( FullSDC_swathmulfcagl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWcape_preCI(j,1)      = mean(  mean( FullSDC_swathmucape_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWcin_preCI(j,1)       = mean(  mean( FullSDC_swathmucin_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                %conv
                                mesoCwidth_preCI(j,1)       = mean(  mean( FullSDC_mesoCwidth_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoCdepth_preCI(j,1)       = mean(  mean( FullSDC_mesoCdepth_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoCstrength_preCI(j,1)    = mean(  mean( FullSDC_mesoCstrength_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoCMFCmean_preCI(j,1)     = mean(  mean( FullSDC_mesoCMFCmean_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoCMCqadvmean_preCI(j,1)  = mean(  mean( FullSDC_mesoCMCqadvmean_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoCMCqconvmean_preCI(j,1) = mean(  mean( FullSDC_mesoCMCqconvmean_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoCMFCmax_preCI(j,1)      = mean(  mean( FullSDC_mesoCMFCmax_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoCMCqadvmax_preCI(j,1)   = mean(  mean( FullSDC_mesoCMCqadvmax_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoCMCqconvmax_preCI(j,1)  = mean(  mean( FullSDC_mesoCMCqconvmax_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
     
                                mesoWTFCbox_eastupslopedepth_preCI(j,1)       = mean(  mean( FullSDC_TFCbox_eastupslopedepth_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean_preCI(j,1)        = mean(  mean( FullSDC_TFCbox_eastupslopemean_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract_preCI(j,1)        = mean(  mean( FullSDC_TFCbox_eastupslopedepthfract_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopetophtasl_preCI(j,1)          = mean(  mean( FullSDC_TFCbox_eastupslopetophtasl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract2500masl_preCI(j,1)= mean(  mean( FullSDC_TFCbox_eastupslopedepthfract2500masl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean2500masl_preCI(j,1)      = mean(  mean( FullSDC_TFCbox_eastupslopemean2500masl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract1500magl_preCI(j,1)= mean(  mean( FullSDC_TFCbox_eastupslopedepthfract1500magl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean1500magl_preCI(j,1)      = mean(  mean( FullSDC_TFCbox_eastupslopemean1500magl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean3to4kmasl_preCI(j,1)           = mean(  mean( FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean4to5kmasl_preCI(j,1)           = mean(  mean( FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean5to6kmasl_preCI(j,1)           = mean(  mean( FullSDC_TFCbox_eastUmean5to6kmasl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract_preCI(j,1)        = mean(  mean( FullSDC_TFCbox_westupslopedepthfract_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopetophtasl_preCI(j,1)          = mean(  mean( FullSDC_TFCbox_westupslopetophtasl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract2500masl_preCI(j,1)= mean(  mean( FullSDC_TFCbox_westupslopedepthfract2500masl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopemean2500masl_preCI(j,1)      = mean(  mean( FullSDC_TFCbox_westupslopemean2500masl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract1500magl_preCI(j,1)= mean(  mean( FullSDC_TFCbox_westupslopedepthfract1500magl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopemean1500magl_preCI(j,1)      = mean(  mean( FullSDC_TFCbox_westupslopemean1500magl_ALLCASES(curr_cell_jspan,CIm15_ind,R) ,'omitnan') );

                            end

                            if( CIm30_ind > 0)
                                %cell portions of swath:
                                %kinematic
                                %mesoWwidth_preCI(j,2)       =   mean(  mean( Wswath_width_sm(curr_cell_jspan,CIm15_ind) ,'omitnan') );
                                mesoWwidth_preCI(j,2)       =   mean(  mean( FullSDC_mesoWwidth_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWdepth_preCI(j,2)       =   mean(  mean( FullSDC_mesoWdepth_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWstrength_preCI(j,2)    =   mean(  mean( FullSDC_mesoWstrength_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWvmf_preCI(j,2)         =   mean(  mean( FullSDC_VMfluxSum_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWtopasl_preCI(j,2)      =   mean(  mean( FullSDC_swathtopasl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWtopagl_preCI(j,2)      =   mean(  mean( FullSDC_swathtopagl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
%                                 mesoWtoplfcasl_cell(i,2)    =   mean(  mean( FullSDC_swathtoplfcasl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
%                                 mesoWtoplfcagl_cell(i,2)    =   mean(  mean( FullSDC_swathtoplfcagl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') ); 
                                mesoWtoplfcasl_preCI(j,2)    =   mean(  mean( FullSDC_swathtoplfcasl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWtoplfcagl_preCI(j,2)    =   mean(  mean( FullSDC_swathtoplfcagl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') ); 
                                %time
                                timehr_preCI(j,2)        = CellCIhr - 0.5;
                                %thermo
                                mesoWqvap_preCI(j,2)    = mean(  mean( FullSDC_swathqvap_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWtheta_preCI(j,2)   = mean(  mean( FullSDC_swaththetamean_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWthetae_preCI(j,2)  = mean(  mean( FullSDC_swaththetaemean_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                %sounding
                                mesoWlfcasl_preCI(j,2)    = mean(  mean( FullSDC_swathmulfcasl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWlfcagl_preCI(j,2)    = mean(  mean( FullSDC_swathmulfcagl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWcape_preCI(j,2)      = mean(  mean( FullSDC_swathmucape_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWcin_preCI(j,2)       = mean(  mean( FullSDC_swathmucin_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                %conv
                                mesoCwidth_preCI(j,2)       = mean(  mean( FullSDC_mesoCwidth_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoCdepth_preCI(j,2)       = mean(  mean( FullSDC_mesoCdepth_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoCstrength_preCI(j,2)    = mean(  mean( FullSDC_mesoCstrength_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoCMFCmean_preCI(j,2)     = mean(  mean( FullSDC_mesoCMFCmean_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoCMCqadvmean_preCI(j,2)  = mean(  mean( FullSDC_mesoCMCqadvmean_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoCMCqconvmean_preCI(j,2) = mean(  mean( FullSDC_mesoCMCqconvmean_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoCMFCmax_preCI(j,2)      = mean(  mean( FullSDC_mesoCMFCmax_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoCMCqadvmax_preCI(j,2)   = mean(  mean( FullSDC_mesoCMCqadvmax_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoCMCqconvmax_preCI(j,2)  = mean(  mean( FullSDC_mesoCMCqconvmax_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );


                                mesoWTFCbox_eastupslopedepth_preCI(j,2)       = mean(  mean( FullSDC_TFCbox_eastupslopedepth_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean_preCI(j,2)        = mean(  mean( FullSDC_TFCbox_eastupslopemean_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract_preCI(j,2)        = mean(  mean( FullSDC_TFCbox_eastupslopedepthfract_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopetophtasl_preCI(j,2)          = mean(  mean( FullSDC_TFCbox_eastupslopetophtasl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract2500masl_preCI(j,2)= mean(  mean( FullSDC_TFCbox_eastupslopedepthfract2500masl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean2500masl_preCI(j,2)      = mean(  mean( FullSDC_TFCbox_eastupslopemean2500masl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract1500magl_preCI(j,2)= mean(  mean( FullSDC_TFCbox_eastupslopedepthfract1500magl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean1500magl_preCI(j,2)      = mean(  mean( FullSDC_TFCbox_eastupslopemean1500magl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean3to4kmasl_preCI(j,2)           = mean(  mean( FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean4to5kmasl_preCI(j,2)           = mean(  mean( FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean5to6kmasl_preCI(j,2)           = mean(  mean( FullSDC_TFCbox_eastUmean5to6kmasl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract_preCI(j,2)        = mean(  mean( FullSDC_TFCbox_westupslopedepthfract_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopetophtasl_preCI(j,2)          = mean(  mean( FullSDC_TFCbox_westupslopetophtasl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract2500masl_preCI(j,2)= mean(  mean( FullSDC_TFCbox_westupslopedepthfract2500masl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopemean2500masl_preCI(j,2)      = mean(  mean( FullSDC_TFCbox_westupslopemean2500masl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract1500magl_preCI(j,2)= mean(  mean( FullSDC_TFCbox_westupslopedepthfract1500magl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopemean1500magl_preCI(j,2)      = mean(  mean( FullSDC_TFCbox_westupslopemean1500magl_ALLCASES(curr_cell_jspan,CIm30_ind,R) ,'omitnan') );

                            end


                            if( CIm45_ind > 0)
                                %cell portions of swath:
                                %kinematic
                                %mesoWwidth_preCI(j,3)       =   mean(  mean( Wswath_width_sm(curr_cell_jspan,CIm45_ind) ,'omitnan') );
                                mesoWwidth_preCI(j,3)       =   mean(  mean( FullSDC_mesoWwidth_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWdepth_preCI(j,3)       =   mean(  mean( FullSDC_mesoWdepth_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWstrength_preCI(j,3)    =   mean(  mean( FullSDC_mesoWstrength_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWvmf_preCI(j,3)         =   mean(  mean( FullSDC_VMfluxSum_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWtopasl_preCI(j,3)      =   mean(  mean( FullSDC_swathtopasl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWtopagl_preCI(j,3)      =   mean(  mean( FullSDC_swathtopagl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
%                                 mesoWtoplfcasl_cell(i,3)    =   mean(  mean( FullSDC_swathtoplfcasl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
%                                 mesoWtoplfcagl_cell(i,3)    =   mean(  mean( FullSDC_swathtoplfcagl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') ); 
                                mesoWtoplfcasl_preCI(j,3)    =   mean(  mean( FullSDC_swathtoplfcasl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWtoplfcagl_preCI(j,3)    =   mean(  mean( FullSDC_swathtoplfcagl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') ); 
                                %time
                                timehr_preCI(j,3)        = CellCIhr - 0.75;
                                %thermo
                                mesoWqvap_preCI(j,3)    = mean(  mean( FullSDC_swathqvap_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWtheta_preCI(j,3)   = mean(  mean( FullSDC_swaththetamean_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWthetae_preCI(j,3)  = mean(  mean( FullSDC_swaththetaemean_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                %sounding
                                mesoWlfcasl_preCI(j,3)    = mean(  mean( FullSDC_swathmulfcasl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWlfcagl_preCI(j,3)    = mean(  mean( FullSDC_swathmulfcagl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWcape_preCI(j,3)      = mean(  mean( FullSDC_swathmucape_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWcin_preCI(j,3)       = mean(  mean( FullSDC_swathmucin_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                %conv
                                mesoCwidth_preCI(j,3)       = mean(  mean( FullSDC_mesoCwidth_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoCdepth_preCI(j,3)       = mean(  mean( FullSDC_mesoCdepth_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoCstrength_preCI(j,3)    = mean(  mean( FullSDC_mesoCstrength_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoCMFCmean_preCI(j,3)     = mean(  mean( FullSDC_mesoCMFCmean_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoCMCqadvmean_preCI(j,3)  = mean(  mean( FullSDC_mesoCMCqadvmean_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoCMCqconvmean_preCI(j,3) = mean(  mean( FullSDC_mesoCMCqconvmean_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoCMFCmax_preCI(j,3)      = mean(  mean( FullSDC_mesoCMFCmax_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoCMCqadvmax_preCI(j,3)   = mean(  mean( FullSDC_mesoCMCqadvmax_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoCMCqconvmax_preCI(j,3)  = mean(  mean( FullSDC_mesoCMCqconvmax_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );

                                mesoWTFCbox_eastupslopedepth_preCI(j,3)       = mean(  mean( FullSDC_TFCbox_eastupslopedepth_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean_preCI(j,3)         = mean(  mean( FullSDC_TFCbox_eastupslopemean_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract_preCI(j,3)        = mean(  mean( FullSDC_TFCbox_eastupslopedepthfract_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopetophtasl_preCI(j,3)          = mean(  mean( FullSDC_TFCbox_eastupslopetophtasl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract2500masl_preCI(j,3)= mean(  mean( FullSDC_TFCbox_eastupslopedepthfract2500masl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean2500masl_preCI(j,3)      = mean(  mean( FullSDC_TFCbox_eastupslopemean2500masl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract1500magl_preCI(j,3)= mean(  mean( FullSDC_TFCbox_eastupslopedepthfract1500magl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean1500magl_preCI(j,3)      = mean(  mean( FullSDC_TFCbox_eastupslopemean1500magl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean3to4kmasl_preCI(j,3)           = mean(  mean( FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean4to5kmasl_preCI(j,3)           = mean(  mean( FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean5to6kmasl_preCI(j,3)           = mean(  mean( FullSDC_TFCbox_eastUmean5to6kmasl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract_preCI(j,3)        = mean(  mean( FullSDC_TFCbox_westupslopedepthfract_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopetophtasl_preCI(j,3)          = mean(  mean( FullSDC_TFCbox_westupslopetophtasl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract2500masl_preCI(j,3)= mean(  mean( FullSDC_TFCbox_westupslopedepthfract2500masl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopemean2500masl_preCI(j,3)      = mean(  mean( FullSDC_TFCbox_westupslopemean2500masl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract1500magl_preCI(j,3)= mean(  mean( FullSDC_TFCbox_westupslopedepthfract1500magl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopemean1500magl_preCI(j,3)      = mean(  mean( FullSDC_TFCbox_westupslopemean1500magl_ALLCASES(curr_cell_jspan,CIm45_ind,R) ,'omitnan') );



                            end


                            if( CIm60_ind > 0)
                                %cell portions of swath:
                                %kinematic
                                %mesoWwidth_preCI(j,4)       =   mean(  mean( Wswath_width_sm(curr_cell_jspan,CIm45_ind) ,'omitnan') );
                                mesoWwidth_preCI(j,4)        =   mean(  mean( FullSDC_mesoWwidth_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWdepth_preCI(j,4)        =   mean(  mean( FullSDC_mesoWdepth_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWstrength_preCI(j,4)     =   mean(  mean( FullSDC_mesoWstrength_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWvmf_preCI(j,4)          =   mean(  mean( FullSDC_VMfluxSum_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWtopasl_preCI(j,4)       =   mean(  mean( FullSDC_swathtopasl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWtopagl_preCI(j,4)       =   mean(  mean( FullSDC_swathtopagl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWtoplfcasl_preCI(j,4)    =   mean(  mean( FullSDC_swathtoplfcasl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWtoplfcagl_preCI(j,4)    =   mean(  mean( FullSDC_swathtoplfcagl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') ); 
                                %time
                                timehr_preCI(j,4)        = CellCIhr - 1.0;
                                %thermo
                                mesoWqvap_preCI(j,4)    = mean(  mean( FullSDC_swathqvap_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWtheta_preCI(j,4)   = mean(  mean( FullSDC_swaththetamean_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWthetae_preCI(j,4)  = mean(  mean( FullSDC_swaththetaemean_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                %sounding
                                mesoWlfcasl_preCI(j,4)    = mean(  mean( FullSDC_swathmulfcasl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWlfcagl_preCI(j,4)    = mean(  mean( FullSDC_swathmulfcagl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWcape_preCI(j,4)      = mean(  mean( FullSDC_swathmucape_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWcin_preCI(j,4)       = mean(  mean( FullSDC_swathmucin_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                %conv
                                mesoCwidth_preCI(j,4)       = mean(  mean( FullSDC_mesoCwidth_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoCdepth_preCI(j,4)       = mean(  mean( FullSDC_mesoCdepth_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoCstrength_preCI(j,4)    = mean(  mean( FullSDC_mesoCstrength_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoCMFCmean_preCI(j,4)     = mean(  mean( FullSDC_mesoCMFCmean_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoCMCqadvmean_preCI(j,4)  = mean(  mean( FullSDC_mesoCMCqadvmean_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoCMCqconvmean_preCI(j,4) = mean(  mean( FullSDC_mesoCMCqconvmean_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoCMFCmax_preCI(j,4)      = mean(  mean( FullSDC_mesoCMFCmax_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoCMCqadvmax_preCI(j,4)   = mean(  mean( FullSDC_mesoCMCqadvmax_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoCMCqconvmax_preCI(j,4)  = mean(  mean( FullSDC_mesoCMCqconvmax_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );


                                mesoWTFCbox_eastupslopedepth_preCI(j,4)             = mean(  mean( FullSDC_TFCbox_eastupslopedepth_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean_preCI(j,4)              = mean(  mean( FullSDC_TFCbox_eastupslopemean_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract_preCI(j,4)        = mean(  mean( FullSDC_TFCbox_eastupslopedepthfract_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopetophtasl_preCI(j,4)          = mean(  mean( FullSDC_TFCbox_eastupslopetophtasl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract2500masl_preCI(j,4)= mean(  mean( FullSDC_TFCbox_eastupslopedepthfract2500masl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean2500masl_preCI(j,4)      = mean(  mean( FullSDC_TFCbox_eastupslopemean2500masl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopedepthfract1500magl_preCI(j,4)= mean(  mean( FullSDC_TFCbox_eastupslopedepthfract1500magl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastupslopemean1500magl_preCI(j,4)      = mean(  mean( FullSDC_TFCbox_eastupslopemean1500magl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean3to4kmasl_preCI(j,4)           = mean(  mean( FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean4to5kmasl_preCI(j,4)           = mean(  mean( FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_eastUmean5to6kmasl_preCI(j,4)           = mean(  mean( FullSDC_TFCbox_eastUmean5to6kmasl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract_preCI(j,4)        = mean(  mean( FullSDC_TFCbox_westupslopedepthfract_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopetophtasl_preCI(j,4)          = mean(  mean( FullSDC_TFCbox_westupslopetophtasl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract2500masl_preCI(j,4)= mean(  mean( FullSDC_TFCbox_westupslopedepthfract2500masl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopemean2500masl_preCI(j,4)      = mean(  mean( FullSDC_TFCbox_westupslopemean2500masl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopedepthfract1500magl_preCI(j,4)= mean(  mean( FullSDC_TFCbox_westupslopedepthfract1500magl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );
                                mesoWTFCbox_westupslopemean1500magl_preCI(j,4)      = mean(  mean( FullSDC_TFCbox_westupslopemean1500magl_ALLCASES(curr_cell_jspan,CIm60_ind,R) ,'omitnan') );

                            end

                        end %merge/split check

                    end  % cell geogrpahy & duration filter
                end  %swath check
            end  %desired time of day if

        end  %j (num cells)
    end  %i(cell times)


    toc
    disp('  good to here  ')


    % some post processing of swath properties for cells:

    %these are in the time ref frame of t = 1(CI-15min) to 4(CI-60min).
    % will need to flipdim it to make it intuitive.
    timehr_preCI = timehr_preCI';
    mesoWwidth_preCI = mesoWwidth_preCI';
    mesoWdepth_preCI = mesoWdepth_preCI';
    mesoWtopasl_preCI = mesoWtopasl_preCI';
    mesoWtopagl_preCI = mesoWtopagl_preCI';
    mesoWstrength_preCI = mesoWstrength_preCI';
    mesoWvmf_preCI = mesoWvmf_preCI';
    mesoWqvap_preCI = mesoWqvap_preCI';
    mesoWtheta_preCI = mesoWtheta_preCI';
    mesoWthetae_preCI = mesoWthetae_preCI';
    mesoWlfcagl_preCI = mesoWlfcagl_preCI';
    mesoWlfcasl_preCI = mesoWlfcasl_preCI';
    mesoWtoplfcagl_preCI = mesoWtoplfcagl_preCI';
    mesoWtoplfcasl_preCI = mesoWtoplfcasl_preCI';
    mesoWcape_preCI = mesoWcape_preCI';
    mesoWcin_preCI = mesoWcin_preCI';

    mesoCwidth_preCI         = mesoCwidth_preCI';
    mesoCdepth_preCI         = mesoCdepth_preCI';
    mesoCstrength_preCI      = mesoCstrength_preCI';
    mesoCMFCmean_preCI       = mesoCMFCmean_preCI';
    mesoCMCqadvmean_preCI    = mesoCMCqadvmean_preCI';
    mesoCMCqconvmean_preCI   = mesoCMCqconvmean_preCI';
    mesoCMFCmax_preCI        = mesoCMFCmax_preCI';
    mesoCMCqadvmax_preCI     = mesoCMCqadvmax_preCI';
    mesoCMCqconvmax_preCI    = mesoCMCqconvmax_preCI';

    mesoWTFCbox_eastupslopedepth_preCI = mesoWTFCbox_eastupslopedepth_preCI';  
    mesoWTFCbox_eastupslopemean_preCI = mesoWTFCbox_eastupslopemean_preCI';  
    mesoWTFCbox_eastupslopedepthfract_preCI = mesoWTFCbox_eastupslopedepthfract_preCI';   
    mesoWTFCbox_eastupslopetophtasl_preCI = mesoWTFCbox_eastupslopetophtasl_preCI';   
    mesoWTFCbox_eastupslopedepthfract2500masl_preCI = mesoWTFCbox_eastupslopedepthfract2500masl_preCI';   
    mesoWTFCbox_eastupslopemean2500masl_preCI = mesoWTFCbox_eastupslopemean2500masl_preCI';   
    mesoWTFCbox_eastupslopedepthfract1500magl_preCI = mesoWTFCbox_eastupslopedepthfract1500magl_preCI';   
    mesoWTFCbox_eastupslopemean1500magl_preCI = mesoWTFCbox_eastupslopemean1500magl_preCI';   
    mesoWTFCbox_eastUmean3to4kmasl_preCI = mesoWTFCbox_eastUmean3to4kmasl_preCI';   
    mesoWTFCbox_eastUmean4to5kmasl_preCI = mesoWTFCbox_eastUmean4to5kmasl_preCI';
    mesoWTFCbox_eastUmean5to6kmasl_preCI = mesoWTFCbox_eastUmean5to6kmasl_preCI';   
    mesoWTFCbox_westupslopedepthfract_preCI = mesoWTFCbox_westupslopedepthfract_preCI';   
    mesoWTFCbox_westupslopetophtasl_preCI = mesoWTFCbox_westupslopetophtasl_preCI';   
    mesoWTFCbox_westupslopedepthfract2500masl_preCI = mesoWTFCbox_westupslopedepthfract2500masl_preCI';   
    mesoWTFCbox_westupslopemean2500masl_preCI = mesoWTFCbox_westupslopemean2500masl_preCI';   
    mesoWTFCbox_westupslopedepthfract1500magl_preCI = mesoWTFCbox_westupslopedepthfract1500magl_preCI';   
    mesoWTFCbox_westupslopemean1500magl_preCI = mesoWTFCbox_westupslopemean1500magl_preCI';   


    % stitch together pre and post CI arrays (and flipdim them for time array: CI-60, CI-45, CI-30, CI-15, CI, CI+15 ... CI + n (t = 5 is the CI time).
    prepost_timehr = cat(1,flipdim(timehr_preCI,1),hour_cell);
    % prepost_timehr(:,find(isnan(mesoWwidth_cell(1,:)))) = NaN;
    prepost_timerelCI = prepost_timehr - prepost_timehr(5,:);  %%%% <----------- time index senstivte to dt = 5min vs 15min?  No, I think it's fine as t=5 because of the CI-15 thru CI-60 indices above
    prepost_mesoWwidth = cat(1,flipdim(mesoWwidth_preCI,1),mesoWwidth_cell);
    prepost_mesoWdepth = cat(1,flipdim(mesoWdepth_preCI,1),mesoWdepth_cell);
    prepost_mesoWtopasl = cat(1,flipdim(mesoWtopasl_preCI,1),mesoWtopasl_cell);
    prepost_mesoWtopagl = cat(1,flipdim(mesoWtopagl_preCI,1),mesoWtopagl_cell);
    prepost_mesoWstrength = cat(1,flipdim(mesoWstrength_preCI,1),mesoWstrength_cell);
    prepost_mesoWvmf = cat(1,flipdim(mesoWvmf_preCI,1),mesoWvmf_cell);
    prepost_mesoWqvap = cat(1,flipdim(mesoWqvap_preCI,1),mesoWqvap_cell);
    prepost_mesoWtheta = cat(1,flipdim(mesoWtheta_preCI,1),mesoWtheta_cell);
    prepost_mesoWthetae = cat(1,flipdim(mesoWthetae_preCI,1),mesoWthetae_cell);
    prepost_mesoWlfcagl    = cat(1,flipdim(mesoWlfcagl_preCI,1),mesoWlfcagl_cell);
    prepost_mesoWlfcasl    = cat(1,flipdim(mesoWlfcasl_preCI,1),mesoWlfcasl_cell);
    prepost_mesoWcape         = cat(1,flipdim(mesoWcape_preCI,1),mesoWcape_cell);
    prepost_mesoWcin          = cat(1,flipdim(mesoWcin_preCI,1),mesoWcin_cell);
    prepost_mesoWtoplfcagl    = cat(1,flipdim(mesoWtoplfcagl_preCI,1),mesoWtoplfcagl_cell);
    prepost_mesoWtoplfcasl    = cat(1,flipdim(mesoWtoplfcasl_preCI,1),mesoWtoplfcasl_cell);  

    prepost_mesoCwidth          = cat(1,flipdim(mesoCwidth_preCI,1),mesoCwidth_cell);
    prepost_mesoCdepth          = cat(1,flipdim(mesoCdepth_preCI,1),mesoCdepth_cell);
    prepost_mesoCstrength       = cat(1,flipdim(mesoCstrength_preCI,1),mesoCstrength_cell);
    prepost_mesoCMFCmean        = cat(1,flipdim(mesoCMFCmean_preCI,1),mesoCMFCmean_cell);
    prepost_mesoCMCqadvmean     = cat(1,flipdim(mesoCMCqadvmean_preCI,1),mesoCMCqadvmean_cell);
    prepost_mesoCMCqconvmean    = cat(1,flipdim(mesoCMCqconvmean_preCI,1),mesoCMCqconvmean_cell);
    prepost_mesoCMFCmax         = cat(1,flipdim(mesoCMFCmax_preCI,1),mesoCMFCmax_cell);
    prepost_mesoCMCqadvmax      = cat(1,flipdim(mesoCMCqadvmax_preCI,1),mesoCMCqadvmax_cell);
    prepost_mesoCMCqconvmax     = cat(1,flipdim(mesoCMCqconvmax_preCI,1),mesoCMCqconvmax_cell);

    
    prepost_mesoWTFCbox_eastupslopedepth                = cat(1,flipdim(mesoWTFCbox_eastupslopedepth_preCI,1),mesoW_TFCbox_eastupslopedepth_cell);
    prepost_mesoWTFCbox_eastupslopemean                 = cat(1,flipdim(mesoWTFCbox_eastupslopemean_preCI,1),mesoW_TFCbox_eastupslopemean_cell);
    prepost_mesoWTFCbox_eastupslopedepthfract           = cat(1,flipdim(mesoWTFCbox_eastupslopedepthfract_preCI,1),mesoW_TFCbox_eastupslopedepthfract_cell);
    prepost_mesoWTFCbox_eastupslopetophtasl             = cat(1,flipdim(mesoWTFCbox_eastupslopetophtasl_preCI,1),mesoW_TFCbox_eastupslopetophtasl_cell);
    prepost_mesoWTFCbox_eastupslopedepthfract2500masl   = cat(1,flipdim(mesoWTFCbox_eastupslopedepthfract2500masl_preCI,1),mesoW_TFCbox_eastupslopedepthfract2500masl_cell);
    prepost_mesoWTFCbox_eastupslopemean2500masl         = cat(1,flipdim(mesoWTFCbox_eastupslopemean2500masl_preCI,1),mesoW_TFCbox_eastupslopemean2500masl_cell);
    prepost_mesoWTFCbox_eastupslopedepthfract1500magl   = cat(1,flipdim(mesoWTFCbox_eastupslopedepthfract1500magl_preCI,1),mesoW_TFCbox_eastupslopedepthfract1500magl_cell);
    prepost_mesoWTFCbox_eastupslopemean1500magl         = cat(1,flipdim(mesoWTFCbox_eastupslopemean1500magl_preCI,1),mesoW_TFCbox_eastupslopemean1500magl_cell);
    prepost_mesoWTFCbox_eastUmean3to4kmasl              = cat(1,flipdim(mesoWTFCbox_eastUmean3to4kmasl_preCI,1),mesoW_TFCbox_eastUmean3to4kmasl_cell);
    prepost_mesoWTFCbox_eastUmean4to5kmasl              = cat(1,flipdim(mesoWTFCbox_eastUmean4to5kmasl_preCI,1),mesoW_TFCbox_eastUmean4to5kmasl_cell);
    prepost_mesoWTFCbox_eastUmean5to6kmasl              = cat(1,flipdim(mesoWTFCbox_eastUmean5to6kmasl_preCI,1),mesoW_TFCbox_eastUmean5to6kmasl_cell);
    prepost_mesoWTFCbox_westupslopedepthfract           = cat(1,flipdim(mesoWTFCbox_westupslopedepthfract_preCI,1),mesoW_TFCbox_westupslopedepthfract_cell);
    prepost_mesoWTFCbox_westupslopetophtasl             = cat(1,flipdim(mesoWTFCbox_westupslopetophtasl_preCI,1),mesoW_TFCbox_westupslopetophtasl_cell);
    prepost_mesoWTFCbox_westupslopedepthfract2500masl   = cat(1,flipdim(mesoWTFCbox_westupslopedepthfract2500masl_preCI,1),mesoW_TFCbox_westupslopedepthfract2500masl_cell);
    prepost_mesoWTFCbox_westupslopemean2500masl         = cat(1,flipdim(mesoWTFCbox_westupslopemean2500masl_preCI,1),mesoW_TFCbox_westupslopemean2500masl_cell);
    prepost_mesoWTFCbox_westupslopedepthfract1500magl   = cat(1,flipdim(mesoWTFCbox_westupslopedepthfract1500magl_preCI,1),mesoW_TFCbox_westupslopedepthfract1500magl_cell);
    prepost_mesoWTFCbox_westupslopemean1500magl         = cat(1,flipdim(mesoWTFCbox_westupslopemean1500magl_preCI,1),mesoW_TFCbox_westupslopemean1500magl_cell);


    %%% sensitive to dt frequency:
    % cell metrics in the first X times of the cell history (i.e., the radar detected CI window)
    % we will "NaN-out" cells using cellkeeper_mask_ALLCASES later:
    cellCI_maxETH10 = max(ETH10_cell(1:10,:),[],'omitnan')';
    cellCI_maxdbz   = max(maxdbz_cell(1:10,:),[],'omitnan')';
    cellCI_cellarea = max(cellarea_cell(1:10,:),[],'omitnan')';
    cellCI_corearea = max(corearea_cell(1:10,:),[],'omitnan')';
   
    % cell metrics in the full the cell lifetime:
    cellfull_maxETH10 = max(ETH10_cell(:,:),[],'omitnan')';
    cellfull_maxdbz   = max(maxdbz_cell(:,:),[],'omitnan')';
    cellfull_cellarea = max(cellarea_cell(:,:),[],'omitnan')';
    cellfull_corearea = max(corearea_cell(:,:),[],'omitnan')';
    cellfull_duration = duration_cell;
    
    %%%%%% Some Null metrics (some of which are obsolete?):
    % % mean properties in the mesoscale swath not aligned with a cell (i.e., Null meso properties); in y-time
%     %mesoWwidth_nullmean     = mean( Wswath_width_sm .* Null_swath_mask, 1, 'omitnan');
%     mesoWwidth_nullmean     = mean( FullSDC_mesoWwidth_ALLCASES(:,maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
%     mesoWdepth_nullmean     = mean( FullSDC_mesoWdepth_ALLCASES(:,maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
%     mesoWstrength_nullmean  = mean( FullSDC_mesoWstrength_ALLCASES(:,maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
%     mesoWqvap_nullmean      = mean( FullSDC_swathqvap_ALLCASES(:,maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
%     mesoWtheta_nullmean     = mean( FullSDC_swaththetamean_ALLCASES(:,maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
%     mesoWthetae_nullmean    = mean( FullSDC_swaththetaemean_ALLCASES(:,maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');

    %mesoWwidth_nullmean     = mean( Wswath_width_sm .* Null_swath_mask, 1, 'omitnan');
    mesoWwidth_nullmean     = mean( FullSDC_mesoWwidth_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoWdepth_nullmean     = mean( FullSDC_mesoWdepth_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoWstrength_nullmean  = mean( FullSDC_mesoWstrength_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoWvmf_nullmean       = mean( FullSDC_VMfluxSum_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoWqvap_nullmean      = mean( FullSDC_swathqvap_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoWtheta_nullmean     = mean( FullSDC_swaththetamean_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoWthetae_nullmean    = mean( FullSDC_swaththetaemean_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');

    mesoCwidth_nullmean         = mean( FullSDC_mesoCwidth_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoCdepth_nullmean         = mean( FullSDC_mesoCdepth_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoCstrength_nullmean      = mean( FullSDC_mesoCstrength_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');    
    mesoCMFCmean_nullmean       = mean( FullSDC_mesoCMFCmean_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoCMCqadvmean_nullmean    = mean( FullSDC_mesoCMCqadvmean_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoCMCqconvmean_nullmean   = mean( FullSDC_mesoCMCqconvmean_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan'); 
    mesoCMFCmax_nullmean        = mean( FullSDC_mesoCMFCmax_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoCMCqadvmax_nullmean     = mean( FullSDC_mesoCMCqadvmax_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan');
    mesoCMCqconvmax_nullmean    = mean( FullSDC_mesoCMCqconvmax_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask, 1, 'omitnan'); 

    
    % properties in the mesoscale swath not aligned with a cell (the whole swath length, not just the mean of it; i.e., also in y-time space)
    %mesoWwidth_nullfullsdc     = Wswath_width_sm .* Null_swath_mask;
    mesoWwidth_nullfullsdc      = FullSDC_mesoWwidth_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    mesoWdepth_nullfullsdc      = FullSDC_mesoWdepth_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    mesoWtopasl_nullfullsdc     = FullSDC_swathtopasl_ALLCASES(:,1:maxtime_ALLCASES(R),R)   .* Null_swath_mask;
    mesoWtopagl_nullfullsdc     = FullSDC_swathtopagl_ALLCASES(:,1:maxtime_ALLCASES(R),R)   .* Null_swath_mask;
    mesoWstrength_nullfullsdc   = FullSDC_mesoWstrength_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;
    mesoWvmf_nullfullsdc        = FullSDC_VMfluxSum_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;
    mesoWqvap_nullfullsdc       = FullSDC_swathqvap_ALLCASES(:,1:maxtime_ALLCASES(R),R)     .* Null_swath_mask;
    mesoWtheta_nullfullsdc      = FullSDC_swaththetamean_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;
    mesoWthetae_nullfullsdc     = FullSDC_swaththetaemean_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;
    mesoWlfcagl_nullfullsdc     = FullSDC_swathmulfcagl_ALLCASES(:,1:maxtime_ALLCASES(R),R)  .* Null_swath_mask;
    mesoWlfcasl_nullfullsdc     = FullSDC_swathmulfcasl_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;
    mesoWcape_nullfullsdc       = FullSDC_swathmucape_ALLCASES(:,1:maxtime_ALLCASES(R),R)  .* Null_swath_mask;
    mesoWcin_nullfullsdc        = FullSDC_swathmucin_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    mesoWtoplfcagl_nullfullsdc  = FullSDC_swathtoplfcagl_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;
    mesoWtoplfcasl_nullfullsdc  = FullSDC_swathtoplfcasl_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;  

    mesoCwidth_nullfullsdc          = FullSDC_mesoCwidth_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    mesoCdepth_nullfullsdc          = FullSDC_mesoCdepth_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    mesoCstrength_nullfullsdc       = FullSDC_mesoCstrength_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;
    mesoCMFCmean_nullfullsdc        = FullSDC_mesoCMFCmean_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    mesoCMCqadvmean_nullfullsdc     = FullSDC_mesoCMCqadvmean_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    mesoCMCqconvmean_nullfullsdc    = FullSDC_mesoCMCqconvmean_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;
    mesoCMFCmax_nullfullsdc         = FullSDC_mesoCMFCmax_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    mesoCMCqadvmax_nullfullsdc      = FullSDC_mesoCMCqadvmax_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    mesoCMCqconvmax_nullfullsdc     = FullSDC_mesoCMCqconvmax_ALLCASES(:,1:maxtime_ALLCASES(R),R) .* Null_swath_mask;


    mesoWTFCbox_eastupslopedepth_nullfullsdc        = FullSDC_TFCbox_eastupslopedepth_ALLCASES(:,1:maxtime_ALLCASES(R),R)    .* Null_swath_mask;
    
    %%%% good to here

    %Better Null metric option:
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%  Calculate "null" properties for each cell in a different format:
    %%%%%       now that the null_mask for each time is complete, go back
    %%%%%       into a cell number/time loop and look within R = X kilometers
    %%%%%       of each cell centroid along the swath and record the null
    %%%%%       properties  (or  CI - Null properties, or just calculate these later). Record them in
    %%%%%       cellstat prepost format.
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    disp('asdf1')

    %list corresponding start/stop time limits from the swath detection periods per case:
    firstcall = 130000;   %first utc time to look for cells
   
    if(R == 1)            
        lastcall = 163000; %last utc time to look for cells
    elseif(R == 2)
        lastcall = 173000; %183000;  %new shorter time
    elseif(R == 3)
        lastcall = 183000;
    elseif(R == 4)
        lastcall = 150000;
    elseif(R == 5)
        lastcall = 163000; %183000;   %new shorter time
    elseif(R == 6)
        lastcall = 160000;
    elseif(R == 7)
        lastcall = 183000;
    end

    %  lastcall = 150000;  %tester bypass

% %     if(R == 1)            
% %         lastcall = 163000; %last utc time to look for cells
% %     elseif(R == 2)
% %         lastcall = 183000;
% %     elseif(R == 3)
% %         lastcall = 183000;
% %     elseif(R == 1)
% %         lastcall = 145500;
%     if(R == 1)
%         lastcall = 183000;
%     elseif(R == 2)
%         lastcall = 160000;
%     elseif(R == 3)
%         lastcall = 183000;
%     end
    
    for i = 1:as  %loop through cell track time steps
        for j = 1:bs  %loop through cell track numbers


            %current cell's current time:
            currtime =  str2num( hhmmss_cell(i,j) ) ;
            
            %if(  currtime >= 150000 & currtime < 180000   )  %limit to looking at 20UTC or less
            if( currtime >= firstcall & currtime <= lastcall & currtime ~= 000000   )  %limit to looking at 20UTC or less       %may need to limit for each day separately based on lasso times you used in swath detection?

                % meso swath time index correpsonding to current cell's current time
                currmesotime_ind = find( str2num(HHMMSS_all_ALLCASES(:,:,R)) == currtime ) ;
                
                %define the indices of the N-S span of the SDC to reference:
                curr_cell_rad   =  ( cellarea_cell(i,j) / 3.14159 ) .^ 0.5 ;
                radtolat = 1/110 ;    % ~ 1 deg lat / 110 km
                
                %this cell's correpsonding cross section + a null portion along the w-swath:
                
                % a factor you will multiply the cell radius by to look for a local null portion of the the swath:
                null_radius_factor = 2.5;
                % latitude span of cell +  null area:
                xtracellrad = 1; %km;  a little extra buffer to bloat the cell radius
                southlat = meanlat_cell(i,j) - null_radius_factor * (curr_cell_rad*radtolat + xtracellrad*radtolat);  %northern end of cell cross section
                northlat = meanlat_cell(i,j) + null_radius_factor * (curr_cell_rad*radtolat + xtracellrad*radtolat);  %southern end of cell cross section
                
                %j index of the cell + null cross section projectable onto swath span:
                curr_null_jspan =  [  find(abs(southlat - lat_alongSDC) == min(abs(southlat - lat_alongSDC)))  : ...
                    find(abs(northlat - lat_alongSDC) == min(abs(northlat - lat_alongSDC))) ]  ;
                
                % if prescribed, offset the cell's projection N-S along the span of swath according to an estimated
                %   cloud-rel V (mean over a depth within the 'swathbox'
                %   subdomain). !!!!!!!!!!! dont reccomend using this anymore   
                kill_swath = 0; %jnm_vadj

%                 if( Vadjusted_swath_window == 1 )  %addabove (also followup kill_swath=1 part)
%                              you've sense abandonded this effort, but if
%                              you copy it from a previous version (v11c or
%                              earlier), but it here and another place
%                              above
%                 end %jnm_vadj - generally dont recommend using this anymore
                
                
                disp(['asdfB_i',num2str(i),'_j',num2str(j)])

                %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                %%%%%% CATALOG NULL SWATH METRICS DURING CELL LIFETIME
                %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                
                if(kill_swath == 0) %jnm_vadj
                    
                    %%%% apply this to the Null_mask'ed swath property - each
                    %%%% cell's 'null' value is a mean of the nearby null
                    %%%% swath. Note, that cell's parts are NaNed out of the
                    %%%% variables before applying the curr_null_jspan
                    
                    nulllocalcell_mesoWwidth(i,j) =        mean( mesoWwidth_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWdepth(i,j) =        mean( mesoWdepth_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWtopasl(i,j) =       mean( mesoWtopasl_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWtopagl(i,j) =       mean( mesoWtopagl_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWstrength(i,j) =     mean( mesoWstrength_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWvmf(i,j) =          mean( mesoWvmf_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWqvap(i,j)   =       mean( mesoWqvap_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWtheta(i,j)   =      mean( mesoWtheta_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWthetae(i,j)   =     mean( mesoWthetae_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWlfcagl(i,j) =       mean( mesoWlfcagl_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWlfcasl(i,j) =       mean( mesoWlfcasl_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWcape(i,j) =         mean( mesoWcape_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWcin(i,j) =          mean( mesoWcin_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWtoplfcasl(i,j) =    mean( mesoWtoplfcasl_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoWtoplfcagl(i,j) =    mean( mesoWtoplfcagl_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;

                    nulllocalcell_mesoCwidth(i,j) =         mean( mesoCwidth_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoCdepth(i,j) =         mean( mesoCdepth_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoCstrength(i,j) =      mean( mesoCstrength_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoCMFCmean(i,j) =       mean( mesoCMFCmean_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoCMCqadvmean(i,j) =    mean( mesoCMCqadvmean_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoCMCqconvmean(i,j) =   mean( mesoCMCqconvmean_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoCMFCmax(i,j) =        mean( mesoCMFCmax_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoCMCqadvmax(i,j) =     mean( mesoCMCqadvmax_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;
                    nulllocalcell_mesoCMCqconvmax(i,j) =    mean( mesoCMCqconvmax_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;

                    disp(['asdfC_i',num2str(i),'_j',num2str(j)])                    
                    nulllocalcell_mesoWTFCbox_eastupslopedepth(i,j) =          mean( mesoWTFCbox_eastupslopedepth_nullfullsdc(curr_null_jspan,currmesotime_ind),'omitnan' )  ;


                
                    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                    %%%%%% NOW CATALOG NULL SWATH METRICS BACKWARD IN TIME (PRIOR TO CELL TRACK): @ CI -15min, -30min, -45min, -60min
                    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                    
                    % current cell's CI time (first time in radar track):
                    CellCItime = char(hhmmss_cell(1,j)) ;
                    CellCIhh = CellCItime(1:2) ;
                    CellCImm = CellCItime(3:4) ;
                    CellCIhr = str2num(CellCIhh) + str2num(CellCImm)/60;  %converted to decimal hour time of day
                    
                    %find time indices inmeso swath reference frame corresponding to times preceeding each cell's CI (@ -15min intervals)
                    CIm15_ind = find( HOUR_all ==   CellCIhr - 0.25  )  ;
                    CIm30_ind = find( HOUR_all ==   CellCIhr - 0.5   )  ;
                    CIm45_ind = find( HOUR_all ==   CellCIhr - 0.75  )  ;
                    CIm60_ind = find( HOUR_all ==   CellCIhr - 1.0   )  ;
                    
                    
                    %populate the pre-CI metric arrays:
                    %T = 1, 2, 3, 4  => CI-15min, CI-30min, CI-45min, CI-60min
                    
                    if( CIm15_ind > 0)
                        %kinematic:
                        localnull_mesoWwidth_preCI(j,1)        = mean(  mean( mesoWwidth_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoWdepth_preCI(j,1)        = mean(  mean( mesoWdepth_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoWstrength_preCI(j,1)     = mean(  mean( mesoWstrength_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoWvmf_preCI(j,1)          = mean(  mean( mesoWvmf_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoWtopasl_preCI(j,1)       = mean(  mean( mesoWtopasl_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoWtopagl_preCI(j,1)       = mean(  mean( mesoWtopagl_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoWtoplfcasl_preCI(j,1)    = mean(  mean( mesoWtoplfcasl_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoWtoplfcagl_preCI(j,1)    = mean(  mean( mesoWtoplfcagl_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        %thermo:
                        localnull_mesoWqvap_preCI(j,1)    = mean( mean( mesoWqvap_nullfullsdc(curr_null_jspan,CIm15_ind),'omitnan' ) ) ;
                        localnull_mesoWtheta_preCI(j,1)   = mean( mean( mesoWtheta_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') ) ;
                        localnull_mesoWthetae_preCI(j,1)  = mean( mean( mesoWthetae_nullfullsdc(curr_null_jspan,CIm15_ind),'omitnan' ) )  ;
                        %sounding:
                        localnull_mesoWlfcagl_preCI(j,1)    = mean( mean( mesoWlfcagl_nullfullsdc(curr_null_jspan,CIm15_ind),'omitnan' ) ) ;
                        localnull_mesoWlfcasl_preCI(j,1)    = mean( mean( mesoWlfcasl_nullfullsdc(curr_null_jspan,CIm15_ind),'omitnan' ) ) ;
                        localnull_mesoWcape_preCI(j,1)   = mean( mean( mesoWcape_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') ) ;
                        localnull_mesoWcin_preCI(j,1)    = mean( mean( mesoWcin_nullfullsdc(curr_null_jspan,CIm15_ind),'omitnan' ) )  ;

                        localnull_mesoCwidth_preCI(j,1)        = mean(  mean( mesoCwidth_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoCdepth_preCI(j,1)        = mean(  mean( mesoCdepth_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoCstrength_preCI(j,1)     = mean(  mean( mesoCstrength_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoCMFCmean_preCI(j,1)      = mean(  mean( mesoCMFCmean_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoCMCqadvmean_preCI(j,1)   = mean(  mean( mesoCMCqadvmean_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoCMCqconvmean_preCI(j,1)  = mean(  mean( mesoCMCqconvmean_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoCMFCmax_preCI(j,1)       = mean(  mean( mesoCMFCmax_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoCMCqadvmax_preCI(j,1)    = mean(  mean( mesoCMCqadvmax_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );
                        localnull_mesoCMCqconvmax_preCI(j,1)   = mean(  mean( mesoCMCqconvmax_nullfullsdc(curr_null_jspan,CIm15_ind) ,'omitnan') );

                        localnull_mesoWTFCbox_eastupslopedepth_preCI(j,1)    = mean( mean( mesoWTFCbox_eastupslopedepth_nullfullsdc(curr_null_jspan,CIm15_ind),'omitnan' ) )  ;       
                    end
                    
                    
                    if( CIm30_ind > 0)
                        %kinematic:
                        localnull_mesoWwidth_preCI(j,2)    = mean(  mean( mesoWwidth_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoWdepth_preCI(j,2)    = mean(  mean( mesoWdepth_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoWstrength_preCI(j,2) = mean(  mean( mesoWstrength_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoWvmf_preCI(j,2)      = mean(  mean( mesoWvmf_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoWtopasl_preCI(j,2)    = mean(  mean( mesoWtopasl_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoWtopagl_preCI(j,2)    = mean(  mean( mesoWtopagl_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoWtoplfcasl_preCI(j,2)    = mean(  mean( mesoWtoplfcasl_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoWtoplfcagl_preCI(j,2)    = mean(  mean( mesoWtoplfcagl_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        %thermo:
                        localnull_mesoWqvap_preCI(j,2)    = mean( mean( mesoWqvap_nullfullsdc(curr_null_jspan,CIm30_ind),'omitnan' ) ) ;
                        localnull_mesoWtheta_preCI(j,2)   = mean( mean( mesoWtheta_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') ) ;
                        localnull_mesoWthetae_preCI(j,2)  = mean( mean( mesoWthetae_nullfullsdc(curr_null_jspan,CIm30_ind),'omitnan' ) )  ;
                        %sounding:
                        localnull_mesoWlfcagl_preCI(j,2)    = mean( mean( mesoWlfcagl_nullfullsdc(curr_null_jspan,CIm30_ind),'omitnan' ) ) ;
                        localnull_mesoWlfcasl_preCI(j,2)    = mean( mean( mesoWlfcasl_nullfullsdc(curr_null_jspan,CIm30_ind),'omitnan' ) ) ;
                        localnull_mesoWcape_preCI(j,2)   = mean( mean( mesoWcape_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') ) ;
                        localnull_mesoWcin_preCI(j,2)    = mean( mean( mesoWcin_nullfullsdc(curr_null_jspan,CIm30_ind),'omitnan' ) )  ;
                        
                        localnull_mesoCwidth_preCI(j,2)        = mean(  mean( mesoCwidth_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoCdepth_preCI(j,2)        = mean(  mean( mesoCdepth_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoCstrength_preCI(j,2)     = mean(  mean( mesoCstrength_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoCMFCmean_preCI(j,2)      = mean(  mean( mesoCMFCmean_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoCMCqadvmean_preCI(j,2)   = mean(  mean( mesoCMCqadvmean_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoCMCqconvmean_preCI(j,2)  = mean(  mean( mesoCMCqconvmean_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoCMFCmax_preCI(j,2)       = mean(  mean( mesoCMFCmax_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoCMCqadvmax_preCI(j,2)    = mean(  mean( mesoCMCqadvmax_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );
                        localnull_mesoCMCqconvmax_preCI(j,2)   = mean(  mean( mesoCMCqconvmax_nullfullsdc(curr_null_jspan,CIm30_ind) ,'omitnan') );

                        localnull_mesoWTFCbox_eastupslopedepth_preCI(j,2)    = mean( mean( mesoWTFCbox_eastupslopedepth_nullfullsdc(curr_null_jspan,CIm30_ind),'omitnan' ) )  ;  
                    end
                    
                    
                    if( CIm45_ind > 0)
                        %kinematic:
                        localnull_mesoWwidth_preCI(j,3)    = mean(  mean( mesoWwidth_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoWdepth_preCI(j,3)    = mean(  mean( mesoWdepth_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoWstrength_preCI(j,3) = mean(  mean( mesoWstrength_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoWvmf_preCI(j,3)       = mean(  mean( mesoWvmf_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoWtopasl_preCI(j,3)    = mean(  mean( mesoWtopasl_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoWtopagl_preCI(j,3)    = mean(  mean( mesoWtopagl_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoWtoplfcasl_preCI(j,3)    = mean(  mean( mesoWtoplfcasl_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoWtoplfcagl_preCI(j,3)    = mean(  mean( mesoWtoplfcagl_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        %thermo:
                        localnull_mesoWqvap_preCI(j,3)    = mean( mean( mesoWqvap_nullfullsdc(curr_null_jspan,CIm45_ind),'omitnan' ) ) ;
                        localnull_mesoWtheta_preCI(j,3)   = mean( mean( mesoWtheta_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') ) ;
                        localnull_mesoWthetae_preCI(j,3)  = mean( mean( mesoWthetae_nullfullsdc(curr_null_jspan,CIm45_ind),'omitnan' ) )  ;
                        %sounding:
                        localnull_mesoWlfcagl_preCI(j,3)    = mean( mean( mesoWlfcagl_nullfullsdc(curr_null_jspan,CIm45_ind),'omitnan' ) ) ;
                        localnull_mesoWlfcasl_preCI(j,3)    = mean( mean( mesoWlfcasl_nullfullsdc(curr_null_jspan,CIm45_ind),'omitnan' ) ) ;
                        localnull_mesoWcape_preCI(j,3)   = mean( mean( mesoWcape_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') ) ;
                        localnull_mesoWcin_preCI(j,3)    = mean( mean( mesoWcin_nullfullsdc(curr_null_jspan,CIm45_ind),'omitnan' ) )  ;

                        localnull_mesoCwidth_preCI(j,3)        = mean(  mean( mesoCwidth_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoCdepth_preCI(j,3)        = mean(  mean( mesoCdepth_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoCstrength_preCI(j,3)     = mean(  mean( mesoCstrength_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoCMFCmean_preCI(j,3)      = mean(  mean( mesoCMFCmean_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoCMCqadvmean_preCI(j,3)   = mean(  mean( mesoCMCqadvmean_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoCMCqconvmean_preCI(j,3)  = mean(  mean( mesoCMCqconvmean_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoCMFCmax_preCI(j,3)       = mean(  mean( mesoCMFCmax_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoCMCqadvmax_preCI(j,3)    = mean(  mean( mesoCMCqadvmax_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );
                        localnull_mesoCMCqconvmax_preCI(j,3)   = mean(  mean( mesoCMCqconvmax_nullfullsdc(curr_null_jspan,CIm45_ind) ,'omitnan') );

                        localnull_mesoWTFCbox_eastupslopedepth_preCI(j,3)    = mean( mean( mesoWTFCbox_eastupslopedepth_nullfullsdc(curr_null_jspan,CIm45_ind),'omitnan' ) )  ;  
                    end
                    
                    
                    if( CIm60_ind > 0)
                        %kinematic:
                        localnull_mesoWwidth_preCI(j,4)    = mean(  mean( mesoWwidth_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoWdepth_preCI(j,4)    = mean(  mean( mesoWdepth_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoWstrength_preCI(j,4) = mean(  mean( mesoWstrength_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoWvmf_preCI(j,4)       = mean(  mean( mesoWvmf_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoWtopasl_preCI(j,4)    = mean(  mean( mesoWtopasl_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoWtopagl_preCI(j,4)    = mean(  mean( mesoWtopagl_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoWtoplfcasl_preCI(j,4)    = mean(  mean( mesoWtoplfcasl_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoWtoplfcagl_preCI(j,4)    = mean(  mean( mesoWtoplfcagl_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        %thermo:
                        localnull_mesoWqvap_preCI(j,4)    = mean( mean( mesoWqvap_nullfullsdc(curr_null_jspan,CIm60_ind),'omitnan' ) ) ;
                        localnull_mesoWtheta_preCI(j,4)   = mean( mean( mesoWtheta_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') ) ;
                        localnull_mesoWthetae_preCI(j,4)  = mean( mean( mesoWthetae_nullfullsdc(curr_null_jspan,CIm60_ind),'omitnan' ) )  ;
                        %sounding:
                        localnull_mesoWlfcagl_preCI(j,4)    = mean( mean( mesoWlfcagl_nullfullsdc(curr_null_jspan,CIm60_ind),'omitnan' ) ) ;
                        localnull_mesoWlfcasl_preCI(j,4)    = mean( mean( mesoWlfcasl_nullfullsdc(curr_null_jspan,CIm60_ind),'omitnan' ) ) ;
                        localnull_mesoWcape_preCI(j,4)   = mean( mean( mesoWcape_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') ) ;
                        localnull_mesoWcin_preCI(j,4)    = mean( mean( mesoWcin_nullfullsdc(curr_null_jspan,CIm60_ind),'omitnan' ) )  ;

                        localnull_mesoCwidth_preCI(j,4)        = mean(  mean( mesoCwidth_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoCdepth_preCI(j,4)        = mean(  mean( mesoCdepth_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoCstrength_preCI(j,4)     = mean(  mean( mesoCstrength_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoCMFCmean_preCI(j,4)      = mean(  mean( mesoCMFCmean_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoCMCqadvmean_preCI(j,4)   = mean(  mean( mesoCMCqadvmean_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoCMCqconvmean_preCI(j,4)  = mean(  mean( mesoCMCqconvmean_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoCMFCmax_preCI(j,4)       = mean(  mean( mesoCMFCmax_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoCMCqadvmax_preCI(j,4)    = mean(  mean( mesoCMCqadvmax_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                        localnull_mesoCMCqconvmax_preCI(j,4)   = mean(  mean( mesoCMCqconvmax_nullfullsdc(curr_null_jspan,CIm60_ind) ,'omitnan') );
                       
                        localnull_mesoWTFCbox_eastupslopedepth_preCI(j,4)    = mean( mean( mesoWTFCbox_eastupslopedepth_nullfullsdc(curr_null_jspan,CIm60_ind),'omitnan' ) )  ;  
                    end
                    
                end %kill_swath check
                
            end  %time check
            
        end % cell num loop
    end % cell num loop


    disp('eegr')
%end %Rtest




    %   good to here
    
    %%%% final modifiation of LOCAL NULL vars:
    % these are in the time ref frame of t = 1(CI-15min) to 4(CI-60min). will need to flipdim it to make it intuitive.
    localnull_mesoWwidth_preCI = localnull_mesoWwidth_preCI';
    localnull_mesoWdepth_preCI = localnull_mesoWdepth_preCI';
    localnull_mesoWstrength_preCI = localnull_mesoWstrength_preCI';
    localnull_mesoWvmf_preCI = localnull_mesoWvmf_preCI';
    localnull_mesoWtopasl_preCI = localnull_mesoWtopasl_preCI';
    localnull_mesoWtopagl_preCI = localnull_mesoWtopagl_preCI';
    localnull_mesoWqvap_preCI = localnull_mesoWqvap_preCI';
    localnull_mesoWtheta_preCI = localnull_mesoWtheta_preCI';
    localnull_mesoWthetae_preCI = localnull_mesoWthetae_preCI';
    localnull_mesoWlfcagl_preCI = localnull_mesoWlfcagl_preCI';
    localnull_mesoWlfcasl_preCI = localnull_mesoWlfcasl_preCI';
    localnull_mesoWcape_preCI = localnull_mesoWcape_preCI';
    localnull_mesoWcin_preCI = localnull_mesoWcin_preCI';
    localnull_mesoWtoplfcasl_preCI = localnull_mesoWtoplfcasl_preCI';
    localnull_mesoWtoplfcagl_preCI = localnull_mesoWtoplfcagl_preCI';

    localnull_mesoCwidth_preCI          = localnull_mesoCwidth_preCI';
    localnull_mesoCdepth_preCI          = localnull_mesoCdepth_preCI';
    localnull_mesoCstrength_preCI       = localnull_mesoCstrength_preCI';
    localnull_mesoCMFCmean_preCI        = localnull_mesoCMFCmean_preCI';
    localnull_mesoCMCqadvmean_preCI     = localnull_mesoCMCqadvmean_preCI';
    localnull_mesoCMCqconvmean_preCI    = localnull_mesoCMCqconvmean_preCI';
    localnull_mesoCMFCmax_preCI         = localnull_mesoCMFCmax_preCI';
    localnull_mesoCMCqadvmax_preCI      = localnull_mesoCMCqadvmax_preCI';
    localnull_mesoCMCqconvmax_preCI     = localnull_mesoCMCqconvmax_preCI';

    disp(['asdfD'])      
    localnull_mesoWTFCbox_eastupslopedepth_preCI = localnull_mesoWTFCbox_eastupslopedepth_preCI';



    % stitch together pre and post CI arrays (and flipdim them for time array: CI-60, CI-45, CI-30, CI-15, CI, CI+15 ... CI + n (t = 5 is the CI time).
    prepost_localnull_mesoWwidth     = cat(1,flipdim(localnull_mesoWwidth_preCI,1),nulllocalcell_mesoWwidth);
    prepost_localnull_mesoWdepth     = cat(1,flipdim(localnull_mesoWdepth_preCI,1),nulllocalcell_mesoWdepth);
    prepost_localnull_mesoWstrength  = cat(1,flipdim(localnull_mesoWstrength_preCI,1),nulllocalcell_mesoWstrength);
    prepost_localnull_mesoWvmf       = cat(1,flipdim(localnull_mesoWvmf_preCI,1),nulllocalcell_mesoWvmf);
    prepost_localnull_mesoWtopasl    = cat(1,flipdim(localnull_mesoWtopasl_preCI,1),nulllocalcell_mesoWtopasl);
    prepost_localnull_mesoWtopagl    = cat(1,flipdim(localnull_mesoWtopagl_preCI,1),nulllocalcell_mesoWtopagl); 
    prepost_localnull_mesoWqvap      = cat(1,flipdim(localnull_mesoWqvap_preCI,1),nulllocalcell_mesoWqvap);
    prepost_localnull_mesoWtheta     = cat(1,flipdim(localnull_mesoWtheta_preCI,1),nulllocalcell_mesoWtheta);
    prepost_localnull_mesoWthetae    = cat(1,flipdim(localnull_mesoWthetae_preCI,1),nulllocalcell_mesoWthetae);
    prepost_localnull_mesoWlfcagl    = cat(1,flipdim(localnull_mesoWlfcagl_preCI,1),nulllocalcell_mesoWlfcagl);
    prepost_localnull_mesoWlfcasl    = cat(1,flipdim(localnull_mesoWlfcasl_preCI,1),nulllocalcell_mesoWlfcasl);
    prepost_localnull_mesoWcape      = cat(1,flipdim(localnull_mesoWcape_preCI,1),nulllocalcell_mesoWcape);
    prepost_localnull_mesoWcin       = cat(1,flipdim(localnull_mesoWcin_preCI,1),nulllocalcell_mesoWcin);
    prepost_localnull_mesoWtoplfcasl = cat(1,flipdim(localnull_mesoWtoplfcasl_preCI,1),nulllocalcell_mesoWtoplfcasl);
    prepost_localnull_mesoWtoplfcagl = cat(1,flipdim(localnull_mesoWtoplfcagl_preCI,1),nulllocalcell_mesoWtoplfcagl); 

    prepost_localnull_mesoCwidth        = cat(1,flipdim(localnull_mesoCwidth_preCI,1),nulllocalcell_mesoCwidth);
    prepost_localnull_mesoCdepth        = cat(1,flipdim(localnull_mesoCdepth_preCI,1),nulllocalcell_mesoCdepth);
    prepost_localnull_mesoCstrength     = cat(1,flipdim(localnull_mesoCstrength_preCI,1),nulllocalcell_mesoCstrength);
    prepost_localnull_mesoCMFCmean      = cat(1,flipdim(localnull_mesoCMFCmean_preCI,1),nulllocalcell_mesoCMFCmean);
    prepost_localnull_mesoCMCqadvmean   = cat(1,flipdim(localnull_mesoCMCqadvmean_preCI,1),nulllocalcell_mesoCMCqadvmean);
    prepost_localnull_mesoCMCqconvmean  = cat(1,flipdim(localnull_mesoCMCqconvmean_preCI,1),nulllocalcell_mesoCMCqconvmean);
    prepost_localnull_mesoCMFCmax       = cat(1,flipdim(localnull_mesoCMFCmax_preCI,1),nulllocalcell_mesoCMFCmax);
    prepost_localnull_mesoCMCqadvmax    = cat(1,flipdim(localnull_mesoCMCqadvmax_preCI,1),nulllocalcell_mesoCMCqadvmax);
    prepost_localnull_mesoCMCqconvmax   = cat(1,flipdim(localnull_mesoCMCqconvmax_preCI,1),nulllocalcell_mesoCMCqconvmax);
   
    disp(['asdfE']) 
    prepost_localnull_mesoWTFCbox_eastupslopedepth  = cat(1,flipdim(localnull_mesoWTFCbox_eastupslopedepth_preCI,1),nulllocalcell_mesoWTFCbox_eastupslopedepth);


    disp(['asdfEb']) 

    %{

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%  Now calculate the desired in-cell flextrkr w metrics:   
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    %initialize variables in cell-stats space (numtimes,numcelltracks)
    updraftbaseZ_CELLstats = zeros(ntimes_updraft,ntracks_updraft);          updraftbaseZ_CELLstats(:) = NaN;
    
    % tabulated in lowest 1 km of part of cells with cores detected: 
    totalwarea_cldbase_CELLstats   = zeros(ntimes_updraft,ntracks_updraft);  	 totalwarea_cldbase_CELLstats(:) = NaN;
    maxwarea_cldbase_CELLstats     = zeros(ntimes_updraft,ntracks_updraft);      maxwarea_cldbase_CELLstats(:) = NaN;
    maxw_cldbase_CELLstats         = zeros(ntimes_updraft,ntracks_updraft);          maxw_cldbase_CELLstats(:) = NaN;
    maxnumwcores_cldbase_CELLstats = zeros(ntimes_updraft,ntracks_updraft);        maxnumwcores_cldbase_CELLstats(:) = NaN;   
    % tabulated throughout cell depth: 
    totalwarea_fullcld_CELLstats   = zeros(ntimes_updraft,ntracks_updraft);    totalwarea_fullcld_CELLstats(:) = NaN;
    maxwarea_fullcld_CELLstats     = zeros(ntimes_updraft,ntracks_updraft);      maxwarea_fullcld_CELLstats(:) = NaN;
    maxw_fullcld_CELLstats         = zeros(ntimes_updraft,ntracks_updraft);          maxw_fullcld_CELLstats(:) = NaN;
    maxnumwcores_fullcld_CELLstats = zeros(ntimes_updraft,ntracks_updraft);  maxnumwcores_fullcld_CELLstats(:) = NaN;    
    
    for n = 1:ntracks_updraft   % loop thru cell tracks
        for t = 1:ntimes_updraft % loop thru cell times

            %%%% tabulated throughout cell depth: 
            %widest summed updraft found summed across all w cores throughout cell profile:
            tmp = sum(area_updraft(:,:,t,n),1,'omitnan')' ;  %summing area across all cores as f(z)
            totalwarea_fullcld_CELLstats(t,n) = max(  tmp,[],'omitnan'  ); %the max summed area within in-cell profile
            
            %widest updraft among all w cores throughout cell profile:
            tmp = max(area_updraft(:,:,t,n),[],1,'omitnan')' ;  %max area across all cores per height
            maxwarea_fullcld_CELLstats(t,n) = max( tmp,[],'omitnan' ) ;  %max of the max area regardless of the height in the cell
            
            %strongest |updraft| among all w cores throughout cell profile:
            tmp = max( max_updraft(:,:,t,n),[],1,'omitnan' )' ;  %max updraft across all cores per height
            maxw_fullcld_CELLstats(t,n) = max( tmp ,[],'omitnan') ; % max of the max updraft regardless of height in the cell
            
            % max of greatest num of updraft cores per height:
            maxnumwcores_fullcld_CELLstats(t,n) = max( numcores_updraft(:,t,n),[],1,'omitnan' )' ;
            

            %%% tabulation limited to within the lowest <wanteddepth> km of cell depth (i.e., cloud-base(er) ):            
            wanteddepth = 3000;  %km how deep you want to look in the lowest ht of the cell containing w cores
            % look for the bottom ht of a cell with any num of w cores:
            kbot = find( numcores_updraft(:,t,n) > 0 );
            
            if( isempty(kbot)==0)
                
                % the "updraft base"
                updraftbaseZ_CELLstats(t,n) = Zmsl_updraft(kbot(1));
                
                %ktop = find( Zmsl_updraft ==  Zmsl_updraft(kbot(1)) + 1500  );
                ktop = find( abs(Zmsl_updraft - (Zmsl_updraft(kbot(1)) + wanteddepth))  ==  min(abs(Zmsl_updraft - (Zmsl_updraft(kbot(1)) + wanteddepth)))   );
                ktop = ktop(1);
                
                %widest summed updraft found summed across all w cores throughout lowest part of cell:
                tmp = sum(area_updraft(:,kbot:ktop,t,n),1,'omitnan')' ;  %summing area across all cores per height
                totalwarea_cldbase_CELLstats(t,n) = max(  tmp,[],'omitnan'  ); %the max summed area within in-cell profile
                
                %widest updraft among all w cores throughout lowest part of cell:
                tmp = max(area_updraft(:,kbot:ktop,t,n),[],1,'omitnan')' ;  %max area across all cores per height
                maxwarea_cldbase_CELLstats(t,n) = max( tmp,[],'omitnan' );  %max of the max area regardless of the height in the cell
                
                %strongest |updraft| among all w cores throughout lowest part of cell:
                tmp = max( max_updraft(:,kbot:ktop,t,n),[],1,'omitnan' )' ;  %max updraft across all cores per height
                maxw_cldbase_CELLstats(t,n) = max( tmp ,[],'omitnan') ; % max of the max updraft regardless of height in the cell
                
                % max of greatest num of updraft cores per height throughout lowest part of cell:
                maxnumwcores_cldbase_CELLstats(t,n) = max( numcores_updraft(kbot:ktop,t,n),[],1,'omitnan' )' ;
                
            end
        end
    end
    %}
    
  
    %  save('jan23test2_disposible.mat','-v7.3')

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%    calculate cell population density & cell metrics along SDC (in lasso grid space):
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    [as bs]  = size(cellarea_cell);
    mask_dur2 = zeros(as,bs);  mask_dur2(:) = NaN;
    mask_latdist = zeros(as,bs);  mask_latdist(:) = NaN;
    
    lonWest = -64.97;
    lonEast = -64.69;

    % define another set of cell criteria masks that I will use for general cell presence rather than targeting individual cloud-swath interactions (e.g., above).
    for i = 1:as
        for j = 1:bs
            
            %if( dist_cell_and_swath(i,j,R) > -5 &
            %dist_cell_and_swath(i,j,R) < 40  &  meanlat_cell(i,j) <
            %latNorth  &  meanlat_cell(i,j) > latSouth )   % this will only keep cells during the swath detection period
            if( meanlon_cell(i,j) > lonWest &  meanlon_cell(i,j) < lonEast  &  meanlat_cell(i,j) < latNorth  &  meanlat_cell(i,j) > latSouth )
                mask_latdist(i,j) = 1;
            end
            
            if( duration_cell(j) > 1)
                mask_dur2(:,j) = 1;
            end
            
            %         nomergekeep = 0;
            %         if( isnan(endmergecloudnumber_cell(j)) & duration_cell(j) < 5 ) % I think this method still might allow mergers where the dominant cell continues on, which we might not want if we just want to look at what the swath is doing ot individual cells?
            %             nomergekeep = 1; % preserves cell if does not end in merger within 1 hr of CI)
            %             mask_spl(:,j) = 1;
            %         end
            %         if( nomergekeep == 1 & isnan(startsplitcloudnumber_cell(j)) )
            %             mask_merspl(:,j) = 1;
            %         end
        end
    end
    
    % accumulate unique cell tracks in time along the sdc
    alongsdccells = zeros(100,sdclength,length(celltrack_hr));   % unique cell tracks in time along sdc at each y;   the first index is a dummy length - a guess at how many cells there could be at any one time
    alongsdccells(:) = NaN;
    

    %%%%%%  parallel version:
    [yc yt yr] = size(CellPopEachTime_ALLCASES) ;
    cellpop = zeros(yc, yt);  cellpop(:) = NaN;
    %may want to parallelize this loop?
    parfor t = 1:length(celltrack_hr) %alltimes  %loop over lasso times

        % the mask you'll use to keep cells:
        maskkeep = mask_latdist(:,:);   % .* mask_dur2 ; 
        %current cell track scene:
        celltracks = celltrack_all(:,:,t);      %celltracks(isnan(celltracks)) = 0;
        
        % tag the tracks in the scene that you dont want to keep:
        killedtracks = [];
        for nn = 1:bs
            %  tt = 10;  nn = 11;
            [currn] = find( floor(celltrack_basetime(t)/100) == floor(basetime_cell(:,nn)/100) ) ;
            if(  isempty(currn)==0 & isnan( maskkeep(currn,nn) ) )
                killedtracks = vertcat(killedtracks,nn);
            end
        end
        %now filter them out:
        celltracks2 = celltracks;
        celltracks2(celltracks2==0) = NaN;
        for k = 1:length(killedtracks)
            killme = find(celltracks2 == killedtracks(k)) ;
            if(  isempty(killme)==0)
                celltracks2(killme) = NaN;    %final filtered cell track current scene
            end
        end
        
        %%%% tabulate the cell count per time and case:
        %uniqcells = unique(  celltracks2 );    uniqcells( isnan(uniqcells))=[];
        %CellPopEachTime_ALLCASES(1:length(uniqcells),t,R) = uniqcells;   %this catalogs the cell IDs present at each time in a chosen domain defined by 'maskkeep'
        %%%% [yc yt yr] = size(CellPopEachTime_ALLCASES) ;
        uniqcells = zeros(yc,1); uniqcells(:) = NaN;
        unc = unique( celltracks2 );   unc(isnan(unc))=[];
        uniqcells(1:length(unc)) = unc;
        cellpop(:,t) = uniqcells; 

        % spatial interp celltrack grid to lasso grid at current time:
        %[lonm latm] =meshgrid(track_lon,track_lat);
        lonm = track_lon;
        latm = track_lat;
        cellmask_on_lassogrid = griddata(lonm, latm, celltracks2, Lon, Lat,'nearest') ;
   
        %accumulate the cell track numbers in time
        [ii, jj] = size( cellmask_on_lassogrid ) ; ii = [];
        dummy = zeros(100,sdclength);    dummy(:) = NaN;
        for j = 1:jj
            ytracks =[];  uytracks =[];
            ytracks = cellmask_on_lassogrid( find(  cellmask_on_lassogrid(:,j)  > 0 ) ,j ) ;   %cell track numbers at each j
            uytracks = unique(ytracks) ;  %unique cell track numbers at this j   
            for de = 1:length(uytracks)
                %alongsdccells(de,j,t) = uytracks(de) ;
                dummy(de,j) = uytracks(de) ;
            end
        end
        alongsdccells(:,:,t) = dummy ;
    end  %time
    CellPopEachTime_ALLCASES(:,:,R) = cellpop ;  clear cellpop
    %CellPopEachTime_ALLCASES_parallel = CellPopEachTime_ALLCASES ;


    % count the uniquecells at each time:
    [a1 b1 c1] = size(alongsdccells)    ;
    % look at current and prev times to sum the unique cell tracks that are cumulatively present at each y location:
    for j = 1:b1     %lasso grid y loop
        for e = 1:c1 %lasso grid time loop
            clear test test2
            test = alongsdccells(:,j,1:e ) ;   %cells at this and prev times
            test2 = find(isnan(alongsdccells(:,j,1:e ))==0) ;
            CumCellPopAlongSDC_ALLCASES(j,e,R) = length( unique(  test(test2)    ) );
        end
    end
    
    %diagnostic
    %  figure; contourf(CumCellPopAlongSDC_ALLCASES(:,:,1),20,'LineColor','none')
    %  figure; contourf(CumCellPopAlongSDC_ALLCASES_serial(:,:,1),20,'LineColor','none')
    %  figure; contourf(CumCellPopAlongSDC_ALLCASES_parallel(:,:,1),20,'LineColor','none')
    %  filledHR = [13:5/60:(19+10/60)];   figure; contourf(filledHR,[1:1600],CumCellPopAlongSDC_ALLCASES_serial(:,:,1),20,'LineColor','none')
   

    %now tabulate the xtramostbestest of the cell properties
    for t = 1:c1
        %         cellareas=[];
        %         celldbzs=[];
        %         celleths=[];
        for j = 1:b1
            %  t = 145;  j = 1415

            cellareas=[];
            celldbzs=[];
            celleths=[];
            celldist = [];
            % look at all cells at each j and t along SDC, tabulate their stats for Hovmoller diagrams
            cellns = alongsdccells(:,j,t);   cellns = unique(cellns);   cellns(isnan(cellns)) =[] ;
            if(  isempty(cellns)==0  )
                for c = 1 : length(cellns)
                    celln = cellns(c)  ;
                    cellt = find( round(celltrack_hr(t),4) == round( hour_cell_ALLCASES(:,celln,R),4) )  ;  %this LASSO time's index in cell stats frame
                    celldbzs  = vertcat( celldbzs,  maxdbz_cell(cellt,celln) ) ;        % all cells' metric at this LASSO-SDC time
                    celleths  = vertcat( celleths,  ETH10_cell(cellt,celln) ) ;         % all cells' metric at this LASSO-SDC time
                    cellareas = vertcat( cellareas, corearea_cell(cellt,celln) ) ;      % all cells' metric at this LASSO-SDC time
                    celldist  = vertcat( celldist,  dist_cell_and_swath(cellt,celln,R) ) ;
                end

                %if multiple cells at this time along the SDC, just pick one:
                if( isempty(celldbzs)==0  &  isempty(celleths)==0  &  isempty(cellareas)==0)
                    CellmaxdbxPopAlongSDC_ALLCASES(j,t,R)   =  max(celldbzs) ;
                    Celleth10PopAlongSDC_ALLCASES(j,t,R)    =  max(celleths) ;
                    CellareaPopAlongSDC_ALLCASES(j,t,R)     =  max(cellareas) ;
                    CellDistswathAlongSDC_ALLCASES(j,t,R)   =  max(celldist) ;
                end

            end
        end
    end



%     pres2_CellmaxdbxPopAlongSDC_ALLCASES = CellmaxdbxPopAlongSDC_ALLCASES;
%     pres2_Celleth10PopAlongSDC_ALLCASES  = Celleth10PopAlongSDC_ALLCASES;
%     pres2_CellareaPopAlongSDC_ALLCASES   = CellareaPopAlongSDC_ALLCASES;

    %  figure;  contourf(celltrack_hr,lat_alongSDC,CellmaxdbxPopAlongSDC_ALLCASES(:,:,2),20)
    %  figure;  contourf(Celleth10PopAlongSDC_ALLCASES(:,:,2),20)

    % figure; contourf(celltrack_hr, lat_alongSDC, CellDistswathAlongSDC_ALLCASES(:,:,1),20)
    % figure; contourf(celltrack_hr, lat_alongSDC, CellDistswathAlongSDC_ALLCASES(:,:,1),20)

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%% now concat relevant variables from each case to all-case
    %%%%%%%%% arrays:
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    disp('    ')
    disp(' concating all cases for ')
    disp( RUNS(R,:) )
    disp('    ')
    tic
    
   % [numpreplusci numcells] = size(preCIandCI_cape_acbl) ;   clear numpreplusci
    [blah numcells]             = size(hhmmss_cell)  ;           clear blah
    [numpreplusci numenvtime]   = size(preCIandCI_cape_acbl) ;   clear numpreplusci
    [blah numtimes]             = size(mesoWtheta_nullmean) ;    clear blah                % [blah numtimes] = size(mesoWthetaca_nullmean);          clear blah
    [numpreandposttimes blah]   = size(prepost_mesoWdepth) ;     clear blah
    [tracksize blah]            =  size(mesoWwidth_cell) ;              clear blah
    
    disp('numcells')
    disp(numcells)
    
    [sdclen timlen] = size(mesoWwidth_nullfullsdc); clear timlen
    
    %%% non-local NULL metrics (generally obsolete after adding local null metrics)
        %     %     % meso swath properties (kinematic & thermo) for portions of SDC without cells
        %     mesoWwidth_nullmean_ALLCASES(:, 1:numtimes, R)  =  mesoWwidth_nullmean;
        %     mesoWdepth_nullmean_ALLCASES(:, 1:numtimes, R)  =  mesoWdepth_nullmean;
        %     mesoWstrength_nullmean_ALLCASES(:, 1:numtimes, R)  = mesoWstrength_nullmean;
        %     mesoWqvap_nullmean_ALLCASES(:, 1:numtimes, R)  = mesoWqvap_nullmean;
        %     mesoWtheta_nullmean_ALLCASES(:, 1:numtimes, R)  = mesoWtheta_nullmean;
        %     mesoWthetae_nullmean_ALLCASES(:, 1:numtimes, R)  = mesoWthetae_nullmean;
%     % meso swath properties (kinematic & thermo) for portions of SDC without cells
    mesoWwidth_nullmean_ALLCASES(1:numtimes, R)     =  mesoWwidth_nullmean;
    mesoWdepth_nullmean_ALLCASES(1:numtimes, R)     =  mesoWdepth_nullmean;
    mesoWstrength_nullmean_ALLCASES(1:numtimes, R)  = mesoWstrength_nullmean;
    mesoWvmf_nullmean_ALLCASES(1:numtimes, R)  = mesoWvmf_nullmean;
    mesoWqvap_nullmean_ALLCASES(1:numtimes, R)      = mesoWqvap_nullmean;
    mesoWtheta_nullmean_ALLCASES(1:numtimes, R)     = mesoWtheta_nullmean;
    mesoWthetae_nullmean_ALLCASES(1:numtimes, R)    = mesoWthetae_nullmean;

    mesoCwidth_nullmean_ALLCASES(1:numtimes, R)         =  mesoCwidth_nullmean;
    mesoCdepth_nullmean_ALLCASES(1:numtimes, R)         =  mesoCdepth_nullmean;
    mesoCstrength_nullmean_ALLCASES(1:numtimes, R)      =  mesoCstrength_nullmean;
    mesoCMFCmean_nullmean_ALLCASES(1:numtimes, R)       =  mesoCMFCmean_nullmean;
    mesoCMCqadvmean_nullmean_ALLCASES(1:numtimes, R)    =  mesoCMCqadvmean_nullmean;
    mesoCMCqconvmean_nullmean_ALLCASES(1:numtimes, R)   =  mesoCMCqconvmean_nullmean;
    mesoCMFCmax_nullmean_ALLCASES(1:numtimes, R)        =  mesoCMFCmax_nullmean;
    mesoCMCqadvmax_nullmean_ALLCASES(1:numtimes, R)     =  mesoCMCqadvmax_nullmean;
    mesoCMCqconvmax_nullmean_ALLCASES(1:numtimes, R)    =  mesoCMCqconvmax_nullmean;


    %     % same but keep the whole sdc length worth of null parameters:
    mesoWwidth_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)    =  mesoWwidth_nullfullsdc;
    mesoWdepth_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)    =  mesoWdepth_nullfullsdc;
    mesoWstrength_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)  = mesoWstrength_nullfullsdc;
    mesoWvmf_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)      = mesoWvmf_nullfullsdc;
    mesoWtopasl_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)   =  mesoWtopasl_nullfullsdc;
    mesoWtopagl_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)   =  mesoWtopagl_nullfullsdc;
    mesoWqvap_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)     = mesoWqvap_nullfullsdc;
    mesoWtheta_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)    = mesoWtheta_nullfullsdc;
    mesoWthetae_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)   = mesoWthetae_nullfullsdc;
    mesoWlfcagl_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)   = mesoWlfcagl_nullfullsdc;
    mesoWlfcasl_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)   = mesoWlfcasl_nullfullsdc;
    mesoWcape_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)     = mesoWcape_nullfullsdc;
    mesoWcin_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)      = mesoWcin_nullfullsdc;
    mesoWtoplfcasl_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)  =  mesoWtoplfcasl_nullfullsdc;
    mesoWtoplfcagl_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)  =  mesoWtoplfcagl_nullfullsdc;

    mesoCwidth_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)        =  mesoCwidth_nullfullsdc;
    mesoCdepth_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)        =  mesoCdepth_nullfullsdc;
    mesoCstrength_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)     = mesoCstrength_nullfullsdc;
    mesoCMFCmean_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)      =  mesoCMFCmean_nullfullsdc;
    mesoCMCqadvmean_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)   =  mesoCMCqadvmean_nullfullsdc;
    mesoCMCqconvmean_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)  = mesoCMCqconvmean_nullfullsdc;
    mesoCMFCmax_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)       =  mesoCMFCmax_nullfullsdc;
    mesoCMCqadvmax_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)    =  mesoCMCqadvmax_nullfullsdc;
    mesoCMCqconvmax_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)   = mesoCMCqconvmax_nullfullsdc;
   
    disp(['asdfF']) 
    mesoWTFCbox_eastupslopedepth_nullfullsdc_ALLCASES(1:sdclen, 1:numtimes, R)      =  mesoWTFCbox_eastupslopedepth_nullfullsdc;



    %     % meso swath properties (kinematic & thermo & sounding metrics) for portions of SDC with cells
    prepost_timehr_ALLCASES(1:numpreandposttimes,1:numcells,R) =          prepost_timehr ;
    prepost_timerelCI_ALLCASES(1:numpreandposttimes,1:numcells,R) =       prepost_timerelCI ;
    prepost_mesoWwidth_ALLCASES(1:numpreandposttimes,1:numcells,R) =      prepost_mesoWwidth ;
    prepost_mesoWdepth_ALLCASES(1:numpreandposttimes,1:numcells,R) =      prepost_mesoWdepth ;
    prepost_mesoWtopasl_ALLCASES(1:numpreandposttimes,1:numcells,R) =     prepost_mesoWtopasl ;
    prepost_mesoWtopagl_ALLCASES(1:numpreandposttimes,1:numcells,R) =     prepost_mesoWtopagl ;
    prepost_mesoWstrength_ALLCASES(1:numpreandposttimes,1:numcells,R) =   prepost_mesoWstrength ;
    prepost_mesoWvmf_ALLCASES(1:numpreandposttimes,1:numcells,R) =        prepost_mesoWvmf ;
    prepost_mesoWqvap_ALLCASES(1:numpreandposttimes,1:numcells,R) =       prepost_mesoWqvap ;
    prepost_mesoWtheta_ALLCASES(1:numpreandposttimes,1:numcells,R) =      prepost_mesoWtheta ;
    prepost_mesoWthetae_ALLCASES(1:numpreandposttimes,1:numcells,R) =     prepost_mesoWthetae ;
    prepost_mesoWlfcagl_ALLCASES(1:numpreandposttimes,1:numcells,R)  =    prepost_mesoWlfcagl;
    prepost_mesoWlfcasl_ALLCASES(1:numpreandposttimes,1:numcells,R)  =    prepost_mesoWlfcasl;
    prepost_mesoWcape_ALLCASES(1:numpreandposttimes,1:numcells,R) =       prepost_mesoWcape;
    prepost_mesoWcin_ALLCASES(1:numpreandposttimes,1:numcells,R)  =       prepost_mesoWcin;
    prepost_mesoWtoplfcasl_ALLCASES(1:numpreandposttimes,1:numcells,R) =  prepost_mesoWtoplfcasl ;
    prepost_mesoWtoplfcagl_ALLCASES(1:numpreandposttimes,1:numcells,R) =  prepost_mesoWtoplfcagl ;

    prepost_mesoCwidth_ALLCASES(1:numpreandposttimes,1:numcells,R) =        prepost_mesoCwidth ;
    prepost_mesoCdepth_ALLCASES(1:numpreandposttimes,1:numcells,R) =        prepost_mesoCdepth ;
    prepost_mesoCstrength_ALLCASES(1:numpreandposttimes,1:numcells,R) =     prepost_mesoCstrength ;
    prepost_mesoCMFCmean_ALLCASES(1:numpreandposttimes,1:numcells,R) =      prepost_mesoCMFCmean ;
    prepost_mesoCMCqadvmean_ALLCASES(1:numpreandposttimes,1:numcells,R) =   prepost_mesoCMCqadvmean ;
    prepost_mesoCMCqconvmean_ALLCASES(1:numpreandposttimes,1:numcells,R) =  prepost_mesoCMCqconvmean ;
    prepost_mesoCMFCmax_ALLCASES(1:numpreandposttimes,1:numcells,R) =      prepost_mesoCMFCmax ;
    prepost_mesoCMCqadvmax_ALLCASES(1:numpreandposttimes,1:numcells,R) =   prepost_mesoCMCqadvmax ;
    prepost_mesoCMCqconvmax_ALLCASES(1:numpreandposttimes,1:numcells,R) =  prepost_mesoCMCqconvmax ; 

    disp(['asdfG']) 
    prepost_mesoWTFCbox_eastupslopedepth_ALLCASES(1:numpreandposttimes,1:numcells,R)                =       prepost_mesoWTFCbox_eastupslopedepth;  %final product

    prepost_mesoWTFCbox_eastupslopemean_ALLCASES(1:numpreandposttimes,1:numcells,R)                 =       prepost_mesoWTFCbox_eastupslopemean;  %final product 
    prepost_mesoWTFCbox_eastupslopedepthfract_ALLCASES(1:numpreandposttimes,1:numcells,R)           =       prepost_mesoWTFCbox_eastupslopedepthfract;  %final product
    prepost_mesoWTFCbox_eastupslopetophtasl_ALLCASES(1:numpreandposttimes,1:numcells,R)             =       prepost_mesoWTFCbox_eastupslopetophtasl;  %final product
    prepost_mesoWTFCbox_eastupslopedepthfract2500masl_ALLCASES(1:numpreandposttimes,1:numcells,R)   =       prepost_mesoWTFCbox_eastupslopedepthfract2500masl;  %final product
    prepost_mesoWTFCbox_eastupslopemean2500masl_ALLCASES(1:numpreandposttimes,1:numcells,R)         =       prepost_mesoWTFCbox_eastupslopemean2500masl;  %final product
    prepost_mesoWTFCbox_eastupslopedepthfract1500magl_ALLCASES(1:numpreandposttimes,1:numcells,R)   =       prepost_mesoWTFCbox_eastupslopedepthfract1500magl;  %final product
    prepost_mesoWTFCbox_eastupslopemean1500magl_ALLCASES(1:numpreandposttimes,1:numcells,R)         =       prepost_mesoWTFCbox_eastupslopemean1500magl;  %final product
    prepost_mesoWTFCbox_eastUmean3to4kmasl_ALLCASES(1:numpreandposttimes,1:numcells,R)              =       prepost_mesoWTFCbox_eastUmean3to4kmasl;  %final product
    prepost_mesoWTFCbox_eastUmean4to5kmasl_ALLCASES(1:numpreandposttimes,1:numcells,R)              =       prepost_mesoWTFCbox_eastUmean4to5kmasl;  %final product
    prepost_mesoWTFCbox_eastUmean5to6kmasl_ALLCASES(1:numpreandposttimes,1:numcells,R)              =       prepost_mesoWTFCbox_eastUmean5to6kmasl;  %final product
    prepost_mesoWTFCbox_westupslopedepthfract_ALLCASES(1:numpreandposttimes,1:numcells,R)           =       prepost_mesoWTFCbox_westupslopedepthfract;  %final product
    prepost_mesoWTFCbox_westupslopetophtasl_ALLCASES(1:numpreandposttimes,1:numcells,R)             =       prepost_mesoWTFCbox_westupslopetophtasl;  %final product
    prepost_mesoWTFCbox_westupslopedepthfract2500masl_ALLCASES(1:numpreandposttimes,1:numcells,R)   =       prepost_mesoWTFCbox_westupslopedepthfract2500masl;  %final product
    prepost_mesoWTFCbox_westupslopemean2500masl_ALLCASES(1:numpreandposttimes,1:numcells,R)         =       prepost_mesoWTFCbox_westupslopemean2500masl;  %final product
    prepost_mesoWTFCbox_westupslopedepthfract1500magl_ALLCASES(1:numpreandposttimes,1:numcells,R)   =       prepost_mesoWTFCbox_westupslopedepthfract1500magl;  %final product
    prepost_mesoWTFCbox_westupslopemean1500magl_ALLCASES(1:numpreandposttimes,1:numcells,R)         =       prepost_mesoWTFCbox_westupslopemean1500magl;  %final product






    %     % LOCAL NULL meso swath properties (kinematic & thermo & sounding) for portions of SDC (portions neighboring active cells that do not have cells)
    prepost_localnull_mesoWwidth_ALLCASES(1:numpreandposttimes,1:numcells,R)    =       prepost_localnull_mesoWwidth ;
    prepost_localnull_mesoWdepth_ALLCASES(1:numpreandposttimes,1:numcells,R)    =       prepost_localnull_mesoWdepth ;
    prepost_localnull_mesoWstrength_ALLCASES(1:numpreandposttimes,1:numcells,R) =       prepost_localnull_mesoWstrength ;
    prepost_localnull_mesoWvmf_ALLCASES(1:numpreandposttimes,1:numcells,R)      =       prepost_localnull_mesoWvmf ;
    prepost_localnull_mesoWtopasl_ALLCASES(1:numpreandposttimes,1:numcells,R)   =       prepost_localnull_mesoWtopasl ;
    prepost_localnull_mesoWtopagl_ALLCASES(1:numpreandposttimes,1:numcells,R)   =       prepost_localnull_mesoWtopagl ;
    prepost_localnull_mesoWqvap_ALLCASES(1:numpreandposttimes,1:numcells,R)     =       prepost_localnull_mesoWqvap ;
    prepost_localnull_mesoWtheta_ALLCASES(1:numpreandposttimes,1:numcells,R)    =       prepost_localnull_mesoWtheta ;
    prepost_localnull_mesoWthetae_ALLCASES(1:numpreandposttimes,1:numcells,R)   =       prepost_localnull_mesoWthetae ;
    prepost_localnull_mesoWlfcagl_ALLCASES(1:numpreandposttimes,1:numcells,R)   =       prepost_localnull_mesoWlfcagl ;
    prepost_localnull_mesoWlfcasl_ALLCASES(1:numpreandposttimes,1:numcells,R)   =       prepost_localnull_mesoWlfcasl ;
    prepost_localnull_mesoWcape_ALLCASES(1:numpreandposttimes,1:numcells,R)     =       prepost_localnull_mesoWcape ;
    prepost_localnull_mesoWcin_ALLCASES(1:numpreandposttimes,1:numcells,R)      =       prepost_localnull_mesoWcin ;
    prepost_localnull_mesoWtoplfcasl_ALLCASES(1:numpreandposttimes,1:numcells,R) =      prepost_localnull_mesoWtoplfcasl ;
    prepost_localnull_mesoWtoplfcagl_ALLCASES(1:numpreandposttimes,1:numcells,R) =      prepost_localnull_mesoWtoplfcagl ;

    prepost_localnull_mesoCwidth_ALLCASES(1:numpreandposttimes,1:numcells,R)    =           prepost_localnull_mesoCwidth ;
    prepost_localnull_mesoCdepth_ALLCASES(1:numpreandposttimes,1:numcells,R)    =           prepost_localnull_mesoCdepth ;
    prepost_localnull_mesoCstrength_ALLCASES(1:numpreandposttimes,1:numcells,R) =           prepost_localnull_mesoCstrength ;
    prepost_localnull_mesoCMFCmean_ALLCASES(1:numpreandposttimes,1:numcells,R)    =         prepost_localnull_mesoCMFCmean ;
    prepost_localnull_mesoCMCqadvmean_ALLCASES(1:numpreandposttimes,1:numcells,R)    =      prepost_localnull_mesoCMCqadvmean ;
    prepost_localnull_mesoCMCqconvmean_ALLCASES(1:numpreandposttimes,1:numcells,R) =        prepost_localnull_mesoCMCqconvmean ;
    prepost_localnull_mesoCMFCmax_ALLCASES(1:numpreandposttimes,1:numcells,R)    =          prepost_localnull_mesoCMFCmax ;
    prepost_localnull_mesoCMCqadvmax_ALLCASES(1:numpreandposttimes,1:numcells,R)    =       prepost_localnull_mesoCMCqadvmax ;
    prepost_localnull_mesoCMCqconvmax_ALLCASES(1:numpreandposttimes,1:numcells,R) =         prepost_localnull_mesoCMCqconvmax ;

    disp(['asdfH']) 
    prepost_localnull_mesoWTFCbox_eastupslopedepth_ALLCASES(1:numpreandposttimes,1:numcells,R) =      prepost_localnull_mesoWTFCbox_eastupslopedepth ;  

     
    %swathboxaloft_RH_ALLCASES(1:sdclen, 1:length(Wswathboxaloft_Zasl),
    %1:numtimes, R) = Wswathboxaloft_RH;  %replaced by FullSDC version?

    %     % cell properties
    %just in CI period
    cellCI_maxETH10_ALLCASES(1:numcells,R) =      cellCI_maxETH10;
    cellCI_maxdbz_ALLCASES(1:numcells,R) =        cellCI_maxdbz;
    cellCI_cellarea_ALLCASES(1:numcells,R) =      cellCI_cellarea;
    cellCI_corearea_ALLCASES(1:numcells,R) =      cellCI_corearea;
    cellCI_cell_motion_x_ALLCASES(1:numcells,R) = cell_motion_x;
    cellCI_cell_motion_y_ALLCASES(1:numcells,R) = cell_motion_y;
    cellCI_meanlon_ALLCASES(1:numcells,R)  =   permute(meanlon_cell(1,:) ,[2 1]);
    cellCI_meanlat_ALLCASES(1:numcells,R)  =   permute(meanlat_cell(1,:) ,[2 1]);
    %full cell lifetime
    cellfull_maxETH10_ALLCASES(1:numcells,R) =          cellfull_maxETH10;
    cellfull_maxdbz_ALLCASES(1:numcells,R)   =          cellfull_maxdbz;
    cellfull_cellarea_ALLCASES(1:numcells,R) =          cellfull_cellarea;
    cellfull_corearea_ALLCASES(1:numcells,R) =          cellfull_corearea;
    cellfull_duration_ALLCASES(1:numcells,R) =          cellfull_duration;
    cellfull_endmergestatus_ALLCASES(1:numcells,R)   =  endmergecloudnumber_cell;
    cellfull_startsplitstatus_ALLCASES(1:numcells,R) =  startsplitcloudnumber_cell;
    

    % % cell thermo (from Env params & flextrkr)
    preCIandCI_ucrel_acbl_ALLCASES(1:numenvtime,1:numcells,R) =          preCIandCI_ucrel_acbl' ;
    preCIandCI_rh_acbl_ALLCASES(1:numenvtime,1:numcells,R) =             preCIandCI_rh_acbl' ;
    preCIandCI_thetae_acbl_ALLCASES(1:numenvtime,1:numcells,R) =         preCIandCI_thetae_acbl' ;
    preCIandCI_cape_acbl_ALLCASES(1:numenvtime,1:numcells,R) =           preCIandCI_cape_acbl' ;
    preCIandCI_mucin_ALLCASES(1:numenvtime,1:numcells,R) =               preCIandCI_mucin' ;
    preCIandCI_shear03_ALLCASES(1:numenvtime,1:numcells,R) =             preCIandCI_shear03' ;
    preCIandCI_shear06_ALLCASES(1:numenvtime,1:numcells,R) =             preCIandCI_shear06' ;
    preCIandCI_shear09_ALLCASES(1:numenvtime,1:numcells,R) =             preCIandCI_shear09' ;
    preCIandCI_mulcl_ALLCASES(1:numenvtime,1:numcells,R) =               preCIandCI_mulcl' ;
    preCIandCI_muel_ALLCASES(1:numenvtime,1:numcells,R) =                preCIandCI_muel' ;
    preCIandCI_mulfc_ALLCASES(1:numenvtime,1:numcells,R) =               preCIandCI_mulfc' ;
    preCIandCI_cape_deep_ALLCASES(1:numenvtime,1:numcells,R) =           preCIandCI_cape_deep' ;
    preCIandCI_ucrel_mu_ALLCASES(1:numenvtime,1:numcells,R) =            preCIandCI_ucrel_mu' ;
    preCIandCI_vcrel_mu_ALLCASES(1:numenvtime,1:numcells,R) =            preCIandCI_vcrel_mu' ;
%     preCIandCI_cell_motion_x_ALLCASES(1:5,1:numcells,R) =            preCIandCI_cell_motion_x ;
%     preCIandCI_cell_motion_y_ALLCASES(1:5,1:numcells,R) =            preCIandCI_cell_motion_y ;  

    preCIandCI_upslopemax_ALLCASES(1:numenvtime,1:numcells,R) =             preCIandCI_upslopemax' ;
    preCIandCI_upslopemean_ALLCASES(1:numenvtime,1:numcells,R) =            preCIandCI_upslopemean' ;
    preCIandCI_upslopefract_ALLCASES(1:numenvtime,1:numcells,R) =           preCIandCI_upslopefract' ;
    preCIandCI_upslopedepth_ALLCASES(1:numenvtime,1:numcells,R) =           preCIandCI_upslopedepth' ;

    
    %     %admin vars
    date_ALLCASES(R,:) = date ;
    run_ALLCASES(R,:) = RUNS(R,:) ;

    %{
    
    % % in-cell flextrkr updraft stats:        
    updraftbaseZ_ALLCASES(1:ntimes_updraft,1:ntracks_updraft,ar) =          updraftbaseZ_CELLstats ;       
    % tabulated in lowest 1 km of part of cells with cores detected:
    totalwarea_cldbase_ALLCASES(1:ntimes_updraft,1:ntracks_updraft,ar) =    totalwarea_cldbase_CELLstats ;        
    maxwarea_cldbase_ALLCASES(1:ntimes_updraft,1:ntracks_updraft,ar) =      maxwarea_cldbase_CELLstats;            
    maxw_cldbase_ALLCASES(1:ntimes_updraft,1:ntracks_updraft,ar) =          maxw_cldbase_CELLstats ;                            
    maxnumwcores_cldbase_ALLCASES(1:ntimes_updraft,1:ntracks_updraft,ar) =  maxnumwcores_cldbase_CELLstats ;           
    % tabulated throughout cell depth:
    totalwarea_fullcld_ALLCASES(1:ntimes_updraft,1:ntracks_updraft,ar) =   	totalwarea_fullcld_CELLstats ;            
    maxwarea_fullcld_ALLCASES(1:ntimes_updraft,1:ntracks_updraft,ar) =      maxwarea_fullcld_CELLstats ;             
    maxw_fullcld_ALLCASES(1:ntimes_updraft,1:ntracks_updraft,ar) =          maxw_fullcld_CELLstats ;              
    maxnumwcores_fullcld_ALLCASES(1:ntimes_updraft,1:ntracks_updraft,ar) =  maxnumwcores_fullcld_CELLstats ;           
    
    %}


    toc
   
    disp(' CLEAN UP  ')
    
    
%     clear preCIandCI_ucrel_acbl preCIandCI_rh_acbl preCIandCI_thetae_acbl preCIandCI_cape_acbl preCIandCI_cape_deep preCIandCI_mucin preCIandCI_shear06 preCIandCI_mulcl preCIandCI_mulfc ...
%         cellCI_maxETH10 cellCI_maxdbz cellCI_cellarea cellCI_corearea preCIandCI_shear03 preCIandCI_shear09
% 
%     clear  prepost_timehr prepost_timerelCI prepost_mesoWwidth prepost_mesoWdepth prepost_mesoWstrength prepost_mesoWvmf...
%         prepost_mesoWqvapca prepost_mesoWthetaca prepost_mesoWthetaeca prepost_localnull_mesoWlfcagl prepost_localnull_mesoWlfcasl ...
%         prepost_localnull_mesoWqvap prepost_localnull_mesoWtheta prepost_localnull_mesoWthetae
% 
%     clear mesoWwidth_nullmean mesoWdepth_nullmean mesoWstrength_nullmean mesoWqvapca_nullmean...
%         mesoWthetaca_nullmean mesoWthetaeca_nullmean  mesoWvmf_nullmean
% 
%     clear mesoWwidth_nullfullsdc mesoWdepth_nullfullsdc mesoWstrength_nullfullsdc mesoWvmf_nullfullsdc ...
%         mesoWqvapca_nullfullsdc mesoWthetaca_nullfullsdc mesoWthetaeca_nullfullsdc ...
%         mesoWqvapca_nullfullsdc mesoWthetaca_nullfullsdc mesoWthetaeca_nullfullsdc ...
% 
%     clear rh_mean_acbl cape_acbl ucrel_mean_acbl thetae_mean_acbl cape_deep...
%         cellfull_cellarea cellfull_corearea cellfull_maxdbz cellfull_maxETH10 cell_motion_x cell_motion_y
% 
%     clear W_object Conv_object Wswath_depth_sm Wswath_maxmag_sm Wswath_thetaemean_sm Wswath_thetamean_sm Wswath_vapormean_sm Wswath_width_sm Wswath_VMsum_sm
% 
%     clear prepost_localnull_mesoWwidth prepost_localnull_mesoWdepth prepost_localnull_mesoWstrength prepost_localnull_mesoWvmf prepost_localnull_mesoWqvapca prepost_localnull_mesoWthetaca prepost_localnull_mesoWthetaeca
% 
%     clear nulllocalcell_mesoWwidth nulllocalcell_mesoWdepth nulllocalcell_mesoWstrength nulllocalcell_mesoWvmf nulllocalcell_mesoWqvapca nulllocalcell_mesoWthetaca nulllocalcell_mesoWthetaeca
% 
%     clear localnull_mesoWwidth_preCI localnull_mesoWdepth_preCI localnull_mesoWstrength_preCI localnull_mesoWvmf_preCI localnull_mesoWqvapca_preCI localnull_mesoWthetaca_preCI localnull_mesoWthetaeca_preCI
%     
%     clear prepost_localnull_mesoWcape prepost_localnull_mesoWcin prepost_localnull_mesoWtopasl prepost_localnull_mesoWtopagl prepost_localnull_mesoWlfc ...
%         prepost_mesoWlfcagl prepost_mesoWlfcasl prepost_mesoWqvap prepost_mesoWtheta prepost_mesoWthetae
%     
%     clear prepost_mesoWcape prepost_mesoWcin prepost_mesoWtopasl prepost_mesoWtopagl prepost_mesoWlfc...
%         prepost_localnull_mesoWlfcagl prepost_localnull_mesoWlfcasl prepost_localnull_mesoWqvap...
%         prepost_localnull_mesoWtheta prepost_localnull_mesoWthetae
%     
%     clear Wswath_mucape Wswath_mucin Wswath_mulfc Wswath_top_asl Wswath_centlat_sm2 Wswath_centlon_sm2
%     
%     clear mesoWtopasl_cell mesoWtopasl_preCI mesoWtopagl_cell mesoWtopagl_preCI mesoWlfc_preCI mesoWlfc_cell mesoWcin_preCI mesoWcin_cell mesoWcape_preCI mesoWcape_cell mesoWcin_nullfullsdc  mesoWcape_nullfullsdc mesoWlfc_nullfullsdc mesoWtopasl_nullfullsdc mesoWtopagl_nullfullsdc
%     
%     clear mesoWdepth_cell mesoWdepth_preCI mesoWqvapca_cell mesoWqvapca_preCI mesoWstrength_cell mesoWvmf_cell mesoWstrength_preCI mesoWvmf_preCI mesoWthetaca_cell ...
%         mesoWthetaca_preCI mesoWthetaeca_cell mesoWthetaeca_preCI mesoWwidth_cell mesoWwidth_preCI
%     
%     clear maxdbz_cell meanlat_cell meanlon_cell mesoCIhh mesoCImm ETH10_cell HHMMSS_all hhmmss_cell hour_cell HOUR_all duration_cell dummy cloudnum_cell tracks_all cellfull_duration
%     
%     clear Wswathboxaloft_RH totalwarea_cldbase_CELLstats totalwarea_fullcld_CELLstats updraftbase_CELLstats updraftbaseZ_CELLstats
%     
%     clear maxnumwcores_cldbase_CELLstats maxnumwcores_fullcld_CELLstats maxw_cldbase_CELLstats maxw_fullcld_CELLstats maxwarea_cldbase_CELLstats ...
%         maxwarea_fullcld_CELLstats preCIandCI_ucrel_mu preCIandCI_vcrel_mu shear03 shear06 shear09 ucrel_mu vcrel_mu
%     
%     clear mesoWlfcagl_nullfullsdc mesoWlfcasl_nullfullsdc mesoWqvap_nullfullsdc mesoWqvap_nullmean ...
%         mesoWtheta_nullfullsdc mesoWtheta_nullmean mesoWthetae_nullfullsdc mesoWthetae_nullmean 
% 
%     clear curr_null_jspan curr_swath_cape curr_swath_cin curr_swath_depth curr_swath_lfcagl curr_swath_lfcasl ...
%         curr_swath_qvap curr_swath_stren curr_swath_theta curr_swath_thetae curr_swath_width curr_swath_wtopagl curr_swath_wtopasl ...
%         curr_cell_jspan curr_cell_rad curr_celltop curr_kmasl curr_ucrel curr_vcrel curr_widdepth curr_widnum curr_widtime ...
%         currmesotime_ind date hn i ia ib j jj k kbot xc yc

%matoutdate = strcat('allprocessed_',RUNS(R,:),'_RcheckpointA10b.mat')  ;

%save(matoutdate)
disp(' checkpt saving... ')

end    % R loop

%
save('checkpintdone10d_deep.mat')
disp(' checkpt saved ')

%   clear ;   load('checkpintdone10d_deep.mat')








%micro QC fix
preCIandCI_upslopemean_ALLCASES(preCIandCI_upslopemean_ALLCASES==-911) = NaN;
preCIandCI_upslopemax_ALLCASES(preCIandCI_upslopemax_ALLCASES==-911) = NaN;
preCIandCI_upslopefract_ALLCASES(preCIandCI_upslopefract_ALLCASES==-911) = NaN;
preCIandCI_upslopedepth_ALLCASES(preCIandCI_upslopedepth_ALLCASES==-911) = NaN;


%   clear;  load('allprocessed_20190129_gefs11_base_d4_Rcheckpoint.mat') 

% blah1 = permute( prepost_mesoWtopasl_ALLCASES(1,:,:), [2 3 1]) ;
% blah2 = permute( prepost_mesoWtoplfcasl_ALLCASES(1,:,:), [2 3 1]);



%%%%deepgoodtohere



%fix dimenions for non-local mean null variables (you dont really use these much anymore): 
mesoWwidth_nullmean_ALLCASES = permute(mesoWwidth_nullmean_ALLCASES,[2 1]);
mesoWdepth_nullmean_ALLCASES = permute(mesoWdepth_nullmean_ALLCASES,[2 1]);
mesoWstrength_nullmean_ALLCASES = permute(mesoWstrength_nullmean_ALLCASES,[2 1]);
mesoWvmf_nullmean_ALLCASES = permute(mesoWvmf_nullmean_ALLCASES,[2 1]);
mesoWqvap_nullmean_ALLCASES = permute(mesoWqvap_nullmean_ALLCASES,[2 1]);
mesoWtheta_nullmean_ALLCASES = permute(mesoWtheta_nullmean_ALLCASES,[2 1]);
mesoWthetae_nullmean_ALLCASES = permute(mesoWthetae_nullmean_ALLCASES,[2 1]);

mesoCwidth_nullmean_ALLCASES =          permute(mesoCwidth_nullmean_ALLCASES,[2 1]);
mesoCdepth_nullmean_ALLCASES =          permute(mesoCdepth_nullmean_ALLCASES,[2 1]);
mesoCstrength_nullmean_ALLCASES =       permute(mesoCstrength_nullmean_ALLCASES,[2 1]);
mesoCMFCmean_nullmean_ALLCASES =        permute(mesoCMFCmean_nullmean_ALLCASES,[2 1]);
mesoCMCqadvmean_nullmean_ALLCASES =     permute(mesoCMCqadvmean_nullmean_ALLCASES,[2 1]);
mesoCMCqconvmean_nullmean_ALLCASES =    permute(mesoCMCqconvmean_nullmean_ALLCASES,[2 1]);
mesoCMFCmax_nullmean_ALLCASES =         permute(mesoCMFCmax_nullmean_ALLCASES,[2 1]);
mesoCMCqadvmax_nullmean_ALLCASES =      permute(mesoCMCqadvmax_nullmean_ALLCASES,[2 1]);
mesoCMCqconvmax_nullmean_ALLCASES =     permute(mesoCMCqconvmax_nullmean_ALLCASES,[2 1]);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% NOW let's nan-out the cells that didn't meet our critera:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% a 3d version of the mask for variables that need it:
cellkeeper_mask3d_ALLCASES = [];
for t = 1:numpreandposttimes
    cellkeeper_mask3d_ALLCASES = cat(3,cellkeeper_mask3d_ALLCASES,cellkeeper_mask_ALLCASES)  ;
end
cellkeeper_mask3d_ALLCASES = permute(cellkeeper_mask3d_ALLCASES, [3 1 2]);

% blah = prepost_mesoWwidth_ALLCASES(:,:,1);


% meso swath properties (kinematic & thermo & sounding metrics) for portions of SDC with cells
prepost_timehr_ALLCASES         = prepost_timehr_ALLCASES      .* cellkeeper_mask3d_ALLCASES;
prepost_timerelCI_ALLCASES      = prepost_timerelCI_ALLCASES   .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWwidth_ALLCASES     = prepost_mesoWwidth_ALLCASES   .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWdepth_ALLCASES     = prepost_mesoWdepth_ALLCASES    .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWstrength_ALLCASES  = prepost_mesoWstrength_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWvmf_ALLCASES       = prepost_mesoWvmf_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWtopasl_ALLCASES    = prepost_mesoWtopasl_ALLCASES   .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWtopagl_ALLCASES    = prepost_mesoWtopagl_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWqvap_ALLCASES      = prepost_mesoWqvap_ALLCASES   .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWtheta_ALLCASES     = prepost_mesoWtheta_ALLCASES  .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWthetae_ALLCASES    = prepost_mesoWthetae_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWlfcagl_ALLCASES    = prepost_mesoWlfcagl_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWlfcasl_ALLCASES    = prepost_mesoWlfcasl_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWcape_ALLCASES      = prepost_mesoWcape_ALLCASES    .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWcin_ALLCASES       = prepost_mesoWcin_ALLCASES      .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWtoplfcasl_ALLCASES = prepost_mesoWtoplfcasl_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_mesoWtoplfcagl_ALLCASES = prepost_mesoWtoplfcagl_ALLCASES .* cellkeeper_mask3d_ALLCASES;

prepost_mesoCwidth_ALLCASES        = prepost_mesoCwidth_ALLCASES   .* cellkeeper_mask3d_ALLCASES;
prepost_mesoCdepth_ALLCASES        = prepost_mesoCdepth_ALLCASES    .* cellkeeper_mask3d_ALLCASES;
prepost_mesoCstrength_ALLCASES     = prepost_mesoCstrength_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_mesoCMFCmean_ALLCASES      = prepost_mesoCMFCmean_ALLCASES   .* cellkeeper_mask3d_ALLCASES;
prepost_mesoCMCqadvmean_ALLCASES   = prepost_mesoCMCqadvmean_ALLCASES    .* cellkeeper_mask3d_ALLCASES;
prepost_mesoCMCqconvmean_ALLCASES  = prepost_mesoCMCqconvmean_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_mesoCMFCmax_ALLCASES      = prepost_mesoCMFCmax_ALLCASES   .* cellkeeper_mask3d_ALLCASES;
prepost_mesoCMCqadvmax_ALLCASES   = prepost_mesoCMCqadvmax_ALLCASES    .* cellkeeper_mask3d_ALLCASES;
prepost_mesoCMCqconvmax_ALLCASES  = prepost_mesoCMCqconvmax_ALLCASES .* cellkeeper_mask3d_ALLCASES;

prepost_timehr_UNFILT_ALLCASES         = prepost_timehr_ALLCASES;
prepost_timerelCI_UNFILT_ALLCASES      = prepost_timerelCI_ALLCASES;
prepost_mesoWwidth_UNFILT_ALLCASES     = prepost_mesoWwidth_ALLCASES;
prepost_mesoWdepth_UNFILT_ALLCASES     = prepost_mesoWdepth_ALLCASES;
prepost_mesoWstrength_UNFILT_ALLCASES  = prepost_mesoWstrength_ALLCASES;
prepost_mesoWvmf_UNFILT_ALLCASES       = prepost_mesoWvmf_ALLCASES;
prepost_mesoWtopasl_UNFILT_ALLCASES    = prepost_mesoWtopasl_ALLCASES;
prepost_mesoWtopagl_UNFILT_ALLCASES    = prepost_mesoWtopagl_ALLCASES;
prepost_mesoWqvap_UNFILT_ALLCASES      = prepost_mesoWqvap_ALLCASES;
prepost_mesoWtheta_UNFILT_ALLCASES     = prepost_mesoWtheta_ALLCASES;
prepost_mesoWthetae_UNFILT_ALLCASES    = prepost_mesoWthetae_ALLCASES;
prepost_mesoWlfcagl_UNFILT_ALLCASES    = prepost_mesoWlfcagl_ALLCASES;
prepost_mesoWlfcasl_UNFILT_ALLCASES    = prepost_mesoWlfcasl_ALLCASES;
prepost_mesoWcape_UNFILT_ALLCASES      = prepost_mesoWcape_ALLCASES;
prepost_mesoWcin_UNFILT_ALLCASES       = prepost_mesoWcin_ALLCASES;
prepost_mesoWtoplfcasl_UNFILT_ALLCASES = prepost_mesoWtoplfcasl_ALLCASES;
prepost_mesoWtoplfcagl_UNFILT_ALLCASES = prepost_mesoWtoplfcagl_ALLCASES;

prepost_mesoCwidth_UNFILT_ALLCASES          = prepost_mesoCwidth_ALLCASES;
prepost_mesoCdepth_UNFILT_ALLCASES          = prepost_mesoCdepth_ALLCASES;
prepost_mesoCstrength_UNFILT_ALLCASES       = prepost_mesoCstrength_ALLCASES;
prepost_mesoCMFCmean_UNFILT_ALLCASES        = prepost_mesoCMFCmean_ALLCASES;
prepost_mesoCMCqadvmean_UNFILT_ALLCASES     = prepost_mesoCMCqadvmean_ALLCASES;
prepost_mesoCMCqconvmean_UNFILT_ALLCASES    = prepost_mesoCMCqconvmean_ALLCASES;
prepost_mesoCMFCmax_UNFILT_ALLCASES         = prepost_mesoCMFCmax_ALLCASES;
prepost_mesoCMCqadvmax_UNFILT_ALLCASES      = prepost_mesoCMCqadvmax_ALLCASES;
prepost_mesoCMCqconvmax_UNFILT_ALLCASES     = prepost_mesoCMCqconvmax_ALLCASES;

prepost_TFCbox_eastupslopedepth_UNFILT_ALLCASES               =       prepost_mesoWTFCbox_eastupslopedepth_ALLCASES ;
prepost_TFCbox_eastupslopemean_UNFILT_ALLCASES                =       prepost_mesoWTFCbox_eastupslopemean_ALLCASES ;
prepost_TFCbox_eastupslopedepthfract_UNFILT_ALLCASES          =       prepost_mesoWTFCbox_eastupslopedepthfract_ALLCASES ;
prepost_TFCbox_eastupslopetophtasl_UNFILT_ALLCASES            =       prepost_mesoWTFCbox_eastupslopetophtasl_ALLCASES ;
prepost_TFCbox_eastupslopedepthfract2500masl_UNFILT_ALLCASES  =       prepost_mesoWTFCbox_eastupslopedepthfract2500masl_ALLCASES ;
prepost_TFCbox_eastupslopemean2500masl_UNFILT_ALLCASES        =       prepost_mesoWTFCbox_eastupslopemean2500masl_ALLCASES ;
prepost_TFCbox_eastupslopedepthfract1500magl_UNFILT_ALLCASES  =       prepost_mesoWTFCbox_eastupslopedepthfract1500magl_ALLCASES ;
prepost_TFCbox_eastupslopemean1500magl_UNFILT_ALLCASES        =       prepost_mesoWTFCbox_eastupslopemean1500magl_ALLCASES ;
prepost_TFCbox_eastUmean3to4kmasl_UNFILT_ALLCASES             =       prepost_mesoWTFCbox_eastUmean3to4kmasl_ALLCASES ;
prepost_TFCbox_eastUmean4to5kmasl_UNFILT_ALLCASES             =       prepost_mesoWTFCbox_eastUmean4to5kmasl_ALLCASES ;
prepost_TFCbox_eastUmean5to6kmasl_UNFILT_ALLCASES             =       prepost_mesoWTFCbox_eastUmean5to6kmasl_ALLCASES ;
prepost_TFCbox_westupslopedepthfract_UNFILT_ALLCASES          =       prepost_mesoWTFCbox_westupslopedepthfract_ALLCASES ;
prepost_TFCbox_westupslopetophtasl_UNFILT_ALLCASES            =       prepost_mesoWTFCbox_westupslopetophtasl_ALLCASES ;
prepost_TFCbox_westupslopedepthfract2500masl_UNFILT_ALLCASES  =       prepost_mesoWTFCbox_westupslopedepthfract2500masl_ALLCASES ;
prepost_TFCbox_westupslopemean2500masl_UNFILT_ALLCASES        =       prepost_mesoWTFCbox_westupslopemean2500masl_ALLCASES ;
prepost_TFCbox_westupslopedepthfract1500magl_UNFILT_ALLCASES  =       prepost_mesoWTFCbox_westupslopedepthfract1500magl_ALLCASES ;
prepost_TFCbox_westupslopemean1500magl_UNFILT_ALLCASES        =       prepost_mesoWTFCbox_westupslopemean1500magl_ALLCASES ;



% blah2 = prepost_mesoWwidth_ALLCASES(:,:,1);
% blah5 = prepost_mesoWtheta_ALLCASES(:,:,1);

% blah3 = prepost_localnull_mesoWwidth_ALLCASES(:,:,1);

% meso swath properties (kinematic & thermo % sounding) for NULL portions of SDC (local portion neighboring active cells )
prepost_localnull_mesoWwidth_ALLCASES = prepost_localnull_mesoWwidth_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWdepth_ALLCASES = prepost_localnull_mesoWdepth_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWstrength_ALLCASES = prepost_localnull_mesoWstrength_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWvmf_ALLCASES = prepost_localnull_mesoWvmf_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWqvap_ALLCASES = prepost_localnull_mesoWqvap_ALLCASES .* cellkeeper_mask3d_ALLCASES;   
prepost_localnull_mesoWtheta_ALLCASES = prepost_localnull_mesoWtheta_ALLCASES .* cellkeeper_mask3d_ALLCASES;      
prepost_localnull_mesoWthetae_ALLCASES = prepost_localnull_mesoWthetae_ALLCASES .* cellkeeper_mask3d_ALLCASES; 
prepost_localnull_mesoWlfcagl_ALLCASES = prepost_localnull_mesoWlfcagl_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWlfcasl_ALLCASES = prepost_localnull_mesoWlfcasl_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWcape_ALLCASES = prepost_localnull_mesoWcape_ALLCASES .* cellkeeper_mask3d_ALLCASES;      
prepost_localnull_mesoWcin_ALLCASES = prepost_localnull_mesoWcin_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWtopasl_ALLCASES = prepost_localnull_mesoWtopasl_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWtopagl_ALLCASES = prepost_localnull_mesoWtopagl_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWtoplfcasl_ALLCASES = prepost_localnull_mesoWtoplfcasl_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoWtoplfcagl_ALLCASES = prepost_localnull_mesoWtoplfcagl_ALLCASES .* cellkeeper_mask3d_ALLCASES;

prepost_localnull_mesoCwidth_ALLCASES       = prepost_localnull_mesoCwidth_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoCdepth_ALLCASES       = prepost_localnull_mesoCdepth_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoCstrength_ALLCASES    = prepost_localnull_mesoCstrength_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoCMFCmean_ALLCASES     = prepost_localnull_mesoCMFCmean_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoCMCqadvmean_ALLCASES  = prepost_localnull_mesoCMCqadvmean_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoCMCqconvmean_ALLCASES = prepost_localnull_mesoCMCqconvmean_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoCMFCmax_ALLCASES     = prepost_localnull_mesoCMFCmax_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoCMCqadvmax_ALLCASES  = prepost_localnull_mesoCMCqadvmax_ALLCASES .* cellkeeper_mask3d_ALLCASES;
prepost_localnull_mesoCMCqconvmax_ALLCASES = prepost_localnull_mesoCMCqconvmax_ALLCASES .* cellkeeper_mask3d_ALLCASES;

% blah4 = prepost_localnull_mesoWwidth_ALLCASES(:,:,1);   blah4 = prepost_localnull_mesoWqvap_ALLCASES(:,:,1);

% % unmasked version:
% cell properties only during CI period:
cellkeeper_mask_UNFILT_ALLCASES      = cellkeeper_mask_ALLCASES ;
cellCI_maxETH10_UNFILT_ALLCASES      = cellCI_maxETH10_ALLCASES ;
cellCI_maxdbz_UNFILT_ALLCASES        = cellCI_maxdbz_ALLCASES ;
cellCI_cellarea_UNFILT_ALLCASES      = cellCI_cellarea_ALLCASES ;
cellCI_corearea_UNFILT_ALLCASES      = cellCI_corearea_ALLCASES ;
cellCI_cell_motion_x_UNFILT_ALLCASES = cellCI_cell_motion_x_ALLCASES ;
cellCI_cell_motion_y_UNFILT_ALLCASES = cellCI_cell_motion_y_ALLCASES ;
% % cell max properties during full cell period:
cellfull_maxETH10_UNFILT_ALLCASES = cellfull_maxETH10_ALLCASES ;
cellfull_maxdbz_UNFILT_ALLCASES   = cellfull_maxdbz_ALLCASES;
cellfull_cellarea_UNFILT_ALLCASES = cellfull_cellarea_ALLCASES ;
cellfull_corearea_UNFILT_ALLCASES = cellfull_corearea_ALLCASES ;
cellfull_duration_UNFILT_ALLCASES = cellfull_duration_ALLCASES ;
% % 
preCIandCI_ucrel_acbl_UNFILT_ALLCASES       = preCIandCI_ucrel_acbl_ALLCASES ;
preCIandCI_rh_acbl_UNFILT_ALLCASES          = preCIandCI_rh_acbl_ALLCASES ;
preCIandCI_thetae_acbl_UNFILT_ALLCASES      = preCIandCI_thetae_acbl_ALLCASES ;
preCIandCI_cape_acbl_UNFILT_ALLCASES        = preCIandCI_cape_acbl_ALLCASES ;
preCIandCI_mucin_UNFILT_ALLCASES            = preCIandCI_mucin_ALLCASES ;
preCIandCI_mulcl_UNFILT_ALLCASES            = preCIandCI_mulcl_ALLCASES ;
preCIandCI_muel_UNFILT_ALLCASES             = preCIandCI_muel_ALLCASES ;
preCIandCI_mulfc_UNFILT_ALLCASES            = preCIandCI_mulfc_ALLCASES ;
preCIandCI_shear03_UNFILT_ALLCASES          = preCIandCI_shear03_ALLCASES ;
preCIandCI_shear06_UNFILT_ALLCASES          = preCIandCI_shear06_ALLCASES ;
preCIandCI_shear09_UNFILT_ALLCASES          = preCIandCI_shear09_ALLCASES ;
preCIandCI_cape_deep_UNFILT_ALLCASES        = preCIandCI_cape_deep_ALLCASES ;
preCIandCI_ucrel_mu_UNFILT_ALLCASES         = preCIandCI_ucrel_mu_ALLCASES ;
preCIandCI_vcrel_mu_UNFILT_ALLCASES         = preCIandCI_vcrel_mu_ALLCASES ;
preCIandCI_upslopemax_UNFILT_ALLCASES       = preCIandCI_upslopemax_ALLCASES ;
preCIandCI_upslopemean_UNFILT_ALLCASES      = preCIandCI_upslopemean_ALLCASES ;
preCIandCI_upslopedepth_UNFILT_ALLCASES     = preCIandCI_upslopedepth_ALLCASES ;
preCIandCI_upslopefract_UNFILT_ALLCASES     = preCIandCI_upslopefract_ALLCASES ;





% % user filtered version:
% cell properties only during CI period
cellkeeper_mask_ALLCASES        = cellkeeper_mask_ALLCASES      .* cellkeeper_mask_ALLCASES;
cellCI_maxETH10_ALLCASES        = cellCI_maxETH10_ALLCASES      .* cellkeeper_mask_ALLCASES;
cellCI_maxdbz_ALLCASES          = cellCI_maxdbz_ALLCASES        .* cellkeeper_mask_ALLCASES;
cellCI_cellarea_ALLCASES        = cellCI_cellarea_ALLCASES      .* cellkeeper_mask_ALLCASES;
cellCI_corearea_ALLCASES        = cellCI_corearea_ALLCASES      .* cellkeeper_mask_ALLCASES;
cellCI_cell_motion_x_ALLCASES   = cellCI_cell_motion_x_ALLCASES .* cellkeeper_mask_ALLCASES;
cellCI_cell_motion_y_ALLCASES   = cellCI_cell_motion_y_ALLCASES .* cellkeeper_mask_ALLCASES;
% cell max properties only during CI period:
cellfull_maxETH10_ALLCASES  = cellfull_maxETH10_ALLCASES .* cellkeeper_mask_ALLCASES;
cellfull_maxdbz_ALLCASES    = cellfull_maxdbz_ALLCASES   .* cellkeeper_mask_ALLCASES;
cellfull_cellarea_ALLCASES  = cellfull_cellarea_ALLCASES .* cellkeeper_mask_ALLCASES;
cellfull_corearea_ALLCASES  = cellfull_corearea_ALLCASES .* cellkeeper_mask_ALLCASES;
cellfull_duration_ALLCASES  = cellfull_duration_ALLCASES .* cellkeeper_mask_ALLCASES;


% cell thermo (from Env params flextrkr):
% a 3d version of the mask for variables that need it (just by repeated appending of the existing mask):
cellkeeper_mask3denv_ALLCASES = [];
for t = 1:numenvtime
    cellkeeper_mask3denv_ALLCASES = cat(3,cellkeeper_mask3denv_ALLCASES,cellkeeper_mask_ALLCASES)  ;
end
cellkeeper_mask3denv_ALLCASES = permute(cellkeeper_mask3denv_ALLCASES, [3 1 2]);

preCIandCI_ucrel_acbl_ALLCASES  = preCIandCI_ucrel_acbl_ALLCASES .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_rh_acbl_ALLCASES     = preCIandCI_rh_acbl_ALLCASES     .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_thetae_acbl_ALLCASES = preCIandCI_thetae_acbl_ALLCASES .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_cape_acbl_ALLCASES   = preCIandCI_cape_acbl_ALLCASES   .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_mucin_ALLCASES       = preCIandCI_mucin_ALLCASES      .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_mulcl_ALLCASES       = preCIandCI_mulcl_ALLCASES     .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_muel_ALLCASES        = preCIandCI_muel_ALLCASES     .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_mulfc_ALLCASES       = preCIandCI_mulfc_ALLCASES     .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_shear03_ALLCASES     = preCIandCI_shear03_ALLCASES   .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_shear06_ALLCASES     = preCIandCI_shear06_ALLCASES   .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_shear09_ALLCASES     = preCIandCI_shear09_ALLCASES   .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_cape_deep_ALLCASES   = preCIandCI_cape_deep_ALLCASES .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_ucrel_mu_ALLCASES    = preCIandCI_ucrel_mu_ALLCASES .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_vcrel_mu_ALLCASES    = preCIandCI_vcrel_mu_ALLCASES .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_upslopemax_ALLCASES    = preCIandCI_upslopemax_ALLCASES .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_upslopemean_ALLCASES    = preCIandCI_upslopemean_ALLCASES .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_upslopedepth_ALLCASES    = preCIandCI_upslopedepth_ALLCASES .* cellkeeper_mask3denv_ALLCASES;
preCIandCI_upslopefract_ALLCASES    = preCIandCI_upslopefract_ALLCASES .* cellkeeper_mask3denv_ALLCASES;



%{
% cell thermo (from Env params flextrkr):
% a 3d version of the mask for variables that need it:
cellkeeper_mask3dtracks_ALLCASES = [];
for t = 1:ntimes_updraft    %60
    cellkeeper_mask3dtracks_ALLCASES = cat(3,cellkeeper_mask3dtracks_ALLCASES,cellkeeper_mask_ALLCASES)  ;
end
cellkeeper_mask3dtracks_ALLCASES = permute(cellkeeper_mask3dtracks_ALLCASES, [3 1 2]);

dist_cell_and_swath = dist_cell_and_swath .* cellkeeper_mask3dtracks_ALLCASES;

%    % in-cell flextrkr updraft stats:   
updraftbaseZ_ALLCASES  = updraftbaseZ_ALLCASES .* cellkeeper_mask3dtracks_ALLCASES;
% tabulated in lowest 1 km of part of cells with cores detected:
totalwarea_cldbase_ALLCASES  = totalwarea_cldbase_ALLCASES .* cellkeeper_mask3dtracks_ALLCASES;
maxwarea_cldbase_ALLCASES  = maxwarea_cldbase_ALLCASES .* cellkeeper_mask3dtracks_ALLCASES;
maxw_cldbase_ALLCASES  = maxw_cldbase_ALLCASES .* cellkeeper_mask3dtracks_ALLCASES;
maxnumwcores_cldbase_ALLCASES  = maxnumwcores_cldbase_ALLCASES .* cellkeeper_mask3dtracks_ALLCASES; 
% tabulated throughout cell depth:
totalwarea_fullcld_ALLCASES  = totalwarea_fullcld_ALLCASES .* cellkeeper_mask3dtracks_ALLCASES;
maxwarea_fullcld_ALLCASES  = maxwarea_fullcld_ALLCASES .* cellkeeper_mask3dtracks_ALLCASES;
maxw_fullcld_ALLCASES  = maxw_fullcld_ALLCASES .* cellkeeper_mask3dtracks_ALLCASES;
maxnumwcores_fullcld_ALLCASES  = maxnumwcores_fullcld_ALLCASES .* cellkeeper_mask3dtracks_ALLCASES;

%}



%  save('/Users/marq789/test_cell_masks.mat','cellkeeper_mask3d_ALLCASES','cellkeeper_mask_ALLCASES','cellkeeper_mask3denv_ALLCASES','cellkeeper_mask3dtracks_ALLCASES','dist_cell_and_swath');

disp('         ')
disp(' ******* ')
disp(' DONEski collating arrays ')
disp(' ******* ')
disp('         ')




% save('allprocessed2_allcases_checkpointb_deep10d.mat')
% disp(' all2 checkptb saved ')

%  clear;  load('allprocessed2_allcases_checkpointb.mat')





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Post process wID profile stuff: 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%
%%% calculate a tilt and shear in updraft layer for wIDs using wid_profs_centHTasl_ALLCASES,
%%% wid_profs_centlat_ALLCASES, wid_profs_centlon_ALLCASES
%%%
%%%  NOTE, these will be over all wID depth, not confined to an LFC layer
%%%
%%%%%%%%%%%%%%%%%%%%%%%
[wn wz wt wr] = size(wid_profs_centlat_ALLCASES) ;
wid_profs_jcent_ALLCASES = wid_profs_centlat_ALLCASES ;    wid_profs_jcent_ALLCASES(:) = NaN;
wid_profs_jcent_ALLCASES = permute(wid_profs_jcent_ALLCASES,[1 2 4 3]);
wid_profs_icent_ALLCASES = wid_profs_jcent_ALLCASES ;

tic
%first calcualte the i,j indices for wID centroids as f(z)
parfor t = 1:wt
    disp(['t=',num2str(t)])

    proficent = zeros(wn,wz,wr) ;    proficent(:) = NaN;
    profjcent = zeros(wn,wz,wr) ;    profjcent(:) = NaN;
    for R = 1: wr
        for n = 1:wn
            for k = 1:wz
                % n = 1;  k = 8;  t=30;  R=3;
                if(  isnan(wid_profs_centlat_ALLCASES(n,k,t,R))==0  )
                    latdiff = [];  londiff = [];  diff = [];
                    latdiff =  abs(Lat - wid_profs_centlat_ALLCASES(n,k,t,R)  ) ;
                    londiff =  abs(Lon - wid_profs_centlon_ALLCASES(n,k,t,R)  ) ;
                    diffl = latdiff + londiff ;

                    icent = [];   jcent = [];
                    [icent jcent] = find(  diffl == min(min(diffl)));
                    profjcent(n,k,R) = mean(jcent,'omitnan') ; %note: means will likely yield non-int values, but I think that's ok if you're just going to *dx anyway
                    proficent(n,k,R) = mean(icent,'omitnan') ;
                end
            end

        end
    end
    wid_profs_jcent_ALLCASES(:,:,:,t) = profjcent ; %note: means will likely yield non-int values, but I think that's ok if you're just going to *dx anyway
    wid_profs_icent_ALLCASES(:,:,:,t) = proficent ;
end
toc
wid_profs_jcent_ALLCASES = permute(wid_profs_jcent_ALLCASES,[1 2 4 3]);
wid_profs_icent_ALLCASES = permute(wid_profs_icent_ALLCASES,[1 2 4 3]);

% calc tilt in two ways - one is continueous tilt profile, another is top position - bottom position:
wid_profs_xcenttilt_ALLCASES = wid_profs_icent_ALLCASES ;   wid_profs_xcenttilt_ALLCASES(:) = NaN;
wid_profs_ycenttilt_ALLCASES = wid_profs_jcent_ALLCASES ;   wid_profs_ycenttilt_ALLCASES(:) = NaN;
wid_bulk_xcenttilt_ALLCASES = zeros(wn,wt,wr);              wid_bulk_xcenttilt_ALLCASES(:) = NaN;
wid_bulk_ycenttilt_ALLCASES = zeros(wn,wt,wr);              wid_bulk_ycenttilt_ALLCASES(:) = NaN;
tic
for t = 1:wt
    %disp(['t=',num2str(t)])
    for R = 1: wr
        for n = 1:wn

            %  t = 30; R = 2;  n = 1;

            % calc tilt profiles:
            itilt = gradient(  wid_profs_icent_ALLCASES(n,:,t,R), wid_profs_centHTagl_ALLCASES(n,:,t,R) )  ;  % now is i-ind/dz
            jtilt = gradient(  wid_profs_jcent_ALLCASES(n,:,t,R), wid_profs_centHTagl_ALLCASES(n,:,t,R) )  ;  % now is j-ind/dz
            wid_profs_xcenttilt_ALLCASES(n,:,t,R) =  itilt * dx_model ;  % now is (i-ind*dx)/dz
            wid_profs_ycenttilt_ALLCASES(n,:,t,R) =  jtilt * dx_model ;  % now is (j-ind*dx)/dz

            %   n = 2;  t=30;  R=1;
            % calc bulk tilt over depth of profile:
            topk = []; botk = []; notnan =[];
            notnan = find(  isnan(wid_profs_centHTagl_ALLCASES(n,:,t,R))==0  )  ; %find the profile of the w that isn't nan in height
            if( isempty(notnan)==0 )
                topk = notnan(end) ;     botk = notnan(1) ;
                dz = (  wid_profs_centHTagl_ALLCASES(n,topk,t,R) - wid_profs_centHTagl_ALLCASES(n,botk,t,R) )   ;
                wid_bulk_xcenttilt_ALLCASES(n,t,R) = ( (wid_profs_icent_ALLCASES(n,topk,t,R) -  wid_profs_icent_ALLCASES(n,botk,t,R)) * dx_model ) / dz ;
                wid_bulk_ycenttilt_ALLCASES(n,t,R) = ( (wid_profs_jcent_ALLCASES(n,topk,t,R) -  wid_profs_jcent_ALLCASES(n,botk,t,R)) * dx_model ) / dz ;
            end

%             % calc bulk shear just spanning depth of w's profile:
%             topk = []; botk = []; topaslw = []; botaslw = []; notnan =[];
%             notnan = find(  isnan(wid_profs_centHTasl_ALLCASES(n,:,t,R))==0  )  ; %find the part of w profile that isn't nan
%             if( isempty(notnan)==0 )
%                 %%%% heights asl of top and bottom of w profile
%                 topaslw = wid_profs_centHTasl_ALLCASES(n,notnan(end),t,R)  ;
%                 botaslw = wid_profs_centHTasl_ALLCASES(n,notnan(1),t,R)  ;
%                 %%%% corresponding k indices in newz_asl swathbox frame
%                 topk = find( abs(newz_asl - topaslw) == min(abs(newz_asl - topaslw)) );
%                 botk = find( abs(newz_asl - botaslw) == min(abs(newz_asl - botaslw)) );
%                 %%%% calc the shear (withTIMELAG)
%                 %  wid_bulkUshearinupdraft_ALLCASES(n,t,R) =  wid_meanUprof_ALLCASES(n,topk,t,R) -  wid_meanUprof_ALLCASES(n,botk,t,R)  ;
%                 %  wid_bulkVshearinupdraft_ALLCASES(n,t,R) =  wid_meanVprof_ALLCASES(n,topk,t,R) -  wid_meanVprof_ALLCASES(n,botk,t,R)  ;
%                 for p = 1 : timelaglookback+1  % +1 because starts at 1 = current time
%                     timl = t - (p-1) ;           % -1 because we want to include current time : tl = t
%                     % index:1 = t.  2 = t-1, ...
%                     if( timl > 0 )  % should keep NAN values for lag times prior to the LASSO analysis time period
%                         wid_bulkUshearinupdraft_ALLCASES(n,t,p,R)  =  wid_meanUprof_ALLCASES(n,topk,timl,R) -  wid_meanUprof_ALLCASES(n,botk,timl,R)  ;
%                         wid_bulkVshearinupdraft_ALLCASES(n,t,p,R)  =  wid_meanVprof_ALLCASES(n,topk,timl,R) -  wid_meanVprof_ALLCASES(n,botk,timl,R)  ;
%                     end
%                 end
% 
%             end

        end
    end
end
toc

wid_profs_meanxcenttilt_ALLCASES  =  mean(  wid_profs_xcenttilt_ALLCASES, 2,'omitnan' ) ; 
wid_profs_meanycenttilt_ALLCASES  =  mean(  wid_profs_ycenttilt_ALLCASES, 2,'omitnan' ) ; 
wid_profs_meanxcenttilt_ALLCASES = permute(wid_profs_meanxcenttilt_ALLCASES,[1 3 4 2]);
wid_profs_meanycenttilt_ALLCASES = permute(wid_profs_meanycenttilt_ALLCASES,[1 3 4 2]);
% %when wIDs are only 1 layer deep:
% kill = find( wid_bulkUshearinupdraft_ALLCASES==0  ) ;
% wid_bulkUshearinupdraft_ALLCASES(kill) =  NaN ;
% wid_bulkVshearinupdraft_ALLCASES(kill) =  NaN ;


%    diagnostics:
%    n = 2;  t=30;  R=1;
%    wid_bulk_xcenttilt_ALLCASES(n,t,R)  
%    wid_bulk_ycenttilt_ALLCASES(n,t,R)
%    wid_profs_icent_ALLCASES(n,:,t,R)  
%    wid_profs_jcent_ALLCASES(n,:,t,R)  
%    wid_profs_centHTagl_ALLCASES(n,:,t,R) 
%    mean( wid_profs_xcenttilt_ALLCASES(n,:,t,R) , 'omitnan'   )
%    mean( wid_profs_ycenttilt_ALLCASES(n,:,t,R) , 'omitnan'   )
%    figure;  scatter( wid_profs_centlon_ALLCASES(n,:,t,R), wid_profs_centlat_ALLCASES(n,:,t,R), 40,  wid_profs_centHTagl_ALLCASES(n,:,t,R), "filled")
%    figure;  scatter( wid_profs_icent_ALLCASES(n,:,t,R), wid_profs_jcent_ALLCASES(n,:,t,R), 40,  wid_profs_centHTagl_ALLCASES(n,:,t,R), "filled")

%    n = 27;  t=1;  R=4;
%    n = 23;  t=1;  R=4;
%  wblah = wid_bulkUshearinupdraft_ALLCASES(:,:,R)  ;
%  wblah = wid_meanUprof_ALLCASES(n,:,t,R) ;
%  wid_profs_centHTasl_ALLCASES(n,:,t,R)
%  wid_meanUprof_ALLCASES(n,22,t,R)
%  wid_meanUprof_ALLCASES(n,20,t,R)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% kill data at heights outside of an LFC layer in wid prof vars. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

layerdepth = 2000 ;   %meters - how high above the wid's lfc you want to still be elidgable for analysis

widLFC_profs_area_ALLCASES      =   wid_profs_area_ALLCASES     ;
widLFC_profs_massflux_ALLCASES  =   wid_profs_massflux_ALLCASES ;
widLFC_profs_maxmag_ALLCASES    =   wid_profs_maxmag_ALLCASES   ;
widLFC_profs_northj_ALLCASES    =   wid_profs_northj_ALLCASES   ;
widLFC_profs_southj_ALLCASES    =   wid_profs_southj_ALLCASES   ;

%need to reload the zagl array for referencing hts in W profiles (not used sounding params... right? .. I believe thats correct) 
% (its same for all cases, so just grab any old one):
wID_file = ['wID_merged_deepmetB3R_newtimes_',RUNS(1,:),'.mat'];
load([rootdir,'/', RUNS(1,:) ,'/',wID_file], 'FwIDprofs_zagl')   ;

for n = 1:numwid
    for t = 1:alltimes
        for RR = 1:ar
            % RR = 1;  t = 19;  n = 62;
            klfcagl = wid_profs_klfcagl_ALLCASES(n,t,RR)  ;
            if(   isnan(klfcagl)==0   )
                lfcagl = FwIDprofs_zagl(klfcagl) ;    % meters
                toplayer = lfcagl + layerdepth;
                ktoplayer = find( abs(FwIDprofs_zagl-toplayer) == min(abs(FwIDprofs_zagl-toplayer))   );
                if(ktoplayer > length(FwIDprofs_zagl)-1 )
                    ktoplayer = length(FwIDprofs_zagl)-1;
                end
                % % %kill whats above lfc layer
                widLFC_profs_area_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widLFC_profs_massflux_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widLFC_profs_maxmag_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widLFC_profs_northj_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widLFC_profs_southj_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                % % %kill whats below lfc layer (should already be dead, killed in first .m script)
                widLFC_profs_area_ALLCASES(n,1:(klfcagl-1),t,RR) = NaN  ;
                widLFC_profs_massflux_ALLCASES(n,1:(klfcagl-1),t,RR) = NaN  ;
                widLFC_profs_maxmag_ALLCASES(n,1:(klfcagl-1),t,RR) = NaN  ;
                widLFC_profs_northj_ALLCASES(n,1:(klfcagl-1),t,RR) = NaN  ;
                widLFC_profs_southj_ALLCASES(n,1:(klfcagl-1),t,RR) = NaN  ;
            end
        end
    end
end


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% now trim off the smaller wIDs 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

widLFCAR_profs_area_ALLCASES         = widLFC_profs_area_ALLCASES;
widLFCAR_profs_massflux_ALLCASES     = widLFC_profs_massflux_ALLCASES;
widLFCAR_profs_maxmag_ALLCASES       = widLFC_profs_maxmag_ALLCASES;
widLFCAR_profs_northj_ALLCASES       = widLFC_profs_northj_ALLCASES;
widLFCAR_profs_southj_ALLCASES       = widLFC_profs_southj_ALLCASES;
widLFCAR_profs_meanxcenttilt_ALLCASES     = wid_profs_meanxcenttilt_ALLCASES;
widLFCAR_profs_meanycenttilt_ALLCASES     = wid_profs_meanycenttilt_ALLCASES;
widLFCAR_bulk_xcenttilt_ALLCASES          = wid_bulk_xcenttilt_ALLCASES;
widLFCAR_bulk_ycenttilt_ALLCASES          = wid_bulk_ycenttilt_ALLCASES;

widLFCAR_mesoWcape_ALLCASES          = wid_mesoWcape_ALLCASES;
widLFCAR_mesoWcin_ALLCASES           = wid_mesoWcin_ALLCASES;
widLFCAR_mesoWdepth_ALLCASES         = wid_mesoWdepth_ALLCASES;
widLFCAR_mesoWdepthrat_ALLCASES      = wid_mesoWdepthrat_ALLCASES;
widLFCAR_mesoWlfcagl_ALLCASES        = wid_mesoWlfcagl_ALLCASES;
widLFCAR_mesoWlfcasl_ALLCASES        = wid_mesoWlfcasl_ALLCASES;
widLFCAR_mesoWqvap_ALLCASES          = wid_mesoWqvap_ALLCASES;
widLFCAR_mesoWstrength_ALLCASES      = wid_mesoWstrength_ALLCASES; 
widLFCAR_mesoWtheta_ALLCASES         = wid_mesoWtheta_ALLCASES; 
widLFCAR_mesoWthetae_ALLCASES        = wid_mesoWthetae_ALLCASES; 
widLFCAR_mesoWtopagl_ALLCASES        = wid_mesoWtopagl_ALLCASES; 
widLFCAR_mesoWtopasl_ALLCASES        = wid_mesoWtopasl_ALLCASES;
widLFCAR_mesoWvmsum_ALLCASES         = wid_mesoWvmsum_ALLCASES;
widLFCAR_mesoWvmsumHSUM_ALLCASES     = wid_mesoWvmsumHSUM_ALLCASES;
widLFCAR_mesoWalongsubupfract_ALLCASES  =  wid_mesoWalongsubupfract_ALLCASES;
widLFCAR_mesoWwidth_ALLCASES         = wid_mesoWwidth_ALLCASES;  
widLFCAR_mesoWtoplfcaglRAT_ALLCASES  = wid_mesoWtoplfcaglRAT_ALLCASES;
widLFCAR_mesoWtoplfcaslRAT_ALLCASES  = wid_mesoWtoplfcaslRAT_ALLCASES;

widLFCAR_mesoCwidth_ALLCASES            = wid_mesoCwidth_ALLCASES;  
widLFCAR_mesoCdepth_ALLCASES            = wid_mesoCdepth_ALLCASES;  
widLFCAR_mesoCstrength_ALLCASES         = wid_mesoCstrength_ALLCASES;  
widLFCAR_mesoCMFCmean_ALLCASES          = wid_mesoCMFCmean_ALLCASES;  
widLFCAR_mesoCMCqadvmean_ALLCASES       = wid_mesoCMCqadvmean_ALLCASES;  
widLFCAR_mesoCMCqconvmean_ALLCASES      = wid_mesoCMCqconvmean_ALLCASES; 
widLFCAR_mesoCMFCmax_ALLCASES          = wid_mesoCMFCmax_ALLCASES;  
widLFCAR_mesoCMCqadvmax_ALLCASES       = wid_mesoCMCqadvmax_ALLCASES;  
widLFCAR_mesoCMCqconvmax_ALLCASES      = wid_mesoCMCqconvmax_ALLCASES; 

widLFCAR_mesoWstrengthMAX_ALLCASES        = wid_mesoWstrengthMAX_ALLCASES;
widLFCAR_mesoWwidthMAX_ALLCASES           = wid_mesoWwidthMAX_ALLCASES;
widLFCAR_mesoWtopaglMAX_ALLCASES          = wid_mesoWtopaglMAX_ALLCASES;
widLFCAR_mesoWtopaslMAX_ALLCASES          = wid_mesoWtopaslMAX_ALLCASES;
widLFCAR_mesoWcapeMAX_ALLCASES            = wid_mesoWcapeMAX_ALLCASES;
widLFCAR_mesoWcinMIN_ALLCASES             = wid_mesoWcinMIN_ALLCASES;
widLFCAR_mesoWqvapMAX_ALLCASES            = wid_mesoWqvapMAX_ALLCASES; 
widLFCAR_mesoWlfcaslMIN_ALLCASES          = wid_mesoWlfcaslMIN_ALLCASES;
widLFCAR_mesoWlfcaglMIN_ALLCASES          = wid_mesoWlfcaglMIN_ALLCASES;
widLFCAR_mesoWthetaMAX_ALLCASES           = wid_mesoWthetaMAX_ALLCASES;
widLFCAR_mesoWthetaeMAX_ALLCASES          = wid_mesoWthetaeMAX_ALLCASES;
widLFCAR_mesoWdepthMAX_ALLCASES           = wid_mesoWdepthMAX_ALLCASES;
widLFCAR_mesoWvmsumMAX_ALLCASES           = wid_mesoWvmsumMAX_ALLCASES;
widLFCAR_mesoWtoplfcaglRATMAX_ALLCASES    = wid_mesoWtoplfcaglRATMAX_ALLCASES;
widLFCAR_mesoWtoplfcaslRATMAX_ALLCASES    = wid_mesoWtoplfcaslRATMAX_ALLCASES;

widLFCAR_mesoCwidthMAX_ALLCASES            = wid_mesoCwidthMAX_ALLCASES;  
widLFCAR_mesoCdepthMAX_ALLCASES            = wid_mesoCdepthMAX_ALLCASES;  
widLFCAR_mesoCstrengthMAX_ALLCASES         = wid_mesoCstrengthMAX_ALLCASES;  
widLFCAR_mesoCMFCmeanMAX_ALLCASES          = wid_mesoCMFCmeanMAX_ALLCASES;  
widLFCAR_mesoCMCqadvmeanMAX_ALLCASES       = wid_mesoCMCqadvmeanMAX_ALLCASES;  
widLFCAR_mesoCMCqconvmeanMAX_ALLCASES      = wid_mesoCMCqconvmeanMAX_ALLCASES; 
widLFCAR_mesoCMFCmaxMAX_ALLCASES          = wid_mesoCMFCmaxMAX_ALLCASES;  
widLFCAR_mesoCMCqadvmaxMAX_ALLCASES       = wid_mesoCMCqadvmaxMAX_ALLCASES;  
widLFCAR_mesoCMCqconvmaxMAX_ALLCASES      = wid_mesoCMCqconvmaxMAX_ALLCASES; 

widLFCAR_mesoWmeanRHboxaloft_ALLCASES            = wid_mesoWmeanRHboxaloft_ALLCASES;
widLFCAR_mesoWmeanQVboxaloft_ALLCASES            = wid_mesoWmeanQVboxaloft_ALLCASES;
widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES    = wid_mesoWeast1to5aslTOTMAGshear_ALLCASES;
widLFCAR_mesoWeast1to5aslUshear_ALLCASES         = wid_mesoWeast1to5aslUshear_ALLCASES;
widLFCAR_mesoWeast1to5aslVshear_ALLCASES         = wid_mesoWeast1to5aslVshear_ALLCASES;
widLFCAR_mesoWeast1to9aslTOTMAGshear_ALLCASES    = wid_mesoWeast1to9aslTOTMAGshear_ALLCASES;
widLFCAR_mesoWeast1to9aslUshear_ALLCASES         = wid_mesoWeast1to9aslUshear_ALLCASES;
widLFCAR_mesoWeast1to9aslVshear_ALLCASES         = wid_mesoWeast1to9aslVshear_ALLCASES;

widLFCAR_eastupslopedepthfract_ALLCASES          = wid_eastupslopedepthfract_ALLCASES;
widLFCAR_westupslopedepthfract_ALLCASES          = wid_westupslopedepthfract_ALLCASES;
widLFCAR_eastupslopemean_ALLCASES                = wid_eastupslopemean_ALLCASES;
widLFCAR_westupslopemean_ALLCASES                = wid_westupslopemean_ALLCASES;
widLFCAR_eastupslopedepthfract2500masl_ALLCASES          = wid_eastupslopedepthfract2500masl_ALLCASES;
widLFCAR_westupslopedepthfract2500masl_ALLCASES          = wid_westupslopedepthfract2500masl_ALLCASES;
widLFCAR_eastupslopemean2500masl_ALLCASES                = wid_eastupslopemean2500masl_ALLCASES;
widLFCAR_westupslopemean2500masl_ALLCASES                = wid_westupslopemean2500masl_ALLCASES;
widLFCAR_eastupslopedepthfract1500magl_ALLCASES          = wid_eastupslopedepthfract1500magl_ALLCASES;
widLFCAR_westupslopedepthfract1500magl_ALLCASES          = wid_westupslopedepthfract1500magl_ALLCASES;
widLFCAR_eastupslopemean1500magl_ALLCASES                = wid_eastupslopemean1500magl_ALLCASES;
widLFCAR_westupslopemean1500magl_ALLCASES                = wid_westupslopemean1500magl_ALLCASES;
% widLFCAR_bulkUshearinupdraft_ALLCASES            = wid_bulkUshearinupdraft_ALLCASES ;
% widLFCAR_bulkVshearinupdraft_ALLCASES            = wid_bulkVshearinupdraft_ALLCASES ;
widLFCAR_eastUmean3to4kmasl_ALLCASES                = wid_eastUmean3to4kmasl_ALLCASES;
widLFCAR_eastUmean4to5kmasl_ALLCASES                = wid_eastUmean4to5kmasl_ALLCASES;
widLFCAR_eastUmean5to6kmasl_ALLCASES                = wid_eastUmean5to6kmasl_ALLCASES;
widLFCAR_eastupslopedepth_ALLCASES                = wid_eastupslopedepth_ALLCASES;
widLFCAR_westupslopedepth_ALLCASES                = wid_westupslopedepth_ALLCASES;
widLFCAR_eastupslopetophtasl_ALLCASES             = wid_eastupslopetophtasl_ALLCASES;
widLFCAR_westupslopetophtasl_ALLCASES             = wid_westupslopetophtasl_ALLCASES;

r300m = 282743.0;
r500m = 785000.0;
r750m = 1767145.0;

%nkill = zeros(numwid,alltimes,ar) ;
for n = 1:numwid
    for t = 1:alltimes
        for RR = 1:ar

            %  n = 33; t = 20; RR = 1

            clear maxarea
            maxarea =  max( widLFC_profs_area_ALLCASES(n,:,t,RR),[],2)  ;

            if( isnan(maxarea )==0 &  maxarea < r300m )    % r=300m:282743    r=500m: 785000.0;    r=750m:1767145.0 
                %nkill(n,t,RR) = 1;

                widLFCAR_profs_area_ALLCASES(n,:,t,RR) = NaN  ;
                widLFCAR_profs_massflux_ALLCASES(n,:,t,RR) = NaN  ;
                widLFCAR_profs_maxmag_ALLCASES(n,:,t,RR) = NaN  ;
                widLFCAR_profs_northj_ALLCASES(n,:,t,RR) = NaN  ;
                widLFCAR_profs_southj_ALLCASES(n,:,t,RR) = NaN  ;

                widLFCAR_profs_meanxcenttilt_ALLCASES(n,t,RR)      = NaN  ;
                widLFCAR_profs_meanycenttilt_ALLCASES(n,t,RR)      = NaN  ;
                widLFCAR_bulk_xcenttilt_ALLCASES(n,t,RR)           = NaN  ;
                widLFCAR_bulk_ycenttilt_ALLCASES(n,t,RR)           = NaN  ;

                %widLFCAR_mesoWcape_ALLCASES(n,t,RR,:)            = NaN  ;
                widLFCAR_mesoWcape_ALLCASES(n,t,:,RR,:)           = NaN  ;
                widLFCAR_mesoWcin_ALLCASES(n,t,:,RR,:)            = NaN  ;
                widLFCAR_mesoWdepth_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWdepthrat_ALLCASES(n,t,:,RR,:)       = NaN  ;
                widLFCAR_mesoWlfcagl_ALLCASES(n,t,:,RR)         = NaN  ;
                widLFCAR_mesoWlfcasl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWqvap_ALLCASES(n,t,:,RR,:)           = NaN  ;
                widLFCAR_mesoWstrength_ALLCASES(n,t,:,RR,:)       = NaN  ;
                widLFCAR_mesoWtheta_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWthetae_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWtopagl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWtopasl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWvmsum_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWvmsumHSUM_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWalongsubupfract_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWwidth_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWtoplfcaglRAT_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWtoplfcaslRAT_ALLCASES(n,t,:,RR,:)         = NaN  ;

                widLFCAR_mesoCwidth_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCdepth_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCstrength_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMFCmean_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMCqadvmean_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMCqconvmean_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMFCmax_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMCqadvmax_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMCqconvmax_ALLCASES(n,t,:,RR,:)          = NaN  ;

                widLFCAR_mesoWstrengthMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWwidthMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWtopaglMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWtopaslMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWcapeMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWcinMIN_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWqvapMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWlfcaslMIN_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWlfcaglMIN_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWthetaMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWthetaeMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWdepthMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWvmsumMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWtoplfcaglRATMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoWtoplfcaslRATMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;

                widLFCAR_mesoCwidthMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCdepthMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCstrengthMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMFCmeanMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMCqadvmeanMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMCqconvmeanMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMFCmaxMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMCqadvmaxMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCAR_mesoCMCqconvmaxMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;

                widLFCAR_mesoWmeanRHboxaloft_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWmeanQVboxaloft_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWeast1to5aslUshear_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWeast1to5aslVshear_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWeast1to9aslTOTMAGshear_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWeast1to9aslUshear_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_mesoWeast1to9aslVshear_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastupslopedepthfract_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_westupslopedepthfract_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastupslopedepthfract2500masl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_westupslopedepthfract2500masl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastupslopemean2500masl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_westupslopemean2500masl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastupslopedepthfract1500magl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_westupslopedepthfract1500magl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastupslopemean1500magl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_westupslopemean1500magl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastupslopemean_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_westupslopemean_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastUmean3to4kmasl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastUmean4to5kmasl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastUmean5to6kmasl_ALLCASES(n,t,:,RR,:)         = NaN  ;
%                 widLFCAR_bulkUshearinupdraft_ALLCASES(n,t,:,RR,:)         = NaN  ;
%                 widLFCAR_bulkVshearinupdraft_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastupslopedepth_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_westupslopedepth_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_eastupslopetophtasl_ALLCASES(n,t,:,RR,:)         = NaN  ;
                widLFCAR_westupslopetophtasl_ALLCASES(n,t,:,RR,:)         = NaN  ;
            end
        end
    end
end

%diagnostics
%   wnblah  =  widLFCAR_mesoWtheta_ALLCASES(:,7,:,1) ;    wnblah = permute(wnblah,[1 3 2 4]) ;
%   wnblah2  =  wid_mesoWtheta_ALLCASES(:,7,:,1) ;    wnblah2 = permute(wnblah2,[1 3 2 4]) ;


% save('cockto.mat','-v7.3')

% load('cockto.mat')

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%       Stuff for Hovemueller  plots of wID metrics in  FullSDC space over full
%%%%%%       10kmagl depth of updraft
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%making these with a side set of wid profs filtered on dist from swath... 

wid_profs_area_ALLCASES_dist3km     = wid_profs_area_ALLCASES;
wid_profs_massflux_ALLCASES_dist3km = wid_profs_massflux_ALLCASES;
wid_profs_maxmag_ALLCASES_dist3km   = wid_profs_maxmag_ALLCASES;
wid_profs_northj_ALLCASES_dist3km   = wid_profs_northj_ALLCASES;
wid_profs_southj_ALLCASES_dist3km   = wid_profs_southj_ALLCASES;
%wid_profs_centHTasl_ALLCASES_dist3km = wid_profs_centHTasl_ALLCASES;
wid_profs_meanxcenttilt_ALLCASES_dist3km    = wid_profs_meanxcenttilt_ALLCASES;
wid_profs_meanycenttilt_ALLCASES_dist3km    = wid_profs_meanycenttilt_ALLCASES;
wid_bulk_xcenttilt_ALLCASES_dist3km         = wid_bulk_xcenttilt_ALLCASES;
wid_bulk_ycenttilt_ALLCASES_dist3km         = wid_bulk_ycenttilt_ALLCASES;

% [killn,killt] = find( distw > distswathwid_thresh);
% for ki = 1:length(killn)
%     wid_profs_area_ALLCASES_dist3km(killn(ki),:,killt(ki))     = NaN;
%     wid_profs_massflux_ALLCASES_dist3km(killn(ki),:,killt(ki))     = NaN;
%     wid_profs_maxmag_ALLCASES_dist3km(killn(ki),:,killt(ki))     = NaN;
%     wid_profs_centHTasl_ALLCASES_dist3km(killn(ki),:,killt(ki))     = NaN;
%     wid_profs_northj_ALLCASES_dist3km(killn(ki),:,killt(ki))     = NaN;
%     wid_profs_southj_ALLCASES_dist3km(killn(ki),:,killt(ki))     = NaN;
%     wid_profs_meanxcenttilt_ALLCASES_dist3km(killn(ki),:,killt(ki))     = NaN;
%     wid_profs_meanycenttilt_ALLCASES_dist3km(killn(ki),:,killt(ki))     = NaN;
% end
% kill = find( distw > distswathwid_thresh);
%     wid_bulk_xcenttilt_ALLCASES_dist3km(kill)         = NaN;
%     wid_bulk_ycenttilt_ALLCASES_dist3km(kill)         = NaN;

for R = 1:ar
    %  R = 1;
    distw = dist_wid_and_swath_ALLCASES(:,:,1,R);
    [killn,killt] = find( distw > distswathwid_thresh);
    for ki = 1:length(killn)
        wid_profs_area_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        wid_profs_massflux_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        wid_profs_maxmag_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        wid_profs_northj_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        wid_profs_southj_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        wid_profs_meanxcenttilt_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        wid_profs_meanycenttilt_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;  
    end
end % Rloop
% jerry-rig a htasl masked field by piggybacking off of filtered area
% field... I *think* this works
killbyarea = find(  isnan(wid_profs_area_ALLCASES_dist3km) ); 
wid_profs_htasl_ALLCASES_dist3km = wid_profs_centHTasl_ALLCASES;
wid_profs_htasl_ALLCASES_dist3km(killbyarea) = NaN;








    %{
    wblah = permute( wid_profs_area_ALLCASES(:,:,:),[1 3 2]) ;
    wblah = max(wblah,[],3,'omitnan');
    wblah2 = permute( wid_profs_area_ALLCASES_dist3km(:,:,:),[1 3 2]) ;
    wblah2 = max(wblah2,[],3,'omitnan');
    %}


peakprofile = max(Terr,[],1)';

%%%%% first make the 2D (y,t) fields:
%%% dumb down the dims of input wID metrics to the height with widest updraft area:
[wn wz wt wr]  =  size( wid_profs_centlon_ALLCASES )  ;
wid_maxk_area_ALLCASES  =  zeros(wn, wt, ar) ;        wid_maxk_area_ALLCASES(:) =  NaN;
wid_maxk_vmf_ALLCASES   =  zeros(wn, wt, ar) ;        wid_maxk_vmf_ALLCASES(:) = NaN;
wid_maxk_mag_ALLCASES   =  zeros(wn, wt, ar) ;        wid_maxk_mag_ALLCASES(:) = NaN;
wid_maxk_topasl_ALLCASES =  zeros(wn, wt, ar) ;       wid_maxk_topasl_ALLCASES(:) = NaN;
wid_maxk_northj_ALLCASES =  zeros(wn, wt, ar) ;       wid_maxk_northj_ALLCASES(:) = NaN;
wid_maxk_southj_ALLCASES =  zeros(wn, wt, ar) ;       wid_maxk_southj_ALLCASES(:) = NaN;
%%%%% now find the wID with best metric at each y along the SDC
wIDnum_best_alongsdc        = zeros(sdclength,wt,ar);      wIDnum_best_alongsdc(:) = NaN;
wIDarea_best_alongsdc       = zeros(sdclength,wt,ar);      wIDarea_best_alongsdc(:) = NaN;
wIDmag_best_alongsdc        = zeros(sdclength,wt,ar);      wIDmag_best_alongsdc(:) = NaN;
wIDtopasl_best_alongsdc     = zeros(sdclength,wt,ar);      wIDtopasl_best_alongsdc(:) = NaN;
wIDvmf_best_alongsdc        = zeros(sdclength,wt,ar);      wIDvmf_best_alongsdc(:) = NaN;
wIDmeanxtilt_best_alongsdc = zeros(sdclength,wt,ar);       wIDmeanxtilt_best_alongsdc(:) = NaN;
wIDmeanytilt_best_alongsdc = zeros(sdclength,wt,ar);       wIDmeanytilt_best_alongsdc(:) = NaN;
wIDbulkxtilt_best_alongsdc = zeros(sdclength,wt,ar);       wIDbulkxtilt_best_alongsdc(:) = NaN;
wIDbulkytilt_best_alongsdc = zeros(sdclength,wt,ar);       wIDbulkytilt_best_alongsdc(:) = NaN;
wIDdistswath_best_alongsdc = zeros(sdclength,wt,ar);      wIDdistswath_best_alongsdc(:) = NaN;
%intermediate vars with all wIDs at each j
numwid_guess = 30;  %how many wIDs do you think there could be at a given j?
wIDnum_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDnum_alongsdc(:) = NaN;
wIDarea_alongsdc = zeros(sdclength,numwid_guess,wt,ar);      wIDarea_alongsdc(:) = NaN;
wIDmag_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDmag_alongsdc(:) = NaN;
wIDtopasl_alongsdc = zeros(sdclength,numwid_guess,wt,ar);    wIDtopasl_alongsdc(:) = NaN;
wIDvmf_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDvmf_alongsdc(:) = NaN;
wIDmeanxtilt_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDmeanxtilt_alongsdc(:) = NaN;
wIDmeanytilt_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDmeanytilt_alongsdc(:) = NaN;
wIDbulkxtilt_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDbulkxtilt_alongsdc(:) = NaN;
wIDbulkytilt_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDbulkytilt_alongsdc(:) = NaN;
wIDswathdist_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDswathdist_alongsdc(:) = NaN;

for R = 1:ar
    for n = 1:wn
        for t = 1:wt
            %  n = 9;  t = 20; R = 1;

            %log area/mag/vmf of updraft at it's widest height
            maxk  =  find(    wid_profs_area_ALLCASES_dist3km(n,:,t,R)   ==   max(wid_profs_area_ALLCASES_dist3km(n,:,t,R),[],'omitnan' )     ) ;
            maxk = mode(maxk) ;      %if there are more than 1 maxk area, pick something in the middle
            if( isnan(maxk)==0  & isempty(maxk)==0 )
                wid_maxk_area_ALLCASES(n,t,R)       =   wid_profs_area_ALLCASES_dist3km(n,maxk,t,R)  ;
                wid_maxk_vmf_ALLCASES(n,t,R)        =   wid_profs_massflux_ALLCASES_dist3km(n,maxk,t,R)  ;
                wid_maxk_mag_ALLCASES(n,t,R)        =   wid_profs_maxmag_ALLCASES_dist3km(n,maxk,t,R)  ;
                wid_maxk_northj_ALLCASES(n,t,R)     =   wid_profs_northj_ALLCASES_dist3km(n,maxk,t,R)  ;
                wid_maxk_southj_ALLCASES(n,t,R)     =   wid_profs_southj_ALLCASES_dist3km(n,maxk,t,R)  ;
            end
            %also log updraft top asl
            ks = find(    wid_profs_area_ALLCASES_dist3km(n,:,t,R) > 0    )    ; %find height indices for this updraft where there is a recognizable area value (i.e., not a nan updraft)
            if( isnan(ks)==0  & isempty(ks)==0 )
                %wid_maxk_topasl_ALLCASES(n,t,R)  =  wid_profs_centHTasl_ALLCASES_dist3km(n,ks(end),t,R)  ;  %top height asl is at the highest ks
                wid_maxk_topasl_ALLCASES(n,t,R)  =  wid_profs_htasl_ALLCASES_dist3km(n,ks(end),t,R)  ;  %top height asl is at the highest ks
            end
        end
    end

    %loop to find updrafts that span the current j along SDC
    for t = 1 : maxtime_ALLCASES(R)
        for j = 1 : sdclength   %length(wIDprofs_ID)
            %  j = 8; t = 20;
            wids = find(   j <= wid_maxk_northj_ALLCASES(:,t,R)    &    j >= wid_maxk_southj_ALLCASES(:,t,R)   ) ;
            for ww = 1:length(wids)
                wIDnum_alongsdc(j,ww,t,R) = wids(ww);
                wIDarea_alongsdc(j,ww,t,R) = wid_maxk_area_ALLCASES( wids(ww), t, R);
                wIDmag_alongsdc(j,ww,t,R) = wid_maxk_mag_ALLCASES( wids(ww), t, R);
                wIDtopasl_alongsdc(j,ww,t,R) = wid_maxk_topasl_ALLCASES( wids(ww), t, R);  %new5aug
                wIDvmf_alongsdc(j,ww,t,R) = wid_maxk_vmf_ALLCASES( wids(ww), t, R);
                wIDmeanxtilt_alongsdc(j,ww,t,R) = wid_profs_meanxcenttilt_ALLCASES_dist3km( wids(ww), t, R);
                wIDmeanytilt_alongsdc(j,ww,t,R) = wid_profs_meanycenttilt_ALLCASES_dist3km( wids(ww), t, R);
                wIDbulkxtilt_alongsdc(j,ww,t,R) = wid_bulk_xcenttilt_ALLCASES_dist3km( wids(ww), t, R);
                wIDbulkytilt_alongsdc(j,ww,t,R) = wid_bulk_ycenttilt_ALLCASES_dist3km( wids(ww), t, R);
                wIDswathdist_alongsdc(j,ww,t,R) = dist_wid_and_swath_ALLCASES( wids(ww), t, 1, R);  %hardcode 1 for timelag = 0
            end

            %final product:
            wIDnum_best_alongsdc(j,t,R)     = sum(   (wIDnum_alongsdc(j,:,t,R)./wIDnum_alongsdc(j,:,t,R)),[],'omitnan'  ) ;
%             wIDarea_best_alongsdc(j,t,R)    = median(   wIDarea_alongsdc(j,:,t,R),'omitnan'  ) ;
%             wIDmag_best_alongsdc(j,t,R)     = median(   wIDmag_alongsdc(j,:,t,R),'omitnan'  ) ;
%             wIDtopasl_best_alongsdc(j,t,R)  = median(   wIDtopasl_alongsdc(j,:,t,R),'omitnan'  ) ;
%             wIDvmf_best_alongsdc(j,t,R)     = median(   wIDvmf_alongsdc(j,:,t,R),'omitnan'  ) ;
            wIDarea_best_alongsdc(j,t,R)    = max(   wIDarea_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDmag_best_alongsdc(j,t,R)     = max(   wIDmag_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDtopasl_best_alongsdc(j,t,R)  = max(   wIDtopasl_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDvmf_best_alongsdc(j,t,R)     = max(   wIDvmf_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDmeanxtilt_best_alongsdc(j,t,R)     =  max(   wIDmeanxtilt_alongsdc(j,:,t,R),[],'omitnan'  ) ; 
            wIDmeanytilt_best_alongsdc(j,t,R)     =  max(   wIDmeanytilt_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDbulkxtilt_best_alongsdc(j,t,R)     =  max(   wIDbulkxtilt_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDbulkytilt_best_alongsdc(j,t,R)     =  max(   wIDbulkytilt_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDdistswath_best_alongsdc(j,t,R)     =  min(  wIDswathdist_alongsdc(j,:,t,R),[],'omitnan'    );
        end
    end
end  % R loop
%cumulative sum of wID
wIDcumnum_best_alongsdc = cumsum(wIDnum_best_alongsdc,2) ;


%  figure; contourf(  wIDdistswath_best_alongsdc(:,:,1) , 20, 'LineColor','none')


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%       Repeat of wID metrics in FullSDC space but now over just
%%%%%%       heights within above-prescribed near-LFC and layer and with
%%%%%%       small wIDs removed, and dist from swath filtered
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%making these with a side set of wid profs filtered on dist from swath... 
widLFCAR_profs_area_ALLCASES_dist3km     = widLFCAR_profs_area_ALLCASES;
%widLFCAR_profs_htasl_ALLCASES_dist3km    =   %new5aug;
widLFCAR_profs_massflux_ALLCASES_dist3km = widLFCAR_profs_massflux_ALLCASES;
widLFCAR_profs_maxmag_ALLCASES_dist3km   = widLFCAR_profs_maxmag_ALLCASES;
widLFCAR_profs_northj_ALLCASES_dist3km   = widLFCAR_profs_northj_ALLCASES;
widLFCAR_profs_southj_ALLCASES_dist3km   = widLFCAR_profs_southj_ALLCASES;
widLFCAR_profs_meanxcenttilt_ALLCASES_dist3km    = widLFCAR_profs_meanxcenttilt_ALLCASES;
widLFCAR_profs_meanycenttilt_ALLCASES_dist3km    = widLFCAR_profs_meanycenttilt_ALLCASES;
widLFCAR_bulk_xcenttilt_ALLCASES_dist3km         = widLFCAR_bulk_xcenttilt_ALLCASES;
widLFCAR_bulk_ycenttilt_ALLCASES_dist3km         = widLFCAR_bulk_ycenttilt_ALLCASES;

for R = 1:ar
    %  R = 1;
    distw = dist_wid_and_swath_ALLCASES(:,:,1,R);

    [killn,killt] = find( distw > distswathwid_thresh);
    for ki = 1:length(killn)
        widLFCAR_profs_area_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        widLFCAR_profs_massflux_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        widLFCAR_profs_maxmag_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        widLFCAR_profs_northj_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        widLFCAR_profs_southj_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        widLFCAR_profs_meanxcenttilt_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        widLFCAR_profs_meanycenttilt_ALLCASES_dist3km(killn(ki),:,killt(ki),R)     = NaN;
        widLFCAR_bulk_xcenttilt_ALLCASES_dist3km(killn(ki),killt(ki),R)         = NaN;
        widLFCAR_bulk_ycenttilt_ALLCASES_dist3km(killn(ki),killt(ki),R)         = NaN;    
    end
end % Rloop

%nevermind, a topasl ht doesnt mean much with LFCAR because you're only
%looking at the LFC to LFC+2 km, so top would always cap at LFC+2km
% % jerry-rig a htasl masked field by piggybacking off of filtered area
% % field... I *think* this works
% killbyarea = find(  isnan(widLFCAR_profs_area_ALLCASES_dist3km) ); 
% widLFCAR_profs_htasl_ALLCASES_dist3km = wid_profs_centHTasl_ALLCASES;
% widLFCAR_profs_htasl_ALLCASES_dist3km(killbyarea) = NaN;



    %{
    wblah = permute( widLFCAR_profs_area_ALLCASES(:,:,:),[1 3 2]) ;
    wblah = max(wblah,[],3,'omitnan');
    wblah2 = permute( widLFCAR_profs_area_ALLCASES_dist3km(:,:,:),[1 3 2]) ;
    wblah2 = max(wblah2,[],3,'omitnan');
    %}


%%%%% first make the 2D (y,t) fields:
%%% dumb down the dims of input wID metrics to the height with widest updraft area:
[wn wz wt wr]  =  size( wid_profs_centlon_ALLCASES )  ;
widLFCAR_maxk_area_ALLCASES  =  zeros(wn, wt, ar) ;        widLFCAR_maxk_area_ALLCASES(:) =  NaN;
widLFCAR_maxk_vmf_ALLCASES   =  zeros(wn, wt, ar) ;        widLFCAR_maxk_vmf_ALLCASES(:) = NaN;
widLFCAR_maxk_mag_ALLCASES   =  zeros(wn, wt, ar) ;        widLFCAR_maxk_mag_ALLCASES(:) = NaN;
%widLFCAR_maxk_topasl_ALLCASES =  zeros(wn, wt, ar) ;       widLFCAR_maxk_topasl_ALLCASES(:) = NaN;  %new5aug
widLFCAR_maxk_northj_ALLCASES =  zeros(wn, wt, ar) ;       widLFCAR_maxk_northj_ALLCASES(:) = NaN;
widLFCAR_maxk_southj_ALLCASES =  zeros(wn, wt, ar) ;       widLFCAR_maxk_southj_ALLCASES(:) = NaN;
%%%%% now find the wID with best metric at each y along the SDC
wIDLFCARnum_best_alongsdc        = zeros(sdclength,wt,ar);      wIDLFCARnum_best_alongsdc(:) = NaN;
wIDLFCARarea_best_alongsdc       = zeros(sdclength,wt,ar);      wIDLFCARarea_best_alongsdc(:) = NaN;
wIDLFCARmag_best_alongsdc        = zeros(sdclength,wt,ar);      wIDLFCARmag_best_alongsdc(:) = NaN;
wIDLFCARtopasl_best_alongsdc     = zeros(sdclength,wt,ar);      wIDLFCARtopasl_best_alongsdc(:) = NaN;
wIDLFCARvmf_best_alongsdc        = zeros(sdclength,wt,ar);      wIDLFCARvmf_best_alongsdc(:) = NaN;
wIDLFCARmeanxtilt_best_alongsdc = zeros(sdclength,wt,ar);       wIDLFCARmeanxtilt_best_alongsdc(:) = NaN;
wIDLFCARmeanytilt_best_alongsdc = zeros(sdclength,wt,ar);       wIDLFCARmeanytilt_best_alongsdc(:) = NaN;
wIDLFCARbulkxtilt_best_alongsdc = zeros(sdclength,wt,ar);       wIDLFCARbulkxtilt_best_alongsdc(:) = NaN;
wIDLFCARbulkytilt_best_alongsdc = zeros(sdclength,wt,ar);       wIDLFCARbulkytilt_best_alongsdc(:) = NaN;
%intermediate vars with all wIDs at each j
numwid_guess = 30;  %how many wIDs do you think there could be at a given j?
wIDLFCARnum_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDLFCARnum_alongsdc(:) = NaN;
wIDLFCARarea_alongsdc = zeros(sdclength,numwid_guess,wt,ar);      wIDLFCARarea_alongsdc(:) = NaN;
wIDLFCARtopasl_alongsdc = zeros(sdclength,numwid_guess,wt,ar);     wIDLFCARtopasl_alongsdc(:) = NaN;
wIDLFCARmag_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDLFCARmag_alongsdc(:) = NaN;
wIDLFCARvmf_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDLFCARvmf_alongsdc(:) = NaN;
wIDLFCARmeanxtilt_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDLFCARmeanxtilt_alongsdc(:) = NaN;
wIDLFCARmeanytilt_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDLFCARmeanytilt_alongsdc(:) = NaN;
wIDLFCARbulkxtilt_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDLFCARbulkxtilt_alongsdc(:) = NaN;
wIDLFCARbulkytilt_alongsdc = zeros(sdclength,numwid_guess,wt,ar);       wIDLFCARbulkytilt_alongsdc(:) = NaN;

% %manual calc to dumbdown to 1 value per updraft
% widLFCAR_maxk_topasl_ALLCASES = max( widLFCAR_profs_htasl_ALLCASES_dist3km,[],2,'omitnan' );
% widLFCAR_maxk_topasl_ALLCASES = permute(widLFCAR_maxk_topasl_ALLCASES,[1 3 4 2]);

%dumb down to id (z) values :
for R = 1:ar
    for n = 1:wn
        for t = 1:wt
            %  n = 9;  t = 20; R = 1;
            %log area/mag/vmf of updraft at it's widest height
            maxk  =  find(    widLFCAR_profs_area_ALLCASES_dist3km(n,:,t,R)   ==   max(widLFCAR_profs_area_ALLCASES_dist3km(n,:,t,R),[],'omitnan' )     ) ;
            maxk = mode(maxk) ;      %if there are more than 1 maxk area, pick something in the middle
            if( isnan(maxk)==0  & isempty(maxk)==0 )
                widLFCAR_maxk_area_ALLCASES(n,t,R)       =   widLFCAR_profs_area_ALLCASES_dist3km(n,maxk,t,R)  ;
                widLFCAR_maxk_vmf_ALLCASES(n,t,R)        =   widLFCAR_profs_massflux_ALLCASES_dist3km(n,maxk,t,R)  ;
                widLFCAR_maxk_mag_ALLCASES(n,t,R)        =   widLFCAR_profs_maxmag_ALLCASES_dist3km(n,maxk,t,R)  ;
                widLFCAR_maxk_northj_ALLCASES(n,t,R)     =   widLFCAR_profs_northj_ALLCASES_dist3km(n,maxk,t,R)  ;
                widLFCAR_maxk_southj_ALLCASES(n,t,R)     =   widLFCAR_profs_southj_ALLCASES_dist3km(n,maxk,t,R)  ;
            end
        end
    end

    %loop to find updrafts that span the current j along SDC
    for t = 1 : maxtime_ALLCASES(R)
        for j = 1 : sdclength   %length(wIDprofs_ID)
            %  j = 8; t = 20;
            wids = find(   j <= widLFCAR_maxk_northj_ALLCASES(:,t,R)    &    j >= widLFCAR_maxk_southj_ALLCASES(:,t,R)   ) ;
            for ww = 1:length(wids)
                wIDLFCARnum_alongsdc(j,ww,t,R)  = wids(ww);
                wIDLFCARarea_alongsdc(j,ww,t,R) = widLFCAR_maxk_area_ALLCASES( wids(ww), t, R);
                wIDLFCARmag_alongsdc(j,ww,t,R)  = widLFCAR_maxk_mag_ALLCASES( wids(ww), t, R);
                wIDLFCARvmf_alongsdc(j,ww,t,R)  = widLFCAR_maxk_vmf_ALLCASES( wids(ww), t, R);
                wIDLFCARmeanxtilt_alongsdc(j,ww,t,R) = widLFCAR_profs_meanxcenttilt_ALLCASES_dist3km( wids(ww), t, R);
                wIDLFCARmeanytilt_alongsdc(j,ww,t,R) = widLFCAR_profs_meanycenttilt_ALLCASES_dist3km( wids(ww), t, R);
                wIDLFCARbulkxtilt_alongsdc(j,ww,t,R) = widLFCAR_bulk_xcenttilt_ALLCASES_dist3km( wids(ww), t, R);
                wIDLFCARbulkytilt_alongsdc(j,ww,t,R) = widLFCAR_bulk_ycenttilt_ALLCASES_dist3km( wids(ww), t, R);

                %wIDLFCARtopasl_alongsdc(j,ww,t,R) = widLFCAR_maxk_topasl_ALLCASES( wids(ww), t, R);  %new5aug

            end
            %final product:
            wIDLFCARnum_best_alongsdc(j,t,R)     = sum(   (wIDLFCARnum_alongsdc(j,:,t,R)./wIDLFCARnum_alongsdc(j,:,t,R)),[],'omitnan'  ) ;
%             wIDLFCARarea_best_alongsdc(j,t,R)    = median(   wIDLFCARarea_alongsdc(j,:,t,R),'omitnan'  ) ;
%             wIDLFCARmag_best_alongsdc(j,t,R)     = median(   wIDLFCARmag_alongsdc(j,:,t,R),'omitnan'  ) ;
%             wIDLFCARvmf_best_alongsdc(j,t,R)     = median(   wIDLFCARvmf_alongsdc(j,:,t,R),'omitnan'  ) ;
            wIDLFCARarea_best_alongsdc(j,t,R)      = max(   wIDLFCARarea_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            %wIDLFCARtopasl_best_alongsdc(j,t,R)    = max(   wIDLFCARtopasl_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDLFCARmag_best_alongsdc(j,t,R)       = max(   wIDLFCARmag_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDLFCARvmf_best_alongsdc(j,t,R)       = max(   wIDLFCARvmf_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDLFCARmeanxtilt_best_alongsdc(j,t,R)     =  max(   wIDLFCARmeanxtilt_alongsdc(j,:,t,R),[],'omitnan'  ) ; 
            wIDLFCARmeanytilt_best_alongsdc(j,t,R)     =  max(   wIDLFCARmeanytilt_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDLFCARbulkxtilt_best_alongsdc(j,t,R)     =  max(   wIDLFCARbulkxtilt_alongsdc(j,:,t,R),[],'omitnan'  ) ;
            wIDLFCARbulkytilt_best_alongsdc(j,t,R)     =  max(   wIDLFCARbulkytilt_alongsdc(j,:,t,R),[],'omitnan'  ) ;
        end
    end
end  % R loop
%cumulative sum of wID
wIDLFCARcumnum_best_alongsdc = cumsum(wIDLFCARnum_best_alongsdc,2) ;




%moved up from below
%%%%%% try same but filter out wIDs with tops shallower than MINTOP masl
%%%%%% (CHANGE TO ASL LATER)

MINTOP = 5000;
%MAXBOT = 4000; % nvrmnd on the min height requirement b/c of detached thermals. 
widLFCARdeep_profs_area_ALLCASES        =  widLFCAR_profs_area_ALLCASES ;
widLFCARdeep_profs_massflux_ALLCASES    =  widLFCAR_profs_massflux_ALLCASES ;
widLFCARdeep_profs_maxmag_ALLCASES      =  widLFCAR_profs_maxmag_ALLCASES ;
widLFCARdeep_profs_meanxcenttilt_ALLCASES   =  widLFCAR_profs_meanxcenttilt_ALLCASES;
widLFCARdeep_profs_meanycenttilt_ALLCASES   =  widLFCAR_profs_meanycenttilt_ALLCASES;
widLFCARdeep_bulk_xcenttilt_ALLCASES        =  widLFCAR_bulk_xcenttilt_ALLCASES;
widLFCARdeep_bulk_ycenttilt_ALLCASES        =  widLFCAR_bulk_ycenttilt_ALLCASES;
      
widLFCARdeep_mesoWstrength_ALLCASES     =  widLFCAR_mesoWstrength_ALLCASES;
widLFCARdeep_mesoWwidth_ALLCASES        =  widLFCAR_mesoWwidth_ALLCASES;
widLFCARdeep_mesoWvmsum_ALLCASES        =  widLFCAR_mesoWvmsum_ALLCASES;
widLFCARdeep_mesoWvmsumHSUM_ALLCASES    =  widLFCAR_mesoWvmsumHSUM_ALLCASES;
widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES =  widLFCAR_mesoWtoplfcaslRAT_ALLCASES;
widLFCARdeep_mesoWalongsubupfract_ALLCASES     = widLFCAR_mesoWalongsubupfract_ALLCASES;
widLFCARdeep_mesoWlfcagl_ALLCASES           = widLFCAR_mesoWlfcagl_ALLCASES;
widLFCARdeep_mesoWqvap_ALLCASES             = widLFCAR_mesoWqvap_ALLCASES;
widLFCARdeep_mesoWcape_ALLCASES             = widLFCAR_mesoWcape_ALLCASES;
widLFCARdeep_mesoWcin_ALLCASES              = widLFCAR_mesoWcin_ALLCASES;
widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES   = widLFCAR_mesoWmeanRHboxaloft_ALLCASES;
widLFCARdeep_mesoWmeanQVboxaloft_ALLCASES   = widLFCAR_mesoWmeanQVboxaloft_ALLCASES;
widLFCARdeep_mesoWdepthrat_ALLCASES         = widLFCAR_mesoWdepthrat_ALLCASES;
widLFCARdeep_mesoWtheta_ALLCASES            = widLFCAR_mesoWtheta_ALLCASES;

widLFCARdeep_mesoCstrength_ALLCASES     =  widLFCAR_mesoCstrength_ALLCASES;
widLFCARdeep_mesoCwidth_ALLCASES        =  widLFCAR_mesoCwidth_ALLCASES;
widLFCARdeep_mesoCdepth_ALLCASES        =  widLFCAR_mesoCdepth_ALLCASES;
widLFCARdeep_mesoCMFCmean_ALLCASES      =  widLFCAR_mesoCMFCmean_ALLCASES;
widLFCARdeep_mesoCMCqadvmean_ALLCASES   =  widLFCAR_mesoCMCqadvmean_ALLCASES;
widLFCARdeep_mesoCMCqconvmean_ALLCASES  =  widLFCAR_mesoCMCqconvmean_ALLCASES;
widLFCARdeep_mesoCMFCmax_ALLCASES      =  widLFCAR_mesoCMFCmax_ALLCASES;
widLFCARdeep_mesoCMCqadvmax_ALLCASES   =  widLFCAR_mesoCMCqadvmax_ALLCASES;
widLFCARdeep_mesoCMCqconvmax_ALLCASES  =  widLFCAR_mesoCMCqconvmax_ALLCASES;

widLFCARdeep_mesoWstrengthMAX_ALLCASES        = widLFCAR_mesoWstrengthMAX_ALLCASES;
widLFCARdeep_mesoWwidthMAX_ALLCASES           = widLFCAR_mesoWwidthMAX_ALLCASES;
widLFCARdeep_mesoWtopaglMAX_ALLCASES          = widLFCAR_mesoWtopaglMAX_ALLCASES;
widLFCARdeep_mesoWtopaslMAX_ALLCASES          = widLFCAR_mesoWtopaslMAX_ALLCASES;
widLFCARdeep_mesoWcapeMAX_ALLCASES            = widLFCAR_mesoWcapeMAX_ALLCASES;
widLFCARdeep_mesoWcinMIN_ALLCASES             = widLFCAR_mesoWcinMIN_ALLCASES;
widLFCARdeep_mesoWqvapMAX_ALLCASES            = widLFCAR_mesoWqvapMAX_ALLCASES; 
widLFCARdeep_mesoWlfcaslMIN_ALLCASES          = widLFCAR_mesoWlfcaslMIN_ALLCASES;
widLFCARdeep_mesoWlfcaglMIN_ALLCASES          = widLFCAR_mesoWlfcaglMIN_ALLCASES;
widLFCARdeep_mesoWthetaMAX_ALLCASES           = widLFCAR_mesoWthetaMAX_ALLCASES;
widLFCARdeep_mesoWthetaeMAX_ALLCASES          = widLFCAR_mesoWthetaeMAX_ALLCASES;
widLFCARdeep_mesoWdepthMAX_ALLCASES           = widLFCAR_mesoWdepthMAX_ALLCASES;
widLFCARdeep_mesoWvmsumMAX_ALLCASES           = widLFCAR_mesoWvmsumMAX_ALLCASES;
widLFCARdeep_mesoWtoplfcaglRATMAX_ALLCASES    = widLFCAR_mesoWtoplfcaglRATMAX_ALLCASES;
widLFCARdeep_mesoWtoplfcaslRATMAX_ALLCASES    = widLFCAR_mesoWtoplfcaslRATMAX_ALLCASES;

widLFCARdeep_mesoCstrengthMAX_ALLCASES     =  widLFCAR_mesoCstrengthMAX_ALLCASES;
widLFCARdeep_mesoCwidthMAX_ALLCASES        =  widLFCAR_mesoCwidthMAX_ALLCASES;
widLFCARdeep_mesoCdepthMAX_ALLCASES        =  widLFCAR_mesoCdepthMAX_ALLCASES;
widLFCARdeep_mesoCMFCmeanMAX_ALLCASES      =  widLFCAR_mesoCMFCmeanMAX_ALLCASES;
widLFCARdeep_mesoCMCqadvmeanMAX_ALLCASES   =  widLFCAR_mesoCMCqadvmeanMAX_ALLCASES;
widLFCARdeep_mesoCMCqconvmeanMAX_ALLCASES  =  widLFCAR_mesoCMCqconvmeanMAX_ALLCASES;
widLFCARdeep_mesoCMFCmaxMAX_ALLCASES      =  widLFCAR_mesoCMFCmaxMAX_ALLCASES;
widLFCARdeep_mesoCMCqadvmaxMAX_ALLCASES   =  widLFCAR_mesoCMCqadvmaxMAX_ALLCASES;
widLFCARdeep_mesoCMCqconvmaxMAX_ALLCASES  =  widLFCAR_mesoCMCqconvmaxMAX_ALLCASES;


widLFCARdeep_eastupslopedepthfract_ALLCASES  = widLFCAR_eastupslopedepthfract_ALLCASES;
widLFCARdeep_westupslopedepthfract_ALLCASES  = widLFCAR_westupslopedepthfract_ALLCASES;
widLFCARdeep_eastupslopemean_ALLCASES               = widLFCAR_eastupslopemean_ALLCASES;
widLFCARdeep_westupslopemean_ALLCASES               = widLFCAR_westupslopemean_ALLCASES;

widLFCARdeep_eastupslopedepthfract2500masl_ALLCASES  = widLFCAR_eastupslopedepthfract2500masl_ALLCASES;
widLFCARdeep_westupslopedepthfract2500masl_ALLCASES  = widLFCAR_westupslopedepthfract2500masl_ALLCASES;
widLFCARdeep_eastupslopemean2500masl_ALLCASES                = wid_eastupslopemean2500masl_ALLCASES;
widLFCARdeep_westupslopemean2500masl_ALLCASES                = wid_westupslopemean2500masl_ALLCASES;
widLFCARdeep_eastupslopedepthfract1500magl_ALLCASES  = widLFCAR_eastupslopedepthfract1500magl_ALLCASES;
widLFCARdeep_westupslopedepthfract1500magl_ALLCASES  = widLFCAR_westupslopedepthfract1500magl_ALLCASES;
widLFCARdeep_eastupslopemean1500magl_ALLCASES                = wid_eastupslopemean1500magl_ALLCASES;
widLFCARdeep_westupslopemean1500magl_ALLCASES                = wid_westupslopemean1500magl_ALLCASES;

widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES = widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES;
widLFCARdeep_mesoWeast1to9aslTOTMAGshear_ALLCASES = widLFCAR_mesoWeast1to9aslTOTMAGshear_ALLCASES;
widLFCARdeep_eastUmean3to4kmasl_ALLCASES        = widLFCAR_eastUmean3to4kmasl_ALLCASES;
widLFCARdeep_eastUmean4to5kmasl_ALLCASES        = widLFCAR_eastUmean4to5kmasl_ALLCASES;
widLFCARdeep_eastUmean5to6kmasl_ALLCASES        = widLFCAR_eastUmean5to6kmasl_ALLCASES;

widLFCARdeep_eastupslopedepth_ALLCASES       = widLFCAR_eastupslopedepth_ALLCASES;
widLFCARdeep_westupslopedepth_ALLCASES       = widLFCAR_westupslopedepth_ALLCASES;
widLFCARdeep_eastupslopetophtasl_ALLCASES       = widLFCAR_eastupslopetophtasl_ALLCASES;
widLFCARdeep_westupslopetophtasl_ALLCASES       = widLFCAR_westupslopetophtasl_ALLCASES;

% widLFCARdeep_bulkUshearinupdraft_ALLCASES = widLFCAR_bulkUshearinupdraft_ALLCASES ;
% widLFCARdeep_bulkVshearinupdraft_ALLCASES = widLFCAR_bulkVshearinupdraft_ALLCASES ;

% filter out shallow wIDs:
for n = 1:wn
    for t = 1:wt
        for R = 1:ar
            %  n = 2;   R=1;  t=30;

            maxasl = max(wid_profs_centHTasl_ALLCASES(n,:,t,R),[],'omitnan');

            %minasl = min(wid_profs_centHTasl_ALLCASES(n,:,t,R),[],'omitnan');   %nvrmind
%             if( isempty(maxasl)==0  & isnan(maxasl)==0 & isempty(minasl)==0  & isnan(minasl)==0  ...
%                     &  maxasl < MINTOP  |  minasl > MAXBOT )  % nvrmnd on
%                     the min height requirement b/c of detached thermals. 

            if( isempty(maxasl)==0  & isnan(maxasl)==0  &  maxasl < MINTOP ) % kill when true
                %disp(['picked off ',num2str(n),'_',num2str(t),'_',num2str(R)])

                widLFCARdeep_profs_area_ALLCASES(n,:,t,R)           =  NaN;
                widLFCARdeep_profs_massflux_ALLCASES(n,:,t,R)       =  NaN;
                widLFCARdeep_profs_maxmag_ALLCASES(n,:,t,R)         =  NaN;   
                widLFCARdeep_profs_meanxcenttilt_ALLCASES(n,t,R)    =  NaN;   
                widLFCARdeep_profs_meanycenttilt_ALLCASES(n,t,R)    =  NaN;   
                widLFCARdeep_bulk_xcenttilt_ALLCASES(n,t,R)         =  NaN;   
                widLFCARdeep_bulk_ycenttilt_ALLCASES(n,t,R)         =  NaN;   

                widLFCARdeep_mesoWstrength_ALLCASES(n,t,:,R,:)        = NaN  ;
                widLFCARdeep_mesoWwidth_ALLCASES(n,t,:,R,:)           = NaN  ;
                widLFCARdeep_mesoWvmsum_ALLCASES(n,t,:,R,:)           = NaN  ;
                widLFCARdeep_mesoWvmsumHSUM_ALLCASES(n,t,:,R,:)       = NaN  ;
                widLFCARdeep_mesoWalongsubupfract_ALLCASES(n,t,:,R,:)       = NaN  ;
                widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(n,t,:,R,:)    = NaN  ;
                widLFCARdeep_mesoWlfcagl_ALLCASES(n,t,:,R,:)          = NaN  ;
                widLFCARdeep_mesoWqvap_ALLCASES(n,t,:,R,:)            = NaN  ;
                widLFCARdeep_mesoWcape_ALLCASES(n,t,:,R,:)            = NaN  ;
                widLFCARdeep_mesoWcin_ALLCASES(n,t,:,R,:)             = NaN  ;
                widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES(n,t,:,R,:)  = NaN  ;
                widLFCARdeep_mesoWmeanQVboxaloft_ALLCASES(n,t,:,R,:)  = NaN  ;
                widLFCARdeep_mesoWdepthrat_ALLCASES(n,t,:,R,:)        = NaN  ;
                widLFCARdeep_mesoWtheta_ALLCASES(n,t,:,R,:)           = NaN  ;
                widLFCARdeep_eastupslopedepthfract_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_westupslopedepthfract_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_eastupslopedepthfract2500masl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_westupslopedepthfract2500masl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_eastupslopemean2500masl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_westupslopemean2500masl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_eastupslopedepthfract1500magl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_westupslopedepthfract1500magl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_eastupslopemean1500magl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_westupslopemean1500magl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_eastupslopemean_ALLCASES(n,t,:,R,:)      = NaN  ;
                widLFCARdeep_westupslopemean_ALLCASES(n,t,:,R,:)      = NaN  ;
                widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWeast1to9aslTOTMAGshear_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_eastUmean3to4kmasl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_eastUmean4to5kmasl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_eastUmean5to6kmasl_ALLCASES(n,t,:,R,:) = NaN  ;
%                 widLFCARdeep_bulkUshearinupdraft_ALLCASES(n,t,:,R,:)   = NaN  ;
%                 widLFCARdeep_bulkVshearinupdraft_ALLCASES(n,t,:,R,:)   = NaN  ;
                widLFCARdeep_eastupslopedepthasl_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_westupslopedepthasl_ALLCASES(n,t,:,R,:) = NaN  ;

                widLFCARdeep_mesoWstrengthMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWwidthMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWtopaglMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWtopaslMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWcapeMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWcinMIN_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWqvapMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWlfcaslMIN_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWlfcaglMIN_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWthetaMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWthetaeMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWdepthMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWvmsumMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWtoplfcaglRATMAX_ALLCASES(n,t,:,R,:) = NaN  ;
                widLFCARdeep_mesoWtoplfcaslRATMAX_ALLCASES(n,t,:,R,:) = NaN  ;

                widLFCARdeep_mesoCwidth_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCdepth_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCstrength_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMFCmean_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMCqadvmean_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMCqconvmean_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMFCmax_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMCqadvmax_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMCqconvmax_ALLCASES(n,t,:,RR,:)          = NaN  ;

                widLFCARdeep_mesoCwidthMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCdepthMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCstrengthMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMFCmeanMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMCqadvmeanMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMCqconvmeanMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMFCmaxMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMCqadvmaxMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;
                widLFCARdeep_mesoCMCqconvmaxMAX_ALLCASES(n,t,:,RR,:)          = NaN  ;

            end
        end
    end
end


%diagnostics:
%   wnblah   =  widLFCARdeep_mesoWtheta_ALLCASES(:,30,:,1) ;  wnblah = permute(wnblah,[1 3 2 4]) ;
%   wnblah1  =  widLFCAR_mesoWtheta_ALLCASES(:,30,:,1) ;      wnblah1 = permute(wnblah1,[1 3 2 4]) ;
%   wnblah2  =  wid_mesoWtheta_ALLCASES(:,30,:,1) ;           wnblah2 = permute(wnblah2,[1 3 2 4]) ;

%   whtblah  =  wid_profs_centHTasl_ALLCASES(:,:,30,1) ;      %whtblah = permute(whtblah,[3 4 1 2]) ;



Total_cells_tracked = sum(num_cells_ALLCASES)

Subset_considered4CI = length(find(isnan(cellkeeper_mask_ALLCASES)==0) )

disp(' SAVING FINAL CHECKPOINT ')                                                            % /SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_v13_d4_

save('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_env3R_v13f_SDCsmj1p5_topf_widcull.mat','-v7.3')

disp(' FINAL CHECKPOINT SAVED ')




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%           load data sets here  
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%% MeS_C1p11_Wraw_Wwin5v15h_Cwin5v40h_Wmag05
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% 
% % ~most up to date before switching to widerwid-swath serach areas (just
% % mean fields within a  wid diameter )
% % also is before I started looking at smoothed (mesoscale) swaths - so uses
% % raw W in Wobject
% 
% %     clear;   load('allprocessed3_allcases_checkpointc_deep10d_2.mat')  -
% %     Allprocessed_swathIDthermoOutput_100m_rhcamod_wID_qcldicesnow0.0001_dbz10_run.mat
% %     (currently most stable)
% %
% %     - made redundant eventually by... 
% %     clear;   load('allprocessed_checkpointc_deep11b_WIDshadowbloat1_swathmaxs.mat')
% %            (... i think)
% 
% 
% % ~before looking at mesoscale smoothed w_objects
% % but uses wider wid - swath serach area - bloat WID radius by 3 and max
% % values calculated
% 
% %     clear;   load('allprocessed_checkpointc_deep11b_WIDshadowbloat3_swathmaxs.mat')
% 
% 
% 
% 
% % ~before looking at mesoscale smoothed w_objects
% % but uses wid search area on swath = +/- 2250m (constant for all updrafts)
% % note: 2250m = ~90th percetile of deep udpraft population radius * 2 
% 
% %     clear;  load('allprocessed_checkpointc_deep11b_WIDconstbloat2250m_swathmaxs.mat')
% 
% 
% 
% 
% % original swath set: w>0.5m/s  c1p11, wraw, wv5
% %three wid match methods
% 
% %  clear;  load('Allprocessed_swathIDthermoOutput_100m_rhcamod_wID_qcldicesnow0.0001_dbz10_run.mat');  DATASET = 'c1p11_wraw_wmag05';  DS = 'c1p11 wraw wmag05';
% 
% 
% 
% 
% 
% 
% % 1st restructured swath set: w>0.25m/s  c1p11, wraw, wv5
% %three wid match methods
% 
% %   clear ;  load('/Users/marq789/Downloads/0_backup/older_WID_SWATH_processed_mats/SwathIDthermoOutput_c1p11_wraw_wmag025_dirtfix_d4_run.mat');  DATASET = 'c1p11_wraw_wmag025';  DS = 'c1p11 wraw wmag025';
% 
%     
% 
% 
% % 1st restructured mesoscale smoothed swath set: w>0.25m/s  c1p11, w2p16, wv5
% %three wid match methods
% 
% %   clear;  load('SwathIDthermoOutput_c1p11_w2p16_wmag025_post2p9_d4_run.mat');   DATASET = 'c1p11_w2p16_wmag025';   DS = 'c1p11 w2p16 wmag025';
% 
% 
% 
% 
% 
% % last run BEFORE I fixed several things about the swath detection (i.e., not yet fixed LFC ceiling, asl only, ?), but switched 
% % to wid near-cloud environment sampled around ring at 3 x circ equiv updraft Rad :    w>0.25m/s  c1p11, w2p16, wv5
% % really, you're just using this to test the 3xR env's, and this will be
% % replaced by the fixed swath data set
% 
% % clear;  load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11_wraw_wmag025_env3R.mat');  DATASET = 'c1p11_wraw_wmag025_preswathfix_env3R';  DS = 'c1p11 wraw wmag025 preswathfix env3R';








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% saved .mat's prior to this point are probably fully obsolete now. You
%%% can find most of them in /Users/marq789/Downloads/0_backup/older_WID_SWATH_processed_mats
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% RELOAD HERE




%{

%%%% first run using the new, fixed swath detection code (v12b; e.g.,
%%%% LASSO_SWATHidthermobox_w1p16swath_100m5min_TerrcutAsl_v12b_04Dec.m  -
%%%% note, the "w1p16swath" is in the filename even though you use the same
%%%% script for other swath rund (e.g., wraw, w2p16). This run searches for
%%%% the w swath in the 1pass16ij smoothing w field within a ik-dir search
%%%% window from the time-mean and 1p11ij near-sfc conv band, omitting a
%%%% previous middle step of looking for the w_max near the conv_max that's
%%%% near the time mean conv. 
%%% uses: wp15, outermost w contour for floodfill = 0.25m/s, processed
%%% near-wID env at 3*circ equiv R of each wid, and swath properties [as
%%% funct(j,t)] are unsmoothed (sm0) after swath detection. 
%%%
%%%  Also, fixed the swath top/depth issue where I was dumbly flood-filling on
%%%  W_dummy field that naned outside the w_mxa search window:


%%% w1p16:

clear; 
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_w1p16_wmag01_env3R_v12b_smf0topf.mat')
DATASET = 'c1p11h1p13t_w1p16_wmag01_sm0_e3R_v12b_topf';   DS = 'c1p11h1p13t w1p16 wmag01 sm0 e3R v12b';

clear; 
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_w1p16_wmag025_env3R_v12b_smf0topf.mat')
DATASET = 'c1p11h1p13t_w1p16_wmag025_sm0_e3R_v12b_topf';   DS = 'c1p11h1p13t w1p16 wmag025 sm0 e3R v12b';

clear; 
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_w1p16_wmag05_env3R_v12b_smf0topf.mat')
DATASET = 'c1p11h1p13t_w1p16_wmag05_sm0_e3R_v12b_topf';   DS = 'c1p11h1p13t w1p16 wmag05 sm0 e3R v12b';

clear; 
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_w1p16_wmag075_env3R_v12b_smf0topf.mat')
DATASET = 'c1p11h1p13t_w1p16_wmag075_sm0_e3R_v12b_topf';   DS = 'c1p11h1p13t w1p16 wmag075 sm0 e3R v12b';


%%% w2p16:

clear; 
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_w2p16_wmag025_env3R_v12b_smf0topf.mat')
DATASET = 'c1p11h1p13t_w2p16_wmag025_sm0_e3R_v12b_topf';   DS = 'c1p11h1p13t w2p16 wmag025 sm0 e3R v12b';

clear; 
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_w2p16_wmag05_env3R_v12b_smf0topf.mat')
DATASET = 'c1p11h1p13t_w2p16_wmag05_sm0_e3R_v12b_topf';   DS = 'c1p11h1p13t w2p16 wmag05 sm0 e3R v12b';





%%% wraw:

clear; 
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_wraw_wmag025_env3R_v12b_smf0topf.mat')
DATASET = 'c1p11h1p13t_wraw_wmag025_sm0_e3R_v12b_topf';   DS = 'c1p11h1p13t wraw wmag025 sm0 e3R v12b';


clear; 
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_wraw_wmag05_env3R_v12b_smf0topf.mat')
DATASET = 'c1p11h1p13t_wraw_wmag05_sm0_e3R_v12b_topf';   DS = 'c1p11h1p13t wraw wmag05 sm0 e3R v12b';


% read in sm0 swath metrics, then smoothed them along j only with 1p5
movemean (w05), no sublfc cap
clear;
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_wraw_wmag05_env3R_v12b_SDCsmj1p5_topf.mat')
DATASET = 'c1p11h1p13t_wraw_wmag05_SDCsmj1p5_e3R_v12b_topf';   DS = 'c1p11h1p13t wraw wmag05 SDCsmj1p5 e3R v12b';




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    previous long-running standard       %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% (replaced below with DS = 'c1p11h1p13t wraw wmag025 SDCsmj1p5 cobj1e3MFC
e3R v12b ';)

% read in sm0 swath metrics, then smoothed them along j only with 1p5 movemean (w025)
%rh500,600,5km,6km added, no sublfc cap
clear;
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13t_wraw_wmag025_env3R_v12b_SDCsmj1p5_topf.mat')
DATASET = 'c1p11h1p13t_wraw_wmag025_SDCsmj1p5_e3R_v12b_topf';   DS = 'c1p11h1p13t wraw wmag025 SDCsmj1p5 e3R v12b';





%same as one immediately above, but where I cap the swath ceiling at 2 km agl if the local LFC is deeper than 2 km agl 
clear;
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf2kmlfccap_wraw_wmag025_env3R_v12b_SDCsmj1p5_topf.mat')
DATASET = 'c1p11h1p13t_wraw_wmag025_SDCsmj1p5_e3R_v12b_topf_2kmlfccap';   DS = 'c1p11h1p13t wraw wmag025 SDCsmj1p5 e3R v12b 2kmlfccap';



% read in sm0 swath metrics, then smoothed them along j only with 1p5
movemean (w075), no sublfc cap
%rh500,600,5km,6km added
clear;
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag075_env3R_v12b_SDCsmj1p5_topf.mat')
DATASET = 'c1p11h1p13t_wraw_wmag025_SDCsmj1p5_e3R_v12b_topf';   DS = 'c1p11h1p13t wraw wmag075 SDCsmj1p5 e3R v12b ';


% read in sm0 swath metrics, then smoothed them along j only with 1p5
movemean (w100 - 1m/s), no sublfc cap
%rh500,600,5km,6km added
clear;
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag100_env3R_v12b_SDCsmj1p5_topf.mat')
DATASET = 'c1p11h1p13t_wraw_wmag100_SDCsmj1p5_e3R_v12b_topf';   DS = 'c1p11h1p13t wraw wmag100 SDCsmj1p5 e3R v12b ';




% read in sm0 swath metrics, then smoothed them along j only with 1p5 movemean (w025)
%rh500,600,5km,6km added, no sublfc cap,  now calculates max conv, conv
%object width/depth, and in-Cswath mosture convergence vars - Cobj > 1e-3 1/s

clear
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_env3R_v13_SDCsmj1p5_topf.mat')
DATASET = 'c1p11h1p13t_wraw_wmag025_cobj1e3MFC_SDCsmj1p5_e3R_v12b_topf';   DS = 'c1p11h1p13t wraw wmag025 SDCsmj1p5 cobj1e3MFC e3R v12b ';



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%% (10 may 2025) standard
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% read in sm0 swath metrics, then smoothed them along j only with 1p5 movemean (w025)
%rh500,600,5km,6km added, no sublfc cap,  now calculates max conv, conv
%object width/depth, and in-Cswath mosture convergence vars - Cobj > 1e-3
% 1/s, added swathboxaloft_QVap, fixed the wid_alongsdc vars for hovmoller plots to have dist from swath > 3km filter 

clear
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_env3R_v13b_SDCsmj1p5_topf.mat')
DATASET = 'c1p11h1p13t_wraw_wmag025_cobj1e3MFC_SDCsmj1p5_e3R_v13b_topf';   DS = 'c1p11h1p13t wraw wmag025 SDCsmj1p5 cobj1e3MFC e3R v13b ';
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_env3R_v13b_SDCsmj1p5_topf_widcull.mat


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% read in sm0 swath metrics, then smoothed them along j only with 1p5 movemean (w025)
%rh500,600,5km,6km added, no sublfc cap,  now calculates max conv, conv
%object width/depth, and in-Cswath mosture convergence vars - Cobj > 1e-3
% 1/s, added swathboxaloft_QVap, fixed the wid_alongsdc vars for hovmoller plots to have dist from swath > 3km filter 
% also manually chops out the wids whose central latitudes are where I manually culled j&t swath identification - and includes a (j,t,R) mask of the culling info. 
% 
% clear
% load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_env3R_v13b_SDCsmj1p5_topf_widcull.mat')
% DATASET = 'c1p11h1p13t_wraw_wmag025_cobj1e3MFC_SDCsmj1p5_e3R_v13b_topf_widcull';   DS = 'c1p11h1p13t wraw wmag025 SDCsmj1p5 cobj1e3MFC e3R v13b widcull';
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%% (Aug 6 2025) standard
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% read in sm0 swath metrics, then smoothed them along j only with 1p5 movemean (w025)
%rh500,600,5km,6km added, no sublfc cap,  now calculates max conv, conv
%object width/depth, and in-Cswath mosture convergence vars - Cobj > 1e-3
% 1/s, added swathboxaloft_QVap, fixed the wid_alongsdc vars for hovmoller plots to have dist from swath > 3km filter 
% also manually chops out the wids whose central latitudes are where I manually culled j&t swath identification - and includes a (j,t,R) mask of the culling info.
%v13d adds alongsdc topht asl that you used to debug the agl vs asl updraft sampling strategy (ultimatley, I think you were ok afterall)

clear
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_env3R_v13d_SDCsmj1p5_topf_widcull.mat')
DATASET = 'c1p11h1p13t_wraw_wmag025_cobj1e3MFC_SDCsmj1p5_e3R_v13d_topf_widcull';   DS = 'c1p11h1p13t wraw wmag025 SDCsmj1p5 cobj1e3MFC e3R v13d widcull';
%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%% (Aug 24 2025) standard
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% read in sm0 swath metrics, then smoothed them along j only with 1p5 movemean (w025)
%rh500,600,5km,6km added, no sublfc cap,  now calculates max conv, conv
%object width/depth, and in-Cswath mosture convergence vars - Cobj > 1e-3
% 1/s, added swathboxaloft_QVap, fixed the wid_alongsdc vars for hovmoller plots to have dist from swath > 3km filter 
% also manually chops out the wids whose central latitudes are where I manually culled j&t swath identification - and includes a (j,t,R) mask of the culling info.
%v13d adds alongsdc topht asl that you used to debug the agl vs asl updraft sampling strategy (ultimatley, I think you were ok afterall)
%13e modified RH/QV box profiles to z = 1-4kmagl and adds an LFC-centric version too.

clear
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_env3R_v13e_SDCsmj1p5_topf_widcull.mat')
DATASET = 'c1p11h1p13t_wraw_wmag025_cobj1e3MFC_SDCsmj1p5_e3R_v13e_topf_widcull';   DS = 'c1p11h1p13t wraw wmag025 SDCsmj1p5 cobj1e3MFC e3R v13e widcull';
%%%%%%




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%% CURRENT (Aug 28 2025) standard
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% read in sm0 swath metrics, then smoothed them along j only with 1p5 movemean (w025)
%rh500,600,5km,6km added, no sublfc cap,  now calculates max conv, conv
%object width/depth, and in-Cswath mosture convergence vars - Cobj > 1e-3
% 1/s, added swathboxaloft_QVap, fixed the wid_alongsdc vars for hovmoller plots to have dist from swath > 3km filter 
% also manually chops out the wids whose central latitudes are where I manually culled j&t swath identification - and includes a (j,t,R) mask of the culling info.
%v13d adds alongsdc topht asl that you used to debug the agl vs asl updraft sampling strategy (ultimatley, I think you were ok afterall)
%13e modified RH/QV box profiles to z = 1-4kmagl and adds an LFC-centric version too.
%13f adds dz and z of U = # m/s above the ridge

clear
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/SwathIDthermoOutput_c1p11h1p13tsmftopf_wraw_wmag025_cobj1e3MFC_env3R_v13f_SDCsmj1p5_topf_widcull.mat')
DATASET = 'c1p11h1p13t_wraw_wmag025_cobj1e3MFC_SDCsmj1p5_e3R_v13f_topf_widcull';   DS = 'c1p11h1p13t wraw wmag025 SDCsmj1p5 cobj1e3MFC e3R v13f widcull';
%%%%%%


%}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%note, calculation of this variable (after LFCAR stage) had a bug, so I'm
% deleting it for now until you rerun to fix it. (had to do with
% accidentally missing a : in the 'method" dimension. May not be an issue?
% but I'd rerun it before using (I've already fixed the code oon 29Jan2025, just needs
% eventual reruns)

%clear widLFCARdeep_mesoWcapeMAX_ALLCASES









%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%    pick your WID - projected area method from above

% meth = 1;     % dynamic 

meth = 3 ;

wid_mesoWstrength_ALLCASES          =  wid_mesoWstrength_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWvmsum_ALLCASES             =  wid_mesoWvmsum_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWvmsumHSUM_ALLCASES         =  wid_mesoWvmsumHSUM_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWalongsubupfract_ALLCASES   =  wid_mesoWalongsubupfract_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWwidth_ALLCASES             =  wid_mesoWwidth_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWtopagl_ALLCASES            =  wid_mesoWtopagl_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWtopasl_ALLCASES            =  wid_mesoWtopasl_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWcape_ALLCASES              =  wid_mesoWcape_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWcin_ALLCASES               =  wid_mesoWcin_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWqvap_ALLCASES              =  wid_mesoWqvap_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWlfcasl_ALLCASES            =  wid_mesoWlfcasl_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWlfcagl_ALLCASES            =  wid_mesoWlfcagl_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWtheta_ALLCASES             =  wid_mesoWtheta_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWthetae_ALLCASES            =  wid_mesoWthetae_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWdepth_ALLCASES             =  wid_mesoWdepth_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWtoplfcaglRAT_ALLCASES      =  wid_mesoWtoplfcaglRAT_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWtoplfcaslRAT_ALLCASES      =  wid_mesoWtoplfcaslRAT_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWstrengthMAX_ALLCASES       =  wid_mesoWstrengthMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWwidthMAX_ALLCASES          =  wid_mesoWwidthMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWtopaglMAX_ALLCASES         =  wid_mesoWtopaglMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWtopaslMAX_ALLCASES         =  wid_mesoWtopaslMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWcapeMAX_ALLCASES           =  wid_mesoWcapeMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWcinMIN_ALLCASES            =  wid_mesoWcinMIN_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWqvapMAX_ALLCASES           =  wid_mesoWqvapMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWlfcaslMIN_ALLCASES         =  wid_mesoWlfcaslMIN_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWlfcaglMIN_ALLCASES         =  wid_mesoWlfcaglMIN_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWthetaMAX_ALLCASES          =  wid_mesoWthetaMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWthetaeMAX_ALLCASES         =  wid_mesoWthetaeMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWdepthMAX_ALLCASES          =  wid_mesoWdepthMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWvmsumMAX_ALLCASES          =  wid_mesoWvmsumMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWtoplfcaglRATMAX_ALLCASES       =   wid_mesoWtoplfcaglRATMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWtoplfcaslRATMAX_ALLCASES       =   wid_mesoWtoplfcaslRATMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWeast1to5aslUshear_ALLCASES     =   wid_mesoWeast1to5aslUshear_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWeast1to5aslVshear_ALLCASES     =   wid_mesoWeast1to5aslVshear_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWeast1to9aslUshear_ALLCASES     =   wid_mesoWeast1to9aslUshear_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWeast1to9aslVshear_ALLCASES         =  wid_mesoWeast1to9aslVshear_ALLCASES(:,:,:,:,meth)    ; 
wid_eastupslopedepthfract_ALLCASES          =  wid_eastupslopedepthfract_ALLCASES(:,:,:,:,meth)    ; 
wid_westupslopedepthfract_ALLCASES          =  wid_westupslopedepthfract_ALLCASES(:,:,:,:,meth)    ; 
wid_eastupslopedepthfract2500masl_ALLCASES  =  wid_eastupslopedepthfract2500masl_ALLCASES(:,:,:,:,meth)    ; 
wid_westupslopedepthfract2500masl_ALLCASES  =  wid_westupslopedepthfract2500masl_ALLCASES(:,:,:,:,meth)    ; 
wid_eastupslopemean2500masl_ALLCASES        =  wid_eastupslopemean2500masl_ALLCASES(:,:,:,:,meth)    ; 
wid_westupslopemean2500masl_ALLCASES        =  wid_westupslopemean2500masl_ALLCASES(:,:,:,:,meth)    ; 
wid_eastupslopedepthfract1500magl_ALLCASES  =  wid_eastupslopedepthfract1500magl_ALLCASES(:,:,:,:,meth)    ; 
wid_westupslopedepthfract1500magl_ALLCASES  =  wid_westupslopedepthfract1500magl_ALLCASES(:,:,:,:,meth)    ; 
wid_eastupslopemean1500magl_ALLCASES        =  wid_eastupslopemean1500magl_ALLCASES(:,:,:,:,meth)    ; 
wid_westupslopemean1500magl_ALLCASES        =  wid_westupslopemean1500magl_ALLCASES(:,:,:,:,meth)    ; 
wid_eastupslopemean_ALLCASES                =  wid_eastupslopemean_ALLCASES(:,:,:,:,meth)    ; 
wid_westupslopemean_ALLCASES                =  wid_westupslopemean_ALLCASES(:,:,:,:,meth)    ; 
wid_eastUmean3to4kmasl_ALLCASES             =  wid_eastUmean3to4kmasl_ALLCASES(:,:,:,:,meth)    ; 
wid_eastUmean4to5kmasl_ALLCASES             =  wid_eastUmean4to5kmasl_ALLCASES(:,:,:,:,meth)    ; 
wid_eastUmean5to6kmasl_ALLCASES             =  wid_eastUmean5to6kmasl_ALLCASES(:,:,:,:,meth)    ; 
wid_eastupslopedepth_ALLCASES               =  wid_eastupslopedepth_ALLCASES(:,:,:,:,meth)    ; 
wid_westupslopedepth_ALLCASES               =  wid_westupslopedepth_ALLCASES(:,:,:,:,meth)    ; 
wid_eastupslopetophtasl_ALLCASES            =  wid_eastupslopetophtasl_ALLCASES(:,:,:,:,meth)    ; 
wid_westupslopetophtasl_ALLCASES            =  wid_westupslopetophtasl_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWmeanRHboxaloft_ALLCASES            =  wid_mesoWmeanRHboxaloft_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWmeanQVboxaloft_ALLCASES            =  wid_mesoWmeanQVboxaloft_ALLCASES(:,:,:,:,meth)    ;
% wid_meanUprof_ALLCASES                      =  wid_meanUprof_ALLCASES(:,:,:,:,meth)    ; 
% wid_meanVprof_ALLCASES                      =  wid_meanVprof_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoWdepthrat_ALLCASES                  =  wid_mesoWdepthrat_ALLCASES(:,:,:,:,meth)    ; 

wid_mesoCstrength_ALLCASES                         = wid_mesoCstrength_ALLCASES(:,:,:,:,meth)    ;  
wid_mesoCwidth_ALLCASES                            = wid_mesoCwidth_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoCdepth_ALLCASES                            = wid_mesoCdepth_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoCMFCmean_ALLCASES                          = wid_mesoCMFCmean_ALLCASES(:,:,:,:,meth)    ;  
wid_mesoCMCqadvmean_ALLCASES                       = wid_mesoCMCqadvmean_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoCMCqconvmean_ALLCASES                      = wid_mesoCMCqconvmean_ALLCASES(:,:,:,:,meth)    ;
wid_mesoCMFCmax_ALLCASES                          = wid_mesoCMFCmax_ALLCASES(:,:,:,:,meth)    ;  
wid_mesoCMCqadvmax_ALLCASES                       = wid_mesoCMCqadvmax_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoCMCqconvmax_ALLCASES                      = wid_mesoCMCqconvmax_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoCstrengthMAX_ALLCASES                         = wid_mesoCstrengthMAX_ALLCASES(:,:,:,:,meth)    ;  
wid_mesoCwidthMAX_ALLCASES                            = wid_mesoCwidthMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoCdepthMAX_ALLCASES                            = wid_mesoCdepthMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoCMFCmeanMAX_ALLCASES                          = wid_mesoCMFCmeanMAX_ALLCASES(:,:,:,:,meth)    ;  
wid_mesoCMCqadvmeanMAX_ALLCASES                       = wid_mesoCMCqadvmeanMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoCMCqconvmeanMAX_ALLCASES                      = wid_mesoCMCqconvmeanMAX_ALLCASES(:,:,:,:,meth)    ;
wid_mesoCMFCmaxMAX_ALLCASES                          = wid_mesoCMFCmaxMAX_ALLCASES(:,:,:,:,meth)    ;  
wid_mesoCMCqadvmaxMAX_ALLCASES                       = wid_mesoCMCqadvmaxMAX_ALLCASES(:,:,:,:,meth)    ; 
wid_mesoCMCqconvmaxMAX_ALLCASES                      = wid_mesoCMCqconvmaxMAX_ALLCASES(:,:,:,:,meth)    ; 

widLFCAR_mesoWstrength_ALLCASES                         = widLFCAR_mesoWstrength_ALLCASES(:,:,:,:,meth)    ;  
widLFCAR_mesoWwidth_ALLCASES                            = widLFCAR_mesoWwidth_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoWvmsum_ALLCASES                            = widLFCAR_mesoWvmsum_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoWvmsumHSUM_ALLCASES                        = widLFCAR_mesoWvmsumHSUM_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWalongsubupfract_ALLCASES                  = widLFCAR_mesoWalongsubupfract_ALLCASES(:,:,:,:,meth)  ;  
widLFCAR_mesoWtoplfcaslRAT_ALLCASES                     = widLFCAR_mesoWtoplfcaslRAT_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWlfcagl_ALLCASES                           = widLFCAR_mesoWlfcagl_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWqvap_ALLCASES                             = widLFCAR_mesoWqvap_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWcape_ALLCASES                             = widLFCAR_mesoWcape_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWcin_ALLCASES                              = widLFCAR_mesoWcin_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWmeanRHboxaloft_ALLCASES                   = widLFCAR_mesoWmeanRHboxaloft_ALLCASES(:,:,:,:,meth); 
widLFCAR_mesoWmeanQVboxaloft_ALLCASES                   = widLFCAR_mesoWmeanQVboxaloft_ALLCASES(:,:,:,:,meth); 
widLFCAR_mesoWdepthrat_ALLCASES                         = widLFCAR_mesoWdepthrat_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWtheta_ALLCASES                            = widLFCAR_mesoWtheta_ALLCASES(:,:,:,:,meth) ;
widLFCAR_eastupslopedepthfract_ALLCASES                 = widLFCAR_eastupslopedepthfract_ALLCASES(:,:,:,:,meth);
widLFCAR_westupslopedepthfract_ALLCASES                 = widLFCAR_westupslopedepthfract_ALLCASES(:,:,:,:,meth) ;
widLFCAR_eastupslopedepthfract2500masl_ALLCASES         = widLFCAR_eastupslopedepthfract2500masl_ALLCASES(:,:,:,:,meth);
widLFCAR_westupslopedepthfract2500masl_ALLCASES         = widLFCAR_westupslopedepthfract2500masl_ALLCASES(:,:,:,:,meth) ;
widLFCAR_eastupslopemean2500masl_ALLCASES               = widLFCAR_eastupslopemean2500masl_ALLCASES(:,:,:,:,meth) ;
widLFCAR_westupslopemean2500masl_ALLCASES               = widLFCAR_westupslopemean2500masl_ALLCASES(:,:,:,:,meth) ;
widLFCAR_eastupslopedepthfract1500magl_ALLCASES         = widLFCAR_eastupslopedepthfract1500magl_ALLCASES(:,:,:,:,meth);  
widLFCAR_westupslopedepthfract1500magl_ALLCASES         = widLFCAR_westupslopedepthfract1500magl_ALLCASES(:,:,:,:,meth);
widLFCAR_eastupslopemean1500magl_ALLCASES               = widLFCAR_eastupslopemean1500magl_ALLCASES(:,:,:,:,meth);
widLFCAR_westupslopemean1500magl_ALLCASES               = widLFCAR_westupslopemean1500magl_ALLCASES(:,:,:,:,meth);
widLFCAR_eastupslopemean_ALLCASES                       = widLFCAR_eastupslopemean_ALLCASES(:,:,:,:,meth);
widLFCAR_westupslopemean_ALLCASES                       = widLFCAR_westupslopemean_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES           = widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWeast1to9aslTOTMAGshear_ALLCASES           = widLFCAR_mesoWeast1to9aslTOTMAGshear_ALLCASES(:,:,:,:,meth) ;
widLFCAR_eastUmean3to4kmasl_ALLCASES                    = widLFCAR_eastUmean3to4kmasl_ALLCASES(:,:,:,:,meth) ;
widLFCAR_eastUmean4to5kmasl_ALLCASES                    = widLFCAR_eastUmean4to5kmasl_ALLCASES(:,:,:,:,meth);
widLFCAR_eastUmean5to6kmasl_ALLCASES                    = widLFCAR_eastUmean5to6kmasl_ALLCASES(:,:,:,:,meth) ;
% widLFCAR_eastupslopedepthasl_ALLCASES                   = widLFCAR_eastupslopedepthasl_ALLCASES(:,:,:,:,meth) ;
% widLFCAR_westupslopedepthasl_ALLCASES                   = widLFCAR_westupslopedepthasl_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWstrengthMAX_ALLCASES                      = widLFCAR_mesoWstrengthMAX_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWwidthMAX_ALLCASES                         = widLFCAR_mesoWwidthMAX_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWtopaglMAX_ALLCASES                        = widLFCAR_mesoWtopaglMAX_ALLCASES(:,:,:,:,meth); 
widLFCAR_mesoWtopaslMAX_ALLCASES                        = widLFCAR_mesoWtopaslMAX_ALLCASES(:,:,:,:,meth) ;
%widLFCAR_mesoWcapeMAX_ALLCASES                          = widLFCAR_mesoWcapeMAX_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWcinMIN_ALLCASES                           = widLFCAR_mesoWcinMIN_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWqvapMAX_ALLCASES                          = widLFCAR_mesoWqvapMAX_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWlfcaslMIN_ALLCASES                        = widLFCAR_mesoWlfcaslMIN_ALLCASES(:,:,:,:,meth); 
widLFCAR_mesoWlfcaglMIN_ALLCASES                        = widLFCAR_mesoWlfcaglMIN_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWthetaMAX_ALLCASES                         = widLFCAR_mesoWthetaMAX_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWthetaeMAX_ALLCASES                        = widLFCAR_mesoWthetaeMAX_ALLCASES(:,:,:,:,meth); 
widLFCAR_mesoWdepthMAX_ALLCASES                         = widLFCAR_mesoWdepthMAX_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWvmsumMAX_ALLCASES                         = widLFCAR_mesoWvmsumMAX_ALLCASES(:,:,:,:,meth) ;
widLFCAR_mesoWtoplfcaglRATMAX_ALLCASES                  = widLFCAR_mesoWtoplfcaglRATMAX_ALLCASES(:,:,:,:,meth);
widLFCAR_mesoWtoplfcaslRATMAX_ALLCASES                  = widLFCAR_mesoWtoplfcaslRATMAX_ALLCASES(:,:,:,:,meth);

widLFCAR_mesoCstrength_ALLCASES                         = widLFCAR_mesoCstrength_ALLCASES(:,:,:,:,meth)    ;  
widLFCAR_mesoCwidth_ALLCASES                            = widLFCAR_mesoCwidth_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoCdepth_ALLCASES                            = widLFCAR_mesoCdepth_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoCMFCmean_ALLCASES                          = widLFCAR_mesoCMFCmean_ALLCASES(:,:,:,:,meth)    ;  
widLFCAR_mesoCMCqadvmean_ALLCASES                       = widLFCAR_mesoCMCqadvmean_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoCMCqconvmean_ALLCASES                      = widLFCAR_mesoCMCqconvmean_ALLCASES(:,:,:,:,meth)    ;
widLFCAR_mesoCMFCmax_ALLCASES                          = widLFCAR_mesoCMFCmax_ALLCASES(:,:,:,:,meth)    ;  
widLFCAR_mesoCMCqadvmax_ALLCASES                       = widLFCAR_mesoCMCqadvmax_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoCMCqconvmax_ALLCASES                      = widLFCAR_mesoCMCqconvmax_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoCstrengthMAX_ALLCASES                         = widLFCAR_mesoCstrengthMAX_ALLCASES(:,:,:,:,meth)    ;  
widLFCAR_mesoCwidthMAX_ALLCASES                            = widLFCAR_mesoCwidthMAX_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoCdepthMAX_ALLCASES                            = widLFCAR_mesoCdepthMAX_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoCMFCmeanMAX_ALLCASES                          = widLFCAR_mesoCMFCmeanMAX_ALLCASES(:,:,:,:,meth)    ;  
widLFCAR_mesoCMCqadvmeanMAX_ALLCASES                       = widLFCAR_mesoCMCqadvmeanMAX_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoCMCqconvmeanMAX_ALLCASES                      = widLFCAR_mesoCMCqconvmeanMAX_ALLCASES(:,:,:,:,meth)    ;
widLFCAR_mesoCMFCmaxMAX_ALLCASES                           = widLFCAR_mesoCMFCmaxMAX_ALLCASES(:,:,:,:,meth)    ;  
widLFCAR_mesoCMCqadvmaxMAX_ALLCASES                        = widLFCAR_mesoCMCqadvmaxMAX_ALLCASES(:,:,:,:,meth)    ; 
widLFCAR_mesoCMCqconvmaxMAX_ALLCASES                       = widLFCAR_mesoCMCqconvmaxMAX_ALLCASES(:,:,:,:,meth)    ; 


widLFCARdeep_mesoWstrength_ALLCASES                         = widLFCARdeep_mesoWstrength_ALLCASES(:,:,:,:,meth)   ; 
widLFCARdeep_mesoWwidth_ALLCASES                            = widLFCARdeep_mesoWwidth_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWvmsum_ALLCASES                            = widLFCARdeep_mesoWvmsum_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWvmsumHSUM_ALLCASES                        = widLFCARdeep_mesoWvmsumHSUM_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWalongsubupfract_ALLCASES                  = widLFCARdeep_mesoWalongsubupfract_ALLCASES(:,:,:,:,meth);  
widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES                     = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWlfcagl_ALLCASES                           = widLFCARdeep_mesoWlfcagl_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWqvap_ALLCASES                             = widLFCARdeep_mesoWqvap_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWcape_ALLCASES                             = widLFCARdeep_mesoWcape_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWcin_ALLCASES                              = widLFCARdeep_mesoWcin_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES                   = widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES(:,:,:,:,meth); 
widLFCARdeep_mesoWmeanQVboxaloft_ALLCASES                   = widLFCARdeep_mesoWmeanQVboxaloft_ALLCASES(:,:,:,:,meth); 
widLFCARdeep_mesoWdepthrat_ALLCASES                         = widLFCARdeep_mesoWdepthrat_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWtheta_ALLCASES                            = widLFCARdeep_mesoWtheta_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_eastupslopedepthfract_ALLCASES                 = widLFCARdeep_eastupslopedepthfract_ALLCASES(:,:,:,:,meth);
widLFCARdeep_westupslopedepthfract_ALLCASES                 = widLFCARdeep_westupslopedepthfract_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_eastupslopedepthfract2500masl_ALLCASES         = widLFCARdeep_eastupslopedepthfract2500masl_ALLCASES(:,:,:,:,meth);
widLFCARdeep_westupslopedepthfract2500masl_ALLCASES         = widLFCARdeep_westupslopedepthfract2500masl_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_eastupslopemean2500masl_ALLCASES               = widLFCARdeep_eastupslopemean2500masl_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_westupslopemean2500masl_ALLCASES               = widLFCARdeep_westupslopemean2500masl_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_eastupslopedepthfract1500magl_ALLCASES         = widLFCARdeep_eastupslopedepthfract1500magl_ALLCASES(:,:,:,:,meth);  
widLFCARdeep_westupslopedepthfract1500magl_ALLCASES         = widLFCARdeep_westupslopedepthfract1500magl_ALLCASES(:,:,:,:,meth);
widLFCARdeep_eastupslopemean1500magl_ALLCASES               = widLFCARdeep_eastupslopemean1500magl_ALLCASES(:,:,:,:,meth);
widLFCARdeep_westupslopemean1500magl_ALLCASES               = widLFCARdeep_westupslopemean1500magl_ALLCASES(:,:,:,:,meth);
widLFCARdeep_eastupslopemean_ALLCASES                       = widLFCARdeep_eastupslopemean_ALLCASES(:,:,:,:,meth);
widLFCARdeep_westupslopemean_ALLCASES                       = widLFCARdeep_westupslopemean_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES           = widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWeast1to9aslTOTMAGshear_ALLCASES           = widLFCARdeep_mesoWeast1to9aslTOTMAGshear_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_eastUmean3to4kmasl_ALLCASES                    = widLFCARdeep_eastUmean3to4kmasl_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_eastUmean4to5kmasl_ALLCASES                    = widLFCARdeep_eastUmean4to5kmasl_ALLCASES(:,:,:,:,meth);
widLFCARdeep_eastUmean5to6kmasl_ALLCASES                    = widLFCARdeep_eastUmean5to6kmasl_ALLCASES(:,:,:,:,meth) ;
% widLFCARdeep_eastupslopedepthasl_ALLCASES                   = widLFCARdeep_eastupslopedepthasl_ALLCASES(:,:,:,:,meth) ;
% widLFCARdeep_westupslopedepthasl_ALLCASES                   = widLFCARdeep_westupslopedepthasl_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWstrengthMAX_ALLCASES                      = widLFCARdeep_mesoWstrengthMAX_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWwidthMAX_ALLCASES                         = widLFCARdeep_mesoWwidthMAX_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWtopaglMAX_ALLCASES                        = widLFCARdeep_mesoWtopaglMAX_ALLCASES(:,:,:,:,meth); 
widLFCARdeep_mesoWtopaslMAX_ALLCASES                        = widLFCARdeep_mesoWtopaslMAX_ALLCASES(:,:,:,:,meth) ;
%widLFCARdeep_mesoWcapeMAX_ALLCASES                          = widLFCARdeep_mesoWcapeMAX_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWcinMIN_ALLCASES                           = widLFCARdeep_mesoWcinMIN_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWqvapMAX_ALLCASES                          = widLFCARdeep_mesoWqvapMAX_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWlfcaslMIN_ALLCASES                        = widLFCARdeep_mesoWlfcaslMIN_ALLCASES(:,:,:,:,meth); 
widLFCARdeep_mesoWlfcaglMIN_ALLCASES                        = widLFCARdeep_mesoWlfcaglMIN_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWthetaMAX_ALLCASES                         = widLFCARdeep_mesoWthetaMAX_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWthetaeMAX_ALLCASES                        = widLFCARdeep_mesoWthetaeMAX_ALLCASES(:,:,:,:,meth); 
widLFCARdeep_mesoWdepthMAX_ALLCASES                         = widLFCARdeep_mesoWdepthMAX_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWvmsumMAX_ALLCASES                         = widLFCARdeep_mesoWvmsumMAX_ALLCASES(:,:,:,:,meth) ;
widLFCARdeep_mesoWtoplfcaglRATMAX_ALLCASES                  = widLFCARdeep_mesoWtoplfcaglRATMAX_ALLCASES(:,:,:,:,meth);
widLFCARdeep_mesoWtoplfcaslRATMAX_ALLCASES                  = widLFCARdeep_mesoWtoplfcaslRATMAX_ALLCASES(:,:,:,:,meth); 


widLFCARdeep_mesoCstrength_ALLCASES                         = widLFCARdeep_mesoCstrength_ALLCASES(:,:,:,:,meth)    ;  
widLFCARdeep_mesoCwidth_ALLCASES                            = widLFCARdeep_mesoCwidth_ALLCASES(:,:,:,:,meth)    ; 
widLFCARdeep_mesoCdepth_ALLCASES                            = widLFCARdeep_mesoCdepth_ALLCASES(:,:,:,:,meth)    ; 
widLFCARdeep_mesoCMFCmean_ALLCASES                          = widLFCARdeep_mesoCMFCmean_ALLCASES(:,:,:,:,meth)    ;  
widLFCARdeep_mesoCMCqadvmean_ALLCASES                       = widLFCARdeep_mesoCMCqadvmean_ALLCASES(:,:,:,:,meth)    ; 
widLFCARdeep_mesoCMCqconvmean_ALLCASES                      = widLFCARdeep_mesoCMCqconvmean_ALLCASES(:,:,:,:,meth)    ;
widLFCARdeep_mesoCMFCmax_ALLCASES                          = widLFCARdeep_mesoCMFCmax_ALLCASES(:,:,:,:,meth)    ;  
widLFCARdeep_mesoCMCqadvmax_ALLCASES                       = widLFCARdeep_mesoCMCqadvmax_ALLCASES(:,:,:,:,meth)    ; 
widLFCARdeep_mesoCMCqconvmax_ALLCASES                      = widLFCARdeep_mesoCMCqconvmax_ALLCASES(:,:,:,:,meth)    ; 
widLFCARdeep_mesoCstrengthMAX_ALLCASES                         = widLFCARdeep_mesoCstrengthMAX_ALLCASES(:,:,:,:,meth)    ;  
widLFCARdeep_mesoCwidthMAX_ALLCASES                            = widLFCARdeep_mesoCwidthMAX_ALLCASES(:,:,:,:,meth)    ; 
widLFCARdeep_mesoCdepthMAX_ALLCASES                            = widLFCARdeep_mesoCdepthMAX_ALLCASES(:,:,:,:,meth)    ; 
widLFCARdeep_mesoCMFCmeanMAX_ALLCASES                          = widLFCARdeep_mesoCMFCmeanMAX_ALLCASES(:,:,:,:,meth)    ;  
widLFCARdeep_mesoCMCqadvmeanMAX_ALLCASES                       = widLFCARdeep_mesoCMCqadvmeanMAX_ALLCASES(:,:,:,:,meth)    ; 
widLFCARdeep_mesoCMCqconvmeanMAX_ALLCASES                      = widLFCARdeep_mesoCMCqconvmeanMAX_ALLCASES(:,:,:,:,meth)    ;
widLFCARdeep_mesoCMFCmaxMAX_ALLCASES                           = widLFCARdeep_mesoCMFCmaxMAX_ALLCASES(:,:,:,:,meth)    ;  
widLFCARdeep_mesoCMCqadvmaxMAX_ALLCASES                        = widLFCARdeep_mesoCMCqadvmaxMAX_ALLCASES(:,:,:,:,meth)    ; 
widLFCARdeep_mesoCMCqconvmaxMAX_ALLCASES                       = widLFCARdeep_mesoCMCqconvmaxMAX_ALLCASES(:,:,:,:,meth)    ; 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%{

%%% i forgot to tell the nersc code to chop my manual ill zones from the
%%% SM0 fields in the non-SMF runs. I did from SM2, but not SM0 or 1. poo! Fix that manually
%%% here. I could do that in the nersc code, but dont have the time right
%%% now. Probably go back and do that and reprocess everything over
%%% again in the near future, then comment this section

% I think the above is moot now? but you still need to apply to the wID
% fields, at least to the wid_prof_ cloud metrics

chop_mask = FullSDC_VMfluxSum_ALLCASES;  chop_mask(:) = 1; 

%29N
chop_mask(1:200, :, 1) = NaN;
%4D
chop_mask(1:400, :, 2) = NaN;
%22J
chop_mask(1400:end, 31:end, 3) = NaN;
chop_mask(1:200, 49:end, 3) = NaN;
%23J
chop_mask(1:200, :, 4) = NaN;
chop_mask(1400:end, :, 4) = NaN;
chop_mask(1025:1100, 23:end, 4) = NaN;
%25J
chop_mask(1:100, 1:29, 5) = NaN;
chop_mask(1200:end, :, 5) = NaN;
%29J
chop_mask(1:175, 1:13, 6) = NaN;
chop_mask(1:150, 1:25, 6) = NaN;
chop_mask(1200:end, :, 6) = NaN;
%8F
chop_mask(1:200, 29:end, 7) = NaN;
chop_mask(1:400, 49:end, 7) = NaN;

FullSDC_mesoWwidth_ALLCASES     = FullSDC_mesoWwidth_ALLCASES .* chop_mask;
FullSDC_mesoWdepth_ALLCASES     = FullSDC_mesoWdepth_ALLCASES .* chop_mask;
FullSDC_mesoWstrength_ALLCASES  = FullSDC_mesoWstrength_ALLCASES .* chop_mask;
FullSDC_VMfluxSum_ALLCASES      = FullSDC_VMfluxSum_ALLCASES .* chop_mask;
FullSDC_swathqvap_ALLCASES      = FullSDC_swathqvap_ALLCASES .* chop_mask;
FullSDC_swaththetamean_ALLCASES = FullSDC_swaththetamean_ALLCASES .* chop_mask;
FullSDC_swaththetaemean_ALLCASES = FullSDC_swaththetaemean_ALLCASES .* chop_mask;

%}

%{

%%%%%%%% BEGIN OF OF LAT/TIME CULL

%%%% THIS NEEDS TO BE BROUGHT INTO THE POST-PROCESSING ABOVE BECAUSE THE
%%%% ALONG_SDC HOVMOLLER STUFF IS CALCUALTED THERE! ARGH. 

%same filter on WID lats/times: 

% lat_alongSDC
               %start lat(S)    endlat (N)          startt       endt    case num
killcodes = [lat_alongSDC(1),    lat_alongSDC(200),    1,       75,      1;            %29N
             lat_alongSDC(1),    lat_alongSDC(400),    1,       75,      2;            %4D
             lat_alongSDC(1400), lat_alongSDC(1600),   31,      75,      3;            %22J
             lat_alongSDC(1),    lat_alongSDC(200),    49,      75,      3;            %22J
             lat_alongSDC(1),    lat_alongSDC(200),    1,       75,      4;            %23J
             lat_alongSDC(1400), lat_alongSDC(1600),   1,       75,      4;            %23J
             lat_alongSDC(1025), lat_alongSDC(1100),   23,      75,      4;            %23J
             lat_alongSDC(1),    lat_alongSDC(100),    1,       29,      5;            %25J
             lat_alongSDC(1200), lat_alongSDC(1600),   1,       75,      5;            %25J
             lat_alongSDC(1),    lat_alongSDC(175),    1,       13,      6;            %29J
             lat_alongSDC(1),    lat_alongSDC(150),    1,       25,      6;            %29J
             lat_alongSDC(1200), lat_alongSDC(1600),   1,       75,      6;            %29J
             lat_alongSDC(1),    lat_alongSDC(200),    29,      75,      7;            %8F
             lat_alongSDC(1),    lat_alongSDC(400),    49,      75,      7];           %8F

[killa killb] = size(killcodes);
[wn wk wt wr] = size(wid_profs_centlat_ALLCASES);

widmeanlat = permute( mean(wid_profs_centlat_ALLCASES(:,:,:,:),2,'omitnan') ,[1 3 4 2 ])   ;
wid_lattime_cull_mask = widmeanlat;  wid_lattime_cull_mask(:) = 1;

for ka = 1:killa
    rkill = killcodes(ka,5) ;
    for tkill = killcodes(ka,3):1:killcodes(ka,4)
        for n = 1:wn
            if( widmeanlat(n,tkill,rkill)  >=  killcodes(ka,1)  &  widmeanlat(n,tkill,rkill)  <=  killcodes(ka,2) ) 
                wid_lattime_cull_mask(n,tkill,rkill) = NaN;
            end
        end
    end
end

%{
 wblah0 = widmeanlat(:,:,1);   
 wblah1 = wid_lattime_cull_mask(:,:,1);   

 wblah2 =  max( widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2,'omitnan' );
 wblah2 =  permute(  wblah2 , [1 3 4 2]   ) ;
 wblah2 =  wblah2(:,:,1);
 length(find( isnan(wblah2)==0 ))

 wblah3 = wblah2 .* wid_lattime_cull_mask(:,:,1)  ;
 length(find( isnan(wblah3)==0 ))
%}

%%%%%%%% END OF LAT/TIME CULL

%}


%%%%% TEST ME


% for t = 1:wt
%     for R = 1:wr
%         for n = 1:wn
%     
%             if( t <  &   mean(wid_profs_centlat_ALLCASES(t,:,t,R),'omitnan')    )
% 
%                 wid_lattime_cull_mask
% 
%             end
% 
%         end
%     end
% end


%     end
% end





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

distswathwid_thresh = 3.0 ;  % km max distance you'll allow a wid centroid to be from adjacent swath centroid

SIGTHRESH = 0.05;   % stat significance confidence interval





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% save netcdf file of some vars for later Shapley LR contribution analysis
%%% send this output to nersc as input for /global/cfs/projectdirs/m1657/jmarquis/jupylabs/wIDCorrelations_Jim.ipynb
%%% note, you'll need to update the pandas package in the JIMenv (pandas 1.2.5 is used for the WACCEM MP tracking code. 
% Update pandas before running the shapley code)


%pick the swath time rel to cloudy time:
TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; -# to go a # dt prior to cloud time (native 5min LASSO dt)
             % t=1 = curent time, 2= current time - 5min, 3= -10min, 4= -15min...

%Cloud vars
CLDupdraft_area       =  max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2) ;   % 
    CLDupdraft_area = permute(CLDupdraft_area ,[1 3 4 2]);
    cht_mask = CLDupdraft_area;  
    cht_mask(:) = NaN; 
    cht_mask( isnan(CLDupdraft_area)==0 )=1;  
CLDupdraft_Radius     =  ((CLDupdraft_area/3.14159).^0.5)/1000;      %circ equiv rad [km]
CLDupdraft_topZasl    =  wid_maxk_topasl_ALLCASES(:,:,:) .* cht_mask;

Nearcloud_acblRH      =   (FwID_RH_mean_ACBL_ALLCASES/100) .* cht_mask;
Nearcloud_acblCAPE    =   FwID_MUACBLCAPE_ALLCASES .* cht_mask;
Nearcloud_deepCAPE    =   FwID_MUCAPE_ALLCASES .* cht_mask;
Nearcloud_shear06     =   FwID_shear_mag_bulk_0to6km_ALLCASES .* cht_mask;
Nearcloud_acblTHE     =   FwID_thetae_mean_ACBL_mu_ALLCASES .* cht_mask;

Nearcloud_RH500     =   FwID_RH_500mb_ALLCASES .* cht_mask;
Nearcloud_RH600     =   FwID_RH_600mb_ALLCASES .* cht_mask;
Nearcloud_RH6km     =   FwID_RH_6kmasl_ALLCASES .* cht_mask;
Nearcloud_RH5km     =   FwID_RH_5kmasl_ALLCASES .* cht_mask;

MesoAscent_Wmag           = widLFCAR_mesoWstrength_ALLCASES(:,:,TIMLG,:);
    MesoAscent_Wmag = permute(MesoAscent_Wmag,[1 2 4 3]);
MesoAscent_width                = widLFCAR_mesoWwidth_ALLCASES(:,:,TIMLG,:);
    MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
MesoAscent_DepthPerLfc          = widLFCAR_mesoWtoplfcaslRAT_ALLCASES(:,:,TIMLG,:);
    MesoAscent_DepthPerLfc = permute(MesoAscent_DepthPerLfc,[1 2 4 3]);
MesoAscent_Wmag = MesoAscent_Wmag .* cht_mask;
MesoAscent_width = MesoAscent_width .* cht_mask;
MesoAscent_DepthPerLfc = MesoAscent_DepthPerLfc .* cht_mask;



% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
%just kill the mesoascent fields so that we can still compare cldy
%updrafts to near-cloud sounding metrics

dist = abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,:) );  dist = permute(dist,[1 2 4 3]);
kill = find(  dist  >  distswathwid_thresh  );
CLDupdraft_area(kill) = NaN;
CLDupdraft_Radius(kill) = NaN;
CLDupdraft_topZasl(kill) = NaN;
Nearcloud_acblRH(kill) = NaN;
Nearcloud_RH500(kill) = NaN;
Nearcloud_RH600(kill) = NaN;
Nearcloud_RH6km(kill) = NaN;
Nearcloud_RH5km(kill) = NaN;
Nearcloud_acblCAPE(kill) = NaN;
Nearcloud_deepCAPE(kill) = NaN;
Nearcloud_shear06(kill) = NaN;
Nearcloud_acblTHE(kill) = NaN;
MesoAscent_Wmag(kill) = NaN;
MesoAscent_width(kill) = NaN;
MesoAscent_DepthPerLfc(kill) = NaN;


ncfile  = ['/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/WIDmetricsForShapleyB_',DATASET,'.nc' ] ;


[nl tl rl] = size(CLDupdraft_area);
nccreate(ncfile,'CLDupdraft_area',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'CLDupdraft_area',CLDupdraft_area) ;
ncwriteatt(ncfile,'CLDupdraft_area','units','unitless');
ncwriteatt(ncfile,'CLDupdraft_area','description','');

[nl tl rl] = size(CLDupdraft_Radius);
nccreate(ncfile,'CLDupdraft_Radius',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'CLDupdraft_Radius',CLDupdraft_Radius) ;
ncwriteatt(ncfile,'CLDupdraft_Radius','units','unitless');
ncwriteatt(ncfile,'CLDupdraft_Radius','description','');

[nl tl rl] = size(CLDupdraft_topZasl);
nccreate(ncfile,'CLDupdraft_topZasl',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'CLDupdraft_topZasl',CLDupdraft_topZasl) ;
ncwriteatt(ncfile,'CLDupdraft_topZasl','units','unitless');
ncwriteatt(ncfile,'CLDupdraft_topZasl','description','');

[nl tl rl] = size(Nearcloud_acblRH);
nccreate(ncfile,'Nearcloud_acblRH',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'Nearcloud_acblRH',Nearcloud_acblRH) ;
ncwriteatt(ncfile,'Nearcloud_acblRH','units','unitless');
ncwriteatt(ncfile,'Nearcloud_acblRH','description','');

[nl tl rl] = size(Nearcloud_RH500);
nccreate(ncfile,'Nearcloud_RH500',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'Nearcloud_RH500',Nearcloud_RH500) ;
ncwriteatt(ncfile,'Nearcloud_RH500','units','unitless');
ncwriteatt(ncfile,'Nearcloud_RH500','description','');

[nl tl rl] = size(Nearcloud_RH600);
nccreate(ncfile,'Nearcloud_RH600',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'Nearcloud_RH600',Nearcloud_RH600) ;
ncwriteatt(ncfile,'Nearcloud_RH600','units','unitless');
ncwriteatt(ncfile,'Nearcloud_RH600','description','');

[nl tl rl] = size(Nearcloud_RH5km);
nccreate(ncfile,'Nearcloud_RH5km',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'Nearcloud_RH5km',Nearcloud_RH5km) ;
ncwriteatt(ncfile,'Nearcloud_RH5km','units','unitless');
ncwriteatt(ncfile,'Nearcloud_RH5km','description','');

[nl tl rl] = size(Nearcloud_RH6km);
nccreate(ncfile,'Nearcloud_RH6km',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'Nearcloud_RH6km',Nearcloud_RH6km) ;
ncwriteatt(ncfile,'Nearcloud_RH6km','units','unitless');
ncwriteatt(ncfile,'Nearcloud_RH6km','description','');

[nl tl rl] = size(Nearcloud_acblTHE);
nccreate(ncfile,'Nearcloud_acblTHE',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'Nearcloud_acblTHE',Nearcloud_acblTHE) ;
ncwriteatt(ncfile,'Nearcloud_acblTHE','units','unitless');
ncwriteatt(ncfile,'Nearcloud_acblTHE','description','');

[nl tl rl] = size(Nearcloud_acblCAPE);
nccreate(ncfile,'Nearcloud_acblCAPE',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'Nearcloud_acblCAPE',Nearcloud_acblCAPE) ;
ncwriteatt(ncfile,'Nearcloud_acblCAPE','units','unitless');
ncwriteatt(ncfile,'Nearcloud_acblCAPE','description','');

[nl tl rl] = size(Nearcloud_deepCAPE);
nccreate(ncfile,'Nearcloud_deepCAPE',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'Nearcloud_deepCAPE',Nearcloud_deepCAPE) ;
ncwriteatt(ncfile,'Nearcloud_deepCAPE','units','unitless');
ncwriteatt(ncfile,'Nearcloud_deepCAPE','description','');

[nl tl rl] = size(Nearcloud_shear06);
nccreate(ncfile,'Nearcloud_shear06',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'Nearcloud_shear06',Nearcloud_shear06) ;
ncwriteatt(ncfile,'Nearcloud_shear06','units','unitless');
ncwriteatt(ncfile,'Nearcloud_shear06','description','');

[nl tl rl] = size(MesoAscent_Wmag);
nccreate(ncfile,'MesoAscent_Wmag',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'MesoAscent_Wmag',MesoAscent_Wmag) ;
ncwriteatt(ncfile,'MesoAscent_Wmag','units','unitless');
ncwriteatt(ncfile,'MesoAscent_Wmag','description','');

[nl tl rl] = size(MesoAscent_width);
nccreate(ncfile,'MesoAscent_width',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'MesoAscent_width',MesoAscent_width) ;
ncwriteatt(ncfile,'MesoAscent_width','units','unitless');
ncwriteatt(ncfile,'MesoAscent_width','description','');

[nl tl rl] = size(MesoAscent_DepthPerLfc);
nccreate(ncfile,'MesoAscent_DepthPerLfc',...
    'Dimensions', {'n',nl,'t',tl,'r',rl},...
    'FillValue','disable');
ncwrite(ncfile,'MesoAscent_DepthPerLfc',MesoAscent_DepthPerLfc) ;
ncwriteatt(ncfile,'MesoAscent_DepthPerLfc','units','unitless');
ncwriteatt(ncfile,'MesoAscent_DepthPerLfc','description','');



%single-var lin regresion significane tests:
% used to make dots in shapley figure. 

% CLDupdraft_area 
% CLDupdraft_Radius 
% CLDupdraft_topZasl 
% Nearcloud_acblRH 
% Nearcloud_RH500 
% Nearcloud_RH600 
% Nearcloud_RH6km 
% Nearcloud_RH5km 
% Nearcloud_acblCAPE 
% Nearcloud_deepCAPE 
% Nearcloud_shear06 
% Nearcloud_acblTHE 
% MesoAscent_Wmag
% MesoAscent_width
% MesoAscent_DepthPerLfc





%{
%%%% diagnostic

R=3;   t = 20;

depth = FullSDC_mesoWdepth_ALLCASES(:,t,R) ;
figure; plot(depth,'ok')



topasl = FullSDC_swathtopasl_ALLCASES(:,t,R) ;
figure; plot(topasl,'ok')

hold on

botasl = FullSDC_swathbotasl_ALLCASES(:,t,R) ;
plot(botasl,'or')


lfcasl = FullSDC_swathtoplfcasl_ALLCASES(:,t,R) / 1000 ;
plot(lfcasl,'og')



topasl = FullSDC_swathtopasl_ALLCASES(:,t,R) ;
figure; plot(topasl,'ok')

hold on

lfcasl = FullSDC_swathtoplfcasl_ALLCASES(:,t,R) / 1000 ;
plot(lfcasl,'or')


figure; plot(topasl./lfcasl,'og')


%}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% updraft size histograms
areaZmax = max(widLFCAR_profs_area_ALLCASES,[],2,'omitnan' ) ;
areaZmax = max(widLFCARdeep_profs_area_ALLCASES,[],2,'omitnan' ) ; 
rZmax = (areaZmax/3.14159).^ 0.5 ;
figure; histogram(rZmax(:)/1000,50)
rp90 = prctile(rZmax(:)/1000,90.)

%filter LASSO raw cell fields to be somewhat equivalent to AMF-obs cell tracks:

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

tmean = [13, 16 , 31 , 2 , 25 , 13 , 25 ]; % roughly 1 hr prior to most of CI:  (t13 = 1400z, t25 = 1500z, t31 = 1530z, )  %
tstart = tmean - 6;  %when to start the calc  (-6  ~=  CI-1.5hr)
tstart(find(tstart <1))=1;
tend = tmean + 12;  % ~ CI-0hr time

% values used as basis for red/blue MLR on NERSC jupyter labs python code

var = mean(Nearcloud_acblRH,1,'omitnan') ;
arh_29N = mean(var(1,tmean(1):tend(1),1),'omitnan')
arh_04D = mean(var(1,tmean(2):tend(2),2),'omitnan')
arh_22J = mean(var(1,tmean(3):tend(3),3),'omitnan')
arh_23J = mean(var(1,tmean(4):tend(4),4),'omitnan')
arh_25J = mean(var(1,tmean(5):tend(5),5),'omitnan')
arh_29J = mean(var(1,tmean(6):tend(6),6),'omitnan')
arh_08F = mean(var(1,tmean(7):tend(7),7),'omitnan')
arhmedian = median([arh_29N, arh_04D, arh_22J, arh_23J, arh_25J, arh_29J, arh_08F])
arhmean = mean([arh_29N, arh_04D, arh_22J, arh_23J, arh_25J, arh_29J, arh_08F])


var = mean(Nearcloud_RH5km,1,'omitnan') ;
rh5km_29N = mean(var(1,tmean(1):tend(1),1),'omitnan')
rh5km_04D = mean(var(1,tmean(2):tend(2),2),'omitnan')
rh5km_22J = mean(var(1,tmean(3):tend(3),3),'omitnan')
rh5km_23J = mean(var(1,tmean(4):tend(4),4),'omitnan')
rh5km_25J = mean(var(1,tmean(5):tend(5),5),'omitnan')
rh5km_29J = mean(var(1,tmean(6):tend(6),6),'omitnan')
rh5km_08F = mean(var(1,tmean(7):tend(7),7),'omitnan')
rh5kmmedian = median([rh5km_29N, rh5km_04D, rh5km_22J, rh5km_23J, rh5km_25J, rh5km_29J, rh5km_08F])
rh5kmmean = mean([rh5km_29N, rh5km_04D, rh5km_22J, rh5km_23J, rh5km_25J, rh5km_29J, rh5km_08F])


var = mean(Nearcloud_acblCAPE,1,'omitnan') ;
acape_29N = mean(var(1,tmean(1):tend(1),1),'omitnan')
acape_04D = mean(var(1,tmean(2):tend(2),2),'omitnan')
acape_22J = mean(var(1,tmean(3):tend(3),3),'omitnan')
acape_23J = mean(var(1,tmean(4):tend(4),4),'omitnan')
acape_25J = mean(var(1,tmean(5):tend(5),5),'omitnan')
acape_29J = mean(var(1,tmean(6):tend(6),6),'omitnan')
acape_08F = mean(var(1,tmean(7):tend(7),7),'omitnan')
acapeallmedian = median([acape_29N, acape_04D, acape_22J, acape_23J, acape_25J, acape_29J, acape_08F])
acapeallmean = mean([acape_29N, acape_04D, acape_22J, acape_23J, acape_25J, acape_29J, acape_08F])


var = mean(Nearcloud_deepCAPE,1,'omitnan') ;
dcape_29N = mean(var(1,tmean(1):tend(1),1),'omitnan')
dcape_04D = mean(var(1,tmean(2):tend(2),2),'omitnan')
dcape_22J = mean(var(1,tmean(3):tend(3),3),'omitnan')
dcape_23J = mean(var(1,tmean(4):tend(4),4),'omitnan')
dcape_25J = mean(var(1,tmean(5):tend(5),5),'omitnan')
dcape_29J = mean(var(1,tmean(6):tend(6),6),'omitnan')
dcape_08F = mean(var(1,tmean(7):tend(7),7),'omitnan')
dcapeallmedian = median([dcape_29N, dcape_04D, dcape_22J, dcape_23J, dcape_25J, dcape_29J, dcape_08F])
dcapeallmean = mean([dcape_29N, dcape_04D, dcape_22J, dcape_23J, dcape_25J, dcape_29J, dcape_08F])

var = mean(Nearcloud_shear06,1,'omitnan') ;
s06_29N = mean(var(1,tmean(1):tend(1),1),'omitnan')
s06_04D = mean(var(1,tmean(2):tend(2),2),'omitnan')
s06_22J = mean(var(1,tmean(3):tend(3),3),'omitnan')
s06_23J = mean(var(1,tmean(4):tend(4),4),'omitnan')
s06_25J = mean(var(1,tmean(5):tend(5),5),'omitnan')
s06_29J = mean(var(1,tmean(6):tend(6),6),'omitnan')
s06_08F = mean(var(1,tmean(7):tend(7),7),'omitnan')
s06median = median([s06_29N, s06_04D, s06_22J, s06_23J, s06_25J, s06_29J, s06_08F])
s06mean = mean([s06_29N, s06_04D, s06_22J, s06_23J, s06_25J, s06_29J, s06_08F])


var = mean(MesoAscent_Wmag,1,'omitnan') ;
Smag_29N = mean(var(1,tmean(1):tend(1),1),'omitnan')
Smag_04D = mean(var(1,tmean(2):tend(2),2),'omitnan')
Smag_22J = mean(var(1,tmean(3):tend(3),3),'omitnan')
Smag_23J = mean(var(1,tmean(4):tend(4),4),'omitnan')
Smag_25J = mean(var(1,tmean(5):tend(5),5),'omitnan')
Smag_29J = mean(var(1,tmean(6):tend(6),6),'omitnan')
Smag_08F = mean(var(1,tmean(7):tend(7),7),'omitnan')
Smagallmedian = median([Smag_29N, Smag_04D, Smag_22J, Smag_23J, Smag_25J, Smag_29J, Smag_08F])
Smagmedian = median([Smag_29N, Smag_04D, Smag_22J, Smag_23J, Smag_25J, Smag_29J, Smag_08F])
Smagmean = mean([Smag_29N, Smag_04D, Smag_22J, Smag_23J, Smag_25J, Smag_29J, Smag_08F])


var = mean(MesoAscent_width,1,'omitnan') ;
Swid_29N = mean(var(1,tmean(1):tend(1),1),'omitnan')
Swid_04D = mean(var(1,tmean(2):tend(2),2),'omitnan')
Swid_22J = mean(var(1,tmean(3):tend(3),3),'omitnan')
Swid_23J = mean(var(1,tmean(4):tend(4),4),'omitnan')
Swid_25J = mean(var(1,tmean(5):tend(5),5),'omitnan')
Swid_29J = mean(var(1,tmean(6):tend(6),6),'omitnan')
Swid_08F = mean(var(1,tmean(7):tend(7),7),'omitnan')
Swidmedian = median([Swid_29N, Swid_04D, Swid_22J, Swid_23J, Swid_25J, Swid_29J, Swid_08F])
Swidmean = mean([Swid_29N, Swid_04D, Swid_22J, Swid_23J, Swid_25J, Swid_29J, Swid_08F])


var = mean(MesoAscent_DepthPerLfc,1,'omitnan') ;
Sdep_29N = mean(var(1,tmean(1):tend(1),1),'omitnan')
Sdep_04D = mean(var(1,tmean(2):tend(2),2),'omitnan')
Sdep_22J = mean(var(1,tmean(3):tend(3),3),'omitnan')
Sdep_23J = mean(var(1,tmean(4):tend(4),4),'omitnan')
Sdep_25J = mean(var(1,tmean(5):tend(5),5),'omitnan')
Sdep_29J = mean(var(1,tmean(6):tend(6),6),'omitnan')
Sdep_08F = mean(var(1,tmean(7):tend(7),7),'omitnan')
Sdepmedian = median([Sdep_29N, Sdep_04D, Sdep_22J, Sdep_23J, Sdep_25J, Sdep_29J, Sdep_08F])
Sdepmean = mean([Sdep_29N, Sdep_04D, Sdep_22J, Sdep_23J, Sdep_25J, Sdep_29J, Sdep_08F])


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%  science plots: 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





%%%% some mean vars on each day in FUllSDC space at CI-1hr in lat span including prominent CI
%%%% zone(s).

%                    29N    22J    25J    29J
% latN_allcases = [-31.4, -31.5, -31.8, -31.8];  %lat spans per case
% latS_allcases = [-32.8, -32.3, -32.8, -32.8];

%                  29N    4D    22J     23J    25J     29J   8F
latN_allcases = [-31.4, -31.4, -31.5, -31.5,  -31.9, -31.9,  -31.4];  %lat spans per case
latS_allcases = [-32.8, -32.6, -32.3, -32.8,  -32.8, -32.8,  -32.8 ];

%tmean = [13, 31, 25, 13 ]; % roughly 1 hr prior to most of CI:  (t13 = 1400z, t25 = 1500z, t31 = 1530z, )  %
   %    29N  4D  22J  23J  25J  29J  8F
tmean = [13, 16 , 31 , 2 , 25 , 13 , 25 ]; % roughly 1 hr prior to most of CI:  (t13 = 1400z, t25 = 1500z, t31 = 1530z, )  %


RRR = 4 ;

top = find( abs(lat_alongSDC-latN_allcases(RRR)) == min(abs(lat_alongSDC-latN_allcases(RRR)),[],'omitnan')) ;
bot = find( abs(lat_alongSDC-latS_allcases(RRR)) == min(abs(lat_alongSDC-latS_allcases(RRR)),[],'omitnan')) ;

mean_swathlift      =  mean(  FullSDC_mesoWstrength_ALLCASES(bot:top,tmean(RRR),RRR),'omitnan' ) ;
mean_swathwidth     =  mean(  FullSDC_mesoWwidth_ALLCASES(bot:top,tmean(RRR),RRR),'omitnan' ) ;
%mean_swathvmf       =  mean(FullSDC_VMfluxSum_ALLCASES(bot:top,tmean(RRR),RRR),'omitnan' )  ;
mean_swathDepthRelToLfc  = mean( 1000.*FullSDC_swathtopasl_ALLCASES(bot:top,tmean(RRR),RRR) ./  FullSDC_swathtoplfcasl_ALLCASES(bot:top,tmean(RRR),RRR) , 'omitnan' ) ;

mean_mucape         =  mean(  FullSDC_swathmucape_ALLCASES(bot:top,tmean(RRR),RRR),'omitnan')  ;
mean_rhaloft        =  mean( mean(  FullSDC_swathboxaloftRH_ALLCASES(bot:top,:,tmean(RRR),RRR),1,'omitnan' ) )  ;
mean_qvap           =  mean(  FullSDC_swathqvap_ALLCASES(bot:top,tmean(RRR),RRR),'omitnan' ) .* 1000  ;
%mean_theta          =  mean(FullSDC_swaththetamean_ALLCASES(bot:top,tmean(RRR),RRR),'omitnan' )  ;
mean_thetae         =  mean(  FullSDC_swaththetaemean_ALLCASES(bot:top,tmean(RRR),RRR),'omitnan' )  ;

maxwarea = permute( max( widLFCAR_profs_area_ALLCASES,[],2,'omitnan') , [1 3 4 2]) ;
maxwmag  = permute( max( widLFCAR_profs_maxmag_ALLCASES,[],2,'omitnan') , [1 3 4 2]) ;
maxwarea = maxwarea(:,tmean(RRR),RRR);
maxwmag  = maxwmag(:,tmean(RRR),RRR);
latsmean = mean( wid_profs_centlat_ALLCASES,2,'omitnan' );
latsmean = latsmean(:,:,tmean(RRR),RRR);

wkeeps  =  find(   latsmean > latS_allcases(RRR)  &  latsmean < latN_allcases(RRR) ) ; 

mean_widarea = round( mean( maxwarea(wkeeps)   ,'omitnan')/(1000*1000),2)
mean_widmag  = round( mean( maxwmag(wkeeps) ,'omitnan') , 1)


% 
% 
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%        correlogram of all vars vs all vars
% %%%
% %%%%     CORRELOGRAM OF deep + shallow WIDS vs env ?
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% %pick the swath time rel to cloudy time:
% TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; 1=0offset, 2:swath -5min back, 3:swath -10min back, 4:swath -15min back, 7 = -30min back
% 
% %%%% all cases together
% CLDupdraft_area = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2) ;       
%         CLDupdraft_area = permute(CLDupdraft_area,[1 3 4 2]);
% CLDupdraft_VertMassFlux = max(widLFCAR_profs_massflux_ALLCASES(:,:,:,:),[],2) ;
%         CLDupdraft_VertMassFlux = permute(CLDupdraft_VertMassFlux,[1 3 4 2]);
% CLDupdraft_MaxMagnitude = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,:),[],2) ;
%         CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);
% CLDupdraft_topZasl      =   wid_maxk_topasl_ALLCASES;
%         %CLDupdraft_topZasl      = permute(CLDupdraft_topZasl,[1 3 4 2]);
% CLDupdraft_bulkXtilt    = abs(widLFCAR_bulk_xcenttilt_ALLCASES);
%         CLDupdraft_bulkXtilt    = permute(CLDupdraft_bulkXtilt,[1 3 4 2]);
% CLDupdraft_bulkMAGtilt  = (widLFCAR_bulk_xcenttilt_ALLCASES.*widLFCAR_bulk_xcenttilt_ALLCASES +  widLFCAR_bulk_ycenttilt_ALLCASES.*widLFCAR_bulk_ycenttilt_ALLCASES ).^0.5 ;
%         CLDupdraft_bulkMAGtilt  = permute(CLDupdraft_bulkMAGtilt,[1 3 4 2]);
% 
% MesoAscent_Wmagnitude           = widLFCAR_mesoWstrength_ALLCASES(:,:,TIMLG,:);  
%     MesoAscent_Wmagnitude = permute(MesoAscent_Wmagnitude,[1 2 4 3]);
% MesoAscent_width                = widLFCAR_mesoWwidth_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
% MesoAscent_VertMassFlux         = widLFCAR_mesoWvmsum_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_VertMassFlux = permute(MesoAscent_VertMassFlux,[1 2 4 3]);
% MesoAscent_DepthPerLfc          = widLFCAR_mesoWtoplfcaslRAT_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_DepthPerLfc = permute(MesoAscent_DepthPerLfc,[1 2 4 3]);
% MesoAscent_LFCzagl              = widLFCAR_mesoWlfcagl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_LFCzagl = permute(MesoAscent_LFCzagl,[1 2 4 3]);
% MesoAscent_CAPE                 = widLFCAR_mesoWcape_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_CAPE = permute(MesoAscent_CAPE, [1 2 4 3]);
% MesoAscent_CIN                  = widLFCAR_mesoWcin_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_CIN = permute(MesoAscent_CIN, [1 2 4 3]);
% MesoAscent_Theta                = widLFCAR_mesoWtheta_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_Theta = permute(MesoAscent_Theta, [1 2 4 3]);
% MesoAscent_Qvapor               = widLFCAR_mesoWqvap_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_Qvapor = permute(MesoAscent_Qvapor, [1 2 4 3]);
% MesoAscent_RHaloft              = widLFCAR_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_RHaloft = permute(MesoAscent_RHaloft, [1 2 4 3]);
% 
% MesoAscent_EastUpslopeMag       = abs(widLFCAR_eastupslopemean_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeMag = permute(MesoAscent_EastUpslopeMag, [1 2 4 3]);
% MesoAscent_EastUpslopeDepthFract     = widLFCAR_eastupslopedepthfract_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_EastUpslopeDepthFract = permute(MesoAscent_EastUpslopeDepthFract, [1 2 4 3]);
% 
% MesoAscent_WestUpslopeMag       = widLFCAR_westupslopemean_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeMag = permute(MesoAscent_WestUpslopeMag, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract     = widLFCAR_westupslopedepthfract_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract = permute(MesoAscent_WestUpslopeDepthFract, [1 2 4 3]);    
% 
% MesoAscent_EastUpslopeDepth       = abs(widLFCAR_eastupslopedepth_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeDepth = permute(MesoAscent_EastUpslopeDepth, [1 2 4 3]); 
% MesoAscent_WestUpslopeDepth       = abs(widLFCAR_westupslopedepth_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeDepth = permute(MesoAscent_WestUpslopeDepth, [1 2 4 3]);
% 
% MesoAscent_EastUpslopeTopHt       = abs(widLFCAR_eastupslopetophtasl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeTopHt = permute(MesoAscent_EastUpslopeTopHt, [1 2 4 3]); 
% MesoAscent_WestUpslopeTopHt       = abs(widLFCAR_westupslopetophtasl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeTopHt = permute(MesoAscent_WestUpslopeDepth, [1 2 4 3]);
% 
% MesoAscent_EastUpslopeMag2500       = abs(widLFCAR_eastupslopemean2500masl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeMag2500 = permute(MesoAscent_EastUpslopeMag2500, [1 2 4 3]);
% MesoAscent_EastUpslopeDepthFract2500     = widLFCAR_eastupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_EastUpslopeDepthFract2500 = permute(MesoAscent_EastUpslopeDepthFract2500, [1 2 4 3]);
% MesoAscent_WestUpslopeMag2500       = abs(widLFCAR_westupslopemean2500masl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeMag2500 = permute(MesoAscent_WestUpslopeMag2500, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract2500     = widLFCAR_westupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract2500 = permute(MesoAscent_WestUpslopeDepthFract2500, [1 2 4 3]);    
% 
% MesoAscent_EastUpslopeMag1500       = abs(widLFCAR_eastupslopemean1500magl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeMag1500 = permute(MesoAscent_EastUpslopeMag1500, [1 2 4 3]);
% MesoAscent_EastUpslopeDepthFract1500     = widLFCAR_eastupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_EastUpslopeDepthFract1500 = permute(MesoAscent_EastUpslopeDepthFract1500, [1 2 4 3]);
% MesoAscent_WestUpslopeMag1500       = abs(widLFCAR_westupslopemean1500magl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeMag1500 = permute(MesoAscent_WestUpslopeMag1500, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract1500     = widLFCAR_westupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract1500 = permute(MesoAscent_WestUpslopeDepthFract1500, [1 2 4 3]);    
% 
% MesoAscent_1to5kmaslBulkShear   = widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_1to5kmaslBulkShear = permute(MesoAscent_1to5kmaslBulkShear, [1 2 4 3]);
% MesoAscent_1to9kmaslBulkShear   = widLFCAR_mesoWeast1to9aslTOTMAGshear_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_1to9kmaslBulkShear = permute(MesoAscent_1to9kmaslBulkShear, [1 2 4 3]);
% MesoAscent_InCloudBulkUShear    = widLFCAR_bulkUshearinupdraft_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_InCloudBulkUShear = permute(MesoAscent_InCloudBulkUShear, [1 2 4 3]);
% 
% MesoAscent_eastUmean3to4kmasl    = widLFCAR_eastUmean3to4kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean3to4kmasl = permute(MesoAscent_eastUmean3to4kmasl, [1 2 4 3]);
% MesoAscent_eastUmean4to5kmasl    = widLFCAR_eastUmean4to5kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean4to5kmasl = permute(MesoAscent_eastUmean4to5kmasl, [1 2 4 3]);
% MesoAscent_eastUmean5to6kmasl    = widLFCAR_eastUmean5to6kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean5to6kmasl = permute(MesoAscent_eastUmean5to6kmasl, [1 2 4 3]);
% 
% nearupdaft_0to3kmaglBulkShear   =   FwID_shear_mag_bulk_0to3km_ALLCASES(:);
% nearupdaft_0to6kmaglBulkShear   =   FwID_shear_mag_bulk_0to6km_ALLCASES(:);
% nearupdaft_0to9kmaglBulkShear   =   FwID_shear_mag_bulk_0to9km_ALLCASES(:);
% nearupdaft_mean_ACBL_RH         =   FwID_RH_mean_ACBL_ALLCASES(:);
% nearupdaft_MUCAPE               =   FwID_MUCAPE_ALLCASES(:);
% nearupdaft_MUCIN                =   FwID_MUCIN_ALLCASES(:);
% nearupdaft_MU_ACBL_CAPE         =   FwID_MUACBLCAPE_ALLCASES(:);
% nearupdaft_MUEL                 =   FwID_MUEL_ALLCASES(:);
% nearupdaft_MULFC                =   FwID_MULFC_ALLCASES(:);
% nearupdaft_MULCL                =   FwID_MULCL_ALLCASES(:);
% nearupdaft_MUvap                =   FwID_MUvap_ALLCASES(:);
% %nearupdaft_MUtheta              =   FwID_MUtheta_ALLCASES(:);
% %nearupdaft_MUthetae             =   FwID_MUthetae_ALLCASES(:);
% nearupdaft_ACBLthetae           =   FwID_thetae_mean_ACBL_mu_ALLCASES(:);
% 
% nearupdaft_upslopemean             =   abs(FwID_upslope_mean_ALLCASES(:));
% nearupdaft_upslopemax              =   abs(FwID_upslope_max_ALLCASES(:));
% nearupdaft_upslopedepth            =   FwID_upslope_depth_ALLCASES(:);
% nearupdaft_upslopefract            =   FwID_upslope_fract_ALLCASES(:);
% 
% 
% % filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
% % just killing the swath metrics (and upslope vars) so that we can still look at cloud vs near-cloud-sounding metrics
% kill = find(  abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,:) )  >  distswathwid_thresh  ); 
% % CLDupdraft_area(kill) = NaN;
% % CLDupdraft_VertMassFlux(kill) = NaN;
% % CLDupdraft_MaxMagnitude(kill) = NaN;       
% % CLDupdraft_topZasl(kill) = NaN;
% % CLDupdraft_bulkXtilt(kill) = NaN;
% % CLDupdraft_bulkMAGtilt(kill) = NaN;
% MesoAscent_Wmagnitude(kill)           = NaN;
% MesoAscent_width(kill)                = NaN;
% MesoAscent_VertMassFlux(kill)         = NaN;
% MesoAscent_DepthPerLfc(kill)          = NaN;
% MesoAscent_LFCzagl(kill)              = NaN;
% % MesoAscent_CAPE                 = NaN;
% % MesoAscent_CIN                  = NaN;
% % MesoAscent_Theta                = NaN;
% % MesoAscent_Qvapor               = NaN;
% % MesoAscent_RHaloft              = NaN;
% MesoAscent_EastUpslopeMag(kill)       = NaN;
% MesoAscent_EastUpslopeDepth(kill)     = NaN;
% MesoAscent_WestUpslopeMag(kill)       = NaN;
% MesoAscent_WestUpslopeDepth(kill)     = NaN;
% % MesoAscent_1to5kmaslBulkShear   = NaN;
% % MesoAscent_1to9kmaslBulkShear   = NaN;
% % MesoAscent_InCloudBulkUShear    = NaN;



%%%%%%%%%%%%% Use these for env metrics grabbed from lasso -wrfout domain (not calculated by Jim's specialized code):
%{
ALL_vars = {'CLDupdraft_area'; 
'CLDupdraft_VertMassFlux';
'CLDupdraft_MaxMagnitude';
%'CLDupdraft_topZasl';

'MesoAscent_Wmagnitude';
'MesoAscent_width';
'MesoAscent_VertMassFlux';
'MesoAscent_DepthPerLfc';

'MesoAscent_eastUmean5to6kmasl';
'MesoAscent_eastUmean4to5kmasl';
'MesoAscent_eastUmean3to4kmasl';
'MesoAscent_1to9kmaslBulkShear';
'MesoAscent_1to5kmaslBulkShear';

'MesoAscent_EastUpslopeDepth';
'MesoAscent_EastUpslopeMag';
'MesoAscent_WestUpslopeMag';

'MesoAscent_EastUpslopeDepth'; 
'MesoAscent_WestUpslopeDepth'; 
'MesoAscent_EastUpslopeTopHt';
'MesoAscent_WestUpslopeTopHt';     

'MesoAscent_EastUpslopeMag2500';
'MesoAscent_EastUpslopeDepthFract2500';
'MesoAscent_WestUpslopeMag2500';
'MesoAscent_WestUpslopeDepthFract2500';  

'MesoAscent_EastUpslopeMag1500';
'MesoAscent_EastUpslopeDepthFract1500';
'MesoAscent_WestUpslopeMag1500';
'MesoAscent_WestUpslopeDepthFract1500';   

'MesoAscent_LFCzagl';
'MesoAscent_CIN';

'MesoAscent_Theta';
'MesoAscent_Qvapor';
'MesoAscent_RHaloft';
'MesoAscent_CAPE' };

%}    
%end of LASSO-domain based WRF parameters





% %%%%%%%%%%%%% Use these for Jim sounding code based env metrics:
% 
% ALL_vars = {'CLDupdraft_area'; 
% 'CLDupdraft_VertMassFlux';
% 'CLDupdraft_MaxMagnitude';
% %'CLDupdraft_topZasl';
% 
% 'MesoAscent_Wmagnitude';
% 'MesoAscent_width';
% 'MesoAscent_VertMassFlux';
% 'MesoAscent_DepthPerLfc';
% 
% % 'MesoAscent_1to9kmaslBulkShear';
% % 'MesoAscent_1to5kmaslBulkShear';
% 
% 'nearupdaft_0to3kmaglBulkShear';
% 'nearupdaft_0to6kmaglBulkShear';
% 'nearupdaft_0to9kmaglBulkShear';
% 
% 'nearupdaft_upslopefract';
% 'nearupdaft_upslopemax';
% %'MesoAscent_EastUpslopeDepth';
% %'MesoAscent_EastUpslopeMag';
% %%'MesoAscent_WestUpslopeMag';
% 
% % 'MesoAscent_LFCzagl';
% % 'MesoAscent_CIN';
% % 'MesoAscent_Theta';
% % 'MesoAscent_Qvapor';
% % 'MesoAscent_RHaloft'
% % 'MesoAscent_CAPE';
% 
% 'nearupdaft_ACBLthetae';
% 'nearupdaft_mean_ACBL_RH';
% 'nearupdaft_MUvap';
% 
% 'nearupdaft_MULCL';
% 'nearupdaft_MULFC';
% 'nearupdaft_MUCIN';
% 'nearupdaft_MU_ACBL_CAPE';
% 'nearupdaft_MUCAPE';
% };


%{
ALL_vars = flipdim(ALL_vars,1) ;

ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;
SIGTHRESH = 0.05;
for n = 1:length(ALL_vars)
    for m = 1:length(ALL_vars)
        %  n = 1; m = 3
        AA = char(ALL_vars(n)) ; 
        AA = eval(AA);
        BB = char(ALL_vars(m)) ;  
        BB = eval(BB);
        kill = isnan(BB);
        BB(kill) = []; AA(kill) = [];
        kill = isnan(AA);
        BB(kill) = []; AA(kill) = [];
        [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
        ALL_corrs(n,m) = corab ;
        ALL_Ps(n,m) = pval;
        if(pval < SIGTHRESH)
            ALL_statsig(n,m) = NaN;
        else
            ALL_corrs(n,m) = NaN;
            ALL_statsig(n,m) = 0; %0;    
        end
    end
end
ALL_corrs = single(ALL_corrs);
isupper = logical(triu(ones(size(ALL_corrs)),1));
ALL_corrs(isupper) = NaN;
ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN;

ALL_statsig = single(ALL_statsig);
isupper = logical(triu(ones(size(ALL_statsig)),1));
ALL_statsig(isupper) = NaN;
ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;

varlab = {};
for l = 1:length(ALL_vars)
   asd = char(ALL_vars(l,:) )   ;
   asd(find(asd=='_'))=' '   ;
   varlab = vertcat(varlab,asd);
end

%round 
ALL_corrs = round(ALL_corrs,2);

dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
title(['wID-lasso Correlogram - all cases combined  (Filt: LFClayer,small area),  cloud time lag = ',num2str((TIMLG-1)*5),'min'])

saveas(h, horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
outlab = horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%}






%%%%%%%% WDSD upplementary plot of max Rcloud along SDC in each case and the
%%%%%%%% cape/rh/swath/shear metrics 15 min  prior; run: 
%    .../ICLASS/LASSO_stuff/disposibleWDSDtest1_RcMAXalltime.m



i






%%%%%%%%%%%%%%
%%%%%%%%%%%%%%    play with some of these correlograpm stats to wring out
%%%%%%%%%%%%%%    importance of other variables' effects on Rcloud - R/W_meso relationships 
%%%%%%%%%%%%%%



%%% play with .../LASSO_stuff/experimental_case_violin_sensitivity around
%%% here I think.
















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% confidence correlogram starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% per case:
ALL_CORRS = [];
ALL_SIG = [];
num_updrafts = [];

for R = 1:ar

    % R = 4;

    %pick the swath time rel to cloudy time:
    TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; 1=0offset, 2:swath -5min back, 3:swath -10min back, 4:swath -15min back, 7 = -30min back

%     %%%% all cases together
%     CLDupdraft_area = max(widLFCAR_profs_area_ALLCASES(:,:,:,R),[],2) ;
%          CLDupdraft_area = permute(CLDupdraft_area,[1 3 4 2]);
%     CLDupdraft_VertMassFlux = max(widLFCAR_profs_massflux_ALLCASES(:,:,:,R),[],2) ;
%          CLDupdraft_VertMassFlux = permute(CLDupdraft_VertMassFlux,[1 3 4 2]);
%     CLDupdraft_MaxMagnitude = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,R),[],2) ;
%          CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);


    %%%% all cases together
    CLDupdraft_area = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2) ;
         CLDupdraft_area = permute(CLDupdraft_area,[1 3 4 2]);
         CLDupdraft_area = CLDupdraft_area(:,:,R);

    CLDupdraft_VertMassFlux = max(widLFCARdeep_profs_massflux_ALLCASES(:,:,:,:),[],2) ;
         CLDupdraft_VertMassFlux = permute(CLDupdraft_VertMassFlux,[1 3 4 2]);
         CLDupdraft_VertMassFlux = CLDupdraft_VertMassFlux(:,:,R);

    CLDupdraft_MaxMagnitude = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,:),[],2) ;
         CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);
         CLDupdraft_MaxMagnitude = CLDupdraft_MaxMagnitude(:,:,R);

    
    % dont know if I need this extra filter... I think yes if I'm including in correlationss between cloud top and env vars:
       cht_mask = CLDupdraft_area;   cht_mask( isnan(CLDupdraft_area)==0 )=1;   
    CLDupdraft_topZasl      =   wid_maxk_topasl_ALLCASES(:,:,R)    .* cht_mask;




    num_updrafts = vertcat( num_updrafts, length(find(isnan(CLDupdraft_MaxMagnitude)==0)) ); 

    %         %CLDupdraft_topZasl      = permute(CLDupdraft_topZasl,[1 3 4 2]);
    % CLDupdraft_bulkXtilt    = abs(widLFCAR_bulk_xcenttilt_ALLCASES);
    %         CLDupdraft_bulkXtilt    = permute(CLDupdraft_bulkXtilt,[1 3 4 2]);
    % CLDupdraft_bulkMAGtilt  = (widLFCAR_bulk_xcenttilt_ALLCASES.*widLFCAR_bulk_xcenttilt_ALLCASES +  widLFCAR_bulk_ycenttilt_ALLCASES.*widLFCAR_bulk_ycenttilt_ALLCASES ).^0.5 ;
    %         CLDupdraft_bulkMAGtilt  = permute(CLDupdraft_bulkMAGtilt,[1 3 4 2]);

    MesoAscent_Wmagnitude           = widLFCARdeep_mesoWstrength_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_Wmagnitude = permute(MesoAscent_Wmagnitude,[1 2 4 3]);
    MesoAscent_width                = widLFCARdeep_mesoWwidth_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
    MesoAscent_VertMassFlux         = widLFCARdeep_mesoWvmsum_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_VertMassFlux         = widLFCAR_mesoWvmsumHSUM_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_VertMassFlux = permute(MesoAscent_VertMassFlux,[1 2 4 3]);
    %MesoAscent_subupfract_ALLCASES         = widLFCAR_mesoWalongsubupfract_ALLCASES(:,:,TIMLG,R);
    MesoAscent_DepthPerLfc          = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_DepthPerLfc = permute(MesoAscent_DepthPerLfc,[1 2 4 3]);
    MesoAscent_LFCzagl              = widLFCARdeep_mesoWlfcagl_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_LFCzagl = permute(MesoAscent_LFCzagl,[1 2 4 3]);
    MesoAscent_CAPE                 = widLFCARdeep_mesoWcape_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_CAPE = permute(MesoAscent_CAPE, [1 2 4 3]);
    MesoAscent_CIN                  = widLFCARdeep_mesoWcin_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_CIN = permute(MesoAscent_CIN, [1 2 4 3]);
    MesoAscent_Theta                = widLFCARdeep_mesoWtheta_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_Theta = permute(MesoAscent_Theta, [1 2 4 3]);
    MesoAscent_Qvapor               = widLFCARdeep_mesoWqvap_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_Qvapor = permute(MesoAscent_Qvapor, [1 2 4 3]);
    MesoAscent_RHaloft              = widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_RHaloft = permute(MesoAscent_RHaloft, [1 2 4 3]);
    MesoAscent_1to5kmaslBulkShear   = widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_1to5kmaslBulkShear = permute(MesoAscent_1to5kmaslBulkShear, [1 2 4 3]);
    MesoAscent_1to9kmaslBulkShear   = widLFCARdeep_mesoWeast1to9aslTOTMAGshear_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_1to9kmaslBulkShear = permute(MesoAscent_1to9kmaslBulkShear, [1 2 4 3]);
    %MesoAscent_InCloudBulkUShear    = widLFCAR_bulkUshearinupdraft_ALLCASES(:,:,TIMLG,R) ;
    %MesoAscent_InCloudBulkUShear = permute(MesoAscent_InCloudBulkUShear, [1 2 4 3]);

    MesoAscent_EastUpslopeMag            = abs(widLFCARdeep_eastupslopemean_ALLCASES(:,:,TIMLG,R));   %note: mean of just the layer with upslope present, not some static ht layer
    MesoAscent_EastUpslopeDepthFract     = widLFCARdeep_eastupslopedepthfract_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeMag            = widLFCARdeep_westupslopemean_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeDepthFract     = widLFCARdeep_westupslopedepthfract_ALLCASES(:,:,TIMLG,R) ;

    MesoAscent_EastUpslopeDepth          = widLFCARdeep_eastupslopedepth_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_WestUpslopeDepth          = widLFCARdeep_westupslopedepth_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_EastUpslopeTopHt          = widLFCARdeep_eastupslopetophtasl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeTopHt          = widLFCARdeep_westupslopetophtasl_ALLCASES(:,:,TIMLG,R);

    MesoAscent_EastUpslopeMag2500            = abs(widLFCARdeep_eastupslopemean2500masl_ALLCASES(:,:,TIMLG,R));
    MesoAscent_EastUpslopeDepthFract2500     = widLFCARdeep_eastupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeMag2500            = widLFCARdeep_westupslopemean2500masl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeDepthFract2500     = widLFCARdeep_westupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,R);

    MesoAscent_EastUpslopeMag1500            = abs(widLFCARdeep_eastupslopemean1500magl_ALLCASES(:,:,TIMLG,R));
    MesoAscent_EastUpslopeDepthFract1500     = widLFCARdeep_eastupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeMag1500            = widLFCARdeep_westupslopemean1500magl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeDepthFract1500     = widLFCARdeep_westupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,R);

    MesoAscent_eastUmean3to4kmasl    = widLFCARdeep_eastUmean3to4kmasl_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_eastUmean4to5kmasl    = widLFCARdeep_eastUmean4to5kmasl_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_eastUmean5to6kmasl    = widLFCARdeep_eastUmean5to6kmasl_ALLCASES(:,:,TIMLG,R) ;

    %note, these already are time-offset from wID time by -15 min:
    nearupdaft_0to3kmaglBulkShear   =   FwID_shear_mag_bulk_0to3km_ALLCASES(:,:,R);
    nearupdaft_0to6kmaglBulkShear   =   FwID_shear_mag_bulk_0to6km_ALLCASES(:,:,R);
    nearupdaft_0to9kmaglBulkShear   =   FwID_shear_mag_bulk_0to9km_ALLCASES(:,:,R);
    nearupdaft_mean_ACBL_RH         =   FwID_RH_mean_ACBL_ALLCASES(:,:,R);
    nearupdaft_MUCAPE               =   FwID_MUCAPE_ALLCASES(:,:,R);
    nearupdaft_MUCIN                =   FwID_MUCIN_ALLCASES(:,:,R);
    nearupdaft_MU_ACBL_CAPE         =   FwID_MUACBLCAPE_ALLCASES(:,:,R);
    nearupdaft_MUEL                 =   FwID_MUEL_ALLCASES(:,:,R);
    %nearupdaft_MUvap                =   FwID_MUvap_ALLCASES(:,:,R);
    %nearupdaft_MUthetae              =   FwID_MUthetae_ALLCASES(:,:,R);
    nearupdaft_MULFC                =   FwID_MULFC_ALLCASES(:,:,R);
    nearupdaft_MULCL                =   FwID_MULCL_ALLCASES(:,:,R);
    nearupdaft_ACBLthetae           =   FwID_thetae_mean_ACBL_mu_ALLCASES(:,:,R);
    nearupdaft_upslopemean             =   abs(FwID_upslope_mean_ALLCASES(:,:,R));
    nearupdaft_upslopemax              =   abs(FwID_upslope_max_ALLCASES(:,:,R));
    nearupdaft_upslopedepth            =   FwID_upslope_depth_ALLCASES(:,:,R);
    nearupdaft_upslopefract            =   FwID_upslope_fract_ALLCASES(:,:,R);



    % filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
    %just kill the mesoascent fields so that we can still compare cldy
    %updrafts to near-cloud sounding metrics
    kill = find(  abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,R) )  >  distswathwid_thresh  );
    CLDupdraft_area(kill) = NaN;
    CLDupdraft_VertMassFlux(kill) = NaN;
    CLDupdraft_MaxMagnitude(kill) = NaN;
    CLDupdraft_topZasl(kill) = NaN;
    % CLDupdraft_bulkXtilt(kill) = NaN;
    % CLDupdraft_bulkMAGtilt(kill) = NaN;
    MesoAscent_Wmagnitude(kill)           = NaN;
    MesoAscent_width(kill)                = NaN;
    MesoAscent_VertMassFlux(kill)         = NaN;
    MesoAscent_DepthPerLfc(kill)          = NaN;
    MesoAscent_LFCzagl(kill)              = NaN;
    % MesoAscent_CAPE                 = NaN;
    % MesoAscent_CIN                  = NaN;
    % MesoAscent_Theta                = NaN;
    % MesoAscent_Qvapor               = NaN;
    % MesoAscent_RHaloft              = NaN;
    MesoAscent_EastUpslopeMag(kill)       = NaN;
    MesoAscent_EastUpslopeDepth(kill)     = NaN;
    MesoAscent_WestUpslopeMag(kill)       = NaN;
    MesoAscent_WestUpslopeDepth(kill)     = NaN;
    % MesoAscent_1to5kmaslBulkShear   = NaN;
    % MesoAscent_1to9kmaslBulkShear   = NaN;
    % MesoAscent_InCloudBulkUShear    = NaN;
    MesoAscent_eastUmean3to4kmasl(kill)     = NaN;
    MesoAscent_eastUmean4to5kmasl(kill)     = NaN;
    MesoAscent_eastUmean5to6kmasl(kill)     = NaN;


% use these for full LASSO-domain version:
%     ALL_vars = {'CLDupdraft_area';
%         'CLDupdraft_VertMassFlux';
%         'CLDupdraft_MaxMagnitude';
%         'CLDupdraft_topZasl';
% 
%         'MesoAscent_Wmagnitude';
%         'MesoAscent_width';
%         'MesoAscent_VertMassFlux';
%         'MesoAscent_DepthPerLfc';
% 
%         'MesoAscent_eastUmean5to6kmasl';
%         'MesoAscent_eastUmean4to5kmasl';
%         'MesoAscent_eastUmean3to4kmasl';
%         'MesoAscent_1to9kmaslBulkShear';
%         'MesoAscent_1to5kmaslBulkShear';
% 
%         'MesoAscent_EastUpslopeMag';
%         'MesoAscent_WestUpslopeMag';
%         'MesoAscent_EastUpslopeDepth';
%         'MesoAscent_WestUpslopeDepth';
% %         'MesoAscent_EastUpslopeTopHt';
% %         'MesoAscent_WestUpslopeTopHt';
% 
% %         'MesoAscent_EastUpslopeMag2500';
% %         'MesoAscent_EastUpslopeDepthFract2500';
% %         'MesoAscent_WestUpslopeMag2500';
% %         'MesoAscent_WestUpslopeDepthFract2500';
% 
% %         'MesoAscent_EastUpslopeMag1500';
% %         'MesoAscent_EastUpslopeDepthFract1500';
% %         'MesoAscent_WestUpslopeMag1500';
% %         'MesoAscent_WestUpslopeDepthFract1500';
% 
%         'MesoAscent_LFCzagl';
%         'MesoAscent_CIN';
% 
%         'MesoAscent_Theta';
%         'MesoAscent_Qvapor';
%         'MesoAscent_RHaloft';
%         'MesoAscent_CAPE'
%         };




    %%%%%%%%%%%%% Use these for Jim sounding code based env metrics:
    
    ALL_vars = {'CLDupdraft_area';
    'CLDupdraft_VertMassFlux';
    %'CLDupdraft_MaxMagnitude';
    'CLDupdraft_topZasl';
    
    'MesoAscent_Wmagnitude';
    'MesoAscent_width';
    %'MesoAscent_VertMassFlux';
    'MesoAscent_DepthPerLfc';
    
    % 'MesoAscent_1to9kmaslBulkShear';
    % 'MesoAscent_1to5kmaslBulkShear';
    
    'nearupdaft_0to3kmaglBulkShear';
    'nearupdaft_0to6kmaglBulkShear';
    'nearupdaft_0to9kmaglBulkShear';

%     'MesoAscent_eastUmean3to4kmasl';
%     'MesoAscent_eastUmean4to5kmasl';
%     'MesoAscent_eastUmean5to6kmasl';
    
%     'nearupdaft_upslopefract';
%     'nearupdaft_upslopemax';
   'MesoAscent_EastUpslopeDepth';
   'MesoAscent_WestUpslopeDepth';
   'MesoAscent_EastUpslopeMag';
   'MesoAscent_WestUpslopeMag';
    
%     'MesoAscent_LFCzagl';
%     'MesoAscent_CIN';
% %     'MesoAscent_Theta';
% %     'MesoAscent_Qvapor';
%     'MesoAscent_RHaloft'
%     'MesoAscent_CAPE';

    %'nearupdaft_MUthetae'
%    'nearupdaft_ACBLthetae';
    'nearupdaft_mean_ACBL_RH';

    %'nearupdaft_MUthetae';  
    %'nearupdaft_MUvap';
    'nearupdaft_MULCL';
    'nearupdaft_MULFC';
%    'nearupdaft_MUCIN';
    'nearupdaft_MU_ACBL_CAPE';
    'nearupdaft_MUCAPE';
    };


    ALL_vars = flipdim(ALL_vars,1) ;

    ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
    ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
    ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;

    SIGTHRESH = 0.05;
    for n = 1:length(ALL_vars)
        for m = 1:length(ALL_vars)
            %  n = 1; m = 3
            AA = char(ALL_vars(n)) ;
            AA = eval(AA);
            BB = char(ALL_vars(m)) ;
            BB = eval(BB);
            kill = isnan(BB);
            BB(kill) = []; AA(kill) = [];
            kill = isnan(AA);
            BB(kill) = []; AA(kill) = [];
            [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
            ALL_corrs(n,m) = corab ;
            ALL_Ps(n,m) = pval;
            if(pval < SIGTHRESH)          %significant
                ALL_statsig(n,m) = NaN;   % marking signif as nan for now (dont remember why - i think matlab couldnt handle 1 and 0 for something at some stage), it will be switched to 1 later for plotting purposes
            else 
                ALL_corrs(n,m) = NaN;   %insig = nan
                ALL_statsig(n,m) = 0; %0;   %insig = 1
            end
        end
    end
    ALL_corrs = single(ALL_corrs);
    isupper = logical(triu(ones(size(ALL_corrs)),1));
    ALL_corrs(isupper) = NaN;
    ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN;

    ALL_statsig = single(ALL_statsig);
    isupper = logical(triu(ones(size(ALL_statsig)),1));
    ALL_statsig(isupper) = NaN;
    ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;


    varlab = {};
    for l = 1:length(ALL_vars)
        asd = char(ALL_vars(l,:) )   ;
        asd(find(asd=='_'))=' '   ;
        varlab = vertcat(varlab,asd);
    end

    %round
    ALL_corrs = round(ALL_corrs,2);

    ALL_CORRS = cat(3,ALL_CORRS,ALL_corrs);
    ALL_SIG = cat(3,ALL_SIG,ALL_statsig);

    dualpol_colmap
    ff = figure('Position',[246,77,1187,900])
    h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['Correlogram - ', Rlab ,' (Filt: LFClayer,small area,deeponly)  cloud time lag = ',num2str((TIMLG-1)*5),'min ',RUNS(R,1:8)])

%     saveas(ff, horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.png') );
%     outlab = horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);

end




dualpol_colmap
ff = figure('Position',[246,77,1187,900])
meancorr = mean(ALL_CORRS,3,'omitnan');  
h = heatmap(round(meancorr,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['Correlogram - (Filt: LFClayer,small area,deeponly)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%%% helpful diagnostic plots:

% count blocks with statistical significance:
dualpol_colmap
%ff = figure('Position',[246,77,1187,900])
ALL_SIG(isnan(ALL_SIG)) = 1;   %swap significant marker from nan to 1
SUMSIG = sum(ALL_SIG,3,'omitnan');  
%{
h = heatmap(round(SUMSIG,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['sum of significant cases ',num2str((TIMLG-1)*5)])
%}
% saveas(ff, horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);



% number of blocks with same correlation sign as the ensemble mean :
ALL_COR_SIGN  = sign( ALL_CORRS );
meancorr = mean(ALL_CORRS,3,'omitnan');
MEANCOR = [];
for y = 1:ar  % stitch together for dimension matching. 
    MEANCOR = cat(3,MEANCOR, meancorr);  %note, this is not dicthing values from the mean that dont have the same sign as mean (i.e., the means have both + and - values)
end
MEANCOR_SIGN = sign(MEANCOR);
[ci cj cy] = size(MEANCOR);
MATCHED_SIGNS = MEANCOR_SIGN;   MATCHED_SIGNS(:) = NaN; %array with 1 where case blocks match mean block
match = find(MEANCOR_SIGN == ALL_COR_SIGN);
MATCHED_SIGNS(match) = 1;
SUM_MATCHED_SIGNS = sum(MATCHED_SIGNS,3,'omitnan');



% count blocks with matched sign to mean:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(SUM_MATCHED_SIGNS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['MATCHED SIGNS- ( Filt: LFClayer,small area,deeponly)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%per-case log of useable confidence
for R = 1:ar

    [asd fgh] = size(ALL_CORRS(:,:,1))
    dayconf = zeros(asd,fgh);    

    good = find( MATCHED_SIGNS(:,:,R) == 1 & ALL_SIG(:,:,R) == 1  ) ; 
    %good = find( ALL_SIG(:,:,R) == 1  ) ; 
    dayconf(good) = 1;

    %{
    figure
    h = heatmap(round(dayconf,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    %h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['matched sign and stat sig for case: ', RUNS(R,:) ])
    %}

end





%%%%%%%% now use this to divide into high, med, low confidence
%%%%%%%% interpretations:

%%% NOTE (21mar2025) - I think the actual mean correlatoin value being plotted is mean of all that are
%%% significant, not mean of just those with a sign consistent with the
%%% mean. You may or may not want to change this in the future

HICONF_MEAN_CORRS = zeros(ci,cj);    HICONF_MEAN_CORRS(:) = NaN; 
MECONF_MEAN_CORRS = zeros(ci,cj);    MECONF_MEAN_CORRS(:) = NaN; 
LOCONF_MEAN_CORRS = zeros(ci,cj);    LOCONF_MEAN_CORRS(:) = NaN; 
for i = 1:ci
    for j = 1:cj
        %  i = 19; j = 18

   
        
        HSIGN = ( SUM_MATCHED_SIGNS(i,j)   >= 5  )   ;
        MSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 5  &  SUM_MATCHED_SIGNS(i,j)   >= 3 );
        LSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 3 );

        HSIG = ( SUMSIG(i,j)   >=  5  )   ;
        MSIG = ( SUMSIG(i,j) < 5  &   SUMSIG(i,j) >= 3 );
        LSIG = ( SUMSIG(i,j) < 3 );        

        %{
        % Hi/Med/Lo breakdown - use for article plot hi & med breakdown using both mean-matched sign and statistical significance counts:
        if( HSIGN==1  &  HSIG==1 & MSIGN==0  &  MSIG==0 & LSIGN==0  & LSIG==0)
            HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==0  &  HSIG==0 & MSIGN==1  &  MSIG==1 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(LSIGN==1  | LSIG==1 )
            LOCONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        end
        %}

        % same but only caring about the statistical significant count
        if(HSIG==1 )

            HICONF_MEAN_CORRS(i,j) = meancorr (i,j);
       
        elseif( MSIG==1 )
            
            MECONF_MEAN_CORRS(i,j) = meancorr(i,j);
       
%         elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%            
%             MECONF_MEAN_CORRS(i,j) = meancorr(i,j);
%        
%         elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = meancorr(i,j);

        elseif(LSIG==1 )
            LOCONF_MEAN_CORRS(i,j) = meancorr (i,j);
        end



%{

        %use for ppt presentations simplified:
        HSIGN = ( SUM_MATCHED_SIGNS(i,j)   >= 4  )   ;
%         MSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 5  &  SUM_MATCHED_SIGNS(i,j)   >= 3 );
        LSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 3 );

        HSIG = ( SUMSIG(i,j)   >=  4  )   ;
        %MSIG = ( SUMSIG(i,j) < 5  &   SUMSIG(i,j) >= 3 );
        LSIG = ( SUMSIG(i,j) < 3 );        

%         if( HSIGN==1  &  HSIG==1 & MSIGN==0  &  MSIG==0 & LSIGN==0  & LSIG==0)
%             HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        if( HSIGN==1  &  HSIG==1 )
            HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==0  &  HSIG==0 & MSIGN==1  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(LSIGN==1  | LSIG==1 )
            LOCONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        end
%}



    end
end



% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(HICONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
fontsize(ff,14,"points")
title(['HI CONF Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])


saveas(ff, horzcat(imout,'/widcorrelogram_HIConf_allcasemean_LFCARdepfilt.png') );
outlab = horzcat(imout,'/widcorrelogram_HIConf_allcasemean_LFCARdeepfilt.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);


% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(MECONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
fontsize(ff,14,"points")
title(['MED CONF Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

saveas(ff, horzcat(imout,'/widcorrelogram_MEDConf_allcasemean_LFCARdeepfilt.png') );
outlab = horzcat(imout,'/widcorrelogram_MEDConf_allcasemean_LFCARdeepfilt.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);


% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(LOCONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['LOW CONF Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

saveas(ff, horzcat(imout,'/widcorrelogram_LOWConf_allcasemean_LFCARdeepfilt.png') );
outlab = horzcat(imout,'/widcorrelogram_LOWConf_allcasemean_LFCARdeepfilt.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);




















% %%%%%% scatter plots of cloud updraft vs swath properties
% figure
% hold on
% for R = 1:4
%     CLDupdraft_area = max(widLFCAR_profs_area_ALLCASES(:,:,:,R),[],2) ;
%     CLDupdraft_MaxMagnitude = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,R),[],2) ;
% 
%     CLDupdraft_rad = (CLDupdraft_area/3.14159).^0.5;
% 
%     MesoAscent_Wmagnitude   = widLFCAR_mesoWstrength_ALLCASES(:,:,TIMLG,R);
%     MesoAscent_width        = widLFCAR_mesoWwidth_ALLCASES(:,:,TIMLG,R);
% 
%     if(R == 1)
%         scatter(permute(CLDupdraft_rad/1000,[1 3 2]),MesoAscent_width/2,'or')
%     elseif(R == 2)
%         scatter(permute(CLDupdraft_rad/1000,[1 3 2]),MesoAscent_width/2,'ob')
%     elseif(R == 3)
%         scatter(permute(CLDupdraft_rad/1000,[1 3 2]),MesoAscent_width/2,'og')
%     elseif(R == 4)
%         scatter(permute(CLDupdraft_rad/1000,[1 3 2]),MesoAscent_width/2,'om')
%     end
% end












%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%   correlograms, but not wIDs, just FullSDC arrays.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%        correlogram of all vars vs all vars - all cases together
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% %pick the swath time rel to cloudy time:
% TIMLG = 1;  % 1 to match cloudy time with concurrent swath time; 1=0offset, 2:swath -5min back, 3:swath -10min back, 4:swath -15min back, 7 = -30min back
% 
% 
% MesoAscent_Wmagnitude           = FullSDC_mesoWstrength_ALLCASES(:);  
% MesoAscent_width                = FullSDC_mesoWwidth_ALLCASES(:);
% MesoAscent_VertMassFlux         = FullSDC_VMfluxSum_ALLCASES(:);
% MesoAscent_DepthPerLfc          = FullSDC_swathtoplfcasl_ALLCASES(:) ./ FullSDC_swathtopasl_ALLCASES(:);
% 
% %raw env metrics
% MesoAscent_LFCzagl              = FullSDC_swathmulfcagl_ALLCASES(:);
% MesoAscent_CAPE                 = FullSDC_swathmucape_ALLCASES(:);
% MesoAscent_CIN                  = FullSDC_swathmucin_ALLCASES(:);
% MesoAscent_Theta                = FullSDC_swaththetamean_ALLCASES(:);
% MesoAscent_ThetaE               = FullSDC_swaththetaemean_ALLCASES(:);
% MesoAscent_Qvapor               = FullSDC_swathqvap_ALLCASES(:);
% MesoAscent_RHaloft              = mean(FullSDC_swathboxaloftRH_ALLCASES,2,'omitnan');
%     MesoAscent_RHaloft = permute(MesoAscent_RHaloft,[1 3 4 2]);
%     MesoAscent_RHaloft = MesoAscent_RHaloft(:);
% MesoAscent_EastUpslopeMag       = abs(FullSDC_eastupslopemean_ALLCASES(:));
% MesoAscent_EastUpslopeDepth     = FullSDC_eastupslopedepthfract_ALLCASES(:);
% MesoAscent_WestUpslopeMag       = FullSDC_westupslopemean_ALLCASES(:);
% MesoAscent_WestUpslopeDepth     = FullSDC_westupslopedepthfract_ALLCASES(:);
% MesoAscent_1to5kmaslBulkShear   = FullSDC_eastV1to5kmasl_bulkshear_ALLCASES(:);
% MesoAscent_1to9kmaslBulkShear   = FullSDC_eastV1to9kmasl_bulkshear_ALLCASES(:);
% 
% %d(env_metrics)/dt
% dtt = 5/60;
% [meh, MesoAscent_ddt_CAPE, meh2]                = gradient(FullSDC_swathmucape_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_LFCzagl, meh2]             = gradient(FullSDC_swathmulfcagl_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_CIN, meh2]                 = gradient(FullSDC_swathmucin_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_Theta, meh2]               = gradient(FullSDC_swaththetamean_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_ThetaE, meh2]              = gradient(FullSDC_swaththetaemean_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_Qvapor, meh2]              = gradient(FullSDC_swathqvap_ALLCASES,1,dtt,1);
% MesoAscent_RHaloft = mean(FullSDC_swathboxaloftRH_ALLCASES,2,'omitnan');
% MesoAscent_RHaloft = permute(MesoAscent_RHaloft,[1 3 4 2]);
% [meh, MesoAscent_ddt_RHaloft, meh2]            = gradient(MesoAscent_RHaloft,1,dtt,1);
% [meh, MesoAscent_ddt_EastUpslopeMag, meh2]       = gradient(FullSDC_eastupslopemean_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_EastUpslopeDepth, meh2]     = gradient(FullSDC_eastupslopedepthfract_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_WestUpslopeMag, meh2]       = gradient(FullSDC_westupslopemean_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_WestUpslopeDepth, meh2]     = gradient(FullSDC_westupslopedepthfract_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_1to5kmaslBulkShear, meh2]   = gradient(FullSDC_eastV1to5kmasl_bulkshear_ALLCASES,1,dtt,1);
% [meh, MesoAscent_ddt_1to9kmaslBulkShear, meh2]   = gradient(FullSDC_eastV1to9kmasl_bulkshear_ALLCASES,1,dtt,1);
% clear meh meh2
% MesoAscent_ddt_CAPE = MesoAscent_ddt_CAPE(:);
% MesoAscent_ddt_LFCzagl = MesoAscent_ddt_LFCzagl(:);
% MesoAscent_ddt_CIN = MesoAscent_ddt_CIN(:);
% MesoAscent_ddt_Theta = MesoAscent_ddt_Theta(:);
% MesoAscent_ddt_ThetaE = MesoAscent_ddt_ThetaE(:);
% MesoAscent_ddt_Qvapor = MesoAscent_ddt_Qvapor(:);
% MesoAscent_ddt_RHaloft = MesoAscent_ddt_RHaloft(:);
% MesoAscent_ddt_EastUpslopeMag = MesoAscent_ddt_EastUpslopeMag(:);
% MesoAscent_ddt_EastUpslopeDepth = MesoAscent_ddt_EastUpslopeDepth(:);
% MesoAscent_ddt_WestUpslopeMag = MesoAscent_ddt_WestUpslopeMag(:);
% MesoAscent_ddt_WestUpslopeDepth = MesoAscent_ddt_WestUpslopeDepth(:);
% MesoAscent_ddt_1to5kmaslBulkShear = MesoAscent_ddt_1to5kmaslBulkShear(:);
% MesoAscent_ddt_1to9kmaslBulkShear = MesoAscent_ddt_1to9kmaslBulkShear(:);
% 
% 
% 
%     ALL_vars = {'MesoAscent_Wmagnitude';
%         'MesoAscent_width';
%         'MesoAscent_VertMassFlux';
%         'MesoAscent_DepthPerLfc';
% 
%         'MesoAscent_1to9kmaslBulkShear';
%         'MesoAscent_1to5kmaslBulkShear';
%         'MesoAscent_EastUpslopeDepth';
%         'MesoAscent_EastUpslopeMag';
%         'MesoAscent_WestUpslopeMag';
%         %'MesoAscent_WestUpslopeDepth';
% 
%         'MesoAscent_LFCzagl';
%         'MesoAscent_CIN';
%         'MesoAscent_Theta';
%         %'MesoAscent_ThetaE';
%         'MesoAscent_Qvapor';
%         'MesoAscent_RHaloft';
%         'MesoAscent_CAPE'};
% 
% %{
% ALL_vars = {'MesoAscent_Wmagnitude';
% 'MesoAscent_width';
% 'MesoAscent_VertMassFlux';
% 'MesoAscent_DepthPerLfc';
% 
% 'MesoAscent_ddt_1to9kmaslBulkShear';
% 'MesoAscent_ddt_1to5kmaslBulkShear';
% 'MesoAscent_ddt_EastUpslopeDepth';
% 'MesoAscent_ddt_EastUpslopeMag';
% 'MesoAscent_ddt_WestUpslopeMag';
% 'MesoAscent_ddt_WestUpslopeDepth';
% 
% 'MesoAscent_ddt_CAPE';
% 'MesoAscent_ddt_CIN';
% 'MesoAscent_ddt_LFCzagl';
% 'MesoAscent_ddt_Theta';
% 'MesoAscent_ddt_ThetaE';
% 'MesoAscent_ddt_Qvapor';
% 'MesoAscent_ddt_RHaloft'};
% %}
% 
% ALL_vars = flipdim(ALL_vars,1) ;
% 
% ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
% SIGTHRESH = 0.05;
% for n = 1:length(ALL_vars)
%     for m = 1:length(ALL_vars)
%         %  n = 1; m = 3
%         AA = char(ALL_vars(n)) ; 
%         AA = eval(AA);
%         BB = char(ALL_vars(m)) ;  
%         BB = eval(BB);
%         kill = isnan(BB);
%         BB(kill) = []; AA(kill) = [];
%         kill = isnan(AA);
%         BB(kill) = []; AA(kill) = [];
%         [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
%         ALL_corrs(n,m) = corab ;
%         ALL_Ps(n,m) = pval;
%         if(pval < SIGTHRESH)
%             ALL_statsig(n,m) = NaN;
%         else
%             ALL_corrs(n,m) = NaN;
%             ALL_statsig(n,m) = 0; %0;    
%         end
%     end
% end
% ALL_corrs = single(ALL_corrs);
% isupper = logical(triu(ones(size(ALL_corrs)),1));
% ALL_corrs(isupper) = NaN;
% ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN
% 
% ALL_corrs = round(ALL_corrs,2);
% 
% varlab = {};
% for l = 1:length(ALL_vars)
%    asd = char(ALL_vars(l,:) )   ;
%    asd(find(asd=='_'))=' '   ;
%    varlab = vertcat(varlab,asd);
% end
% 
% dualpol_colmap
% ff = figure('Position',[246,77,1187,900])
% h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
% h.NodeChildren(3).YDir='normal';
% colormap(flipud(pepsi2))
% caxis([-1 1])
% h.XDisplayLabels = varlab;
% h.YDisplayLabels = varlab;
% ax = gca;
% axp = struct(ax);       %you will get a warning
% axp.Axes.XAxisLocation = 'top';
% title(['Correlogram - all cases combined FULL SDC VARS (Filt: LFClayer,small area), time lag = ',num2str((TIMLG-1)*5),'min'])
% 
% saveas(h, horzcat(imout,'/Correlgram_Allcases_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/Correlgram_Allcases_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);












%{


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%     FULLSDC   correlogram of all vars vs all vars - per case
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
%pick the swath time rel to cloudy time:
%TIMLG = 1;  % 1 to match cloudy time with concurrent swath time; 1=0offset, 2:swath -5min back, 3:swath -10min back, 4:swath -15min back, 7 = -30min back

%timelag swath vars:
MesoAscent_WmagnitudeR           = FullSDC_mesoWstrength_ALLCASES;
MesoAscent_widthR                = FullSDC_mesoWwidth_ALLCASES;
MesoAscent_VertMassFluxR         = FullSDC_VMfluxSum_ALLCASES;
MesoAscent_DepthPerLfcR          = FullSDC_swathtopasl_ALLCASES ./ FullSDC_swathtoplfcasl_ALLCASES ;
MesoAscent_TopMinusBotR          = FullSDC_swathtopasl_ALLCASES - FullSDC_swathbotasl_ALLCASES;
MesoAscent_TopR                  = FullSDC_swathtopasl_ALLCASES ;
MesoAscent_WmagnitudeR(:) = NaN;
MesoAscent_widthR(:) = NaN;
MesoAscent_VertMassFluxR(:) = NaN;
MesoAscent_DepthPerLfcR(:) = NaN;
lagnumdt = 3; % num of dt's to look back from current time  t3 = 15min, 76 = 30min,  set to 0 if you want no lag
for t = (lagnumdt+1) : 75
    MesoAscent_WmagnitudeR(:,t,:)           = FullSDC_mesoWstrength_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_widthR(:,t,:)                = FullSDC_mesoWwidth_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_VertMassFluxR(:,t,:)         = FullSDC_VMfluxSum_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_DepthPerLfcR(:,t,:)          = FullSDC_swathtopasl_ALLCASES(:,t-lagnumdt,:) ./ FullSDC_swathtoplfcasl_ALLCASES(:,t-lagnumdt,:) ;
    MesoAscent_TopMinusBotR(:,t,:)         = FullSDC_swathtopasl_ALLCASES(:,t-lagnumdt,:) - FullSDC_swathbotasl_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_TopR(:,t,:)                  = FullSDC_swathtopasl_ALLCASES(:,t-lagnumdt,:) ;
end

%timelag upslope & env vars:
% MesoAscent_WmagnitudeR           = FullSDC_mesoWstrength_ALLCASES;
MesoAscent_EastUpslopeMagR            = abs(FullSDC_eastupslopemean_ALLCASES);
MesoAscent_EastUpslopeDepthFractR     = FullSDC_eastupslopedepthfract_ALLCASES;
MesoAscent_WestUpslopeMagR            = FullSDC_westupslopemean_ALLCASES;
MesoAscent_WestUpslopeDepthFractR     = FullSDC_westupslopedepthfract_ALLCASES;
MesoAscent_EastUpslopeDepthR          = FullSDC_eastupslopedepth_ALLCASES;
MesoAscent_WestUpslopeDepthR          = FullSDC_westupslopedepth_ALLCASES;
MesoAscent_EastUpslopeTopHtR          = FullSDC_eastupslopetophtasl_ALLCASES;
MesoAscent_WestUpslopeTopHtR          = FullSDC_westupslopetophtasl_ALLCASES;
MesoAscent_EastUpslopeMag2500R            = abs(FullSDC_eastupslopemean2500masl_ALLCASES );
MesoAscent_EastUpslopeDepthFract2500R     = FullSDC_eastupslopedepthfract2500masl_ALLCASES ;
MesoAscent_WestUpslopeMag2500R            = FullSDC_westupslopemean2500masl_ALLCASES ;
MesoAscent_WestUpslopeDepthFract2500R     = FullSDC_westupslopedepthfract2500masl_ALLCASES ;
MesoAscent_EastUpslopeMag1500R            = abs(FullSDC_eastupslopemean1500magl_ALLCASES );
MesoAscent_EastUpslopeDepthFract1500R     = FullSDC_eastupslopedepthfract1500magl_ALLCASES ;
MesoAscent_WestUpslopeMag1500R            = FullSDC_westupslopemean1500magl_ALLCASES ;
MesoAscent_WestUpslopeDepthFract1500R     = FullSDC_westupslopedepthfract1500magl_ALLCASES ;
MesoAscent_eastUmean3to4kmaslR            = FullSDC_eastUmean3to4kmasl_ALLCASES ;
MesoAscent_eastUmean4to5kmaslR            = FullSDC_eastUmean4to5kmasl_ALLCASES ;
MesoAscent_eastUmean5to6kmaslR            = FullSDC_eastUmean5to6kmasl_ALLCASES ;
MesoAscent_1to5kmaslBulkShearR   = FullSDC_eastV1to5kmasl_bulkshear_ALLCASES;
MesoAscent_1to9kmaslBulkShearR   = FullSDC_eastV1to9kmasl_bulkshear_ALLCASES;


MesoAscent_EastUpslopeMagR(:) = NaN;
MesoAscent_EastUpslopeDepthFractR(:) = NaN;
MesoAscent_WestUpslopeMagR(:) = NaN;
MesoAscent_WestUpslopeDepthFractR(:) = NaN;
MesoAscent_EastUpslopeDepthR(:) = NaN;
MesoAscent_WestUpslopeDepthR(:) = NaN;
MesoAscent_EastUpslopeTopHtR(:) = NaN;
MesoAscent_WestUpslopeTopHtR(:) = NaN;
MesoAscent_EastUpslopeMag2500R(:) = NaN;
MesoAscent_EastUpslopeDepthFract2500R(:) = NaN;
MesoAscent_WestUpslopeMag2500R(:) = NaN;
MesoAscent_WestUpslopeDepthFract2500R(:) = NaN;
MesoAscent_EastUpslopeMag1500R(:) = NaN;
MesoAscent_EastUpslopeDepthFract1500R(:) = NaN;
MesoAscent_WestUpslopeMag1500R(:) = NaN;
MesoAscent_WestUpslopeDepthFract1500R(:) = NaN;
MesoAscent_eastUmean3to4kmaslR(:) = NaN;
MesoAscent_eastUmean4to5kmaslR(:) = NaN;
MesoAscent_eastUmean5to6kmaslR(:) = NaN;
MesoAscent_1to5kmaslBulkShearR(:) = NaN;
MesoAscent_1to9kmaslBulkShearR(:) = NaN;
lagnumdt = 6; % num of dt's to look back from current time  t3 = 15min, 76 = 30min,  set to 0 if you want no lag
for t = (lagnumdt+1) : 75
    %MesoAscent_WmagnitudeR(:,t,:)           = FullSDC_mesoWstrength_ALLCASES(:,t-lagnumdt,:);
%     MesoAscent_EastUpslopeMagR(:,t,:)       = abs(FullSDC_eastupslopemean_ALLCASES(:,t-lagnumdt,:));
%     MesoAscent_EastUpslopeDepthR(:,t,:)     = FullSDC_eastupslopedepthfract_ALLCASES(:,t-lagnumdt,:);
%     MesoAscent_WestUpslopeMagR(:,t,:)       = FullSDC_westupslopemean_ALLCASES(:,t-lagnumdt,:);
%     MesoAscent_WestUpslopeDepthR(:,t,:)     = FullSDC_westupslopedepthfract_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_1to5kmaslBulkShearR(:,t,:)   = FullSDC_eastV1to5kmasl_bulkshear_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_1to9kmaslBulkShearR(:,t,:)   = FullSDC_eastV1to9kmasl_bulkshear_ALLCASES(:,t-lagnumdt,:);

    MesoAscent_EastUpslopeMagR(:,t,:)                = abs(FullSDC_eastupslopemean_ALLCASES(:,t-lagnumdt,:));
    MesoAscent_EastUpslopeDepthFractR(:,t,:)         = FullSDC_eastupslopedepthfract_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_WestUpslopeMagR(:,t,:)                = FullSDC_westupslopemean_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_WestUpslopeDepthFractR(:,t,:)         = FullSDC_westupslopedepthfract_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_EastUpslopeDepthR(:,t,:)              = FullSDC_eastupslopedepth_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_WestUpslopeDepthR(:,t,:)              = FullSDC_westupslopedepth_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_EastUpslopeTopHtR(:,t,:)              = FullSDC_eastupslopetophtasl_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_WestUpslopeTopHtR(:,t,:)              = FullSDC_westupslopetophtasl_ALLCASES(:,t-lagnumdt,:);
    MesoAscent_EastUpslopeMag2500R(:,t,:)            = abs(FullSDC_eastupslopemean2500masl_ALLCASES(:,t-lagnumdt,:) );
    MesoAscent_EastUpslopeDepthFract2500R(:,t,:)     = FullSDC_eastupslopedepthfract2500masl_ALLCASES(:,t-lagnumdt,:) ;
    MesoAscent_WestUpslopeMag2500R(:,t,:)            = FullSDC_westupslopemean2500masl_ALLCASES(:,t-lagnumdt,:) ;
    MesoAscent_WestUpslopeDepthFract2500R(:,t,:)     = FullSDC_westupslopedepthfract2500masl_ALLCASES(:,t-lagnumdt,:) ;
    MesoAscent_EastUpslopeMag1500R(:,t,:)            = abs(FullSDC_eastupslopemean1500magl_ALLCASES(:,t-lagnumdt,:) );
    MesoAscent_EastUpslopeDepthFract1500R(:,t,:)     = FullSDC_eastupslopedepthfract1500magl_ALLCASES(:,t-lagnumdt,:) ;
    MesoAscent_WestUpslopeMag1500R(:,t,:)            = FullSDC_westupslopemean1500magl_ALLCASES(:,t-lagnumdt,:) ;
    MesoAscent_WestUpslopeDepthFract1500R(:,t,:)     = FullSDC_westupslopedepthfract1500magl_ALLCASES(:,t-lagnumdt,:) ;
    MesoAscent_eastUmean3to4kmaslR(:,t,:)            = FullSDC_eastUmean3to4kmasl_ALLCASES(:,t-lagnumdt,:) ;
    MesoAscent_eastUmean4to5kmaslR(:,t,:)            = FullSDC_eastUmean4to5kmasl_ALLCASES(:,t-lagnumdt,:) ;
    MesoAscent_eastUmean5to6kmaslR(:,t,:)            = FullSDC_eastUmean5to6kmasl_ALLCASES(:,t-lagnumdt,:) ;
end


ALL_CORRS = [];
ALL_SIG = [];
for Rr = 1:ar
    %Rr = 2
    %raw env metrics
    MesoAscent_LFCzagl              = FullSDC_swathmulfcagl_ALLCASES(:,:,Rr);
    MesoAscent_CAPE                 = FullSDC_swathmucape_ALLCASES(:,:,Rr);
    MesoAscent_CIN                  = FullSDC_swathmucin_ALLCASES(:,:,Rr);
    MesoAscent_Theta                = FullSDC_swaththetamean_ALLCASES(:,:,Rr);
    MesoAscent_ThetaE               = FullSDC_swaththetaemean_ALLCASES(:,:,Rr);
    MesoAscent_Qvapor               = FullSDC_swathqvap_ALLCASES(:,:,Rr);
    MesoAscent_RHaloft              = mean(FullSDC_swathboxaloftRH_ALLCASES,2,'omitnan');
    MesoAscent_RHaloft = permute(MesoAscent_RHaloft,[1 3 4 2]);
    MesoAscent_RHaloft = MesoAscent_RHaloft(:,:,Rr);
    MesoAscent_RHaloft = MesoAscent_RHaloft(:);
    %wind metrics
%     MesoAscent_EastUpslopeMag       = abs(FullSDC_eastupslopemean_ALLCASES(:,:,Rr));
%     MesoAscent_EastUpslopeDepth     = FullSDC_eastupslopedepthfract_ALLCASES(:,:,Rr);
%     MesoAscent_WestUpslopeMag       = FullSDC_westupslopemean_ALLCASES(:,:,Rr);
%     MesoAscent_WestUpslopeDepth     = FullSDC_westupslopedepthfract_ALLCASES(:,:,Rr);
    MesoAscent_1to5kmaslBulkShear   = FullSDC_eastV1to5kmasl_bulkshear_ALLCASES(:,:,Rr);
    MesoAscent_1to9kmaslBulkShear   = FullSDC_eastV1to9kmasl_bulkshear_ALLCASES(:,:,Rr);
  
    MesoAscent_EastUpslopeMag                 = MesoAscent_EastUpslopeMagR(:,:,Rr);
    MesoAscent_EastUpslopeDepthFract          = MesoAscent_EastUpslopeDepthFractR(:,:,Rr);
    MesoAscent_WestUpslopeMag                 = MesoAscent_WestUpslopeMagR(:,:,Rr);
    MesoAscent_WestUpslopeDepthFract          = MesoAscent_WestUpslopeDepthFractR(:,:,Rr);
    MesoAscent_EastUpslopeDepth               = MesoAscent_EastUpslopeDepthR(:,:,Rr);
    MesoAscent_WestUpslopeDepth               = MesoAscent_WestUpslopeDepthR(:,:,Rr);
    MesoAscent_EastUpslopeTopHt               = MesoAscent_EastUpslopeTopHtR(:,:,Rr);
    MesoAscent_WestUpslopeTopHt               = MesoAscent_WestUpslopeTopHtR(:,:,Rr);
    MesoAscent_EastUpslopeMag2500             = MesoAscent_EastUpslopeMag2500R(:,:,Rr);
    MesoAscent_EastUpslopeDepthFract2500      = MesoAscent_EastUpslopeDepthFract2500R(:,:,Rr);
    MesoAscent_WestUpslopeMag2500             = MesoAscent_WestUpslopeMag2500R(:,:,Rr);
    MesoAscent_WestUpslopeDepthFract2500      = MesoAscent_WestUpslopeDepthFract2500R(:,:,Rr);
    MesoAscent_EastUpslopeMag1500             = MesoAscent_EastUpslopeMag1500R(:,:,Rr);
    MesoAscent_EastUpslopeDepthFract1500      = MesoAscent_EastUpslopeDepthFract1500R(:,:,Rr);
    MesoAscent_WestUpslopeMag1500             = MesoAscent_WestUpslopeMag1500R(:,:,Rr);
    MesoAscent_WestUpslopeDepthFract1500      = MesoAscent_WestUpslopeDepthFract1500R(:,:,Rr);
    MesoAscent_eastUmean3to4kmasl             = MesoAscent_eastUmean3to4kmaslR(:,:,Rr);
    MesoAscent_eastUmean4to5kmasl             = MesoAscent_eastUmean4to5kmaslR(:,:,Rr);
    MesoAscent_eastUmean5to6kmasl             = MesoAscent_eastUmean5to6kmaslR(:,:,Rr);
%     % % swath metrics
%     MesoAscent_Wmagnitude           = FullSDC_mesoWstrength_ALLCASES(:,:,Rr);
%     MesoAscent_width                = FullSDC_mesoWwidth_ALLCASES(:,:,Rr);
%     MesoAscent_VertMassFlux         = FullSDC_VMfluxSum_ALLCASES(:,:,Rr);
%     MesoAscent_DepthPerLfc          = FullSDC_swathtopasl_ALLCASES(:,:,Rr) ./ FullSDC_swathtoplfcasl_ALLCASES(:,:,Rr) ;
    MesoAscent_Wmagnitude           = MesoAscent_WmagnitudeR(:,:,Rr);
    MesoAscent_width                = MesoAscent_widthR(:,:,Rr);
    MesoAscent_VertMassFlux         = MesoAscent_VertMassFluxR(:,:,Rr);
    MesoAscent_DepthPerLfc          = MesoAscent_DepthPerLfcR(:,:,Rr);
    MesoAscent_TopMinusBot          = MesoAscent_TopMinusBotR(:,:,Rr);
    MesoAscent_Top                  = MesoAscent_TopR(:,:,Rr);
   
    %de-index into 1D array:
    MesoAscent_Wmagnitude           =  MesoAscent_Wmagnitude(:);
    MesoAscent_width                =  MesoAscent_width(:);
    MesoAscent_VertMassFlux         =  MesoAscent_VertMassFlux(:);
    MesoAscent_DepthPerLfc          =  MesoAscent_DepthPerLfc(:);
    MesoAscent_LFCzagl              =  MesoAscent_LFCzagl(:);
    MesoAscent_CAPE                 =  MesoAscent_CAPE(:);
    MesoAscent_CIN                  =  MesoAscent_CIN(:);
    MesoAscent_Theta                =  MesoAscent_Theta(:);
    MesoAscent_ThetaE               =  MesoAscent_ThetaE(:);
    MesoAscent_Qvapor               =  MesoAscent_Qvapor(:);
    MesoAscent_RHaloft              =  MesoAscent_RHaloft(:);
    MesoAscent_EastUpslopeMag                 = MesoAscent_EastUpslopeMag(:);
    MesoAscent_EastUpslopeDepthFract          = MesoAscent_EastUpslopeDepthFract(:);
    MesoAscent_WestUpslopeMag                 = MesoAscent_WestUpslopeMag(:);
    MesoAscent_WestUpslopeDepthFract          = MesoAscent_WestUpslopeDepthFract(:);
    MesoAscent_EastUpslopeDepth               = MesoAscent_EastUpslopeDepth(:);
    MesoAscent_WestUpslopeDepth               = MesoAscent_WestUpslopeDepth(:);
    MesoAscent_EastUpslopeTopHt               = MesoAscent_EastUpslopeTopHt(:);
    MesoAscent_WestUpslopeTopHt               = MesoAscent_WestUpslopeTopHt(:);
    MesoAscent_EastUpslopeMag2500             = MesoAscent_EastUpslopeMag2500(:);
    MesoAscent_EastUpslopeDepthFract2500      = MesoAscent_EastUpslopeDepthFract2500(:);
    MesoAscent_WestUpslopeMag2500             = MesoAscent_WestUpslopeMag2500(:);
    MesoAscent_WestUpslopeDepthFract2500      = MesoAscent_WestUpslopeDepthFract2500(:);
    MesoAscent_EastUpslopeMag1500             = MesoAscent_EastUpslopeMag1500(:);
    MesoAscent_EastUpslopeDepthFract1500      = MesoAscent_EastUpslopeDepthFract1500(:);
    MesoAscent_WestUpslopeMag1500             = MesoAscent_WestUpslopeMag1500(:);
    MesoAscent_WestUpslopeDepthFract1500      = MesoAscent_WestUpslopeDepthFract1500(:);
    MesoAscent_eastUmean3to4kmasl             = MesoAscent_eastUmean3to4kmasl(:);
    MesoAscent_eastUmean4to5kmasl             = MesoAscent_eastUmean4to5kmasl(:);
    MesoAscent_eastUmean5to6kmasl             = MesoAscent_eastUmean5to6kmasl(:);
    MesoAscent_1to5kmaslBulkShear             =  MesoAscent_1to5kmaslBulkShear(:);
    MesoAscent_1to9kmaslBulkShear             =  MesoAscent_1to9kmaslBulkShear(:);


    ALL_vars = {'MesoAscent_Wmagnitude';
        'MesoAscent_width';
        'MesoAscent_VertMassFlux';
        'MesoAscent_DepthPerLfc';
         'MesoAscent_TopMinusBot';
         'MesoAscent_Top';

        'MesoAscent_eastUmean5to6kmasl';
        'MesoAscent_eastUmean4to5kmasl';
        'MesoAscent_eastUmean3to4kmasl';
        'MesoAscent_1to9kmaslBulkShear';
        'MesoAscent_1to5kmaslBulkShear';

        'MesoAscent_EastUpslopeMag';
        'MesoAscent_WestUpslopeMag';
        'MesoAscent_EastUpslopeDepth';
        'MesoAscent_WestUpslopeDepth';

        'MesoAscent_LFCzagl';
        'MesoAscent_CIN';
        'MesoAscent_Theta';
        %'MesoAscent_ThetaE';
        'MesoAscent_Qvapor';
        'MesoAscent_RHaloft';
        'MesoAscent_CAPE'};
    

    aMesoAscent_RHaloft = mean(FullSDC_swathboxaloftRH_ALLCASES,2,'omitnan');
    aMesoAscent_RHaloft = permute(aMesoAscent_RHaloft,[1 3 4 2]);


%{
    % % do d(env_metrics)/dt instead of raw evolving: 

    %%%% experiment with chopping out times
    keep = [1:13:75];
    % kill = [ 2,3,4,5,  7,8,9,10,  12,13,14,15, 17,18,19,20, 22,23,24,25, 27,28,29,30, 32,33,34,35, 37,38,39,40, ...
    %          42,43,44,45,  47,48,49,50,  52,53,54,55,  57,58,59,60,  62,63,64,65,  66,67,68,69,  71,72,73,74];
    test_FullSDC_swathmucape_ALLCASES                = FullSDC_swathmucape_ALLCASES(:,keep,:);
    test_FullSDC_swathmulfcagl_ALLCASES              = FullSDC_swathmulfcagl_ALLCASES(:,keep,:);
    test_FullSDC_swathmucin_ALLCASES                 = FullSDC_swathmucin_ALLCASES(:,keep,:);
    test_FullSDC_swaththetamean_ALLCASES             = FullSDC_swaththetamean_ALLCASES(:,keep,:);
    test_FullSDC_swaththetaemean_ALLCASES            = FullSDC_swaththetaemean_ALLCASES(:,keep,:);
    test_FullSDC_swathqvap_ALLCASES                  = FullSDC_swathqvap_ALLCASES(:,keep,:);
    test_aMesoAscent_RHaloft                         = aMesoAscent_RHaloft(:,keep,:);
    test_FullSDC_eastupslopemean_ALLCASES            = FullSDC_eastupslopemean_ALLCASES(:,keep,:);
    test_FullSDC_eastupslopedepthfract_ALLCASES      = FullSDC_eastupslopedepthfract_ALLCASES(:,keep,:);
    test_FullSDC_westupslopemean_ALLCASES            = FullSDC_westupslopemean_ALLCASES(:,keep,:);
    test_FullSDC_westupslopedepthfract_ALLCASES      = FullSDC_westupslopedepthfract_ALLCASES(:,keep,:);
    test_FullSDC_eastV1to5kmasl_bulkshear_ALLCASES   = FullSDC_eastV1to5kmasl_bulkshear_ALLCASES(:,keep,:);
    test_FullSDC_eastV1to9kmasl_bulkshear_ALLCASES   = FullSDC_eastV1to9kmasl_bulkshear_ALLCASES(:,keep,:);
    MesoAscent_Wmagnitude           = MesoAscent_WmagnitudeR(:,keep,Rr);
    MesoAscent_width                = MesoAscent_widthR(:,keep,Rr);
    MesoAscent_VertMassFlux         = MesoAscent_VertMassFluxR(:,keep,Rr);
    MesoAscent_DepthPerLfc          = MesoAscent_DepthPerLfcR(:,keep,Rr);
    MesoAscent_TopMinusBot          = MesoAscent_TopMinusBotR(:,keep,Rr);
    MesoAscent_Top                  = MesoAscent_TopR(:,keep,Rr);

    dtt = 1; %5/60;
    [meh, MesoAscent_ddt_CAPE]                = gradient(test_FullSDC_swathmucape_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_LFCzagl]             = gradient(test_FullSDC_swathmulfcagl_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_CIN]                 = gradient(test_FullSDC_swathmucin_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_Theta]               = gradient(test_FullSDC_swaththetamean_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_ThetaE]              = gradient(test_FullSDC_swaththetaemean_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_Qvapor]              = gradient(test_FullSDC_swathqvap_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_RHaloft]            = gradient(test_aMesoAscent_RHaloft(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_EastUpslopeMag]       = gradient(test_FullSDC_eastupslopemean_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_EastUpslopeDepth]     = gradient(test_FullSDC_eastupslopedepthfract_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_WestUpslopeMag]       = gradient(test_FullSDC_westupslopemean_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_WestUpslopeDepth]     = gradient(test_FullSDC_westupslopedepthfract_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_1to5kmaslBulkShear]   = gradient(test_FullSDC_eastV1to5kmasl_bulkshear_ALLCASES(:,:,Rr),1,dtt);
    [meh, MesoAscent_ddt_1to9kmaslBulkShear]   = gradient(test_FullSDC_eastV1to9kmasl_bulkshear_ALLCASES(:,:,Rr),1,dtt);


    clear meh meh2
    MesoAscent_ddt_CAPE                 = MesoAscent_ddt_CAPE(:);
    MesoAscent_ddt_LFCzagl              = MesoAscent_ddt_LFCzagl(:);
    MesoAscent_ddt_CIN                  = MesoAscent_ddt_CIN(:);
    MesoAscent_ddt_Theta                = MesoAscent_ddt_Theta(:);
    MesoAscent_ddt_ThetaE               = MesoAscent_ddt_ThetaE(:);
    MesoAscent_ddt_Qvapor               = MesoAscent_ddt_Qvapor(:);
    MesoAscent_ddt_RHaloft              = MesoAscent_ddt_RHaloft(:);
    MesoAscent_ddt_EastUpslopeMag       = MesoAscent_ddt_EastUpslopeMag(:);
    MesoAscent_ddt_EastUpslopeDepth     = MesoAscent_ddt_EastUpslopeDepth(:);
    MesoAscent_ddt_WestUpslopeMag       = MesoAscent_ddt_WestUpslopeMag(:);
    MesoAscent_ddt_WestUpslopeDepth     = MesoAscent_ddt_WestUpslopeDepth(:);
    MesoAscent_ddt_1to5kmaslBulkShear   = MesoAscent_ddt_1to5kmaslBulkShear(:);
    MesoAscent_ddt_1to9kmaslBulkShear   = MesoAscent_ddt_1to9kmaslBulkShear(:);

    ALL_vars = {'MesoAscent_Wmagnitude';
    'MesoAscent_width';
    'MesoAscent_VertMassFlux';
    'MesoAscent_DepthPerLfc';

    'MesoAscent_ddt_1to9kmaslBulkShear';
    'MesoAscent_ddt_1to5kmaslBulkShear';
    'MesoAscent_ddt_EastUpslopeDepth';
    'MesoAscent_ddt_EastUpslopeMag';
    'MesoAscent_ddt_WestUpslopeMag';
    'MesoAscent_ddt_WestUpslopeDepth';

    'MesoAscent_ddt_CAPE';
    'MesoAscent_ddt_CIN';
    'MesoAscent_ddt_LFCzagl';
    'MesoAscent_ddt_Theta';
    'MesoAscent_ddt_ThetaE';
    'MesoAscent_ddt_Qvapor';
    'MesoAscent_ddt_RHaloft'};

     %%% end of ddt experiment
%}

    ALL_vars = flipdim(ALL_vars,1) ;

    ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
    ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
    ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;
    SIGTHRESH = 0.05;
    for n = 1:length(ALL_vars)
        for m = 1:length(ALL_vars)
            %  n = 1; m = 14
            AA = char(ALL_vars(n)) ;
            AA = eval(AA);
            BB = char(ALL_vars(m)) ;
            BB = eval(BB);  
            kill = find(isnan(BB));
            BB(kill) = []; AA(kill) = [];
            kill = find(isnan(AA));
            BB(kill) = []; AA(kill) = [];
            [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
            ALL_corrs(n,m) = corab ;
            ALL_Ps(n,m) = pval;
            if(pval < SIGTHRESH)
                ALL_statsig(n,m) = NaN;
            else
                ALL_corrs(n,m) = NaN;
                ALL_statsig(n,m) = 0; %0;
            end
        end
    end
    ALL_corrs = single(ALL_corrs);
    isupper = logical(triu(ones(size(ALL_corrs)),1));
    ALL_corrs(isupper) = NaN;
    ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN

    ALL_statsig = single(ALL_statsig);
    isupper = logical(triu(ones(size(ALL_statsig)),1));
    ALL_statsig(isupper) = NaN;
    ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;

    varlab = {};
    for l = 1:length(ALL_vars)
        asd = char(ALL_vars(l,:) )   ;
        asd(find(asd=='_'))=' '   ;
        varlab = vertcat(varlab,asd);
    end

    %round
    ALL_corrs = round(ALL_corrs,2);

    ALL_CORRS = cat(3,ALL_CORRS,ALL_corrs);
    ALL_SIG = cat(3,ALL_SIG,ALL_statsig);

    dualpol_colmap
    ff = figure('Position',[246,77,1187,900])
    h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    title(['Swath Correlogram - FULL SDC VARS (Filt: LFClayer,small area) ',RUNS(Rr,1:8)])

%     saveas(h, horzcat(imout,'/Correlgram_Allcases_swathlag_',RUNS(Rr,1:8),'_LFCARfilt.png') );
%     outlab = horzcat(imout,'/Correlgram_Allcases_swathlag_',RUNS(Rr,1:8),'_LFCARfilt.eps') ;
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);

end

dualpol_colmap
ff = figure('Position',[246,77,1187,900])
meancorr = mean(ALL_CORRS,3,'omitnan');
h = heatmap(round(meancorr,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
title(['Swath Correlogram - all cases combined FULL SDC VARS allcasemean'])

% saveas(h, horzcat(imout,'/Correlgram_AllcasesMEAN_swathlag_LFCARfilt.png') );
% outlab = horzcat(imout,'/Correlgram_AllcasesMEAN_swathlag_LFCARfilt.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%%% helpful diagnostic plots:

% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
ALL_SIG(isnan(ALL_SIG)) = 1;
SUMSIG = sum(ALL_SIG,3,'omitnan');  
h = heatmap(round(SUMSIG,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['Swath Correlogram significance allcasemean'])

% saveas(ff, horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


% number of blocks with same correlation sign as the ensemble mean :
ALL_COR_SIGN  = sign( ALL_CORRS );
meancorr = mean(ALL_CORRS,3,'omitnan');
MEANCOR = [];
for y = 1:ar  % stitch together for dimension matching. 
    MEANCOR = cat(3,MEANCOR, meancorr);
end
MEANCOR_SIGN = sign(MEANCOR);
[ci cj cy] = size(MEANCOR);
MATCHED_SIGNS = MEANCOR_SIGN;   MATCHED_SIGNS(:) = NaN; %array with 1 where case blocks match mean block
match = find(MEANCOR_SIGN == ALL_COR_SIGN);
MATCHED_SIGNS(match) = 1;
SUM_MATCHED_SIGNS = sum(MATCHED_SIGNS,3,'omitnan');

% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(SUM_MATCHED_SIGNS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['Swath Correlogram allcasemean'])

% saveas(ff, horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%%%%%%%% now use this to divide into high, med, low confidence
%%%%%%%% interpretations:

HICONF_MEAN_CORRS = zeros(ci,cj);    HICONF_MEAN_CORRS(:) = NaN; 
MECONF_MEAN_CORRS = zeros(ci,cj);    MECONF_MEAN_CORRS(:) = NaN; 
LOCONF_MEAN_CORRS = zeros(ci,cj);    LOCONF_MEAN_CORRS(:) = NaN; 
for i = 1:ci
    for j = 1:cj
        %  i = 19; j = 18

        %use for article plot hi & med breakdown:
        %{
        HSIGN = ( SUM_MATCHED_SIGNS(i,j)   >= 5  )   ;
        MSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 5  &  SUM_MATCHED_SIGNS(i,j)   >= 3 );
        LSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 3 );

        HSIG = ( SUMSIG(i,j)   >=  5  )   ;
        MSIG = ( SUMSIG(i,j) < 5  &   SUMSIG(i,j) >= 3 );
        LSIG = ( SUMSIG(i,j) < 3 );        

        if( HSIGN==1  &  HSIG==1 & MSIGN==0  &  MSIG==0 & LSIGN==0  & LSIG==0)
            HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==0  &  HSIG==0 & MSIGN==1  &  MSIG==1 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(LSIGN==1  | LSIG==1 )
            LOCONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        end
        %}


        %use for ppt presentations simplified:
        HSIGN = ( SUM_MATCHED_SIGNS(i,j)   >= 4  )   ;
%         MSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 5  &  SUM_MATCHED_SIGNS(i,j)   >= 3 );
        LSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 3 );

        HSIG = ( SUMSIG(i,j)   >=  4  )   ;
        %MSIG = ( SUMSIG(i,j) < 5  &   SUMSIG(i,j) >= 3 );
        LSIG = ( SUMSIG(i,j) < 3 );        

%         if( HSIGN==1  &  HSIG==1 & MSIGN==0  &  MSIG==0 & LSIGN==0  & LSIG==0)
%             HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        if( HSIGN==1  &  HSIG==1 )
            HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==0  &  HSIG==0 & MSIGN==1  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(LSIGN==1  | LSIG==1 )
            LOCONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        end    
    end
end


% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(HICONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['HI CONF Correlogram Swath metrics allcasemean'])

saveas(ff, horzcat(imout,'/FULLSDCswath_correlogram_HIConf_allcasemean.png') );
outlab = horzcat(imout,'/FULLSDCswath_correlogram_HIConf_allcasemean.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);


% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(MECONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['MED CONF Correlogram Swath metrics allcasemean'])

saveas(ff, horzcat(imout,'/FULLSDCswath_correlogram_MEDConf_allcasemean.png') );
outlab = horzcat(imout,'/FULLSDCswath_correlogram_MEDConf_allcasemean.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);


% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(LOCONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['LOW CONF Correlogram Swath metrics allcasemean'])

saveas(ff, horzcat(imout,'/FULLSDCswath_correlogram_LOWConf_allcasemean.png') );
outlab = horzcat(imout,'/FULLSDCswath_correlogram_LOWConf_allcasemean.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);





%}


















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%  experimental Hugh et al. 2022 plots: 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%% first make Hugh-like RC metrics: 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% kill data at heights outside of an LFC layer in wid prof vars. (recall,
%%% LFC is where you start looking at the updraft)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
layerdepth  =  1000 ;   %meters - how high above the wid's lfc you want to still be elidgable for analysis
widLFC1_profs_area_ALLCASES      =   wid_profs_area_ALLCASES     ;
widLFC1_profs_massflux_ALLCASES  =   wid_profs_massflux_ALLCASES ;
widLFC1_profs_maxmag_ALLCASES    =   wid_profs_maxmag_ALLCASES   ;
for n = 1:numwid
    for t = 1:alltimes
        for RR = 1:ar
            % RR = 1;  t = 19;  n = 62;
            klfcagl = wid_profs_klfcagl_ALLCASES(n,t,RR)  ;
            if(   isnan(klfcagl)==0   )
                lfcagl = FwIDprofs_zagl(klfcagl) ;    % meters
                toplayer = lfcagl + layerdepth;
                ktoplayer = find( abs(FwIDprofs_zagl-toplayer) == min(abs(FwIDprofs_zagl-toplayer))   );
                if(ktoplayer > length(FwIDprofs_zagl)-1 )
                    ktoplayer = length(FwIDprofs_zagl)-1;
                end
                % % %kill whats above lfc layer
                widLFC1_profs_area_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widLFC1_profs_massflux_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widLFC1_profs_maxmag_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                % % %kill whats below lfc layer (should already be dead -  killed in first .m script)
                widLFC1_profs_area_ALLCASES(n,1:(klfcagl-1),t,RR) = NaN  ;
                widLFC1_profs_massflux_ALLCASES(n,1:(klfcagl-1),t,RR) = NaN  ;
                widLFC1_profs_maxmag_ALLCASES(n,1:(klfcagl-1),t,RR) = NaN  ;
            end
        end
    end
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% now trim off the smaller wIDs 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
widLFC1AR_profs_area_ALLCASES            = widLFC1_profs_area_ALLCASES;
widLFC1AR_profs_massflux_ALLCASES        = widLFC1_profs_massflux_ALLCASES;
widLFC1AR_profs_maxmag_ALLCASES          = widLFC1_profs_maxmag_ALLCASES;
widLFC1AR_mesoWvmsum_ALLCASES            = wid_mesoWvmsum_ALLCASES;
% widLFC1AR_mesoWvmsumHSUM_ALLCASES        = wid_mesoWvmsumHSUM_ALLCASES;
% widLFC1AR_mesoWalongsubupfract_ALLCASES  = wid_mesoWalongsubupfract_ALLCASES;
widLFC1AR_mesoWwidth_ALLCASES            = wid_mesoWwidth_ALLCASES;  
widLFC1AR_mesoWstrength_ALLCASES         = wid_mesoWstrength_ALLCASES;
% widLFC1AR_mesoWwidthMAX_ALLCASES            = wid_mesoWwidthMAX_ALLCASES;  
% widLFC1AR_mesoWstrengthMAX_ALLCASES         = wid_mesoWstrengthMAX_ALLCASES;
widLFC1AR_mesoWmeanRHboxaloft_ALLCASES   = wid_mesoWmeanRHboxaloft_ALLCASES;
r300m = 282743.0;
r500m = 785000.0;
r750m = 1767145.0;
%nkill = zeros(numwid,alltimes,ar) ;
for n = 1:numwid
    for t = 1:alltimes
        for RR = 1:ar
            %  n = 33; t = 20; RR = 1
            clear maxarea
            maxarea =  max( widLFC1_profs_area_ALLCASES(n,:,t,RR),[],2)  ;
            if( isnan(maxarea )==0 &  maxarea < r300m )    % r=300m:282743    r=500m: 785000.0;    r=750m:1767145.0 
                %nkill(n,t,RR) = 1;
                widLFC1AR_profs_area_ALLCASES(n,:,t,RR) = NaN  ;
                widLFC1AR_profs_massflux_ALLCASES(n,:,t,RR) = NaN  ;
                widLFC1AR_profs_maxmag_ALLCASES(n,:,t,RR) = NaN  ;
                widLFC1AR_mesoWvmsum_ALLCASES(n,t,:,RR)          = NaN  ;
%                 widLFC1AR_mesoWvmsumHSUM_ALLCASES(n,t,:,RR)          = NaN  ;
%                 widLFC1AR_mesoWalongsubupfract_ALLCASES(n,t,:,RR)          = NaN  ;
                widLFC1AR_mesoWwidth_ALLCASES(n,t,:,RR)          = NaN  ;
                widLFC1AR_mesoWstrength_ALLCASES(n,t,:,RR)          = NaN  ;
            end
        end
    end
end





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% another Hugh data set: kill data at heights outside of an 1 km layer centerd on Wmax. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
widMAX1_profs_area_ALLCASES      =   wid_profs_area_ALLCASES     ;
widMAX1_profs_massflux_ALLCASES  =   wid_profs_massflux_ALLCASES ;
widMAX1_profs_maxmag_ALLCASES    =   wid_profs_maxmag_ALLCASES   ;
for n = 1:numwid
    for t = 1:alltimes
        for RR = 1:ar
            % RR = 3;  t = 1;  n = 1;
            % RR = 1;  t = 19;  n = 62;
            %             klfcagl = wid_profs_klfcagl_ALLCASES(n,t,RR)  ;
            %             if(   isnan(klfcagl)==0   )

            kwmaxht  =  find(   max(wid_profs_maxmag_ALLCASES(n,:,t,RR),[],'omitnan') ==  wid_profs_maxmag_ALLCASES(n,:,t,RR)   )  ;    % km

            if(  isnan(kwmaxht)==0  )
                maxht  =  FwIDprofs_zagl( kwmaxht )   ;

                toplayer = maxht + layerdepth  ;
                ktoplayer = find( abs(FwIDprofs_zagl-toplayer) == min(abs(FwIDprofs_zagl-toplayer))   );
                botlayer = maxht - layerdepth  ;
                kbotlayer = find( abs(FwIDprofs_zagl-botlayer) == min(abs(FwIDprofs_zagl-botlayer))   );
                if(ktoplayer > length(FwIDprofs_zagl)-1 )
                    ktoplayer = length(FwIDprofs_zagl)-1;
                end
                if(kbotlayer < 1 )
                    ktoplayer = 1;
                end
                % % %kill whats above wmax layer
                widMAX1_profs_area_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widMAX1_profs_massflux_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widMAX1_profs_maxmag_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                % % %kill whats below wmax layer (should already be dead, killed in first .m script)
                widMAX1_profs_area_ALLCASES(n,1:kbotlayer,t,RR) = NaN  ;
                widMAX1_profs_massflux_ALLCASES(n,1:kbotlayer,t,RR) = NaN  ;
                widMAX1_profs_maxmag_ALLCASES(n,1:kbotlayer,t,RR) = NaN  ;
            end
        end
    end
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% now trim off the smaller wIDs 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
widMAX1AR_profs_area_ALLCASES            = widMAX1_profs_area_ALLCASES;
widMAX1AR_profs_massflux_ALLCASES        = widMAX1_profs_massflux_ALLCASES;
widMAX1AR_profs_maxmag_ALLCASES          = widMAX1_profs_maxmag_ALLCASES;
widMAX1AR_mesoWvmsum_ALLCASES            = wid_mesoWvmsum_ALLCASES;
% widMAX1AR_mesoWvmsumHSUM_ALLCASES        = wid_mesoWvmsumHSUM_ALLCASES;
% widMAX1AR_mesoWalongsubupfract_ALLCASES  = wid_mesoWalongsubupfract_ALLCASES;
widMAX1AR_mesoWwidth_ALLCASES            = wid_mesoWwidth_ALLCASES; 
widMAX1AR_mesoWstrength_ALLCASES         = wid_mesoWstrength_ALLCASES;
% widMAX1AR_mesoWwidthMAX_ALLCASES            = wid_mesoWwidthMAX_ALLCASES; 
% widMAX1AR_mesoWstrengthMAX_ALLCASES         = wid_mesoWstrengthMAX_ALLCASES;
widMAX1AR_mesoWmeanRHboxaloft_ALLCASES   = wid_mesoWmeanRHboxaloft_ALLCASES;
r300m = 282743.0;
r500m = 785000.0;
r750m = 1767145.0;
%nkill = zeros(numwid,alltimes,ar) ;
for n = 1:numwid
    for t = 1:alltimes
        for RR = 1:ar
            %  n = 33; t = 20; RR = 1
            clear maxarea
            maxarea =  max( widMAX1_profs_area_ALLCASES(n,:,t,RR),[],2)  ;
            if( isnan(maxarea )==0 &  maxarea < r300m )    % r=300m:282743    r=500m: 785000.0;    r=750m:1767145.0 
                %nkill(n,t,RR) = 1;
                widMAX1AR_profs_area_ALLCASES(n,:,t,RR)         = NaN  ;
                widMAX1AR_profs_massflux_ALLCASES(n,:,t,RR)     = NaN  ;
                widMAX1AR_profs_maxmag_ALLCASES(n,:,t,RR)       = NaN  ;
                widMAX1AR_mesoWvmsum_ALLCASES(n,t,:,RR)         = NaN  ;
%                 widMAX1AR_mesoWvmsumHSUM_ALLCASES(n,t,:,RR)         = NaN  ;
%                 widMAX1AR_mesoWalongsubupfract_ALLCASES(n,t,:,RR)   = NaN  ;
                widMAX1AR_mesoWwidth_ALLCASES(n,t,:,RR)             = NaN  ;
                widMAX1AR_mesoWstrength_ALLCASES(n,t,:,RR)          = NaN  ;
            end
        end
    end
end



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% make an alternate version of MAX1AR where you  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
widMAX1_profs_area_ALLCASES      =   wid_profs_area_ALLCASES     ;
widMAX1_profs_massflux_ALLCASES  =   wid_profs_massflux_ALLCASES ;
widMAX1_profs_maxmag_ALLCASES    =   wid_profs_maxmag_ALLCASES   ;
for n = 1:numwid
    for t = 1:alltimes
        for RR = 1:ar
            % RR = 3;  t = 1;  n = 1;
            % RR = 1;  t = 19;  n = 62;
            %             klfcagl = wid_profs_klfcagl_ALLCASES(n,t,RR)  ;
            %             if(   isnan(klfcagl)==0   )

            kwmaxht  =  find(   max(wid_profs_maxmag_ALLCASES(n,:,t,RR),[],'omitnan') ==  wid_profs_maxmag_ALLCASES(n,:,t,RR)   )  ;    % km

            if(  isnan(kwmaxht)==0  )
                maxht  =  FwIDprofs_zagl( kwmaxht )   ;

                toplayer = maxht + layerdepth  ;
                ktoplayer = find( abs(FwIDprofs_zagl-toplayer) == min(abs(FwIDprofs_zagl-toplayer))   );
                botlayer = maxht - layerdepth  ;
                kbotlayer = find( abs(FwIDprofs_zagl-botlayer) == min(abs(FwIDprofs_zagl-botlayer))   );
                if(ktoplayer > length(FwIDprofs_zagl)-1 )
                    ktoplayer = length(FwIDprofs_zagl)-1;
                end
                if(kbotlayer < 1 )
                    ktoplayer = 1;
                end
                % % %kill whats above wmax layer
                widMAX1_profs_area_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widMAX1_profs_massflux_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                widMAX1_profs_maxmag_ALLCASES(n,(ktoplayer+1):end,t,RR) = NaN  ;
                % % %kill whats below wmax layer (should already be dead, killed in first .m script)
                widMAX1_profs_area_ALLCASES(n,1:kbotlayer,t,RR) = NaN  ;
                widMAX1_profs_massflux_ALLCASES(n,1:kbotlayer,t,RR) = NaN  ;
                widMAX1_profs_maxmag_ALLCASES(n,1:kbotlayer,t,RR) = NaN  ;
            end
        end
    end
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% now trim off the smaller wIDs 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
widMAX1AR_profs_area_ALLCASES            = widMAX1_profs_area_ALLCASES;
widMAX1AR_profs_massflux_ALLCASES        = widMAX1_profs_massflux_ALLCASES;
widMAX1AR_profs_maxmag_ALLCASES          = widMAX1_profs_maxmag_ALLCASES;
widMAX1AR_mesoWvmsum_ALLCASES            = wid_mesoWvmsum_ALLCASES;
%widMAX1AR_mesoWvmsumHSUM_ALLCASES        = wid_mesoWvmsumHSUM_ALLCASES;
%widMAX1AR_mesoWalongsubupfract_ALLCASES  = wid_mesoWalongsubupfract_ALLCASES;
widMAX1AR_mesoWwidth_ALLCASES            = wid_mesoWwidth_ALLCASES; 
widMAX1AR_mesoWstrength_ALLCASES         = wid_mesoWstrength_ALLCASES;
% widMAX1AR_mesoWwidthMAX_ALLCASES            = wid_mesoWwidthMAX_ALLCASES; 
% widMAX1AR_mesoWstrengthMAX_ALLCASES         = wid_mesoWstrengthMAX_ALLCASES;
widMAX1AR_mesoWmeanRHboxaloft_ALLCASES   = wid_mesoWmeanRHboxaloft_ALLCASES;
r300m = 282743.0;
r500m = 785000.0;
r750m = 1767145.0;
%nkill = zeros(numwid,alltimes,ar) ;
for n = 1:numwid
    for t = 1:alltimes
        for RR = 1:ar
            %  n = 33; t = 20; RR = 1
            clear maxarea
            maxarea =  max( widMAX1_profs_area_ALLCASES(n,:,t,RR),[],2)  ;
            if( isnan(maxarea )==0 &  maxarea < r300m )    % r=300m:282743    r=500m: 785000.0;    r=750m:1767145.0 
                %nkill(n,t,RR) = 1;
                widMAX1AR_profs_area_ALLCASES(n,:,t,RR)         = NaN  ;
                widMAX1AR_profs_massflux_ALLCASES(n,:,t,RR)     = NaN  ;
                widMAX1AR_profs_maxmag_ALLCASES(n,:,t,RR)       = NaN  ;
                widMAX1AR_mesoWvmsum_ALLCASES(n,t,:,RR)         = NaN  ;
                %widMAX1AR_mesoWvmsumHSUM_ALLCASES(n,t,:,RR)         = NaN  ;
                %widMAX1AR_mesoWalongsubupfract_ALLCASES(n,t,:,RR)   = NaN  ;
                widMAX1AR_mesoWwidth_ALLCASES(n,t,:,RR)         = NaN  ;
                widMAX1AR_mesoWstrength_ALLCASES(n,t,:,RR)         = NaN  ;
            end
        end
    end
end

%%% filter out shallow ones:
MINTOP = 5000;
%MAXBOT = 4000; % nvrmnd on the min height requirement b/c of detached thermals. 
widMAX1ARdeep_profs_area_ALLCASES        =  widMAX1AR_profs_area_ALLCASES ;
widMAX1ARdeep_profs_massflux_ALLCASES    =  widMAX1AR_profs_massflux_ALLCASES ;
widMAX1ARdeep_profs_maxmag_ALLCASES      =  widMAX1AR_profs_maxmag_ALLCASES ;
widMAX1ARdeep_mesoWstrength_ALLCASES     =  widMAX1AR_mesoWstrength_ALLCASES;
widMAX1ARdeep_mesoWwidth_ALLCASES        =  widMAX1AR_mesoWwidth_ALLCASES;
widMAX1ARdeep_mesoWvmsum_ALLCASES        =  widMAX1AR_mesoWvmsum_ALLCASES;
%widMAX1ARdeep_mesoWvmsumHSUM_ALLCASES    =  widMAX1AR_mesoWvmsumHSUM_ALLCASES;
%widMAX1ARdeep_mesoWalongsubupfract_ALLCASES    =  widMAX1AR_mesoWalongsubupfract_ALLCASES;
% filter out shallow wIDs:
for n = 1:wn
    for t = 1:wt
        for R = 1:ar
            %  n = 2;   R=1;  t=30;

            maxasl = max(wid_profs_centHTasl_ALLCASES(n,:,t,R),[],'omitnan');

            %minasl = min(wid_profs_centHTasl_ALLCASES(n,:,t,R),[],'omitnan');   %nvrmind
%             if( isempty(maxasl)==0  & isnan(maxasl)==0 & isempty(minasl)==0  & isnan(minasl)==0  ...
%                     &  maxasl < MINTOP  |  minasl > MAXBOT )  % nvrmnd on
%                     the min height requirement b/c of detached thermals. 

            if( isempty(maxasl)==0  & isnan(maxasl)==0  &  maxasl < MINTOP ) % kill when true
                %disp(['picked off ',num2str(n),'_',num2str(t),'_',num2str(R)])

                widMAX1ARdeep_profs_area_ALLCASES(n,:,t,R)           =  NaN;
                widMAX1ARdeep_profs_massflux_ALLCASES(n,:,t,R)       =  NaN;
                widMAX1ARdeep_profs_maxmag_ALLCASES(n,:,t,R)         =  NaN;   
            
                widMAX1ARdeep_mesoWstrength_ALLCASES(n,t,:,R)        = NaN  ;
                widMAX1ARdeep_mesoWwidth_ALLCASES(n,t,:,R)           = NaN  ;
                widMAX1ARdeep_mesoWvmsum_ALLCASES(n,t,:,R)           = NaN  ;
                %widMAX1ARdeep_mesoWvmsumHSUM_ALLCASES(n,t,:,R)           = NaN  ;
                %widMAX1ARdeep_mesoWalongsubupfract_ALLCASES(n,t,:,R)           = NaN  ;

            end
        end
    end
end



%{

figure; 

wmaxs = max(widMAX1AR_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ;
maxtmeans = mean(wmaxs,1,'omitnan');  maxtmeans = permute(maxtmeans,[3 4 1 2]);
%maxtmeans = mean(wmaxs,1,'omitnan');  maxtmeans = permute(meanmaxs,[3 4 1 2]);
%maxtmeans = max(wmaxs,[],1,'omitnan');  maxtmeans = permute(meanmaxs,[3 4 1 2]);

% tmeans = mean(widMAX1AR_profs_maxmag_ALLCASES(:,:,:,:),1,'omitnan') ;
% maxtmeans = max(tmeans,[],2);   maxtmeans = permute(maxtmeans,[3 4 1 2]);

hrs = [13:5/60:19+10/60] - 3;
plot(hrs, maxtmeans(:,1) ,'r'); hold on
plot(hrs,  maxtmeans(:,2) ,'g'); hold on
plot(hrs,  maxtmeans(:,3) ,'b'); hold on
plot(hrs,  maxtmeans(:,5) ,'Color',[1 0.5 0]); hold on
plot(hrs,  maxtmeans(:,4) ,'Color',[139/255 69/255 19/255]); hold on
plot(hrs,  maxtmeans(:,6) ,'c'); hold on
plot(hrs,  maxtmeans(:,7) ,'Color',[1 0 1]); hold on
axis([10 15.5 0 15])
%}



%{
%%%%%%%  w max layer version  - (not really any different than LFC layer)

figure('position',[60,278,762,635]);
sgtitle(' R_c_l_d (mean in W_m_a_x layer) vs R_s_w_a_t_h ')

hold on
for RR = 1:ar

    BB = (MAX_swathwidth(:,:,RR))/2  ; 
    AA = ( (MAX_wid_meanwidth(:,:,RR)/3.14159 ).^0.5 ) /1000 ; 

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','+r','LineWidth',1.5); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','+b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','+g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','+c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','+','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','+','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','+','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB =   (MAX_swathwidth)/2  ; 
AA =   ((MAX_wid_meanwidth/3.14159).^0.5 )/1000 ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
axis equal
axis([0.0 2.5 0.0 2.5 ])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' Cross-terrain width/2 of orographic ascent object');
ylabel(' R_c_l_o_u_d (circular area equiv) 1km-deep layer centered on W_m_a_x ');
%}















%%%% now make heatmap plots: 

%pick the swath time rel to cloudy time:
TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; -# to go a # dt prior to cloud time (native 5min LASSO dt)
             % t=1 = curent time, 2= current time - 5min, 3= -10min, 4= -15min...

%Hugh-like vars:
CLDupdraft_area       =  max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2) ;   % 
    CLDupdraft_area = permute(CLDupdraft_area ,[1 3 4 2]);
CLDupdraft_Radius     =  ((CLDupdraft_area/3.14159).^0.5)/1000;      %circ equiv rad [km]
%CLDupdraft_MaxMagnitude = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ;
CLDupdraft_MaxMagnitude = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ;
    CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);

    cht_mask = CLDupdraft_area;  cht_mask(:) = NaN;  cht_mask( isnan(CLDupdraft_area)==0 )=1;  
CLDupdraft_topZasl    =  wid_maxk_topasl_ALLCASES(:,:,:) .* cht_mask;

%%% kludge convert anything >10 kmasl to 10 km asl:
CLDupdraft_topZasl( CLDupdraft_topZasl > 10000 ) = 9999.9;




MesoAscent_width      =  widLFCAR_mesoWwidth_ALLCASES(:,:,TIMLG,:) ; %/ 2;            % converting to radius (along longitude)  [km]
    MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]) .* cht_mask;

%MesoAscent_RHaloft    =  permute( widLFCAR_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,:),[1 2 4 3]) .* cht_mask;
MesoAscent_RHaloft    =   FwID_RH_mean_ACBL_ALLCASES .* cht_mask ;

% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
%just kill the mesoascent fields so that we can still compare cldy
%updrafts to near-cloud sounding metrics

dist = abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,:) );  dist = permute(dist,[1 2 4 3]);

kill = find(  dist  >  distswathwid_thresh  );
CLDupdraft_area(kill) = NaN;
CLDupdraft_Radius(kill) = NaN;
CLDupdraft_MaxMagnitude(kill) = NaN;
CLDupdraft_topZasl(kill) = NaN;
% MesoAscent_Wmagnitude(kill)           = NaN;
MesoAscent_width(kill)                = NaN;
MesoAscent_RHaloft(kill)         = NaN;



CLDupdraft_MaxMagnitude = CLDupdraft_MaxMagnitude(:);
CLDupdraft_Radius2     =  CLDupdraft_Radius(:) ;%.* CLDupdraft_Radius(:);
CLDupdraft_topZasl    =  CLDupdraft_topZasl(:);
MesoAscent_width2      =  MesoAscent_width(:) ;%.* MesoAscent_width(:);       
MesoAscent_RHaloft    =  MesoAscent_RHaloft(:)/100;

% RCstart = 0;   RCinc = 0.2;   RCend = 6;
% RSstart = 0.2;   RSinc = 0.2;   RSend = 4.6;
% RHstart = 30;   RHinc = 2;   RHend = 90;

RCstart = 0;   RCinc = 0.3;   RCend = 6;
RSstart = 0.2;   RSinc = 0.5;   RSend = 4.6;
RHstart = 30/100;   RHinc = 6/100;   RHend = 90/100;

RCdisc = [ RCstart : RCinc : RCend ];%.^2;
RSdisc = [ RSstart : RSinc : RSend ];%.^2;
RHdisc = [ RHstart : RHinc : RHend ];

CLDupdraft_Radius0  = discretize(CLDupdraft_Radius2,  RCdisc);
MesoAscent_width0   = discretize(MesoAscent_width2,   RSdisc);
MesoAscent_RHaloft0 = discretize(MesoAscent_RHaloft, RHdisc);

RClab = [ (RCstart+(RCinc/2)) : RCinc : (RCend-(RCinc/2))  ];%.^2 ; 
RSlab = [ (RSstart+(RSinc/2)) : RSinc : (RSend-(RSinc/2))  ];%.^2 ; 
RHlab = [ (RHstart+(RHinc/2)) : RHinc : (RHend-(RHinc/2))  ] ;  

CLDupdraft_Radius2   =  CLDupdraft_Radius0  ;
MesoAscent_width2    =  MesoAscent_width0  ;
MesoAscent_RHaloft  =  MesoAscent_RHaloft0  ;

for i = 1:length(RClab)
    CLDupdraft_Radius2(  CLDupdraft_Radius2 == i  ) = RClab(i);
end
for i = 1:length(RSlab)
    MesoAscent_width2(  MesoAscent_width2 == i  ) = RSlab(i);
end
for i = 1:length(RHlab)
    MesoAscent_RHaloft( MesoAscent_RHaloft == i  ) = RHlab(i);
end

CLDupdraft_Radius_numsamples = CLDupdraft_Radius2;   
CLDupdraft_Radius_numsamples( isnan(CLDupdraft_Radius_numsamples)==0 ) = 1;
CLDupdraft_Radius_numsamples( find(CLDupdraft_Radius_numsamples==0) ) = NaN;


%concat together
tabl = table(MesoAscent_RHaloft,MesoAscent_width2,CLDupdraft_Radius2,CLDupdraft_topZasl,CLDupdraft_Radius_numsamples,CLDupdraft_MaxMagnitude);


dualpol_colmap




figure('position',[260,221,908,539])  %260,221,854,539

sgtitle(['filt:LFCAR;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(2,2,1)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 5000])

%
subplot(2,2,3)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','mean','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 5000])

subplot(2,2,4)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 12000])

blackzero =jet(5000);
blackzero = cat(1,[1 1 1],blackzero);

subplot(2,2,2)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(blackzero)
%caxis([10 150])
caxis([0 350])


outlab = horzcat(imout,'/HughHeatmap_LFCAR_SwathWidth_cldtop.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%%%%%%%%%%%%%%%%


figure('position',[260,221,908,539])
sgtitle(['filt:LFCAR;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(2,2,1)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 10000])
%
subplot(2,2,3)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','mean','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 10000])
%
subplot(2,2,4)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 10000])
%

blackzero = jet(5000);
blackzero = cat(1,[1 1 1],blackzero);

subplot(2,2,2)
CLDupdraft_Radius_numsamples(CLDupdraft_Radius_numsamples==0) = NaN;
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(blackzero)
caxis([0 350])

outlab = horzcat(imout,'/HughHeatmap_LFCAR_CloudWidth_cldtop.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);





%%%%%%%%%%%%%%%%

figure


sgtitle(['filt:LFCAR;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(2,2,1)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','mean','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 5000])

blackzero =jet(5000);
blackzero = cat(1,[1 1 1],blackzero);

subplot(2,2,2)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(blackzero)
%caxis([10 150])
caxis([0 350])

subplot(2,2,3)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','mean','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 10000])
%

blackzero = jet(5000);
blackzero = cat(1,[1 1 1],blackzero);

subplot(2,2,4)
CLDupdraft_Radius_numsamples(CLDupdraft_Radius_numsamples==0) = NaN;
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(blackzero)
caxis([0 350])

outlab = horzcat(imout,'/HughHeatmap_LFCAR_swathwidth_CloudWidth_cldtop.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);










%{
%%%%

figure
sgtitle(['filt:LFCAR;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(1,3,1)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_MaxMagnitude',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
%
subplot(1,3,2)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_MaxMagnitude',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
%
subplot(1,3,3)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];

% outlab = horzcat(imout,'/HughHeatmap_LFCAR_SwathWidth_cldupdraftmax.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);

%%%%%%

figure
sgtitle(['filt:LFCAR;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(1,3,1)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_MaxMagnitude',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,2)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_MaxMagnitude',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,3)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)


% outlab = horzcat(imout,'/HughHeatmap_LFCAR_CloudWidth_cldupdraftmax.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);

%}


%%%%%%
%%%%%%  make a version where you've run your RHacbl, Rcloud, Ztop_cloud
%%%%%%  through hugh's 2022 expression.
%%%%%% 

%{
Hugh's output:

Here's the file with the theoretical Ztop for all cases/updrafts/times (non-empty). 
[It's small so I just output as ASCII. The columns are labeled in the top row, and are: 
1) case index, 
2) updraft index, 
3) time index, 
4) updraft area (m^2), 
5) updraft radius (m),
6) 0-1.5 km above LFC mean RH (no units), and 
7) theoretical Ztop relative to ASL (m). 
Empty values are filled with -NaN or -999.000000. ' ...
'Note that in idl array indices start at 0 (as a default) so the case/updraft/time 
indices start at 0 as you can see in the output file.]
%}

%my input to Hugh's code - using one profile per cloudy updraft (the one
%with median mucape of the 8 in the ring), made with:
% .../ICLASS/LASSO_stuff/Hugh_env_profiles_oneprof_medianCAPE.m
%note, there are other scripts with attempts to make a 8-prof-mean profile
%that I ultimately didn't use for this, but prob could (.../LASSO_stuff/Hugh_env_profiles_pertimeoutput.m)
ncfile  = ['/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/ProfilesForHugh_mediancape.nc'] ;
%hugh's output
Hughdat = open('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/HUGHoutput_theory_ztop_L0.4R_v1.dat') ;

H_case = Hughdat.textdata(:,1) ;        H_case(1:2) = [];
H_updraft = Hughdat.textdata(:,2) ;     H_updraft(1:2) = [];
H_time = Hughdat.textdata(:,3) ;        H_time(1:2) = [];
H_Warea = Hughdat.textdata(:,4) ;       H_Warea(1:2) = [];
H_Wrad = Hughdat.textdata(:,5) ;        H_Wrad(1:2) = [];
H_RHacbl = Hughdat.textdata(:,6) ;      H_RHacbl(1:2) = [];
H_Wtop = Hughdat.textdata(:,7) ;        H_Wtop(1:2) = [];

H_updraft   = str2double(H_updraft) ;
H_case      = str2double(H_case) ;
H_time      = str2double(H_time) ;
H_RHacbl    = str2double(H_RHacbl) ;
H_Warea     = str2double(H_Warea) ;
H_Wrad      = str2double(H_Wrad) ;
H_Wtop      = str2double(H_Wtop) ;

H_case(H_case == -999.) = NaN;
H_updraft(H_updraft == -999.) = NaN;
H_time(H_time == -999.) = NaN;
H_Warea(H_Warea == -999.) = NaN;
H_Wrad(H_Wrad == -999.) = NaN;
H_RHacbl(H_RHacbl == -999.) = NaN;
H_Wtop(H_Wtop == -999.) = NaN;
H_updraft   = H_updraft + 1;
H_case      = H_case + 1 ;
H_time      = H_time + 1 ;

Lasso_Wtop = ncread(ncfile,'updraft_topZasl');
[la lb lc]  = size(Lasso_Wtop);

L_Wtop = [];
L_case = [] ;
L_updraft = [] ;
L_time = [] ;

for c = 1:lc
    for u = 1:lb
        for t = 1:la
            L_Wtop = vertcat(L_Wtop, Lasso_Wtop(t,u,c) );
            L_case = vertcat(L_case,c);
            L_time = vertcat(L_time,t);
            L_updraft = vertcat(L_updraft,u);
        end
    end
end

CLDupdraft_Radius       =  H_Wrad/1000;   
MesoAscent_RHaloft      =  H_RHacbl;

%simulated/sampled from LASSO:
CLDupdraft_topZasl      =  L_Wtop;  

%theoretical to from hugh:
CLDupdraft_topZasl      =  H_Wtop;  

%%%%%% kludge reset >10km cloud top to 10 km asl
CLDupdraft_topZasl(CLDupdraft_topZasl>10000) = 10000;

RCstart = 0;   RCinc = 0.3;   RCend = 6;
RHstart = 30/100;   RHinc = 6/100;   RHend = 90/100;

RCdisc = [ RCstart : RCinc : RCend ];%.^2;
RHdisc = [ RHstart : RHinc : RHend ];

CLDupdraft_RadiusD  = discretize(CLDupdraft_Radius,  RCdisc);
MesoAscent_RHaloftD = discretize(MesoAscent_RHaloft, RHdisc);

RClab = [ (RCstart+(RCinc/2)) : RCinc : (RCend-(RCinc/2))  ];%.^2 ; 
RHlab = [ (RHstart+(RHinc/2)) : RHinc : (RHend-(RHinc/2))  ] ;  


for i = 1:length(RClab)
    CLDupdraft_RadiusD(  CLDupdraft_RadiusD == i  ) = RClab(i);
end
for i = 1:length(RHlab)
    MesoAscent_RHaloftD( MesoAscent_RHaloftD == i  ) = RHlab(i);
end

CLDupdraft_Radius_numsamples = CLDupdraft_RadiusD;   
CLDupdraft_Radius_numsamples( isnan(CLDupdraft_Radius_numsamples)==0 ) = 1;
CLDupdraft_Radius_numsamples( find(CLDupdraft_Radius_numsamples==0) ) = NaN;


%concat together
tabl = table(MesoAscent_RHaloftD,CLDupdraft_RadiusD,CLDupdraft_topZasl,CLDupdraft_Radius_numsamples);


dualpol_colmap



figure('position',[260,221,908,539])  %260,221,854,539

subplot(2,2,1)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
%caxis([3000 5000])
caxis([3000 12000])


%
subplot(2,2,3)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','mean','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
%caxis([3000 6500])
caxis([3000 12000])

subplot(2,2,4)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 12000])

blackzero =jet(5000);
blackzero = cat(1,[1 1 1],blackzero);

subplot(2,2,2)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(blackzero)
%caxis([10 150])
caxis([0 350])







%{
Hugh's output:

Hi Jim, I've turned the crank on your new file. 
I also made a 2nd version that applies the min(zh,2*R) related to the vertical 
depth near-undilute ascent I mentioned before. So there are 2 data files. 
"v2" is without the min(zh,2*R), and "v3" is with this. 
These are in the same format as before, except now with an extra column 
of data with the profile number for each case/updraft/time (from 0 to 8). 

So the columns are labeled in the top row, and are: 
1) updraft profile index, 
2) case index, 
3) updraft index, 
4) time index, 
5) updraft area (m^2), 
6) updraft radius (m), 
7) 0-1.5 km above LFC mean RH (no units), and 
8) theoretical Ztop relative to ASL (m). 
Again, empty values are filled with -NaN or -999.000000.
%}

%my input to Hugh's code - using one profile per cloudy updraft (that has all 8 profiles), made with:
% .../ICLASS/LASSO_stuff/Hugh_env_profiles_oneprof_medianCAPE.m
%note, there are other scripts with attempts to make a 8-prof-mean profile
%that I ultimately didn't use for this, but prob could (.../LASSO_stuff/Hugh_env_profiles_onprof_allsondes.m)
ncfile  = ['/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/ProfilesForHugh_8sites_fixed.nc'] ;
%hugh's output
% Hughdat = open('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/profs8_theory_ztop_L04R_v2.dat'); %HUGHoutput_theory_ztop_L0.4R_v2.dat') ;
% H_profileloc = Hughdat.profs8_theory_ztop_L04R_v2(:,1) ;  %H_profileloc(1:2) = [];
% H_case = Hughdat.profs8_theory_ztop_L04R_v2(:,2) ;        %H_case(1:2) = [];
% H_updraft = Hughdat.profs8_theory_ztop_L04R_v2(:,3) ;     %H_updraft(1:2) = [];
% H_time = Hughdat.profs8_theory_ztop_L04R_v2(:,4) ;        %H_time(1:2) = [];
% H_Warea = Hughdat.profs8_theory_ztop_L04R_v2(:,5) ;       %H_Warea(1:2) = [];
% H_Wrad = Hughdat.profs8_theory_ztop_L04R_v2(:,6) ;        %H_Wrad(1:2) = [];
% H_RHacbl = Hughdat.profs8_theory_ztop_L04R_v2(:,7) ;      %H_RHacbl(1:2) = [];
% H_Wtop = Hughdat.profs8_theory_ztop_L04R_v2(:,8) ;        %H_Wtop(1:2) = [];

Hughdat = open('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/profs8_theory_ztop_L04R_v3.dat'); %HUGHoutput_theory_ztop_L0.4R_v2.dat') ;
H_profileloc = Hughdat.profs8_theory_ztop_L04R_v3(:,1) ;  %H_profileloc(1:2) = [];
H_case = Hughdat.profs8_theory_ztop_L04R_v3(:,2) ;        %H_case(1:2) = [];
H_updraft = Hughdat.profs8_theory_ztop_L04R_v3(:,3) ;     %H_updraft(1:2) = [];
H_time = Hughdat.profs8_theory_ztop_L04R_v3(:,4) ;        %H_time(1:2) = [];
H_Warea = Hughdat.profs8_theory_ztop_L04R_v3(:,5) ;       %H_Warea(1:2) = [];
H_Wrad = Hughdat.profs8_theory_ztop_L04R_v3(:,6) ;        %H_Wrad(1:2) = [];
H_RHacbl = Hughdat.profs8_theory_ztop_L04R_v3(:,7) ;      %H_RHacbl(1:2) = [];
H_Wtop = Hughdat.profs8_theory_ztop_L04R_v3(:,8) ;        %H_Wtop(1:2) = [];


% Hughdat = open('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/profs8_theory_ztop_L05R_v3.dat'); %HUGHoutput_theory_ztop_L0.4R_v2.dat') ;
% H_profileloc = Hughdat.profs8_theory_ztop_L05R_v3(:,1) ;  %H_profileloc(1:2) = [];
% H_case = Hughdat.profs8_theory_ztop_L05R_v3(:,2) ;        %H_case(1:2) = [];
% H_updraft = Hughdat.profs8_theory_ztop_L05R_v3(:,3) ;     %H_updraft(1:2) = [];
% H_time = Hughdat.profs8_theory_ztop_L05R_v3(:,4) ;        %H_time(1:2) = [];
% H_Warea = Hughdat.profs8_theory_ztop_L05R_v3(:,5) ;       %H_Warea(1:2) = [];
% H_Wrad = Hughdat.profs8_theory_ztop_L05R_v3(:,6) ;        %H_Wrad(1:2) = [];
% H_RHacbl = Hughdat.profs8_theory_ztop_L05R_v3(:,7) ;      %H_RHacbl(1:2) = [];
% H_Wtop = Hughdat.profs8_theory_ztop_L05R_v3(:,8) ;        %H_Wtop(1:2) = [];

% H_profileloc   = str2double(H_profileloc) ;
% H_updraft   = str2double(H_updraft) ;
% H_case      = str2double(H_case) ;
% H_time      = str2double(H_time) ;
% H_RHacbl    = str2double(H_RHacbl) ;
% H_Warea     = str2double(H_Warea) ;
% H_Wrad      = str2double(H_Wrad) ;
% H_Wtop      = str2double(H_Wtop) ;

H_profileloc(H_profileloc == -999.) = NaN;
H_case(H_case == -999.) = NaN;
H_updraft(H_updraft == -999.) = NaN;
H_time(H_time == -999.) = NaN;
H_Warea(H_Warea == -999.) = NaN;
H_Wrad(H_Wrad == -999.) = NaN;
H_RHacbl(H_RHacbl == -999.) = NaN;
H_Wtop(H_Wtop == -999.) = NaN;

%"correct" (IMHO)
H_updraft   = H_updraft + 1;
H_case      = H_case + 1 ;
H_time      = H_time + 1 ;
H_profileloc = H_profileloc + 1 ;


%note: loc1 (of 8) is really loc 2 out of 9 in my original notation:
loc1 = find( H_profileloc == 1 );
loc2 = find( H_profileloc == 2 );
loc3 = find( H_profileloc == 3 );
loc4 = find( H_profileloc == 4 );
loc5 = find( H_profileloc == 5 );
loc6 = find( H_profileloc == 6 );
loc7 = find( H_profileloc == 7 );
loc8 = find( H_profileloc == 8 );

%arrange to be f(loc,:), where (:) = <t,w#,case>(:)  --- note, just to be
%confusing, #cases = 8 also #profsites = 8
Hlocs_Wtop = cat(2, H_Wtop(loc1),H_Wtop(loc2),H_Wtop(loc3),H_Wtop(loc4),H_Wtop(loc5),H_Wtop(loc6),H_Wtop(loc7),H_Wtop(loc8)) ;
Hlocs_RHa  = cat(2, H_RHacbl(loc1),H_RHacbl(loc2),H_RHacbl(loc3),H_RHacbl(loc4),H_RHacbl(loc5),H_RHacbl(loc6),H_RHacbl(loc7),H_RHacbl(loc8)) ;
Hlocs_Wrad = cat(2, H_Wrad(loc1),H_Wrad(loc2),H_Wrad(loc3),H_Wrad(loc4),H_Wrad(loc5),H_Wrad(loc6),H_Wrad(loc7),H_Wrad(loc8)) ;
Hlocs = cat(2, 1, 2, 3, 4, 5, 6, 7, 8) ;


Lasso_Wtop = ncread(ncfile,'updraft_topZasl');
[la lb lc]  = size(Lasso_Wtop);
lp = 8;

L_Wtop = [];
L_case = [] ;
L_updraft = [] ;
L_time = [] ;
L_ploc = [] ;
for c = 1:lc
    for u = 1:lb
        for t = 1:la
            % L_Wtop = vertcat(L_Wtop, Lasso_Wtop(t,u,c) );
            for p = 1:lp
                L_case = vertcat(L_case,c);
                L_time = vertcat(L_time,t);
                L_updraft = vertcat(L_updraft,u);
                L_ploc = vertcat(L_ploc,p);
                L_Wtop = vertcat(L_Wtop, Lasso_Wtop(t,u,c) );
            end
        end
    end
end

% %  Lasso_Wtop(29,1,1)
% tally = 0;
% for m = 1:420000
%     if( isnan( L_Wtop(m) - H_Wtop(m) ) == 0  )
%         tally = tally + 1;
%     end
% end

%{
%%%%%%%%%%%%%%% method 1: pick a random single profile site for each updraft
randloc = randi([1 8],1,52500);
randrad = zeros(1,52500);
randHWtop = zeros(1,52500);
randrh = zeros(1,52500);
for l = 1:length(randrad)
    randrad(l)   = Hlocs_Wrad(l,randloc(l));
    randHWtop(l) = Hlocs_Wtop(l,randloc(l));
    randrh(l)    = Hlocs_RHa(l,randloc(l));
end
CLDupdraft_Radius       =  randrad/1000;   
MesoAscent_RHaloft      =  randrh;
%simulated/sampled from LASSO:
CLDupdraft_topZasl      =  L_Wtop;  
%theoretical to from hugh:
CLDupdraft_topZasl      =  randHWtop;  
%
%%%%%% kludge reset >10km cloud top to 10 km asl
CLDupdraft_topZasl(CLDupdraft_topZasl>10000) = 10000;
%
RCstart = 0;   RCinc = 0.3;   RCend = 6;
RHstart = 30/100;   RHinc = 6/100;   RHend = 90/100;
RCdisc = [ RCstart : RCinc : RCend ];%.^2;
RHdisc = [ RHstart : RHinc : RHend ];
%
CLDupdraft_RadiusD  = discretize(CLDupdraft_Radius,  RCdisc);
MesoAscent_RHaloftD = discretize(MesoAscent_RHaloft, RHdisc);
RClab = [ (RCstart+(RCinc/2)) : RCinc : (RCend-(RCinc/2))  ];%.^2 ; 
RHlab = [ (RHstart+(RHinc/2)) : RHinc : (RHend-(RHinc/2))  ] ;  
%
for i = 1:length(RClab)
    CLDupdraft_RadiusD(  CLDupdraft_RadiusD == i  ) = RClab(i);
end
for i = 1:length(RHlab)
    MesoAscent_RHaloftD( MesoAscent_RHaloftD == i  ) = RHlab(i);
end
%
CLDupdraft_Radius_numsamples = CLDupdraft_RadiusD;   
CLDupdraft_Radius_numsamples( isnan(CLDupdraft_Radius_numsamples)==0 ) = 1;
CLDupdraft_Radius_numsamples( find(CLDupdraft_Radius_numsamples==0) ) = NaN;
%
%concat together
MesoAscent_RHaloftD  = MesoAscent_RHaloftD';
CLDupdraft_RadiusD   = CLDupdraft_RadiusD';
CLDupdraft_topZasl   = CLDupdraft_topZasl';
CLDupdraft_Radius_numsamples  = CLDupdraft_Radius_numsamples';
%
tabl = table(MesoAscent_RHaloftD,CLDupdraft_RadiusD,CLDupdraft_topZasl,CLDupdraft_Radius_numsamples);
%
dualpol_colmap
figure('position',[260,221,908,539])  %260,221,854,539
%
subplot(2,2,1)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
%caxis([3000 5000])
caxis([3000 12000])
%
subplot(2,2,3)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','mean','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
%caxis([3000 6500])
caxis([3000 12000])
%
subplot(2,2,4)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 12000])
%
blackzero =jet(5000);
blackzero = cat(1,[1 1 1],blackzero);
subplot(2,2,2)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(blackzero)
%caxis([10 150])
caxis([0 350])
%}




%%%%%%%%%%%%%%% method 2: use all 8 profile sites as individual samples
%%%%%%%%%%%%%%% applied to their updraft

Hlocs_all8_Wtop = cat(1, H_Wtop(loc1),H_Wtop(loc2),H_Wtop(loc3),H_Wtop(loc4),H_Wtop(loc5),H_Wtop(loc6),H_Wtop(loc7),H_Wtop(loc8)) ;
Hlocs_all8_RHa  = cat(1, H_RHacbl(loc1),H_RHacbl(loc2),H_RHacbl(loc3),H_RHacbl(loc4),H_RHacbl(loc5),H_RHacbl(loc6),H_RHacbl(loc7),H_RHacbl(loc8)) ;
Hlocs_all8_Wrad = cat(1, H_Wrad(loc1),H_Wrad(loc2),H_Wrad(loc3),H_Wrad(loc4),H_Wrad(loc5),H_Wrad(loc6),H_Wrad(loc7),H_Wrad(loc8)) ;

Llocs_all8_Wtop = cat(1, L_Wtop(loc1),L_Wtop(loc2),L_Wtop(loc3),L_Wtop(loc4),L_Wtop(loc5),L_Wtop(loc6),L_Wtop(loc7),L_Wtop(loc8)) ;


CLDupdraft_Radius       =  Hlocs_all8_Wrad/1000;   
MesoAscent_RHaloft      =  Hlocs_all8_RHa;
% %simulated/sampled from LASSO:
% CLDupdraft_topZasl      =  Llocs_all8_Wtop;  
%theoretical to from hugh:
CLDupdraft_topZasl      =  Hlocs_all8_Wtop;  
%%%%% kludge reset >10km cloud top to 10 km asl
CLDupdraft_topZasl(CLDupdraft_topZasl>10000) = 10000;
%
RCstart = 0;   RCinc = 0.3;   RCend = 6;
RHstart = 30/100;   RHinc = 6/100;   RHend = 90/100;
RCdisc = [ RCstart : RCinc : RCend ];%.^2;
RHdisc = [ RHstart : RHinc : RHend ];
%
CLDupdraft_RadiusD  = discretize(CLDupdraft_Radius,  RCdisc);
MesoAscent_RHaloftD = discretize(MesoAscent_RHaloft, RHdisc);
RClab = [ (RCstart+(RCinc/2)) : RCinc : (RCend-(RCinc/2))  ];%.^2 ; 
RHlab = [ (RHstart+(RHinc/2)) : RHinc : (RHend-(RHinc/2))  ] ;  
%
for i = 1:length(RClab)
    CLDupdraft_RadiusD(  CLDupdraft_RadiusD == i  ) = RClab(i);
end
for i = 1:length(RHlab)
    MesoAscent_RHaloftD( MesoAscent_RHaloftD == i  ) = RHlab(i);
end
%
CLDupdraft_Radius_numsamples = CLDupdraft_RadiusD;   
CLDupdraft_Radius_numsamples( isnan(CLDupdraft_Radius_numsamples)==0 ) = 1;
CLDupdraft_Radius_numsamples( find(CLDupdraft_Radius_numsamples==0) ) = NaN;
%
%concat together
MesoAscent_RHaloftD  = MesoAscent_RHaloftD;
CLDupdraft_RadiusD   = CLDupdraft_RadiusD;
CLDupdraft_topZasl   = CLDupdraft_topZasl;
CLDupdraft_Radius_numsamples  = CLDupdraft_Radius_numsamples;
%
tabl = table(MesoAscent_RHaloftD,CLDupdraft_RadiusD,CLDupdraft_topZasl,CLDupdraft_Radius_numsamples);
%
dualpol_colmap
figure('position',[260,221,908,539])  %260,221,854,539
%
subplot(2,2,1)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
%caxis([3000 5000])
caxis([3000 10000])% caxis([3000 12000])
%
subplot(2,2,3)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','mean','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
%caxis([3000 6500])
caxis([3000 10000])% 
%caxis([3000 12000])
%
subplot(2,2,4)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 10000])% 
%caxis([3000 12000])
%
blackzero =jet(5000);
blackzero = cat(1,[1 1 1],blackzero);
subplot(2,2,2)
h = heatmap(tabl,'MesoAscent_RHaloftD','CLDupdraft_RadiusD','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(blackzero)
%caxis([10 150])
caxis([0 1000])


outlab = horzcat(imout,'/HughHeatmap_LFCAR_L0.4v3_predictedBtop.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);




%{

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% after talking with Hugh at AMS, some ideas for more dissected versions
%%%% of this plot:  CAPE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% now make heatmap plots: 

%pick the swath time rel to cloudy time:
TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; -# to go a # dt prior to cloud time (native 5min LASSO dt)
             % t=1 = curent time, 2= current time - 5min, 3= -10min, 4= -15min...

%Hugh-like vars:
CLDupdraft_area       =  max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2) ;   % 
    CLDupdraft_area = permute(CLDupdraft_area ,[1 3 4 2]);
CLDupdraft_Radius     =  ((CLDupdraft_area/3.14159).^0.5)/1000;      %circ equiv rad [km]
CLDupdraft_MaxMagnitude = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ;
    CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);

    cht_mask = CLDupdraft_area;  
    cht_mask(:) = NaN; 
    cht_mask( isnan(CLDupdraft_area)==0 )=1;  
CLDupdraft_topZasl    =  wid_maxk_topasl_ALLCASES(:,:,:) .* cht_mask;

MesoAscent_width      =  widLFCAR_mesoWwidth_ALLCASES(:,:,TIMLG,:) ; %/ 2;            % converting to radius (along longitude)  [km]
    MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
%MesoAscent_RHaloft    =  permute(widLFCAR_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,:),[1 2 4 3])  .* cht_mask;
MesoAscent_RHaloft    =   (FwID_RH_mean_ACBL_ALLCASES/100) .* cht_mask;

MesoAscent_deepCAPE    =   FwID_MUACBLCAPE_ALLCASES .* cht_mask;
 MesoAscent_deepCAPE    =   FwID_MUCAPE_ALLCASES .* cht_mask;
MesoAscent_shear06     =   FwID_shear_mag_bulk_0to6km_ALLCASES .* cht_mask;

size(MesoAscent_deepCAPE)
length(find(isnan(MesoAscent_deepCAPE)==0))
size(CLDupdraft_topZasl)
length(find(isnan(CLDupdraft_topZasl)==0))


% %filter out tall ones:
% kill = find( CLDupdraft_topZasl > 6000. );
% CLDupdraft_topZasl(kill) = NaN;
% CLDupdraft_Radius(kill) = NaN;
% CLDupdraft_MaxMagnitude(kill) = NaN;
% CLDupdraft_topZasl(kill) = NaN;
% MesoAscent_width(kill)                = NaN;
% MesoAscent_RHaloft(kill)         = NaN;

% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
%just kill the mesoascent fields so that we can still compare cldy
%updrafts to near-cloud sounding metrics

dist = abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,:) );  dist = permute(dist,[1 2 4 3]);

kill = find(  dist  >  distswathwid_thresh  );
CLDupdraft_area(kill) = NaN;
CLDupdraft_Radius(kill) = NaN;
CLDupdraft_MaxMagnitude(kill) = NaN;
CLDupdraft_topZasl(kill) = NaN;
% MesoAscent_Wmagnitude(kill)           = NaN;
MesoAscent_width(kill)                = NaN;
MesoAscent_RHaloft(kill)         = NaN;
MesoAscent_deepCAPE(kill)         = NaN;
MesoAscent_shear06(kill)         = NaN;


mask = find(isnan(CLDupdraft_topZasl)==0) ;

size(MesoAscent_deepCAPE)
length(find(isnan(MesoAscent_deepCAPE)==0))
size(CLDupdraft_topZasl)
length(find(isnan(CLDupdraft_topZasl)==0))

% filter by CAPE (all cases thrown together, not hi,mid,lo cape days):
% figure; histogram(MesoAscent_deepCAPE(:),40)
% cape20 = prctile(MesoAscent_deepCAPE(:),20)
% cape33 = prctile(MesoAscent_deepCAPE(:),33)
% cape50 = prctile(MesoAscent_deepCAPE(:),50)
% cape66 = prctile(MesoAscent_deepCAPE(:),66)
% cape80 = prctile(MesoAscent_deepCAPE(:),80)
mean(MesoAscent_deepCAPE(:),'omitnan') - std(MesoAscent_deepCAPE(:),'omitnan')
mean(MesoAscent_deepCAPE(:),'omitnan') + std(MesoAscent_deepCAPE(:),'omitnan')

%{
figure; 
subplot(2,4,1)
histogram(MesoAscent_deepCAPE(:),40)
title('all cases together')
subplot(2,4,2)
histogram(MesoAscent_deepCAPE(:,:,1),40)
title('case=1 29 Nov')
subplot(2,4,3)
histogram(MesoAscent_deepCAPE(:,:,2),40)
title('case=2 4 Dec')
subplot(2,4,4)
histogram(MesoAscent_deepCAPE(:,:,3),40)
title('case=3 22 Jan')
subplot(2,4,5)
histogram(MesoAscent_deepCAPE(:,:,4),40)
title('case=4 23 Jan')
xlabel('mucape')
subplot(2,4,6)
histogram(MesoAscent_deepCAPE(:,:,5),40)
title('case=5 25 Jan')
xlabel('mucape')
subplot(2,4,7)
histogram(MesoAscent_deepCAPE(:,:,6),40)
title('case=6 29 Jan')
xlabel('mucape')
subplot(2,4,8)
histogram(MesoAscent_deepCAPE(:,:,7),40)
title('case=7 8 Feb')
xlabel('mucape')
%}

% %lo
% CAPEs = 100;
% CAPEf = 1200;
% %mid
% CAPEs = 1200;
% CAPEf = 2200;
% %hi
% CAPEs = 2200;
% CAPEf = 10000;

%acbl:
% lower33%
CAPEs = 0;  CAPEf = 80;
% upper33
CAPEs = 115;  CAPEf = 300;

%bimode rather than trimode
%lo
CAPEs = 100;
CAPEf = 1600;
%hi
CAPEs = 1600;
CAPEf = 10000;

%   CAPEs = 100   CAPEf = 10000;


kill = find( MesoAscent_deepCAPE < CAPEs  |  MesoAscent_deepCAPE > CAPEf );
CLDupdraft_MaxMagnitude(kill) = NaN;
CLDupdraft_Radius(kill) = NaN;    
CLDupdraft_topZasl(kill) = NaN;    
MesoAscent_width(kill) = NaN;            
MesoAscent_RHaloft(kill) = NaN;    

CLDupdraft_MaxMagnitude = CLDupdraft_MaxMagnitude(:);
CLDupdraft_Radius2     =  CLDupdraft_Radius(:) ;% .* CLDupdraft_Radius(:);
CLDupdraft_topZasl    =  CLDupdraft_topZasl(:);
MesoAscent_width2      =  MesoAscent_width(:) ;%.* MesoAscent_width(:);       
MesoAscent_RHaloft    =  MesoAscent_RHaloft(:);

% RCstart = 0;   RCinc = 0.2;   RCend = 6;
% RSstart = 0.2;   RSinc = 0.2;   RSend = 4.6;
% RHstart = 30;   RHinc = 2;   RHend = 90;

RCstart = 0;   RCinc = 0.3;   RCend = 6;
RSstart = 0.2;   RSinc = 0.2;   RSend = 4.6;
RHstart = 30/100;   RHinc = 4/100;   RHend = 90/100;


% RCstart = 0;   RCinc = 0.4;   RCend = 6;
% RSstart = 0.2;   RSinc = 0.2;   RSend = 4.6;
% RHstart = 30;   RHinc = 5;   RHend = 90;
% 
% RCstart = 0;   RCinc = 0.5;   RCend = 6;
% RSstart = 0.2;   RSinc = 0.2;   RSend = 4.6;
% RHstart = 30;   RHinc = 6;   RHend = 90;
% 
% RCstart = 0;   RCinc = 3;   RCend = 6;
% RSstart = 0.2;   RSinc = 0.2;   RSend = 4.6;
% RHstart = 30;   RHinc = 30;   RHend = 90;

RCdisc = [ RCstart : RCinc : RCend ];%.^2;
RSdisc = [ RSstart : RSinc : RSend ];%.^2;
RHdisc = [ RHstart : RHinc : RHend ];

CLDupdraft_Radius0  = discretize(CLDupdraft_Radius2,  RCdisc);
MesoAscent_width0   = discretize(MesoAscent_width2,   RSdisc);
MesoAscent_RHaloft0 = discretize(MesoAscent_RHaloft, RHdisc);

RClab = [ (RCstart+(RCinc/2)) : RCinc : (RCend-(RCinc/2))  ];%.^2 ; 
RSlab = [ (RSstart+(RSinc/2)) : RSinc : (RSend-(RSinc/2))  ];%.^2 ; 
RHlab = [ (RHstart+(RHinc/2)) : RHinc : (RHend-(RHinc/2))  ] ;  

CLDupdraft_Radius2   =  CLDupdraft_Radius0  ;
MesoAscent_width2    =  MesoAscent_width0  ;
MesoAscent_RHaloft  =  MesoAscent_RHaloft0  ;

for i = 1:length(RClab)
    CLDupdraft_Radius2(  CLDupdraft_Radius2 == i  ) = RClab(i);
end
for i = 1:length(RSlab)
    MesoAscent_width2(  MesoAscent_width2 == i  ) = RSlab(i);
end
for i = 1:length(RHlab)
    MesoAscent_RHaloft( MesoAscent_RHaloft == i  ) = RHlab(i);
end

CLDupdraft_Radius_numsamples = CLDupdraft_Radius2;   
CLDupdraft_Radius_numsamples( isnan(CLDupdraft_Radius_numsamples)==0 ) = 1;
CLDupdraft_Radius_numsamples( find(CLDupdraft_Radius_numsamples==0) ) = NaN;


%concat together
tabl = table(MesoAscent_RHaloft,MesoAscent_width2,CLDupdraft_Radius2,CLDupdraft_topZasl,CLDupdraft_Radius_numsamples,CLDupdraft_MaxMagnitude);

figure('position',[232,249,848,527])

ax1 = axes;
sgtitle(['CAPE betweeen',num2str(CAPEs),'and',num2str(CAPEf),' filt:LFCAR;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(2,2,1)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 6000])
caxis([3500 12000])

%axis([RHlab(1) RHlab(2) RClab(1) RClab(2) ])

% %throw on hugh curves:
% figure
% R0 = ( 0.5 * (1-RHlab) ).^0.5;
% R11 = ( 1.5 * (1-RHlab) ).^0.5;
% R1 = ( 5 * (1-RHlab) ).^0.5;
% R2 = ( 10 * (1-RHlab) ).^0.5;
% R3 = ( 15 * (1-RHlab) ).^0.5;
% R4 = (20 * (1-RHlab) ).^0.5;
% plot(RHlab,R0)
% hold on
% plot(RHlab,R11)
% plot(RHlab,R1)
% plot(RHlab,R2)
% plot(RHlab,R3)
% plot(RHlab,R4)
% axis([0.3 0.9 0.3 3])

%
subplot(2,2,3)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','mean','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
%caxis([3000 6000])
caxis([3500 12000])

subplot(2,2,4)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3500 12000])
%caxis([3000 6000])

blackzero =jet(5000);
blackzero = cat(1,[1 1 1],blackzero);

subplot(2,2,2)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(blackzero)
%caxis([10 150])
caxis([0 200])


% outlab = horzcat(imout,'/HughHeatmap_LFCAR_SwathWidth_cldtop.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% after talking with Hugh at AMS, some ideas for more dissected versions
%%%% of this plot:  SHEAR
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% now make heatmap plots: 

%pick the swath time rel to cloudy time:
TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; -# to go a # dt prior to cloud time (native 5min LASSO dt)
             % t=1 = curent time, 2= current time - 5min, 3= -10min, 4= -15min...

%Hugh-like vars:
CLDupdraft_area       =  max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2) ;   % 
    CLDupdraft_area = permute(CLDupdraft_area ,[1 3 4 2]);
CLDupdraft_Radius     =  ((CLDupdraft_area/3.14159).^0.5)/1000;      %circ equiv rad [km]
%CLDupdraft_MaxMagnitude = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ;
CLDupdraft_MaxMagnitude = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ;
    CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);

    cht_mask = CLDupdraft_area;  
    cht_mask(:) = NaN; 
    cht_mask( isnan(CLDupdraft_area)==0 )=1;  
CLDupdraft_topZasl    =  wid_maxk_topasl_ALLCASES(:,:,:) .* cht_mask;

MesoAscent_width      =  widLFCAR_mesoWwidth_ALLCASES(:,:,TIMLG,:) ; %/ 2;            % converting to radius (along longitude)  [km]
    MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
MesoAscent_RHaloft    =  permute(widLFCAR_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,:),[1 2 4 3]) .* cht_mask;
%MesoAscent_RHaloft    =   FwID_RH_mean_ACBL_ALLCASES .* cht_mask;

MesoAscent_deepCAPE    =   FwID_MUCAPE_ALLCASES .* cht_mask;
MesoAscent_shear06     =   FwID_shear_mag_bulk_0to6km_ALLCASES .* cht_mask;

size(MesoAscent_deepCAPE)
length(find(isnan(MesoAscent_deepCAPE)==0))
size(CLDupdraft_topZasl)
length(find(isnan(CLDupdraft_topZasl)==0))

% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
%just kill the mesoascent fields so that we can still compare cldy
%updrafts to near-cloud sounding metrics

dist = abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,:) );  dist = permute(dist,[1 2 4 3]);

kill = find(  dist  >  distswathwid_thresh );
CLDupdraft_area(kill) = NaN;
CLDupdraft_Radius(kill) = NaN;
CLDupdraft_MaxMagnitude(kill) = NaN;
CLDupdraft_topZasl(kill) = NaN;
% MesoAscent_Wmagnitude(kill)           = NaN;
MesoAscent_width(kill)                = NaN;
MesoAscent_RHaloft(kill)         = NaN;
MesoAscent_deepCAPE(kill)         = NaN;
MesoAscent_shear06(kill)         = NaN;


mask = find(isnan(CLDupdraft_topZasl)==0) ;

size(MesoAscent_deepCAPE)
length(find(isnan(MesoAscent_deepCAPE)==0))
size(CLDupdraft_topZasl)
length(find(isnan(CLDupdraft_topZasl)==0))

% filter by shear (all cases thrown together, not hi,mid,lo shear by day):
% figure; histogram(MesoAscent_shear06(:),40)

%bimode rather than trimode
%lo
CAPEs = 0;
CAPEf = 14.0;
%hi
CAPEs = 14.0;
CAPEf = 50;

kill = find( MesoAscent_shear06 < CAPEs  |  MesoAscent_shear06 > CAPEf );
CLDupdraft_MaxMagnitude(kill) = NaN;
CLDupdraft_Radius2(kill) = NaN;    
CLDupdraft_topZasl(kill) = NaN;    
MesoAscent_width2(kill) = NaN;            
MesoAscent_RHaloft(kill) = NaN;    

CLDupdraft_MaxMagnitude = CLDupdraft_MaxMagnitude(:);
CLDupdraft_Radius2     =  CLDupdraft_Radius(:) ;%.* CLDupdraft_Radius(:);
CLDupdraft_topZasl    =  CLDupdraft_topZasl(:);
MesoAscent_width2      =  MesoAscent_width(:) ;%.* MesoAscent_width(:);       
MesoAscent_RHaloft    =  MesoAscent_RHaloft(:);

RCstart = 0;   RCinc = 0.2;   RCend = 6;
RSstart = 0.2;   RSinc = 0.2;   RSend = 4.6;
RHstart = 30;   RHinc = 2;   RHend = 90;

RCdisc = [ RCstart : RCinc : RCend ];%.^2;
RSdisc = [ RSstart : RSinc : RSend ];%.^2;
RHdisc = [ RHstart : RHinc : RHend ];

CLDupdraft_Radius0  = discretize(CLDupdraft_Radius2,  RCdisc);
MesoAscent_width0   = discretize(MesoAscent_width2,   RSdisc);
MesoAscent_RHaloft0 = discretize(MesoAscent_RHaloft, RHdisc);

RClab = [ (RCstart+(RCinc/2)) : RCinc : (RCend-(RCinc/2))  ];%.^2 ; 
RSlab = [ (RSstart+(RSinc/2)) : RSinc : (RSend-(RSinc/2))  ];%.^2 ; 
RHlab = [ (RHstart+(RHinc/2)) : RHinc : (RHend-(RHinc/2))  ] ;  

CLDupdraft_Radius2   =  CLDupdraft_Radius0  ;
MesoAscent_width2    =  MesoAscent_width0  ;
MesoAscent_RHaloft  =  MesoAscent_RHaloft0  ;

for i = 1:length(RClab)
    CLDupdraft_Radius2(  CLDupdraft_Radius2 == i  ) = RClab(i);
end
for i = 1:length(RSlab)
    MesoAscent_width2(  MesoAscent_width2 == i  ) = RSlab(i);
end
for i = 1:length(RHlab)
    MesoAscent_RHaloft( MesoAscent_RHaloft == i  ) = RHlab(i);
end

CLDupdraft_Radius_numsamples = CLDupdraft_Radius2;   
CLDupdraft_Radius_numsamples( isnan(CLDupdraft_Radius_numsamples)==0 ) = 1;
CLDupdraft_Radius_numsamples( find(CLDupdraft_Radius_numsamples==0) ) = NaN;


%concat together
tabl = table(MesoAscent_RHaloft,MesoAscent_width2,CLDupdraft_Radius2,CLDupdraft_topZasl,CLDupdraft_Radius_numsamples,CLDupdraft_MaxMagnitude);


figure('position',[232,249,1084,539])

sgtitle(['S06 betweeen',num2str(CAPEs),'and',num2str(CAPEf),' filt:LFCAR;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(2,2,1)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 6500])

%
subplot(2,2,3)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','mean','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 6500])

subplot(2,2,4)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
h.MissingDataColor = [1 1 1];
caxis([3000 12000])

blackzero =jet(5000);
blackzero = cat(1,[1 1 1],blackzero);

subplot(2,2,2)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(blackzero)
%caxis([10 150])
caxis([0 150])


%}















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%  repeat with just the relatively deep updrafts. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%pick the swath time rel to cloudy time:
TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; -# to go a # dt prior to cloud time (native 5min LASSO dt)


%Hugh-like vars:
CLDupdraft_area       =  max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2) ;   % 
    CLDupdraft_area = permute(CLDupdraft_area ,[1 3 4 2]);
CLDupdraft_Radius     =  ((CLDupdraft_area/3.14159).^0.5)/1000;      %circ equiv rad [km]
%CLDupdraft_MaxMagnitude = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ;
CLDupdraft_MaxMagnitude = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ;
    CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);

    cht_mask = CLDupdraft_area;   cht_mask( isnan(CLDupdraft_area)==0 )=1;  
CLDupdraft_topZasl    =  wid_maxk_topasl_ALLCASES(:,:,:) .* cht_mask;


MesoAscent_width      =  widLFCARdeep_mesoWwidth_ALLCASES(:,:,TIMLG,:) / 2;            % converting to radius (along longitude)  [km]
%MesoAscent_RHaloft    =  widLFCAR_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,:);
MesoAscent_RHaloft    =   FwID_RH_mean_ACBL_ALLCASES(:);


% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
%just kill the mesoascent fields so that we can still compare cldy
%updrafts to near-cloud sounding metrics
kill = find(  abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,R) )  >  distswathwid_thresh  );
CLDupdraft_area(kill) = NaN;
CLDupdraft_Radius(kill) = NaN;
CLDupdraft_MaxMagnitude(kill) = NaN;
% MesoAscent_Wmagnitude(kill)           = NaN;
MesoAscent_width(kill)                = NaN;
MesoAscent_RHaloft(kill)         = NaN;
%     MesoAscent_DepthPerLfc(kill)          = NaN;
%     MesoAscent_LFCzagl(kill)              = NaN;


CLDupdraft_MaxMagnitude = CLDupdraft_MaxMagnitude(:);
CLDupdraft_Radius2     =  CLDupdraft_Radius(:) .* CLDupdraft_Radius(:);
CLDupdraft_topZasl    =  CLDupdraft_topZasl(:);
MesoAscent_width2      =  MesoAscent_width(:) .* MesoAscent_width(:);       
MesoAscent_RHaloft    =  MesoAscent_RHaloft(:);

RCstart = 0;   RCinc = 0.2;   RCend = 5;
RSstart = 0;   RSinc = 0.2;   RSend = 5;
RHstart = 30;   RHinc = 2;   RHend = 90;

RCdisc = [ RCstart : RCinc : RCend ].^2;
RSdisc = [ RSstart : RSinc : RSend ].^2;
RHdisc = [ RHstart : RHinc : RHend ];

CLDupdraft_Radius0  = discretize(CLDupdraft_Radius2,  RCdisc);
MesoAscent_width0   = discretize(MesoAscent_width2,   RSdisc);
MesoAscent_RHaloft0 = discretize(MesoAscent_RHaloft, RHdisc);

RClab = [ (RCstart+(RCinc/2)) : RCinc : (RCend-(RCinc/2))  ].^2 ; 
RSlab = [ (RSstart+(RSinc/2)) : RSinc : (RSend-(RSinc/2))  ].^2 ; 
RHlab = [ (RHstart+(RHinc/2)) : RHinc : (RHend-(RHinc/2))  ] ;  

CLDupdraft_Radius2   =  CLDupdraft_Radius0  ;
MesoAscent_width2    =  MesoAscent_width0  ;
MesoAscent_RHaloft  =  MesoAscent_RHaloft0  ;

for i = 1:length(RClab)
    CLDupdraft_Radius2(  CLDupdraft_Radius2 == i  ) = RClab(i);
end
for i = 1:length(RSlab)
    MesoAscent_width2(  MesoAscent_width2 == i  ) = RSlab(i);
end
for i = 1:length(RHlab)
    MesoAscent_RHaloft( MesoAscent_RHaloft == i  ) = RHlab(i);
end

CLDupdraft_Radius_numsamples = CLDupdraft_Radius2;   
CLDupdraft_Radius_numsamples( isnan(CLDupdraft_Radius_numsamples)==0 ) = 1;
CLDupdraft_Radius_numsamples( find(CLDupdraft_Radius_numsamples==0) ) = NaN;

tabl = table(MesoAscent_RHaloft,MesoAscent_width2,CLDupdraft_Radius2,CLDupdraft_topZasl,CLDupdraft_Radius_numsamples,CLDupdraft_MaxMagnitude);

figure
sgtitle(['filt:LFCARdeep;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(1,3,1)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,2)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,3)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)


figure
sgtitle(['filt:LFCARdeep;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(1,3,1)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,2)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_topZasl',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,3)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)

figure
sgtitle(['filt:LFCARdeep;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(1,3,1)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_MaxMagnitude',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,2)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_MaxMagnitude',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,3)
h = heatmap(tabl,'MesoAscent_RHaloft','MesoAscent_width2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)


figure
sgtitle(['filt:LFCARdeep;  cloud time lag:', num2str((TIMLG-1)*5),'min'])
subplot(1,3,1)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_MaxMagnitude',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,2)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_MaxMagnitude',...
    'ColorMethod','max','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)
%
subplot(1,3,3)
h = heatmap(tabl,'MesoAscent_RHaloft','CLDupdraft_Radius2','ColorVariable','CLDupdraft_Radius_numsamples',...
    'ColorMethod','count','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%  swath vs the outside world: 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%%% heatmap of swathw as function of east vs west upslope magnitude
swathstr = FullSDC_mesoWstrength_ALLCASES(:);
swathwid = FullSDC_mesoWwidth_ALLCASES(:);
eastup   = abs(FullSDC_eastupslopemean_ALLCASES(:));
westup   = FullSDC_westupslopemean_ALLCASES(:);
eastupfrac   =  FullSDC_eastupslopedepthfract_ALLCASES(:);
westupfrac   =  FullSDC_westupslopedepthfract_ALLCASES(:);

SD = discretize(swathstr,[0:0.5:10]);
SW = discretize(swathwid,[0:0.2:4]);

estart = 0;   einc = 0.5;   eend = 6;
wstart = 0;   winc = 0.5;   wend = 6;
eudisc = [ estart : einc : eend ];
wudisc = [ wstart : winc : wend ];
east_upslope0 = discretize(eastup, eudisc);
west_upslope0 = discretize(westup, wudisc);
eulab = [ (estart+(einc/2)) : einc : (eend-(einc/2))  ] ; 
wulab = [ (wstart+(winc/2)) : winc : (wend-(winc/2))  ] ; 
east_upslope  =  east_upslope0  ;
west_upslope  =  west_upslope0  ;
for i = 1:length(eulab)
    east_upslope(  east_upslope == i  ) = eulab(i);
end
for i = 1:length(wulab)
    west_upslope(  west_upslope == i  ) = wulab(i);
end


estart = 0;   einc = 0.1;   eend = 1;
wstart = 0;   winc = 0.1;   wend = 1;
efdisc = [ estart : einc : eend ];
wfdisc = [ wstart : winc : wend ];
east_upslope_fract0 = discretize(eastupfrac,efdisc);
west_upslope_fract0 = discretize(westupfrac,wfdisc);
eflab = [ (estart+(einc/2)) : einc : (eend-(einc/2))  ] ; 
wflab = [ (wstart+(winc/2)) : winc : (wend-(winc/2))  ] ; 
east_upslope_fract = east_upslope_fract0;
west_upslope_fract = west_upslope_fract0;
for i = 1:length(eflab)
    east_upslope_fract(  east_upslope_fract == i  ) = eflab(i);
end
for i = 1:length(wflab)
    west_upslope_fract(  west_upslope_fract == i  ) = wflab(i);
end

swathstr_numsamples = swathstr;   
%swathstr_numsamples( isnan(swathwid_numsamples)==0 ) = 1;   %is this wrong? 
swathstr_numsamples( isnan(swathstr_numsamples)==0 ) = 1;    %should it be this?
swathwid_numsamples = swathwid;   
swathwid_numsamples( isnan(swathwid_numsamples)==0 ) = 1;

%%%%% cut outliers
% % figure; hist(swathstr,[0:1:40])
% % find(swathstr > 20)

p99 = prctile(swathstr,99) ;
swathstr(swathstr > p99) = NaN;

tabl = table(east_upslope_fract,west_upslope_fract,east_upslope,west_upslope,SD,SW,eastup,westup,swathstr,swathwid,swathstr_numsamples,swathwid_numsamples);

figure
subplot(3,2,1)
h = heatmap(tabl,'east_upslope','west_upslope','ColorVariable','swathstr',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)

subplot(3,2,3)
h = heatmap(tabl,'east_upslope','west_upslope','ColorVariable','swathwid',...
    'ColorMethod','median','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)

subplot(3,2,5)
h = heatmap(tabl,'east_upslope','west_upslope','ColorVariable','swathstr_numsamples',...
    'ColorMethod','sum','CellLabelColor','none');
h.NodeChildren(3).YDir='normal';
colormap(jet)

% figure
% h = heatmap(tabl,'east_upslope','west_upslope','ColorVariable','swathwid_numsamples',...
%     'ColorMethod','sum','CellLabelColor','none');
% h.NodeChildren(3).YDir='normal';
% colormap(jet)




subplot(3,2,2)
h2 = heatmap(tabl,'east_upslope_fract','west_upslope_fract','ColorVariable','swathstr',...
    'ColorMethod','median','CellLabelColor','none');
h2.NodeChildren(3).YDir='normal';
colormap(jet)


subplot(3,2,4)
h2 = heatmap(tabl,'east_upslope_fract','west_upslope_fract','ColorVariable','swathwid',...
    'ColorMethod','median','CellLabelColor','none');
h2.NodeChildren(3).YDir='normal';
colormap(jet)

subplot(3,2,6)
h2 = heatmap(tabl,'east_upslope_fract','west_upslope_fract','ColorVariable','swathstr_numsamples',...
    'ColorMethod','sum','CellLabelColor','none');
h2.NodeChildren(3).YDir='normal';
colormap(jet)









% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%  shear vs wID tilt: 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% 
% %%% heatmap of wID Xtilt as function of E-W shear & upslope depth
% %swathstr = FullSDC_mesoWstrength_ALLCASES(:);
% % widbulktilt     =  ( widLFCARdeep_bulk_xcenttilt_ALLCASES .* widLFCARdeep_bulk_xcenttilt_ALLCASES + ...
% %                        widLFCARdeep_bulk_ycenttilt_ALLCASES .* widLFCARdeep_bulk_ycenttilt_ALLCASES ).^0.5 ;
% widbulktilt     =  ( widLFCARdeep_bulk_xcenttilt_ALLCASES );
% % eastshear       =  widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES;
% % eastdeepshear   =  widLFCARdeep_mesoWeast1to9aslTOTMAGshear_ALLCASES;
% % eastupfrac      =  widLFCARdeep_eastupslopedepthfract_ALLCASES;
% % eastupslope     =  widLFCARdeep_eastupslopemean_ALLCASES;
% 
% 
% 
% figure('position',[239,91,1407,745]);
% sgtitle(' wID tilt vs shear;   filtered -  LFClayer,small area,no shallow ')
% 
% hold on
% for RR = 1:ar
%     BB = widbulktilt(:,:,RR); %max( widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan') ;
%     AA = widLFCARdeep_bulkUshearinupdraft_ALLCASES(:,:,RR); %max( wid_profs_centHTasl_ALLCASES(:,:,:,RR)/1000, [], 2, 'omitnan') ;  %note, this iarray is actually unfiltered, but filtered nans from the area field should take care of it
% 
%     kill = isnan(BB);
%     BB(kill) = []; AA(kill) = [];
%     kill = isnan(AA);
%     BB(kill) = []; AA(kill) = [];
%     if(RR==1)
%         scatter( BB(:),AA(:)','.r'); hold on
%         ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
%         linCo1 = polyfit(BB(:), AA(:), 1);
%         xFit1 = linspace(-30,30,30);
%         yFit1 = polyval(linCo1,xFit1);
% 
%     elseif(RR==2)
%         scatter( BB(:),AA(:)','.b'); hold on
%         ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
%         linCo2 = polyfit(BB(:), AA(:), 1);
%         xFit2 = linspace(-30,30,30);
%         yFit2 = polyval(linCo2,xFit2);
% 
%     elseif(RR==3)
%         scatter( BB(:),AA(:)','.g' ); hold on
%         ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
%         linCo3 = polyfit(BB(:), AA(:), 1);
%         xFit3 = linspace(-30,30,30);
%         yFit3 = polyval(linCo3,xFit3);
% 
%     elseif(RR==4)
%         scatter( BB(:),AA(:)','.c' ); hold on
%         ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
%         linCo4 = polyfit(BB(:), AA(:), 1);
%         xFit4 = linspace(-30,30,30);
%         yFit4 = polyval(linCo4,xFit4);
% 
% 
%     elseif(RR==5)
%         scatter( BB(:),AA(:)','.m' ); hold on
%     elseif(RR==6)
%         scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
%     elseif(RR==7)
%         scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
%     elseif(RR==8)
%         scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
%     end
% end
% BB =   widbulktilt;   %max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2,'omitnan'); 
% AA =   widLFCARdeep_bulkUshearinupdraft_ALLCASES; %max( wid_profs_centHTasl_ALLCASES(:,:,:,:)/1000, [], 2, 'omitnan');
% kill = isnan(BB);
% BB(kill) = []; AA(kill) = [];
% kill = isnan(AA);
% BB(kill) = []; AA(kill) = [];
% 
% ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
% linCo = polyfit(BB(:), AA(:), 1);
% xFit = linspace(-30,30,30);
% yFit = polyval(linCo,xFit);
% 
% plot(xFit1,yFit1,'r')
% plot(xFit2,yFit2,'b')
% plot(xFit3,yFit3,'g')
% plot(xFit4,yFit4,'c')
% plot(xFit,yFit,'k')
% 
% legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 12);
% 
% axis([0.0 2.5 -10 30 ])
% title(['Combined popul corcoeff = ', num2str(ccrall) ])
% %xlabel('wid''s mesoWswath strength ALLCASES');
% xlabel(' updraft X-tilt (m/m)');
% ylabel(' bulk U-shear in updraft layer (m/s)');
 


















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%   big picture plots
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%% times of day of CI events: 

ff = figure; 
ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
clear BB
%BB = prepost_timehr_ALLCASES(5,:,:); 
BB = hour_cell_ALLCASES(1,:,:); 
AA = permute(BB,[2 3 1]);
edges = [12:0.25:23];
histogram(AA(:),'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title('Distribution of CI times for all cases')
xlabel(' time (hr) ')
ylabel(' Number of CI events ')
axis([12 23 0 40])


% widLFC1AR_profs_area_ALLCASES        
% widLFC1AR_profs_massflux_ALLCASES      
% widLFC1AR_profs_maxmag_ALLCASES        
% widLFC1AR_mesoWvmsum_ALLCASES           
% widLFC1AR_mesoWwidth_ALLCASES            
% widLFC1AR_mesoWmeanRHboxaloft_ALLCASES  


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%  scatterplots
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%    SCATTERPLOTS OF WID & SWATH 
%%% correlate wID depth & wID area (filtered:  shallow and deep wIDs) for
%%%  updraft stuff within z = 1 km of LFC
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%  meth = 1;

SIGTHRESH = 0.05;

figure('position',[-1534,65,1128,903]);
%sgtitle(' wID depth vs near-LFC area;   L: filtered -  LFClayer,small area;    R: filtered -  LFClayer,small area,no shallow ')

subplot(2,2,1)
hold on
for RR = 1:ar
   
    %old way:

    BB = mean(widLFC1AR_profs_area_ALLCASES(:,:,:,RR),2,'omitnan') ;
    %BB = mean(widLFCAR_profs_area_ALLCASES(:,:,:,RR),2,'omitnan') ;

    BB = permute(BB ,[1 3 4 2]);
    BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;
%     AA = max( wid_profs_centHTasl_ALLCASES(:,:,:,RR)/1000, [], 2, 'omitnan') ;  %note, this iarray is actually unfiltered, but filtered nans from the area field should take care of it

%     %new way:
%     %cloud area:
%     BB       =  max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan') ;   %
%     BB = permute(BB ,[1 3 4 2]);
%     BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;  %convert to radius

    %mask the height field (not sure if needed, but let's do it anyway)
    cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;
    AA    =  wid_maxk_topasl_ALLCASES(:,:,RR)/1000 ; 
    AA = AA .* cht_mask;





    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(0,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(0,30,30);
        yFit6 = polyval(linCo6,xFit6);

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(0,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

%old way
BB = mean(widLFC1AR_profs_area_ALLCASES(:,:,:,:),2,'omitnan'); 
BB = permute(BB,[1 3 4 2]);
BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;
% AA = max( wid_profs_centHTasl_ALLCASES(:,:,:,:)/1000, [], 2, 'omitnan');
    
% %new way:
% BB =  max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2,'omitnan') ;   %
% BB =  permute(BB ,[1 3 4 2]);
% BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;  %convert to radius

%mask the height field (not sure if needed, but let's do it anyway)
cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;
AA = wid_maxk_topasl_ALLCASES(:,:,:)/1000 ;
AA = AA .* cht_mask;


kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(AA(:),BB(:)); ccrall = ccrall(2); pval = pval(2)  ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])
plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), ...
    num2str(round(ccr6,2)), num2str(round(ccr7,2)),'FontSize', 12);

axis([0.3 2 2 12 ])
title(['Combined popul corcoeff = ', num2str( round(ccrall,2)) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel(' near-LFC updraft mean circ-equiv radius (km)');
ylabel(' updraft top asl (km)');






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%  correlate wID depth & wID area (filtered:  shallow and deep wIDs)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% ff = figure('position',[239,91,1407,745]);
% sgtitle(' wID depth vs near-LFC area and strength ')

subplot(2,2,2)
hold on
for RR = 1:ar
    
%     %old way:
     BB = max(widLFC1AR_profs_maxmag_ALLCASES(:,:,:,RR),[],2,'omitnan') ;
%     AA = max( wid_profs_centHTasl_ALLCASES(:,:,:,RR)/1000, [], 2, 'omitnan') ;  %note, this iarray is actually unfiltered, but filtered nans from the area field should take care of it

    %new way:
%    BB  =  max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,RR),[],2,'omitnan') ;
    BB = permute(BB,[1 3 2]);
    %mask the height field (not sure if needed, but let's do it anyway)
    cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;
    AA    =  wid_maxk_topasl_ALLCASES(:,:,RR)/1000 ; 
    AA = AA .* cht_mask;



    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        %scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        %scatter( BB(:),AA(:)','.c' ); hold on
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(0,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        %scatter( BB(:),AA(:)','.c' ); hold on
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(0,30,30);
        yFit6 = polyval(linCo6,xFit6);

    elseif(RR==7)
        %scatter( BB(:),AA(:)','.c' ); hold on
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2);  pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(0,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end

end
%old way
BB = max(widLFC1AR_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ; 
% BB = permute(BB,[1 3 4 2]);
% AA = max( wid_profs_centHTasl_ALLCASES(:,:,:,:)/1000, [], 2, 'omitnan');

%new way:
%BB  =  max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,:),[],2,'omitnan') ;
BB = permute(BB,[1 3 4 2]);
%mask the height field (not sure if needed, but let's do it anyway)
cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;
AA    =  wid_maxk_topasl_ALLCASES(:,:,:)/1000 ;
AA = AA .* cht_mask;

AA= AA(:); BB=BB(:);
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(AA(:),BB(:)); ccrall = ccrall(2); pval = pval(2)  ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])
plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), ...
    num2str(round(ccr6,2)), num2str(round(ccr7,2)),'FontSize', 12);

axis([3 14 2 11 ])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel(' near-LFC updraft max updraft speed (m/s)');
ylabel(' updraft top asl (km)');




% 
% figure


% meth = 3 ; 

%%% make Rc vs Rsub analog plot
tbak = 4;  %4=-15min?

%data within 1 km of Wmax (to mimic a Hugh plot)
MAX_swathwidth    = permute( widMAX1AR_mesoWwidth_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  % swath width
MAX_wid_meanwidth = permute( mean( widMAX1AR_profs_area_ALLCASES,2, 'omitnan'), [1 3 4 2] );   %max of updraft area
%MAX_wid_meanwidth = permute( max( widMAX1AR_profs_area_ALLCASES,[],2, 'omitnan'), [1 3 4 2] );   %max of updraft area within 1 km of wmax

%{
%data within 1 km of LFC height (mimic the hugh plot's 2nd set of data points)
LFC_swathwidth       = permute( widLFC1AR_mesoWwidth_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  
LFC_swathstrength    = permute( widLFC1AR_mesoWstrength_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  
LFC_wid_meanwidth    = permute( mean( widLFC1AR_profs_area_ALLCASES,2, 'omitnan'), [1 3 4 2] );   %mean of remaining z layer
%LFC_wid_meanwidth    = permute( max( widLFC1AR_profs_area_ALLCASES,[],2, 'omitnan'), [1 3 4 2] );   %max of updraft area within 1 km of lfc
%}

LFC_swathwidth       = permute( widLFCAR_mesoWwidth_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  
LFC_swathstrength    = permute( widLFCAR_mesoWstrength_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  
LFC_wid_meanwidth    = permute( max( widLFCAR_profs_area_ALLCASES,[],2, 'omitnan'), [1 3 4 2] ); 

% LFC_swathwidth       = permute( widLFCAR_mesoWwidthMAX_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  
% LFC_swathstrength    = permute( widLFCAR_mesoWstrengthMAX_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  
% LFC_wid_meanwidth    = permute( max( widLFCAR_profs_area_ALLCASES,[],2, 'omitnan'), [1 3 4 2] ); 


% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
%just kill the mesoascent fields so that we can still compare cldy
%updrafts to near-cloud sounding metrics
dist = dist_wid_and_swath_ALLCASES(:,:,tbak,:);
dist = permute(dist,[1 2 4 3]);
kill = find(  abs( dist )  >  distswathwid_thresh  );
LFC_swathwidth(kill)           = NaN;
LFC_swathstrength(kill)        = NaN;
LFC_wid_meanwidth(kill)        = NaN;


% CLDupdraft_area = max(widLFCAR_profs_area_ALLCASES(:,:,:,R),[],2) ;
% MesoAscent_Wmagnitude = widLFCAR_mesoWstrength_ALLCASES(:,:,TIMLG,R);


hold on

subplot(2,2,3)
%figure('position',[60,278,762,635]);
%sgtitle(' R_c_l_d (mean in LFC-LFC+1km layer) vs R_s_w_a_t_h ')

hold on
for RR = 1:ar

    BB = (LFC_swathwidth(:,:,RR))  ; 

    AA = ( (LFC_wid_meanwidth(:,:,RR)/3.14159 ).^0.5 ) /1000 ; 
    %AA = ( (MAX_wid_meanwidth(:,:,RR)/3.14159 ).^0.5 ) /1000 ; 



    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2);   pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2);  pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2);  pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2);  pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB =   (LFC_swathwidth)  ; 
AA =   ((LFC_wid_meanwidth/3.14159).^0.5 )/1000 ; 
%AA =   ((MAX_wid_meanwidth/3.14159).^0.5 )/1000 ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

%ccrall = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);
[ccrall, pval] = corrcoef(AA(:),BB(:)); ccrall = ccrall(2); pval = pval(2)  ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([0.0 4 0.3 2.5 ])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' Cross-terrain width of orographic ascent object');
ylabel(' R_c_l_o_u_d (circular area equiv) between LFC and LFC+1km ');

% %saveas(ff,horzcat(imout2,'/scatter_alldates_LFCRcRsub.png'));
% outlab = horzcat(imout,'/scatter_alldates_Wids.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);







subplot(2,2,4)
%figure('position',[60,278,762,635]);
%sgtitle(' R_c_l_d (mean in LFC-LFC+1km layer) vs R_s_w_a_t_h ')

hold on
for RR = 1:ar

    BB = (LFC_swathstrength(:,:,RR))  ; 
    AA = ( (LFC_wid_meanwidth(:,:,RR)/3.14159 ).^0.5 ) /1000 ;   %note: correlating with cloudyR vs cloudyArea gives (subtly) different results
    %AA = LFC_wid_meanwidth(:,:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB =   (LFC_swathstrength)  ; 
AA =   ((LFC_wid_meanwidth/3.14159).^0.5 )/1000 ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([1 7 0.3 2.5 ])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' |Orographic ascent| (m/s)');
ylabel(' R_c_l_o_u_d (circular area equiv) between LFC and LFC+1km ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])

%saveas(ff,horzcat(imout2,'/scatter_alldates_LFCRcRsub.png'));
outlab = horzcat(imout,'/scatter_alldates_Wids','_meth',num2str(meth),'_',DATASET,'.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);







%%%%%%%%%%%%%%%%  
%%%%%%%%%%%%%%%%
%%%%%%%%%          Alternate scatterplots done as box and whiskers for all
%%%%%%%%%          cases and confidence interval on the trend line for all
%%%%%%%%%          cases
%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%

BB = mean(widLFC1AR_profs_area_ALLCASES(:,:,:,:),2,'omitnan') ;
BB = permute(BB ,[1 3 4 2]);
BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;

cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;

AA    =  wid_maxk_topasl_ALLCASES(:,:,:)/1000 ;
AA = AA .* cht_mask;

kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:), AA(:)','.','MarkerFaceColor','k','MarkerEdgeColor','k','LineWidth',1.5); hold on

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure('position',[760,570,862,324])
hold on
numsamps = [];
dr = 0.1 ;
re = 0;
for r = 0.2 : dr : 3.0
    cent = r + dr/2 ;
    pts = find(  BB(:) >= r  &  BB(:) < r+dr  ) ;
    numsamps = vertcat( numsamps, length(pts) ) ;
end
cents = [];
AAs4box = zeros(1000,length(numsamps));   AAs4box(:) = NaN;
numsamps(numsamps==0) = NaN;
re = 0;
for r = 0.2 : dr : 3.0
    re = re +1;
    cent = r + dr/2 ;
    cents = vertcat(cents,cent);
    pts = find(  BB(:) >= r  &  BB(:) < r+dr  ) ;
    if(isempty(pts)==0)
        AAs4box(1:length(pts), re) = AA(pts);
    end
end %radius
AAs4box(AAs4box==0) = NaN;
boxplot(AAs4box)
%xticklabels(cents)
posy = cents; posy(:) = 11.3;
numsamps(isnan(numsamps))=0;
text([1:re]-0.33,posy,num2str(numsamps))   %1:re]
axis([0.0 20 2 11])
xticklabels(cents)
outlab = horzcat(imout,'/BoxWhisk_CRadiusCTop','_meth',num2str(meth),'_',DATASET,'.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure('position',[760,570,862,324])
hold on

BB = mean(widLFC1AR_profs_area_ALLCASES(:,:,:,:),2,'omitnan') ;
BB = permute(BB ,[1 3 4 2]);
BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;
cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;
AA    =  wid_maxk_topasl_ALLCASES(:,:,:)/1000 ;
AA = AA .* cht_mask;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
linfit = fit(BB', AA', 'poly1');
ci = confint(linfit);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-10,10,10);
yFit = polyval(linCo,xFit);
%plot(xFit,yFit,'r'); hold on
ylin0 = zeros(length(xFit),1) ;     ylin0(:) = NaN ;
ylin1 = zeros(length(xFit),1) ;     ylin1(:) = NaN ;
ylin2 = zeros(length(xFit),1) ;     ylin2(:) = NaN ;
for i = 1:length(xFit)
    ylin2(i) = ci(2,1) .* xFit(i) +  ci(2,2) ;
    ylin1(i) = ci(1,1) .* xFit(i) +  ci(1,2) ;
    ylin0(i) = linfit.p1  .* xFit(i) +  linfit.p2 ;
end
plot(xFit,ylin2,'k-','LineWidth',0.5)
plot(xFit,ylin1,'k-','LineWidth',0.5)
plot(xFit,ylin0,'k-','LineWidth',2)
[corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2)
pval = pval(2)
corr(AA(:),BB(:))
if(pval <= 0.05)
    disp('all SIG')
else
    disp('all INSIG')
end

%daily trendlines
for RR = 1:7
    %RR = 4
    BB = mean(widLFC1AR_profs_area_ALLCASES(:,:,:,RR),2,'omitnan') ;
    BB = permute(BB ,[1 3 4 2]);
    BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;
    cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;
    AA    =  wid_maxk_topasl_ALLCASES(:,:,RR)/1000 ;
    AA = AA .* cht_mask;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    linfit = fit(BB', AA', 'poly1');
    ci = confint(linfit);
    %figure;
    linCo = polyfit(BB(:), AA(:), 1);
    xFit = linspace(-10,10,10);
    yFit = polyval(linCo,xFit);
    %plot(xFit,yFit,'r'); hold on
    ylin0 = zeros(length(xFit),1) ;     ylin0(:) = NaN ;
    ylin1 = zeros(length(xFit),1) ;     ylin1(:) = NaN ;
    ylin2 = zeros(length(xFit),1) ;     ylin2(:) = NaN ;
    for i = 1:length(xFit)
        ylin2(i) = ci(2,1) .* xFit(i) +  ci(2,2) ;
        ylin1(i) = ci(1,1) .* xFit(i) +  ci(1,2) ;
        ylin0(i) = linfit.p1  .* xFit(i) +  linfit.p2 ;
    end
    RR
    [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2)
    pval = pval(2)
    corr(AA(:),BB(:))
    if(pval <= 0.05)
        disp([num2str(RR),' SIG'])
    else
        disp([num2str(RR),' INSIG'])
    end
    if(RR == 1)
        %plot(xFit,ylin2,'r-','LineWidth',0.5)
        %plot(xFit,ylin1,'r-','LineWidth',0.5)
        plot(xFit,ylin0,'r-','LineWidth',1)
    elseif(RR == 2)
        %plot(xFit,ylin2,'b-','LineWidth',0.5)
        %plot(xFit,ylin1,'b-','LineWidth',0.5)
        plot(xFit,ylin0,'b-','LineWidth',1)
    elseif(RR == 3)
        %plot(xFit,ylin2,'g-','LineWidth',0.5)
        %plot(xFit,ylin1,'g-','LineWidth',0.5)
        plot(xFit,ylin0,'g-','LineWidth',1)
    elseif(RR == 4)
        %plot(xFit,ylin2,'c-','LineWidth',0.5)
        %plot(xFit,ylin1,'c-','LineWidth',0.5)
        plot(xFit,ylin0,'c-','LineWidth',1)
    elseif(RR == 5)
        %plot(xFit,ylin2,'-','Color',[1 0.5 0],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[1 0.5 0],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[1 0.5 0],'LineWidth',1)
    elseif(RR == 6)
        %plot(xFit,ylin2,'-','Color',[0 0.5 1],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[0 0.5 1],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[0 0.5 1],'LineWidth',1)
    elseif(RR == 7)
        %plot(xFit,ylin2,'-','Color',[0.5 0 1],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[0.5 0 1],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[0.5 0 1],'LineWidth',1)
    end
end
axis([0.15 2.15 2 11])
outlab = horzcat(imout,'/CItrends_CRadiusCTop','_meth',num2str(meth),'_',DATASET,'.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);


































BB = mean(widLFC1AR_profs_maxmag_ALLCASES(:,:,:,:),2,'omitnan') ;
BB = permute(BB ,[1 3 4 2]);
% BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;

cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;

AA    =  wid_maxk_topasl_ALLCASES(:,:,:)/1000 ;
AA = AA .* cht_mask;

kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:), AA(:)','.','MarkerFaceColor','k','MarkerEdgeColor','k','LineWidth',1.5); hold on

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure('position',[760,570,862,324])
hold on
numsamps = [];
dr = 0.5 ;
re = 0;
for r = 2.75 : dr : 11.75
    cent = r + dr/2 ;
    pts = find(  BB(:) >= r  &  BB(:) < r+dr  ) ;
    numsamps = vertcat( numsamps, length(pts) ) ;
end
cents = [];
AAs4box = zeros(1000,length(numsamps));   AAs4box(:) = NaN;
numsamps(numsamps==0) = NaN;
re = 0;
for r = 2.75 : dr : 11.75
    re = re +1;
    cent = r + dr/2 ;
    cents = vertcat(cents,cent);
    pts = find(  BB(:) >= r  &  BB(:) < r+dr  ) ;
    if(isempty(pts)==0)
        AAs4box(1:length(pts), re) = AA(pts);
    end
end %radius
AAs4box(AAs4box==0) = NaN;
boxplot(AAs4box)
%xticklabels(cents)
posy = cents; posy(:) = 11.3;
numsamps(isnan(numsamps))=0;
text([1:re]-0.33,posy,num2str(numsamps))   %1:re]
axis([0.0 20 2 11])
xticklabels(cents)
outlab = horzcat(imout,'/BoxWhisk_CMagCTop','_meth',num2str(meth),'_',DATASET,'.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure('position',[760,570,862,324])
hold on

BB = mean(widLFC1AR_profs_maxmag_ALLCASES(:,:,:,:),2,'omitnan') ;
BB = permute(BB ,[1 3 4 2]);
% BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;
cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;
AA    =  wid_maxk_topasl_ALLCASES(:,:,:)/1000 ;
AA = AA .* cht_mask;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
linfit = fit(BB', AA', 'poly1');
ci = confint(linfit);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-10,30,10);
yFit = polyval(linCo,xFit);
%plot(xFit,yFit,'r'); hold on
ylin0 = zeros(length(xFit),1) ;     ylin0(:) = NaN ;
ylin1 = zeros(length(xFit),1) ;     ylin1(:) = NaN ;
ylin2 = zeros(length(xFit),1) ;     ylin2(:) = NaN ;
for i = 1:length(xFit)
    ylin2(i) = ci(2,1) .* xFit(i) +  ci(2,2) ;
    ylin1(i) = ci(1,1) .* xFit(i) +  ci(1,2) ;
    ylin0(i) = linfit.p1  .* xFit(i) +  linfit.p2 ;
end
plot(xFit,ylin2,'k-','LineWidth',0.5)
plot(xFit,ylin1,'k-','LineWidth',0.5)
plot(xFit,ylin0,'k-','LineWidth',2)
[corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2)
pval = pval(2)
corr(AA(:),BB(:))
if(pval <= 0.05)
    disp('all SIG')
else
    disp('all INSIG')
end

%daily trendlines
for RR = 1:7
    % RR = 1
    BB = mean(widLFC1AR_profs_maxmag_ALLCASES(:,:,:,RR),2,'omitnan') ;
    BB = permute(BB ,[1 3 4 2]);
    %BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;
    cht_mask = BB;   cht_mask( isnan(BB)==0 )=1;
    AA    =  wid_maxk_topasl_ALLCASES(:,:,RR)/1000 ;
    AA = AA .* cht_mask;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    linfit = fit(BB', AA', 'poly1');
    ci = confint(linfit);
    %figure;
    linCo = polyfit(BB(:), AA(:), 1);
    xFit = linspace(-10,30,10);
    yFit = polyval(linCo,xFit);
    %plot(xFit,yFit,'r'); hold on
    ylin0 = zeros(length(xFit),1) ;     ylin0(:) = NaN ;
    ylin1 = zeros(length(xFit),1) ;     ylin1(:) = NaN ;
    ylin2 = zeros(length(xFit),1) ;     ylin2(:) = NaN ;
    for i = 1:length(xFit)
        ylin2(i) = ci(2,1) .* xFit(i) +  ci(2,2) ;
        ylin1(i) = ci(1,1) .* xFit(i) +  ci(1,2) ;
        ylin0(i) = linfit.p1  .* xFit(i) +  linfit.p2 ;
    end
    [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2)
    pval = pval(2)
    corr(AA(:),BB(:))
    if(pval <= 0.05)
        disp([num2str(RR),' SIG'])
    else
        disp([num2str(RR),' INSIG'])
    end  
    if(RR == 1)
        %plot(xFit,ylin2,'r-','LineWidth',0.5)
        %plot(xFit,ylin1,'r-','LineWidth',0.5)
        plot(xFit,ylin0,'r-','LineWidth',1)
    elseif(RR == 2)
        %plot(xFit,ylin2,'b-','LineWidth',0.5)
        %plot(xFit,ylin1,'b-','LineWidth',0.5)
        plot(xFit,ylin0,'b-','LineWidth',1)
    elseif(RR == 3)
        %plot(xFit,ylin2,'g-','LineWidth',0.5)
        %plot(xFit,ylin1,'g-','LineWidth',0.5)
        plot(xFit,ylin0,'g-','LineWidth',1)
    elseif(RR == 4)
        %plot(xFit,ylin2,'c-','LineWidth',0.5)
        %plot(xFit,ylin1,'c-','LineWidth',0.5)
        plot(xFit,ylin0,'c-','LineWidth',1)
    elseif(RR == 5)
        %plot(xFit,ylin2,'-','Color',[1 0.5 0],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[1 0.5 0],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[1 0.5 0],'LineWidth',1)
    elseif(RR == 6)
        %plot(xFit,ylin2,'-','Color',[0 0.5 1],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[0 0.5 1],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[0 0.5 1],'LineWidth',1)
    elseif(RR == 7)
        %plot(xFit,ylin2,'-','Color',[0.5 0 1],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[0.5 0 1],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[0.5 0 1],'LineWidth',1)
    end
end
axis([2.5 12.5 2 11])
outlab = horzcat(imout,'/CItrends_CMagCTop','_meth',num2str(meth),'_',DATASET,'.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);














%%% make Rc vs Rsub analog plot
tbak = 4;  %4=-15min?

%data within 1 km of Wmax (to mimic a Hugh plot)
MAX_swathwidth    = permute( widMAX1AR_mesoWwidth_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  % swath width
MAX_wid_meanwidth = permute( mean( widMAX1AR_profs_area_ALLCASES,2, 'omitnan'), [1 3 4 2] );   %max of updraft area
%MAX_wid_meanwidth = permute( max( widMAX1AR_profs_area_ALLCASES,[],2, 'omitnan'), [1 3 4 2] );   %max of updraft area within 1 km of wmax

LFC_swathwidth       = permute( widLFCAR_mesoWwidth_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  
LFC_swathstrength    = permute( widLFCAR_mesoWstrength_ALLCASES(:,:,tbak,:),  [1 2 4 3]) ;  
LFC_wid_meanwidth    = permute( max( widLFCAR_profs_area_ALLCASES,[],2, 'omitnan'), [1 3 4 2] ); 

% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
%just kill the mesoascent fields so that we can still compare cldy
%updrafts to near-cloud sounding metrics
dist = dist_wid_and_swath_ALLCASES(:,:,tbak,:);
dist = permute(dist,[1 2 4 3]);
kill = find(  abs( dist )  >  distswathwid_thresh  );
LFC_swathwidth(kill)           = NaN;
LFC_swathstrength(kill)        = NaN;
LFC_wid_meanwidth(kill)        = NaN;


AA = ( (LFC_wid_meanwidth(:,:,:)/3.14159 ).^0.5 ) /1000 ;
cht_mask = AA;   cht_mask( isnan(AA)==0 )=1;
BB    =  LFC_swathwidth(:,:,:) ;
BB = BB .* cht_mask;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:), AA(:)','.','MarkerFaceColor','k','MarkerEdgeColor','k','LineWidth',1.5); hold on

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure('position',[760,570,862,324])
hold on
numsamps = [];
dr = 0.25 ;
re = 0;
for r = 0.125 : dr : 4.125
    cent = r + dr/2 ;
    pts = find(  BB(:) >= r  &  BB(:) < r+dr  ) ;
    numsamps = vertcat( numsamps, length(pts) ) ;
end
cents = [];
AAs4box = zeros(1000,length(numsamps));   AAs4box(:) = NaN;
numsamps(numsamps==0) = NaN;
re = 0;
for r = 0.125 : dr : 4.125
    re = re +1;
    cent = r + dr/2 ;
    cents = vertcat(cents,cent);
    pts = find(  BB(:) >= r  &  BB(:) < r+dr  ) ;
    if(isempty(pts)==0)
        AAs4box(1:length(pts), re) = AA(pts);
    end
end %radius
AAs4box(AAs4box==0) = NaN;
boxplot(AAs4box)
%xticklabels(cents)
posy = cents; posy(:) = 2.1;
numsamps(isnan(numsamps))=0;
text([1:re]-0.33,posy,num2str(numsamps))   %1:re]
axis([0.0 18 0 2.0])
xticklabels(cents)
outlab = horzcat(imout,'/BoxWhisk_CradiusSradius','_meth',num2str(meth),'_',DATASET,'.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure('position',[760,570,862,324])
hold on

AA = ( (LFC_wid_meanwidth/3.14159 ).^0.5 ) /1000 ;
cht_mask = AA;   cht_mask( isnan(AA)==0 )=1;
BB    =  LFC_swathwidth ;
BB = BB .* cht_mask;
kill = isnan(BB(:));
BB(kill) = []; AA(kill) = [];
kill = isnan(AA(:));
BB(kill) = []; AA(kill) = [];
linfit = fit(BB', AA', 'poly1');
ci = confint(linfit);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-10,30,10);
yFit = polyval(linCo,xFit);
%plot(xFit,yFit,'r'); hold on
ylin0 = zeros(length(xFit),1) ;     ylin0(:) = NaN ;
ylin1 = zeros(length(xFit),1) ;     ylin1(:) = NaN ;
ylin2 = zeros(length(xFit),1) ;     ylin2(:) = NaN ;
for i = 1:length(xFit)
    ylin2(i) = ci(2,1) .* xFit(i) +  ci(2,2) ;
    ylin1(i) = ci(1,1) .* xFit(i) +  ci(1,2) ;
    ylin0(i) = linfit.p1  .* xFit(i) +  linfit.p2 ;
end
hold on
plot(xFit,ylin2,'k-','LineWidth',0.5)
plot(xFit,ylin1,'k-','LineWidth',0.5)
plot(xFit,ylin0,'k-','LineWidth',2)
[corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2)
pval = pval(2)
corr(AA(:),BB(:))
if(pval <= 0.05)
    disp('all SIG')
else
    disp('all INSIG')
end

%daily trendlines
for RR = 1:7
    % RR = 7
%     BB = mean(widLFC1AR_profs_area_ALLCASES(:,:,:,RR),2,'omitnan') ;
%     BB = permute(BB ,[1 3 4 2]);
%     BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;

    AA = ( (LFC_wid_meanwidth(:,:,RR)/3.14159 ).^0.5 ) /1000 ;
    cht_mask = AA;   cht_mask( isnan(AA)==0 )=1;
    
    BB    =  LFC_swathwidth(:,:,RR) ;
    BB = BB .* cht_mask;

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    linfit = fit(BB', AA', 'poly1');
    ci = confint(linfit);
    %figure;
    linCo = polyfit(BB(:), AA(:), 1);
    xFit = linspace(-10,10,10);
    yFit = polyval(linCo,xFit);
    %plot(xFit,yFit,'r'); hold on
    ylin0 = zeros(length(xFit),1) ;     ylin0(:) = NaN ;
    ylin1 = zeros(length(xFit),1) ;     ylin1(:) = NaN ;
    ylin2 = zeros(length(xFit),1) ;     ylin2(:) = NaN ;
    for i = 1:length(xFit)
        ylin2(i) = ci(2,1) .* xFit(i) +  ci(2,2) ;
        ylin1(i) = ci(1,1) .* xFit(i) +  ci(1,2) ;
        ylin0(i) = linfit.p1  .* xFit(i) +  linfit.p2 ;
    end
    [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2)
    pval = pval(2)
    corr(AA(:),BB(:))
    if(pval <= 0.05)
        disp([num2str(RR),' SIG'])
    else
        disp([num2str(RR),' INSIG'])
    end
    if(RR == 1)
        %plot(xFit,ylin2,'r-','LineWidth',0.5)
        %plot(xFit,ylin1,'r-','LineWidth',0.5)
        plot(xFit,ylin0,'r-','LineWidth',1)
    elseif(RR == 2)
        %plot(xFit,ylin2,'b-','LineWidth',0.5)
        %plot(xFit,ylin1,'b-','LineWidth',0.5)
        plot(xFit,ylin0,'b-','LineWidth',1)
    elseif(RR == 3)
        %plot(xFit,ylin2,'g-','LineWidth',0.5)
        %plot(xFit,ylin1,'g-','LineWidth',0.5)
        plot(xFit,ylin0,'g-','LineWidth',1)
    elseif(RR == 4)
        %plot(xFit,ylin2,'c-','LineWidth',0.5)
        %plot(xFit,ylin1,'c-','LineWidth',0.5)
        plot(xFit,ylin0,'c-','LineWidth',1)
    elseif(RR == 5)
        %plot(xFit,ylin2,'-','Color',[1 0.5 0],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[1 0.5 0],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[1 0.5 0],'LineWidth',1)
    elseif(RR == 6)
        %plot(xFit,ylin2,'-','Color',[0 0.5 1],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[0 0.5 1],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[0 0.5 1],'LineWidth',1)
    elseif(RR == 7)
        %plot(xFit,ylin2,'-','Color',[0.5 0 1],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[0.5 0 1],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[0.5 0 1],'LineWidth',1)
    end
end
axis([0 4.5 0 2])
outlab = horzcat(imout,'/CItrends_CradiusSradius','_meth',num2str(meth),'_',DATASET,'.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);












AA = ( (LFC_wid_meanwidth(:,:,:)/3.14159 ).^0.5 ) /1000 ;
cht_mask = AA;   cht_mask( isnan(AA)==0 )=1;
BB    =  LFC_swathstrength(:,:,:) ;
BB = BB .* cht_mask;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:), AA(:)','.','MarkerFaceColor','k','MarkerEdgeColor','k','LineWidth',1.5); hold on

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure('position',[760,570,862,324])
hold on
numsamps = [];
dr = 0.5 ;
re = 0;
for r = 1.25 : dr : 7.25
    cent = r + dr/2 ;
    pts = find(  BB(:) >= r  &  BB(:) < r+dr  ) ;
    numsamps = vertcat( numsamps, length(pts) ) ;
end
cents = [];
AAs4box = zeros(1000,length(numsamps));   AAs4box(:) = NaN;
numsamps(numsamps==0) = NaN;
re = 0;
for r = 1.25 : dr : 7.25
    re = re +1;
    cent = r + dr/2 ;
    cents = vertcat(cents,cent);
    pts = find(  BB(:) >= r  &  BB(:) < r+dr  ) ;
    if(isempty(pts)==0)
        AAs4box(1:length(pts), re) = AA(pts);
    end
end %radius
AAs4box(AAs4box==0) = NaN;
boxplot(AAs4box)
%xticklabels(cents)
posy = cents; posy(:) = 2.1;
numsamps(isnan(numsamps))=0;
text([1:re]-0.33,posy,num2str(numsamps))   %1:re]
axis([0.0 14 0 2.0])
xticklabels(cents)
outlab = horzcat(imout,'/BoxWhisk_CmagSradius','_meth',num2str(meth),'_',DATASET,'.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure('position',[760,570,862,324])
hold on

AA = ( (LFC_wid_meanwidth(:,:,:)/3.14159 ).^0.5 ) /1000 ;
cht_mask = AA;   cht_mask( isnan(AA)==0 )=1;
BB    =  LFC_swathstrength(:,:,:) ;
BB = BB .* cht_mask;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
linfit = fit(BB', AA', 'poly1');
ci = confint(linfit);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-10,10,10);
yFit = polyval(linCo,xFit);
%plot(xFit,yFit,'r'); hold on
ylin0 = zeros(length(xFit),1) ;     ylin0(:) = NaN ;
ylin1 = zeros(length(xFit),1) ;     ylin1(:) = NaN ;
ylin2 = zeros(length(xFit),1) ;     ylin2(:) = NaN ;
for i = 1:length(xFit)
    ylin2(i) = ci(2,1) .* xFit(i) +  ci(2,2) ;
    ylin1(i) = ci(1,1) .* xFit(i) +  ci(1,2) ;
    ylin0(i) = linfit.p1  .* xFit(i) +  linfit.p2 ;
end

plot(xFit,ylin2,'k-','LineWidth',0.5)
plot(xFit,ylin1,'k-','LineWidth',0.5)
plot(xFit,ylin0,'k-','LineWidth',2)
[corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2)
pval = pval(2)
corr(AA(:),BB(:))
if(pval <= 0.05)
    disp('all SIG')
else
    disp('all INSIG')
end

%daily trendlines
for RR = 1:7
    %RR = 4
%     BB = mean(widLFC1AR_profs_area_ALLCASES(:,:,:,RR),2,'omitnan') ;
%     BB = permute(BB ,[1 3 4 2]);
%     BB =  ( ( BB/3.14159 ) .^0.5) ./1000 ;

    AA = ( (LFC_wid_meanwidth(:,:,RR)/3.14159 ).^0.5 ) /1000 ;
    cht_mask = AA;   cht_mask( isnan(AA)==0 )=1;
    
    BB    =  LFC_swathstrength(:,:,RR) ;
    BB = BB .* cht_mask;

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    linfit = fit(BB', AA', 'poly1');
    ci = confint(linfit);
    %figure;
    linCo = polyfit(BB(:), AA(:), 1);
    xFit = linspace(-10,10,10);
    yFit = polyval(linCo,xFit);
    %plot(xFit,yFit,'r'); hold on
    ylin0 = zeros(length(xFit),1) ;     ylin0(:) = NaN ;
    ylin1 = zeros(length(xFit),1) ;     ylin1(:) = NaN ;
    ylin2 = zeros(length(xFit),1) ;     ylin2(:) = NaN ;
    for i = 1:length(xFit)
        ylin2(i) = ci(2,1) .* xFit(i) +  ci(2,2) ;
        ylin1(i) = ci(1,1) .* xFit(i) +  ci(1,2) ;
        ylin0(i) = linfit.p1  .* xFit(i) +  linfit.p2 ;
    end
    [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2)
    pval = pval(2)
    corr(AA(:),BB(:))
    if(pval <= 0.05)
        disp([num2str(RR),' SIG'])
    else
        disp([num2str(RR),' INSIG'])
    end
    if(RR == 1)
        %plot(xFit,ylin2,'r-','LineWidth',0.5)
        %plot(xFit,ylin1,'r-','LineWidth',0.5)
        plot(xFit,ylin0,'r-','LineWidth',1)
    elseif(RR == 2)
        %plot(xFit,ylin2,'b-','LineWidth',0.5)
        %plot(xFit,ylin1,'b-','LineWidth',0.5)
        plot(xFit,ylin0,'b-','LineWidth',1)
    elseif(RR == 3)
        %plot(xFit,ylin2,'g-','LineWidth',0.5)
        %plot(xFit,ylin1,'g-','LineWidth',0.5)
        plot(xFit,ylin0,'g-','LineWidth',1)
    elseif(RR == 4)
        %plot(xFit,ylin2,'c-','LineWidth',0.5)
        %plot(xFit,ylin1,'c-','LineWidth',0.5)
        plot(xFit,ylin0,'c-','LineWidth',1)
    elseif(RR == 5)
        %plot(xFit,ylin2,'-','Color',[1 0.5 0],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[1 0.5 0],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[1 0.5 0],'LineWidth',1)
    elseif(RR == 6)
        %plot(xFit,ylin2,'-','Color',[0 0.5 1],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[0 0.5 1],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[0 0.5 1],'LineWidth',1)
    elseif(RR == 7)
        %plot(xFit,ylin2,'-','Color',[0.5 0 1],'LineWidth',0.5)
        %plot(xFit,ylin1,'-','Color',[0.5 0 1],'LineWidth',0.5)
        plot(xFit,ylin0,'-','Color',[0.5 0 1],'LineWidth',1)
    end
end
axis([1 8 0 2])
outlab = horzcat(imout,'/CItrends_CmagSradius','_meth',num2str(meth),'_',DATASET,'.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);























%%%%%%%%%%%%%%%%%%%%
%%%%%%%   some more scatter plots of cloud depth vs: 
%%%%%%%%%%%%%%%%%%%%

%  meth = 1;

%%% make Rc vs Rsub analog plot
tbak = 4;  %4=-15min?

CLDupdraft_area       =  max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2) ;   % 
    CLDupdraft_area = permute(CLDupdraft_area ,[1 3 4 2]);
CLDupdraft_Radius     =  ((CLDupdraft_area/3.14159).^0.5)/1000;      %circ equiv rad [km]
    cht_mask = CLDupdraft_area;   cht_mask( isnan(CLDupdraft_area)==0 )=1;  
CLDupdraft_topZasl    =  wid_maxk_topasl_ALLCASES(:,:,:) .* cht_mask;


LFC_swathwidth       = permute( widLFCAR_mesoWwidth_ALLCASES(:,:,tbak,:),  [1 2 4 3]) .* cht_mask; ;  
LFC_swathstrength    = permute( widLFCAR_mesoWstrength_ALLCASES(:,:,tbak,:),  [1 2 4 3]) .* cht_mask;;  
%LFC_wid_meanwidth    = permute( max( widLFCAR_profs_area_ALLCASES,[],2, 'omitnan'), [1 3 4 2] ) .* cht_mask;; 
MesoAscent_RHaloft    =   (FwID_RH_mean_ACBL_ALLCASES/100) .* cht_mask;
MesoAscent_acblCAPE    =   FwID_MUACBLCAPE_ALLCASES .* cht_mask;
MesoAscent_deepCAPE    =   FwID_MUCAPE_ALLCASES .* cht_mask;
MesoAscent_shear06     =   FwID_shear_mag_bulk_0to6km_ALLCASES .* cht_mask;


% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
%just kill the mesoascent fields so that we can still compare cldy
%updrafts to near-cloud sounding metrics
dist = dist_wid_and_swath_ALLCASES(:,:,tbak,:);
dist = permute(dist,[1 2 4 3]);
kill = find(  abs( dist )  >  distswathwid_thresh  );
LFC_swathwidth(kill)           = NaN;
LFC_swathstrength(kill)        = NaN;
LFC_wid_meanwidth(kill)        = NaN;
MesoAscent_RHaloft(kill)           = NaN;
MesoAscent_acblCAPE(kill)           = NaN;
MesoAscent_deepCAPE(kill)           = NaN;
MesoAscent_shear06(kill)           = NaN;
CLDupdraft_area(kill)           = NaN;
CLDupdraft_Radius(kill)           = NaN;
CLDupdraft_topZasl(kill)           = NaN; 


%{

%%%%%%%% filter by cape
%acbl:
% lower30ish%
CAPEs = 0;  CAPEf = 80;
% upper70is
CAPEs = 115;  CAPEf = 300;

% %bimode deep cape
% %lo
% CAPEs = 100;  CAPEf = 1600;
% %hi
% CAPEs = 1600;  CAPEf = 10000;

kill = find( MesoAscent_acblCAPE < CAPEs  |  MesoAscent_acblCAPE > CAPEf );
LFC_swathwidth(kill)           = NaN;
LFC_swathstrength(kill)        = NaN;
LFC_wid_meanwidth(kill)        = NaN;
MesoAscent_RHaloft(kill)           = NaN;
MesoAscent_acblCAPE(kill)           = NaN;
MesoAscent_deepCAPE(kill)           = NaN;
MesoAscent_shear06(kill)           = NaN;
CLDupdraft_area(kill)           = NaN;
CLDupdraft_Radius(kill)           = NaN;
CLDupdraft_topZasl(kill)           = NaN; 

%}



%{

%%%%%%%% filter by acbl RH
% figure; histogram(MesoAscent_RHaloft(:),40)
% cape33 = prctile(MesoAscent_RHaloft(:),33)
% cape66 = prctile(MesoAscent_RHaloft(:),66)
% mean(MesoAscent_deepCAPE(:),'omitnan') - std(MesoAscent_deepCAPE(:),'omitnan')
% mean(MesoAscent_deepCAPE(:),'omitnan') + std(MesoAscent_deepCAPE(:),'omitnan')
%acbl:
% lower30ish%
RHs = 0;  RHf = 0.65;
% upper70is
RHs = .65;  RHf = 1.00;

kill = find( MesoAscent_RHaloft < RHs  |  MesoAscent_RHaloft > RHf );
LFC_swathwidth(kill)           = NaN;
LFC_swathstrength(kill)        = NaN;
LFC_wid_meanwidth(kill)        = NaN;
MesoAscent_RHaloft(kill)           = NaN;
MesoAscent_acblCAPE(kill)           = NaN;
MesoAscent_deepCAPE(kill)           = NaN;
MesoAscent_shear06(kill)           = NaN;
CLDupdraft_area(kill)           = NaN;
CLDupdraft_Radius(kill)           = NaN;
CLDupdraft_topZasl(kill)           = NaN; 

%}


%{

%%%%%%%% filter by Rcloud
% figure; histogram(CLDupdraft_Radius(:),70)
% cape50 = prctile(CLDupdraft_Radius(:),50)
% cape66 = prctile(CLDupdraft_Radius(:),90)
% mean(MesoAscent_deepCAPE(:),'omitnan') - std(MesoAscent_deepCAPE(:),'omitnan')
% mean(MesoAscent_deepCAPE(:),'omitnan') + std(MesoAscent_deepCAPE(:),'omitnan')
%acbl:
% lower30ish%
Rs = 0;  Rf = 0.7;
% upper70is
Rs = .7;  Rf = 20.00;

kill = find( CLDupdraft_Radius < Rs  |  CLDupdraft_Radius > Rf );
LFC_swathwidth(kill)           = NaN;
LFC_swathstrength(kill)        = NaN;
LFC_wid_meanwidth(kill)        = NaN;
MesoAscent_RHaloft(kill)           = NaN;
MesoAscent_acblCAPE(kill)           = NaN;
MesoAscent_deepCAPE(kill)           = NaN;
MesoAscent_shear06(kill)           = NaN;
CLDupdraft_area(kill)           = NaN;
CLDupdraft_Radius(kill)           = NaN;
CLDupdraft_topZasl(kill)           = NaN; 

%}


figure 
%figure('position',[60,278,762,635]);
%sgtitle(' R_c_l_d (mean in LFC-LFC+1km layer) vs R_s_w_a_t_h ')

hold on
for RR = 1:ar

    BB = MesoAscent_RHaloft(:,:,RR)  ; 

    AA = CLDupdraft_topZasl(:,:,RR) ; 
    %AA = ( (MAX_wid_meanwidth(:,:,RR)/3.14159 ).^0.5 ) /1000 ; 

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-300,300,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-300,300,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2);   pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-300,300,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2);  pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-300,300,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2);  pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-300,300,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2);  pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-300,300,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2)  ;
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-300,300,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB =   MesoAscent_RHaloft  ; 
AA =   CLDupdraft_topZasl ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

%ccrall = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);
[ccrall, pval] = corrcoef(AA(:),BB(:)); ccrall = ccrall(2); pval = pval(2)  ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-50,300,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([0.2 1 3000 12000 ])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

%xlabel(' Cross-terrain width of orographic ascent object');
xlabel(' near-cloud acbl RH ');
ylabel(' cloud top m asl');
























%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% make several Hovmuller plots of everything for each case day. 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 



% 
% imout = '/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/images/';
% 
% %for R = 1 : ar
% 
% 
% 
% R = 2
% 
%     date = RUNS(R,:) ;  datelab = date(1:8)  ;
% 
%     imout2 = [imout,'/',RUNS(R,:)]  ;
%     mkdir(  imout2  )
% 
% 
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     %%%%% just cell info:
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% 
%     twin = 3;
%     lwin = 9;
% 
%     %%%%%%%%      cell count and swath thermo
%     hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;
% 
%     ff = figure('position', [8,114,1901,850]) ;
%     lab = RUNS(R,:) ;  lab(lab=='_') = ' '  ;
%     sgtitle(['Cell properties Hovmoller - ',  lab ])
% 
%     subplot(1,5,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('elev [m]')
% 
%     subplot(1,5,2)
%     contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R), 20, 'LineColor','none')
%     hold on
%     %contour( celltrack_hr, lat_alongSDC, CumCellPopAlongSDC_ALLCASES(:,:,R), [1 5 10], 'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Time cumul. cell count')
%     set(gca,'YTickLabel',[]);
%     xlabel('Time [UTC hr]')
%     colorbar
%     %Celleth10PopAlongSDC_ALLCASES
% 
%     subplot(1,5,3)
%     contourf( celltrack_hr, lat_alongSDC, CellmaxdbxPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     hold on
%     %contour( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(' Cell max dbz ')
%     set(gca,'YTickLabel',[])
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,5,4)
%     contourf( celltrack_hr, lat_alongSDC, Celleth10PopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     hold on
%     %contour( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(' Cell ETH10 ')
%     set(gca,'YTickLabel',[])
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,5,5)
%     contourf( celltrack_hr, lat_alongSDC, CellareaPopAlongSDC_ALLCASES(:,:,R),[0:10:100],'LineColor','none')
%     hold on
%     %contour( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([00 100])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(' Cell area')
%     set(gca,'YTickLabel',[])
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     saveas(ff, horzcat(imout2,'/',datelab,'_HovYT_Cellproperties.png') );
%     outlab = horzcat(imout2,'/',datelab,'_HovYT_Cellproperties.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);
% 
% 
% 
% 
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     %%%%%  Cells & swath
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
%     twin = 3;
%     lwin = 9;
% 
%     %%%%%%%%      cell count and swath thermo
%     hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;
% 
%     ff = figure('position', [8,114,1901,850]) ;
%     lab = RUNS(R,:) ;  lab(lab=='_') = ' '  ;
%     sgtitle(['Swath thermo properties Hovmoller - ',  lab ])
% 
%     subplot(1,7,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('Elev [m]')
% 
% 
%     subplot(1,7,2)
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( celltrack_hr, lat_alongSDC , Celleth10PopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Cell depth & count')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,3)
%     field = movmean(FullSDC_swathmucape_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Swath MUCAPE')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,4)
%     field = movmean(FullSDC_swathmucin_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, [-30:2:0],'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     caxis([-30 0])
%     title('Swath MUCIN')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,5)
%     field = movmean(FullSDC_swathqvap_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field*1000, [5:0.25:11],'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     caxis([5 11])
%     title('Swath Qvap')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,6)
%     field = movmean(FullSDC_swaththetamean_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([301 308])
%     title('Swath theta')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,7)
%     field = movmean(FullSDC_swaththetaemean_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([320 338])
%     title('Swath theta_e')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
% 
%     saveas(ff,horzcat(imout2,'/',datelab,'_HovYT_swaththermo.png'));
%     outlab = horzcat(imout2,'/',datelab,'_HovYT_swaththermo.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);
% 
% 
% 
% 
% 
% 
%     %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%%
%     %%%%%%%%  cell count and swath kinematic structure
%     %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%%
% 
%     hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;
% 
%     ff = figure('position', [8,114,1901,850]) ;
%     lab = RUNS(R,:) ;  lab(lab=='_') = ' '  ;
%     sgtitle(['Swath kinematic properties Hovmoller - ',  lab ])
% 
%     subplot(1,7,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('Elev [m]')
% 
%     subplot(1,7,2)
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( celltrack_hr, lat_alongSDC , Celleth10PopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Cell depth & count')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,3)
%     field = movmean(FullSDC_mesoWstrength_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([0 6])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Swath |w|')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,4)
%     field = movmean(FullSDC_mesoWwidth_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([0 2])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Swath width w')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,5)
%     field = movmean(FullSDC_VMfluxSum_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis( [0, 6]*10.^6 )
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Swath VMF')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,6)
%     field = movmean( FullSDC_swathmulfcagl_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis( [0 2.5] )
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Swath MULFC_a_g_l')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,7)
%     field = movmean( ( FullSDC_swathtopagl_ALLCASES(:,:,R) ./ (FullSDC_swathtoplfcagl_ALLCASES(:,:,R)/1000)   ),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis( [0 1.1] )
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Swath depth/LFC rat')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     saveas(ff,horzcat(imout2,'/',datelab,'_HovYT_swathkinematics.png'));
%     outlab = horzcat(imout2,'/',datelab,'_HovYT_swathkinematics.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);
% 
% 
% 
% 
%     %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%%
%     %%%%%%%%  cell count and swath "box" metrics
%     %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%%
% 
%     hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;
% 
% 
%     ff = figure('position', [8,114,1901,850]) ;
%     lab = RUNS(R,:) ;  lab(lab=='_') = ' '  ;
%     sgtitle(['Swath near-swath env properties Hovmoller - ',  lab ])
% 
% 
%     subplot(1,7,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('Elev [m]')
% 
%     subplot(1,7,2)
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( celltrack_hr, lat_alongSDC , Celleth10PopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('Cell depth & count')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,3)
%     meanrh =  mean(FullSDC_swathboxaloftRH_ALLCASES(:,:,:,R),2,'omitnan');   meanrh = permute(meanrh,[1 3 2]);
%     field = movmean(meanrh,twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([40 85])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('meanRH(ca) 2.5-5kmasl')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,4)
%     field = movmean(FullSDC_eastupslopedepthfract_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([0 1])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('East upslope depth')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,5)
%     upe = FullSDC_eastupslopemean_ALLCASES(:,:,R);      upe(:,1) = NaN;   %funky first time - need to fix in swath ID code?
%     field = movmean(upe,twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([-5 0])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('East |upslope|')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,6)
%     field = movmean(FullSDC_westupslopemean_ALLCASES(:,:,R),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field, 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([0 3])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('West |upslope|')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,7,7)
%     shear = FullSDC_eastU1to5kmasl_bulkshear_ALLCASES(:,:,R);   shear(:,1) = NaN;
%     field = movmean( shear ,twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
%     contourf( hrs, lat_alongSDC , field , 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([8 17])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('1-5kmasl bulk U shear (east)')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
% 
%     saveas(ff,horzcat(imout2,'/',datelab,'_HovYT_swathenv.png'));
%     outlab = horzcat(imout2,'/',datelab,'_HovYT_swathenv.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);
% 







% 
%     %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%%
%     %%%%%%%%  wID count and metrics
%     %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%% %%%%%%%%
% 
%     hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;
% 
% 
%     ff = figure('position', [8,114,1901,850]) ;
%     lab = RUNS(R,:) ;  lab(lab=='_') = ' '  ;
%     sgtitle(['wID properties Hovmoller - ',  lab ])
% 
% 
%     subplot(1,6,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('Elev [m]')
% 
%     % subplot(1,7,2)
%     % %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     % contourf( hrs, lat_alongSDC , wIDnum_best_alongsdc(:,:,R), 20,'LineColor','none')
%     % hold on
%     % contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     % axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     % caxis([0 10])
%     % title('wID inst num')
%     % xlabel('Time [UTC hr]')
%     % colorbar
% 
%     subplot(1,6,2)
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , wIDcumnum_best_alongsdc (:,:,R), 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     caxis([0 100])
%     title('wID time-cumul num')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,6,3)
%     contourf( hrs, lat_alongSDC , wIDmag_best_alongsdc(:,:,R), 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([2.5 20])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('wID mag')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,6,4)
%     contourf( hrs, lat_alongSDC , wIDarea_best_alongsdc(:,:,R), 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([0 10e6])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('wID area')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,6,5)
%     contourf( hrs, lat_alongSDC , wIDvmf_best_alongsdc(:,:,R), 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([0 20e6])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title('wID VMF')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,6,6)
%     contourf( hrs, lat_alongSDC , wIDtopasl_best_alongsdc(:,:,R), 20,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     caxis([0 10000])
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(' wID top (up to 10km)')
%     xlabel('Time [UTC hr]')
%     colorbar
% 
% 
%     saveas(ff,horzcat(imout2,'/',datelab,'_HovYT_wIDproperties.png'));
%     outlab = horzcat(imout2,'/',datelab,'_HovYT_wIDproperties.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);
% 
% 
% 
% %end  % R
% 












%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% make several Hovmuller plots of same variables across each day. 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 
%%%%%%% %%%%%%% %%%%%%% %%%%%%% 








imout = '/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/images/';



%  figure;  contourf( Celleth10PopAlongSDC_ALLCASES(:,:,2), 20 )


    %%%%%%%%
    %%%%%%%%      cell properties
    %%%%%%%%

    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;


    field2 = Celleth10PopAlongSDC_ALLCASES; field2(isnan(field2))=0;

    var = 'Celleth10PopAlongSDC_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    scale = [0:1:12];
    
    subplot(1,8,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,8,2)
    R=1;
    contourf( celltrack_hr, lat_alongSDC , field(:,:,R),scale ,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( celltrack_hr, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( celltrack_hr, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( celltrack_hr, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,6)
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( celltrack_hr, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,7)
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( celltrack_hr, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,8)
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( celltrack_hr, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar





    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);








% R = 1;



    %%%%%%%%
    %%%%%%%%
    %%%%%%%%
    %%%%%%%%      wID properties
    %%%%%%%%
    %%%%%%%%
    %%%%%%%%


    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'wIDtopasl_best_alongsdc';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = field/1000;
    
    scale = [0:1:12];
    
    subplot(1,8,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,8,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale ,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,6)
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,7)
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,8)
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);



    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    



    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'wIDarea_best_alongsdc';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = ( (field/3.14159).^0.5 )/1000 ;  %circ equiv radius
    scale = [0:0.25:2];
    %scale = [0:0.5e6:5e6];
    
    subplot(1,8,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,8,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,6)
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,7)
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,8)
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);



    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    



    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'wIDLFCARarea_best_alongsdc';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = ( (field/3.14159).^0.5 )/1000 ;  %circ equiv radius
    scale = [0:0.25:2];
    %scale = [0:0.5e6:5e6];
    
    subplot(1,8,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,8,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

        subplot(1,8,6)
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

        subplot(1,8,7)
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

            subplot(1,8,8)
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);





  
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    



    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'wIDmag_best_alongsdc';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    scale = [0:1:25];
    
    subplot(1,5,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,5,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar


    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);





    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    



    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'wIDLFCARmag_best_alongsdc';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    scale = [0:1:25];
    
    subplot(1,5,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,5,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar


    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);



    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    

%{

    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'wIDcumnum_best_alongsdc';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    scale = [0:2:110];
    
    subplot(1,5,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,5,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);

%}




    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%  swath metrics
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     dualpol_colmap
% 
% 
% 
%     twin = 3;
%     lwin = 9;
%     hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;
% 
%     ff = figure('position', [8,114,1901,850]) ;
% 
%     var = 'FullSDC_mesoWstrength_ALLCASES';
%     eval(   strcat( 'field =', var,';' )      ) ;
%     var2 = var;   var2(var2=='_') = ' ';
%     sgtitle([var2,' Hovmoller'])
% 
%     field = movmean(field(:,:,:),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
% 
%     subplot(1,5,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('Elev [m]')
% 
%     scale = [0:0.25:8];
%     
%     subplot(1,8,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('Elev [m]')
% 
% 
%     subplot(1,8,2)
%     R=1;
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([1 6])
% 
%     subplot(1,8,3)
%     R=2;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([1 6])
% 
%     subplot(1,8,4)
%     R=3;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([1 6])
% 
%     subplot(1,8,5)
%     R=4;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([1 6])
% 
%         subplot(1,8,6)
%     R=5;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([1 6])
% 
%         subplot(1,8,7)
%     R=6;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([1 6])
% 
%         subplot(1,8,8)
%     R=7;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([1 6])
% 
%     saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
%     outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);


dualpol_colmap

    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_mesoWstrength_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [1:0.25:7];

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;

    axes(ha(1))
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    axes(ha(2))
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    %caxis([0.5 7])

    axes(ha(3))
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])    
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    %colorbar
    %caxis([0.5 7])

    axes(ha(4))
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])  
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    %colorbar
    %caxis([0.5 8])
%
    axes(ha(5))
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])   
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    %caxis([0.5 7])
    %colormap((bluey2))

    axes(ha(6))
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    %caxis([0.5 7])
    %colormap(flipud(creamsicle2))
    colormap((bluey2))    

    axes(ha(7))
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5]) 
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    colorbar
    %caxis([0.5 7])
    colormap(flipud(creamsicle2))
    %colormap((bluey2))

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%     twin = 3;
%     lwin = 9;
%     hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;
% 
%     ff = figure('position', [8,114,1901,850]) ;
% 
%     var = 'FullSDC_mesoWwidth_ALLCASES';
%     eval(   strcat( 'field =', var,';' )      ) ;
%     var2 = var;   var2(var2=='_') = ' ';
%     sgtitle([var2,' Hovmoller'])
% 
%     field = movmean(field(:,:,:),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
% 
%     scale = [0:0.25:3.5];
% 
%     subplot(1,8,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('Elev [m]')
% 
%     subplot(1,8,2)
%     R=1;
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([0.0 2.5])
% 
%     subplot(1,8,3)
%     R=2;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([0.0 2.5])
% 
%     subplot(1,8,4)
%     R=3;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([0.0 2.5])
% 
%     subplot(1,8,5)
%     R=4;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([0.0 2.5])
% 
% 
%     subplot(1,8,6)
%     R=5;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([0.0 2.5])
% 
%     subplot(1,8,7)
%     R=6;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([0.0 2.5])
% 
%     subplot(1,8,8)
%     R=7;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([0.0 2.5])
% 
% 
%     saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
%     outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);




dualpol_colmap

    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_mesoWwidth_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [0:0.25:3.5];

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;

    axes(ha(1))
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    axes(ha(2))
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])    
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0.5 3])

    axes(ha(3))
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5]) 
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    %colorbar
    caxis([0.5 3])

    axes(ha(4))
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5]) 
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    %colorbar
    caxis([0.5 3])

    axes(ha(6))
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5]) 
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0.5 3])
    %colormap((bluey2))

    axes(ha(7))
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5]) 
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0.5 3])
    %colormap(flipud(creamsicle2))
    colormap((bluey2))    

    axes(ha(5))
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5]) 
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0.5 3])
    %colormap(flipud(creamsicle2))
    %colormap((bluey2))

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);











%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





%     twin = 3;
%     lwin = 9;
%     hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;
% 
%     ff = figure('position', [8,114,1901,850]) ;
% 
%     swathtop_to_LFC_ratio = FullSDC_swathtopagl_ALLCASES ./ (FullSDC_swathtoplfcagl_ALLCASES/1000);
%     var = 'swathtop_to_LFC_ratio';
%     eval(   strcat( 'field =', var,';' )      ) ;
%     var2 = var;   var2(var2=='_') = ' ';
%     sgtitle([var2,' Hovmoller'])
% 
%     scale = [0:0.05:1];
% 
%     field = movmean(field(:,:,:),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
% 
%     subplot(1,8,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('Elev [m]')
% 
%     subplot(1,8,2)
%     R=1;
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,8,3)
%     R=2;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,8,4)
%     R=3;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,8,5)
%     R=4;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,8,6)
%     R=5;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     subplot(1,8,7)
%     R=6;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar    
% 
%     subplot(1,8,8)
%     R=7;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
% 
%     saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
%     outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);






%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%



dualpol_colmap

    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    swathtop_to_LFC_ratio = FullSDC_swathtopasl_ALLCASES ./ (FullSDC_swathtoplfcasl_ALLCASES/1000);
    var = 'swathtop_to_LFC_ratio';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

        field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [0:0.05:1];

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;

    axes(ha(1))
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    axes(ha(2))
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0.5 1])

    axes(ha(3))
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    %colorbar
    caxis([0.5 1])

    axes(ha(4))
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    %colorbar
    caxis([0.5 1])

    axes(ha(6))
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0.5 1])
    colormap(flipud(creamsicle2))
    %colormap((bluey2))

    axes(ha(7))
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0.5 1])
    colormap(flipud(creamsicle2))
    %colormap((bluey2))    

    axes(ha(5))
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    colorbar
    caxis([0.5 1])
    colormap((peppermint2))
    %colormap((bluey2))

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);



















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



dualpol_colmap

    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_VMfluxSum_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = field ./ FullSDC_mesoWdepth_ALLCASES;   % normalize by depth of swath object (km)

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [0:0.5e6:9e6];

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;

    axes(ha(1))
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    axes(ha(2))
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])    
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0e6 6e6])

    axes(ha(3))
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])    
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    %colorbar
    caxis([0e6 6e6])

    axes(ha(4))
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])    
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    %colorbar
    caxis([0e6 6e6])

    axes(ha(6))
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])    
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0e6 6e6])
    colormap(flipud(creamsicle2))
    %colormap((bluey2))

    axes(ha(7))
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])    
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0e6 6e6])
    colormap(flipud(creamsicle2))
    %colormap((bluey2))    

    axes(ha(5))
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])    
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    %colorbar
    caxis([0e6 6e6])
    colormap(flipud(creamsicle2))
    %colormap((bluey2))

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);








    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%  swath thermo
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    


    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_swathmucape_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [0:250:3000];

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;
   
    axes(ha(1))  
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3) 
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    
    R=1;
    axes(ha(2)) 
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    caxis([100 4000])
    colormap(peppermint2)
    yticks('')

    axes(ha(3)) 
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    caxis([100 4000])
    colormap(peppermint2)

    axes(ha(4)) 
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    caxis([100 4000])
    colormap(peppermint2)

%     axes(ha(5)) 
%     R=4;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     yticks('')
%     colorbar
%     caxis([000 5000])
%     colormap(peppermint2)

    axes(ha(6)) 
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    caxis([100 4000])
    colormap(peppermint2)

    axes(ha(7)) 
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    caxis([100 4000])
    colormap(peppermint2)

    axes(ha(5)) 
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    colorbar
    caxis([100 4000])
    colormap(peppermint2)


    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);


%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%




    FullSDC_100ed_swathmucin_ALLCASES = FullSDC_swathmucin_ALLCASES;
    FullSDC_100ed_swathmucin_ALLCASES(isnan(FullSDC_100ed_swathmucin_ALLCASES)) = -101;


    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_swathmucin_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [-400:5:0];

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;
   
    axes(ha(1))  
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3) 
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    
    R=1;
    axes(ha(2)) 
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    caxis([-100 0])
    colormap(flipud(bluey2))
    yticks('')

    axes(ha(3)) 
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    caxis([-100 0])
    colormap(flipud(bluey2))

    axes(ha(4)) 
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    caxis([-100 0])
    colormap(flipud(bluey2))

%     axes(ha(5)) 
%     R=4;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     yticks('')
%     colorbar
%     caxis([000 5000])
%     colormap(peppermint2)

    axes(ha(6)) 
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    caxis([-100 0])
    colormap(flipud(bluey2))

    axes(ha(7)) 
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    caxis([-100 0])
    colormap(flipud(bluey2))

    axes(ha(5)) 
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    yticks('')
    caxis([-100 0])
    colormap(flipud(bluey2))


    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);






    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    

%{

    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_swathqvap_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [4e-3:0.5e-3:15e-3];
    
    subplot(1,8,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,8,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,6)
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,7)
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,8)
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);
%}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    

%{

    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_swaththetamean_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [300:1:320];
    
    subplot(1,5,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,5,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)]-10)
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)]-2)
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)-2])
    xlabel('Time [UTC hr]')
    colorbar

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);

%}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
dualpol_colmap


    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;


    var = 'FullSDC_swathboxaloftRH_ALLCASES';
    %var = 'FullSDC_swathboxaloftRHlfcrel_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field =  mean(field(:,:,:,:),2,'omitnan');   field = permute(field,[1 3 4 2]);
    field = movmean(field,twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [30:5:85];
    %scale = [15:5:75];  %lfcrel

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;
    
    axes(ha(1)) 
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    axes(ha(2)) 
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    %caxis([35 85 ])

    axes(ha(3)) 
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    %caxis([35 85 ])

    axes(ha(4)) 
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    %caxis([35 85 ])

%     axes(ha(5)) 
%     R=4;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colormap(melyel2)
%     yticks('')
%     colorbar
%     caxis([25 75 ])

    axes(ha(6)) 
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    %caxis([35 85 ])

    axes(ha(7)) 
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    %caxis([35 85 ])

    axes(ha(5)) 
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colormap(melyel2)
    yticks('')
    %colorbar
    %caxis([35 85 ])

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);







    %%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   wIDLFCARnum_alongsdc
    
    dualpol_colmap

    wIDcumnum_best_ZEROED_alongsdc = wIDcumnum_best_alongsdc;   
    wIDcumnum_best_ZEROED_alongsdc = wIDLFCARcumnum_best_alongsdc;
    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    [wq we wr]  = size(wIDcumnum_best_alongsdc);
    for j = 1:wq
        %for t = 1:we
            for y = 1:wr
               
                wpresent = find( isnan(wIDcumnum_best_alongsdc(j,:,y)==0  ) ) ;
                
                if(  isempty(wpresent)==0 ) 
                    
                    wIDcumnum_best_ZEROED_alongsdc(j,1:wpresent(1),y) = 0;

                end

            end
        %end
    end


    wIDcumnum_best_ZEROED_alongsdc = wIDcumnum_best_ZEROED_alongsdc .* ManSwathCull_keptMask ;


    ff = figure('position', [8,114,1901,850]) ;

    var = 'wIDcumnum_best_ZEROED_alongsdc';
    var(var==0) = NaN;
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])



%     field =  mean(field(:,:,:,:),2,'omitnan');   field = permute(field,[1 3 4 2]);
%     field = movmean(field,twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
% 
%     field = movmean(field(:,:,:),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');

    scale = [1:20:121];
    scale = [1:5:51];

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;
    
    axes(ha(1)) 
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    axes(ha(2)) 
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(allpurp2)


    axes(ha(3)) 
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R), scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(allpurp2)


    axes(ha(4)) 
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(allpurp2)


    axes(ha(6)) 
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colormap(allpurp2)
    yticks('')
    

    axes(ha(7)) 
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colormap(allpurp2)
    yticks('')
    %colorbar
    


    axes(ha(5)) 
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colormap(allpurp2)
    yticks('')
    

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);

    




%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     
% 
% 
% 
%     twin = 3;
%     lwin = 9;
%     hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;
% 
%     ff = figure('position', [8,114,1901,850]) ;
% 
%     var = 'FullSDC_swathmucin_ALLCASES';
%     eval(   strcat( 'field =', var,';' )      ) ;
%     var2 = var;   var2(var2=='_') = ' ';
%     sgtitle([var2,' Hovmoller'])
% 
%     field = movmean(field(:,:,:),twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');
% 
%     scale = [-500:5:0];
%     
%     subplot(1,5,1)
%     plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
%     hold on
%     axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
%     set(gca, 'XDir','reverse')
%     title('ridge profile')
%     xlabel('Elev [m]')
% 
%     subplot(1,5,2)
%     R=1;
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([-75 0])
% 
%     subplot(1,5,3)
%     R=2;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([-75 0])
% 
%     subplot(1,5,4)
%     R=3;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([-75 0])
% 
%     subplot(1,5,5)
%     R=4;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colorbar
%     caxis([-75 0])
% 
%     saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
%     outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    



    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_swathmulfcagl_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [0.0:0.1:4];
    
    subplot(1,5,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,5,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 20 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    %colorbar

    subplot(1,5,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 20 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    %colorbar

    subplot(1,5,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 20 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    %colorbar

    subplot(1,5,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 20 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    %colorbar


    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);



    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    



    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_eastupslopedepthfract_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [0.0:0.05:1];
    
    subplot(1,5,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,5,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar


    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);



    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
   % come up with an updraft speed associated with projecting upslope U on
   % the mean terrain gradient between  1000m to the local peak.
    ridge = max(Terr,[],1,'omitnan')' ;
    i_ridge = zeros(1600,1);  i_ridge(:) = NaN;
    i_east = zeros(1600,1);  i_east(:) = NaN;
    for j = 1:1600
        pki = find( Terr(:,j) == max(Terr(:,j)) ) ;  
        i_ridge(j) = pki(end) ;

        eastslope = Terr(:,j) ;

        eastslope(1:i_ridge(j)) = NaN ;
        i1000 = find( eastslope  <=  1000.0 ) ;   
        if(  isempty(i1000)==0  )
            i_east(j) = i1000(1) ;
        else
            i_east(j) = 500 ;       % there are a few j's where terrain at the eastern edge(500) is just a tad taller than 1000m, so let's just call it the edge       
        end
    end

    SLOPEridge = (ridge - 1000.) ./ ( ( i_ridge - i_east )*100  );  % (dz_peak/dx_1000)

    [ac av ab] = size(FullSDC_eastupslopemean_ALLCASES) ;
    SLOPE3d = zeros(ac,av,ab) ;    SLOPE3d(:) = NaN ;
    for j = 1:av
        for k = 1:ab
            SLOPE3d(:,j,k) = SLOPEridge ;
        end
    end


    % the w you'd get if you let 
    FullSDC_WPROJ_eastupslopemean_ALLCASES = SLOPE3d .* FullSDC_eastupslopemean_ALLCASES ;


    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_WPROJ_eastupslopemean_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    %scale = [-12:0.25:0];
    scale = [0:0.05:0.3];

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;
    
    axes(ha(1)) 
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    %axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    axis([1000 3000 lat_alongSDC(1) -31.5])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    axes(ha(2)) 
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(allpurp2)


    axes(ha(3)) 
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(allpurp2)


    axes(ha(4)) 
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(allpurp2)


    axes(ha(6)) 
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colormap(allpurp2)
    yticks('')
    

    axes(ha(7)) 
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colormap(allpurp2)
    yticks('')
    


    axes(ha(5)) 
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    %axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    axis([13 19 lat_alongSDC(1) -31.5])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colormap(allpurp2)
    yticks('')
    colorbar

    colormap(greeny2)

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);


%%%%

dualpol_colmap


    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    var = 'FullSDC_eastupslopemean_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

%     field =  mean(field(:,:,:,:),2,'omitnan');   field = permute(field,[1 3 4 2]);
%     field = movmean(field,twin,2 ,'omitnan');
%     field = movmean(field, lwin, 1 ,'omitnan');


    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [-8:0.25:0];

    [ha, pos] = tight_subplot(1,7,0.005,0.1) ;
    
    axes(ha(1)) 
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    axes(ha(2)) 
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    caxis([ scale(1) scale(end)])

    axes(ha(3)) 
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    caxis([ scale(1) scale(end)])

    axes(ha(4)) 
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    caxis([ scale(1) scale(end)])

%     axes(ha(5)) 
%     R=4;
%     %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
%     contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
%     hold on
%     contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
%     %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
%     axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
%     title(RUNS(R,1:8))
%     caxis([ scale(1) scale(end)])
%     xlabel('Time [UTC hr]')
%     colormap(melyel2)
%     yticks('')
%     colorbar
%     caxis([25 75 ])

    axes(ha(6)) 
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    caxis([ scale(1) scale(end)])

    axes(ha(7)) 
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    yticks('')
    xlabel('Time [UTC hr]')
    colormap(crush2)
    caxis([ scale(1) scale(end)])

    axes(ha(5)) 
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 19 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colormap(melyel2)
    yticks('')
    colorbar
    caxis([ scale(1) scale(end)])

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);










    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    



    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;

    total_bulk_shear = ( FullSDC_eastU1to5kmasl_bulkshear_ALLCASES.^2 + FullSDC_eastV1to5kmasl_bulkshear_ALLCASES.^2     ).^0.5;
    var = 'total_bulk_shear';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [0:0.25:20];
    
    subplot(1,8,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,8,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,6)
    R=5;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,8,7)
    R=6;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar    

    subplot(1,8,8)
    R=7;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar 

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);









    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    



    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;


    FullSDC_eastVlowlev_ALLCASES = mean(  FullSDC_eastV_ALLCASES(:,2:7,:,:),2, 'omitnan' )  ;
    FullSDC_eastVlowlev_ALLCASES = permute(FullSDC_eastVlowlev_ALLCASES,[1 3 4 2]);


    var = 'FullSDC_eastVlowlev_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [-12:0.25:0];
    
    subplot(1,5,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,5,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    



    twin = 3;
    lwin = 9;
    hrs = [ 13 : (5/60) : (19 + 10/60) ]  ;

    ff = figure('position', [8,114,1901,850]) ;


    FullSDC_eastUlowlev_ALLCASES = mean(  FullSDC_eastU_ALLCASES(:,2:7,:,:),2, 'omitnan' )  ;
    FullSDC_eastUlowlev_ALLCASES = permute(FullSDC_eastUlowlev_ALLCASES,[1 3 4 2]);


    var = 'FullSDC_eastUlowlev_ALLCASES';
    eval(   strcat( 'field =', var,';' )      ) ;
    var2 = var;   var2(var2=='_') = ' ';
    sgtitle([var2,' Hovmoller'])

    field = movmean(field(:,:,:),twin,2 ,'omitnan');
    field = movmean(field, lwin, 1 ,'omitnan');

    scale = [-12:0.25:0];
    
    subplot(1,5,1)
    plot( peakprofile, lat_alongSDC, 'LineWidth', 3)
    hold on
    axis([1000 3000 lat_alongSDC(1) lat_alongSDC(end)])
    set(gca, 'XDir','reverse')
    title('ridge profile')
    xlabel('Elev [m]')

    subplot(1,5,2)
    R=1;
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,3)
    R=2;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,4)
    R=3;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    subplot(1,5,5)
    R=4;
    %contourf( celltrack_hr, lat_alongSDC , CumCellPopAlongSDC_ALLCASES(:,:,R),20,'LineColor','none')
    contourf( hrs, lat_alongSDC , field(:,:,R),scale,'LineColor','none')
    hold on
    contour( celltrack_hr, lat_alongSDC ,CumCellPopAlongSDC_ALLCASES(:,:,R),[1 5 10],'LineColor','k','LineWidth',2)
    %contour( celltrack_hr, lat_alongSDC , field2(:,:,R),[8 8],'LineColor','k','LineWidth',2)
    axis([13 20 lat_alongSDC(1) lat_alongSDC(end)])
    title(RUNS(R,1:8))
    caxis([ scale(1) scale(end)])
    xlabel('Time [UTC hr]')
    colorbar

    saveas(ff,horzcat(imout,'/HovYT_4days_',var,'.png'));
    outlab = horzcat(imout,'/HovYT_4days_',var,'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%  wID only analysis
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%wID population counts by filtration method:
widpopul_raw       = zeros(alltimes,ar);
widpopul_lfcfilt  = zeros(alltimes,ar);
widpopul_lfcsizefilt   = zeros(alltimes,ar);
for R = 1:ar
    for t = 1:alltimes

        maxarea_raw =           max( wid_profs_area_ALLCASES(:,:,t,R) , [], 2);
        maxarea_lfcfilt =       max( widLFC_profs_area_ALLCASES(:,:,t,R) , [], 2);
        maxarea_lfcsizefilt =   max( widLFCAR_profs_area_ALLCASES(:,:,t,R) , [], 2);

        widpopul_raw(t,R)       = length(find(isnan(maxarea_raw)==0)) ;
        widpopul_lfcfilt(t,R)  = length(find(isnan(maxarea_lfcfilt)==0)) ;
        widpopul_lfcsizefilt(t,R)   = length(find(isnan(maxarea_lfcsizefilt)==0)) ;
    end
end
widpopul_raw_fullday            = sum(widpopul_raw,1)
widpopul_lfcfilt_fullday        = sum(widpopul_lfcfilt,1)
widpopul_lfcsizefilt_fullday    = sum(widpopul_lfcsizefilt,1)






%%% general histograms of wid stats all cases: 
figure
sgtitle('unfiltered wID population')
%%% histogram of max up area in each ups profile all cases and times
subplot(1,3,1)
BB = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
BB = permute(BB,[1 3 4 2]);
CC =  ( BB/3.14159 ) .^0.5 ;
edges = [0:0.1:5];
histogram(CC(:)/1000,'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title(' Updraft circ-equiv radius (km) for all cases & times ' )
xlabel(' circ-equiv rad (km) ')
ylabel(' Number of updrafts')
set(gca,'YScale','log')
axis([0 5 0 10000])

%%% histogram of max up mag in each ups profile all cases and times
subplot(1,3,2)
BB = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
BB = permute(BB,[1 3 4 2]);
edges = [2.5:0.25:50];
histogram(BB(:) ,'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title(' |Updraft|_m_a_x for all cases & times ' )
xlabel(' (m/s) ')
ylabel(' Number of updrafts')
set(gca,'YScale','log')
axis([2.5 30 0 10000])

%%% histogram of max up area in each ups profile all cases and times
subplot(1,3,3)
BB = max(wid_profs_massflux_ALLCASES(:,:,:,:),[],2); 
BB = permute(BB,[1 3 4 2]); BB(BB==0) = NaN;
edges = [0:200000:50000000];
histogram(BB(:),'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title(' vert mass flux for all cases & times ' )
xlabel(' (flux units) ')
ylabel(' Number of updrafts')
set(gca,'YScale','log')
axis([edges(1) edges(end) 0 10000])




%%%%%%%%%%%%%%%%%%%%%%%% same but LFC-layer & small area filtered wIDs:

figure
sgtitle(' LFCLAYER & area filtered wID population')
%%% histogram of max up area in each ups profile all cases and times
subplot(1,3,1)
BB = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2); 
BB = permute(BB,[1 3 4 2]);
CC =  ( BB/3.14159 ) .^0.5 ;
edges = [0:0.1:5];
histogram(CC(:)/1000,'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title(' Updraft circ-equiv radius (km) for all cases & times ' )
xlabel(' circ-equiv rad (km) ')
ylabel(' Number of updrafts')
set(gca,'YScale','log')
axis([0 5 0 1000])

%%% histogram of max up mag in each ups profile all cases and times
subplot(1,3,2)
BB = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
BB = permute(BB,[1 3 4 2]);
edges = [2.5:0.25:50];
histogram(BB(:) ,'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title(' |Updraft|_m_a_x for all cases & times ' )
xlabel(' (m/s) ')
ylabel(' Number of updrafts')
set(gca,'YScale','log')
axis([2.5 30 0 1000])

%%% histogram of max up area in each ups profile all cases and times
subplot(1,3,3)
BB = max(widLFCAR_profs_massflux_ALLCASES(:,:,:,:),[],2); 
BB = permute(BB,[1 3 4 2]); BB(BB==0) = NaN;
edges = [0:200000:50000000];
histogram(BB(:),'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title(' vert mass flux for all cases & times ' )
xlabel(' (flux units) ')
ylabel(' Number of updrafts')
set(gca,'YScale','log')
axis([edges(1) edges(end) 0 1000])




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%   start plots of correlations alltogether and by case:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  wID width vs mesoscale swath properties  (LFC-layer & small area
%  filtered):  deep + shallow clouds
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%{
ff = figure('position',[1862,67,1407,543]);

sgtitle('filtered outside of lfc-layer & small area filtered wIDs')
tmlg = 4;
subplot(1,2,1)
hold on

for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan')./(1000*1000);
%     AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWstrength_ALLCASES(:,:,tmlg,RR);
    CC = widLFCAR_mesoWwidth_ALLCASES(:,:,tmlg,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = []; CC(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];  CC(kill) = [];
    kill = find(CC < 0.5);
    BB(kill) = []; AA(kill) = [];  CC(kill) = [];  
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2,'omitnan')./(1000*1000); 
AA = permute(AA,[1 3 4 2]);
% AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWstrength_ALLCASES(:,:,tmlg,:); 
CC = widLFCAR_mesoWwidth_ALLCASES(:,:,tmlg,:);
kill = isnan(BB);
BB(kill) = []; AA(kill) = []; CC(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];  CC(kill) = [];
kill = find(CC < 0.5);
BB(kill) = []; AA(kill) = [];  CC(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), 'FontSize', 12);

axis([2 9 0.2 10])
title(['Combined popul corcoeff = ',  num2str(round(ccrall,2)) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('swath strength (m/s)');
ylabel('max[updraft circ-equiv radius] (km)');


subplot(1,2,2)
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWwidth_ALLCASES(:,:,tmlg,RR)/2;
    CC = widLFCAR_mesoWwidth_ALLCASES(:,:,tmlg,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = []; CC(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];  CC(kill) = [];
    kill = find(CC < 0.5);
    BB(kill) = []; AA(kill) = [];  CC(kill) = [];  
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWwidth_ALLCASES(:,:,tmlg,:)/2;
CC = widLFCAR_mesoWwidth_ALLCASES(:,:,tmlg,:);
kill = isnan(BB);
BB(kill) = []; AA(kill) = []; CC(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];  CC(kill) = [];
kill = find(CC < 0.5);
BB(kill) = []; AA(kill) = [];  CC(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

%axis equal

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), 'FontSize', 12);

axis([0.2 2 0.25 2])
title(['Combined popul corcoeff = ',  num2str(round(ccrall,2)) ])
xlabel('swath width/2 (km)');
ylabel('max[updraft circ-equiv radius] (km)');

saveas(ff,horzcat(imout,'/wID_swathstr.png'));
outlab = horzcat(imout,'/wID_swathstr.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% same but just the deep wID's     widLFCARdeep
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

ff = figure('position',[1862,67,1407,543]);

sgtitle('Just deep wids, filtered outside of lfc-layer & small area filtered wIDs')
tmlg = 4;
subplot(1,2,1)
hold on

for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan')./(1000*1000);
%     AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWstrength_ALLCASES(:,:,tmlg,RR);
    CC = widLFCARdeep_mesoWwidth_ALLCASES(:,:,tmlg,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = []; CC(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];  CC(kill) = [];
    kill = find(CC < 0.5);
    BB(kill) = []; AA(kill) = [];  CC(kill) = [];  
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2,'omitnan')./(1000*1000); 
AA = permute(AA,[1 3 4 2]);
% AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWstrength_ALLCASES(:,:,tmlg,:); 
CC = widLFCARdeep_mesoWwidth_ALLCASES(:,:,tmlg,:);
kill = isnan(BB);
BB(kill) = []; AA(kill) = []; CC(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];  CC(kill) = [];
kill = find(CC < 0.5);
BB(kill) = []; AA(kill) = [];  CC(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), 'FontSize', 12);

axis([2 9 0.2 10])
title(['Combined popul corcoeff = ',  num2str(round(ccrall,2)) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('swath ascent (m/s)');
ylabel('max[updraft area] (km^2)');


subplot(1,2,2)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWwidth_ALLCASES(:,:,tmlg,RR)/2;
    CC = widLFCARdeep_mesoWwidth_ALLCASES(:,:,tmlg,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = []; CC(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];  CC(kill) = [];
    kill = find(CC < 0.5);
    BB(kill) = []; AA(kill) = [];  CC(kill) = [];  
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWwidth_ALLCASES(:,:,tmlg,:)/2;
CC = widLFCARdeep_mesoWwidth_ALLCASES(:,:,tmlg,:);
kill = isnan(BB);
BB(kill) = []; AA(kill) = []; CC(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];  CC(kill) = [];
kill = find(CC < 0.5);
BB(kill) = []; AA(kill) = [];  CC(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

%axis equal

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), 'FontSize', 12);

axis([0.2 2 0.25 2])
title(['Combined popul corcoeff = ',  num2str(round(ccrall,2)) ])
xlabel('swath width/2 (km)');
ylabel('max[updraft circ-equiv radius] (km)');

saveas(ff,horzcat(imout,'/wID_swathstr_justdeep.png'));
outlab = horzcat(imout,'/wID_swathstr_justdeep.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%}





%{

subplot(2,2,3)
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWvmsum_ALLCASES(:,:,tmlg,RR)/2;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30000000,100000);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30000000,100000);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30000000,100000);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30000000,100000);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWvmsum_ALLCASES(:,:,tmlg,:)/2;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30000000,100000);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), 'FontSize', 12);
    
axis([0 10000000. 0.25 3])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])
%xlabel('wid''s mesoWswath accumVMF ALLCASES');
xlabel('swath vert mass flux');
ylabel('max[updraft circ-equiv radius] (km)');




subplot(2,2,4)
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWtoplfcaslRAT_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,5,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,5,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,5,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,5,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWtoplfcaslRAT_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,5,30);
yFit = polyval(linCo,xFit);
plot(xFit,yFit,'k')

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0.5 1 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('swath depth (ratio swath top/LFC)');
ylabel('max[updraft circ-equiv radius] (km)');

%}






% %%%%%% try same but filter out wIDs with tops shallower than MINTOP masl
% %%%%%% (CHANGE TO ASL LATER)
% 
% MINTOP = 4500;
% widLFCARdeep_profs_area_ALLCASES        =  widLFCAR_profs_area_ALLCASES ;
% widLFCARdeep_profs_massflux_ALLCASES    =  widLFCAR_profs_massflux_ALLCASES ;
% widLFCARdeep_profs_maxmag_ALLCASES      =  widLFCAR_profs_maxmag_ALLCASES ;
% 
% widLFCARdeep_mesoWstrength_ALLCASES     =  widLFCAR_mesoWstrength_ALLCASES;
% widLFCARdeep_mesoWwidth_ALLCASES        =  widLFCAR_mesoWwidth_ALLCASES;
% widLFCARdeep_mesoWvmsum_ALLCASES        =  widLFCAR_mesoWvmsum_ALLCASES;
% widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES =  widLFCAR_mesoWtoplfcaslRAT_ALLCASES;
% widLFCARdeep_mesoWlfcagl_ALLCASES           = widLFCAR_mesoWlfcagl_ALLCASES;
% widLFCARdeep_mesoWqvap_ALLCASES             = widLFCAR_mesoWqvap_ALLCASES;
% widLFCARdeep_mesoWcape_ALLCASES             = widLFCAR_mesoWcape_ALLCASES;
% widLFCARdeep_mesoWcin_ALLCASES              = widLFCAR_mesoWcin_ALLCASES;
% widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES   = widLFCAR_mesoWmeanRHboxaloft_ALLCASES;
% widLFCARdeep_mesoWdepthrat_ALLCASES         = widLFCAR_mesoWdepthrat_ALLCASES;
% widLFCARdeep_mesoWtheta_ALLCASES            = widLFCAR_mesoWtheta_ALLCASES;
% widLFCARdeep_eastupslopedepthfract_ALLCASES  = widLFCAR_eastupslopedepthfract_ALLCASES;
% widLFCARdeep_eastupslopemean_ALLCASES        = widLFCAR_eastupslopemean_ALLCASES;
% widLFCARdeep_westupslopemean_ALLCASES        = widLFCAR_westupslopemean_ALLCASES;
% widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES = widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES;
% % filter out shallow wIDs:
% for n = 1:wn
%     for t = 1:wt
%         for R = 1:ar
%             maxasl = max(wid_profs_centHTasl_ALLCASES(n,:,t,R),[],'omitnan');
%             
%             if( isempty(maxasl)==0  & isnan(maxasl)==0  &  maxasl < MINTOP )
%                 widLFCARdeep_profs_area_ALLCASES(n,:,t,R)  =  NaN;
%                 widLFCARdeep_profs_massflux_ALLCASES(n,:,t,R)  =  NaN;
%                 widLFCARdeep_profs_maxmag_ALLCASES(n,:,t,R)    =  NaN;                
% 
%                 widLFCARdeep_mesoWstrength_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWwidth_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWvmsum_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWlfcagl_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWqvap_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWcape_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWcin_ALLCASES(n,t,R)      =  NaN; 
%                 widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWdepthrat_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWtheta_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_eastupslopedepthfract_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_eastupslopemean_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_westupslopemean_ALLCASES(n,t,R)      =  NaN;
%                 widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES(n,t,R)      =  NaN;
%             end
%         end
%     end
% end

% % % diagnostics
% wblah0 = wid_profs_centHTasl_ALLCASES(:,:,33,1) / 1000;
% wblah1 = widLFCAR_profs_area_ALLCASES(:,:,33,1);
% wblah2 = widLFCARdeep_profs_area_ALLCASES(:,:,33,1);






%{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  wID width vs mesoscale swath properties  (LFC-layer & small area & zasl < 4km filtered):
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

figure('position',[239,91,1407,745]);
sgtitle(['filtered outside of lfc-layer & small area & shorter than ', num2str(MINTOP) ,' m asl'])

subplot(2,2,1)
hold on
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan');
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWstrength_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2,'omitnan'); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWstrength_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 12);

axis([1 12 -0.1 5])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('swath strength (m/s)');
ylabel('max[updraft circ-equiv radius] (km)');


subplot(2,2,2)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWwidth_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWwidth_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0 5 -0.1 5])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('swath width (km)');
ylabel('max[updraft circ-equiv radius] (km)');





subplot(2,2,3)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWvmsum_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30000000,100000);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30000000,100000);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30000000,100000);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30000000,100000);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWvmsum_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30000000,100000);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);
    
axis([0 20000000. -0.1 5])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath accumVMF ALLCASES');
xlabel('swath vert mass flux');
ylabel('max[updraft circ-equiv radius] (km)');




subplot(2,2,4)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,5,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,5,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,5,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,5,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,5,30);
yFit = polyval(linCo,xFit);
plot(xFit,yFit,'k')

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0.5 1 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('swath depth (ratio swath top/LFC)');
ylabel('max[updraft circ-equiv radius] (km)');

%}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%   %wID strength vs mesoscale swath properties (filt: FLC layer, small w area):
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%{

figure('position',[239,91,1407,745]);
sgtitle('filtered outside of lfc-layer & small area wIDs')
subplot(2,2,1)
hold on
for RR = 1:ar
    AA = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWstrength_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWstrength_ALLCASES(:,:,tbak,:);   BB = permute(BB,[1 2 4 3]);
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 12);

axis([1 12 2.5 25])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('swath strength (m/s)');
ylabel('max[updraft mag] (m/s)');






subplot(2,2,2)
for RR = 1:ar
    AA = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWwidth_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWwidth_ALLCASES(:,:,tbak,:);  BB = permute(BB,[1 2 4 3]);
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0 5.5 2.5 25])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath width ALLCASES');
xlabel('swath width (km)');
ylabel('max[updraft mag] (m/s)');





subplot(2,2,3)
for RR = 1:ar
    AA = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,RR),[],2);  AA = permute(AA,[1 3 2]);
    %AA = permute(AA,[1 3 4 2]);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWvmsum_ALLCASES(:,:,tbak, RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30000000,100000);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30000000,100000);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30000000,100000);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30000000,100000);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_maxmag_ALLCASES,[],2,'omitnan');
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWvmsum_ALLCASES(:,:,tbak,:);  BB = permute(BB,[1 2 4 3]); 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30000000,100000);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);
    
axis([0 20000000. 2.5 25])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath accumVMF ALLCASES');
xlabel('swath vert mass flux');
ylabel('max[updraft mag] (m/s)');





subplot(2,2,4)
for RR = 1:ar
    AA = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,RR),[],2,'omitnan'); AA = permute(AA,[1 3 2]);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWtoplfcaslRAT_ALLCASES(:,:,tbak,RR); 
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,5,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,5,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,5,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,5,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_maxmag_ALLCASES,[],2,'omitnan');
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWtoplfcaslRAT_ALLCASES(:,:,tbak,:);  BB = permute(BB,[1 2 4 3]);
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,5,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0.5 1 3 15])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('swath depth (ratio swath top/LFC)');
ylabel('max[updraft mag] (m/s)');





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%   %wID strength vs mesoscale swath properties (filt: FLC layer, small w area, shallow updrafts):
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


figure('position',[239,91,1407,745]);
sgtitle('filtered outside of lfc-layer & small area wIDs & shallow wIDs')

subplot(2,2,1)
hold on
for RR = 1:ar
    AA = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWstrength_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWstrength_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 12);

axis([1 12 2.5 25])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('swath strength (m/s)');
ylabel('max[updraft mag] (m/s)');






subplot(2,2,2)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWwidth_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWwidth_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30,30);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0 5.5 2.5 25])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath width ALLCASES');
xlabel('swath width (km)');
ylabel('max[updraft mag] (m/s)');





subplot(2,2,3)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWvmsum_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,30000000,100000);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,30000000,100000);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,30000000,100000);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,30000000,100000);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWvmsum_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,30000000,100000);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);
    
axis([0 20000000. 2.5 25])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath accumVMF ALLCASES');
xlabel('swath vert mass flux');
ylabel('max[updraft mag] (m/s)');





subplot(2,2,4)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,5,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,5,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,5,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,5,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,5,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0.5 1 3 15])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('swath depth (ratio swath top/LFC)');
ylabel('max[updraft mag] (m/s)');








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%  |wID|  vs.  swath thermo  (filt: LFC, area)
%%%%%%%%%%%%%%%%%%%%%%%%%%


figure('position',[239,91,1407,745]);
sgtitle('filtered outside of lfc-layer & small area wIDs')
subplot(2,2,1) 
for RR = 1:ar
    AA = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWcape_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,10000,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,10000,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,10000,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,10000,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWcape_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,10000,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12); 

axis([500 6000 3 25])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath CAPE (j/kg)');
ylabel('max[updraft mag] (m/s)');



subplot(2,2,2) 
for RR = 1:ar
    AA = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWcin_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-400, 400, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-400, 400, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-400, 400, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-400, 400, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWcin_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-400, 400, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([-40 0 3 25])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])%xlabel('wid''s mesoWswath cin ALLCASES');
xlabel('in-swath CIN (j/kg)');
ylabel('max[updraft mag] (m/s)');





subplot(2,2,3)
for RR = 1:ar
    AA = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWqvap_ALLCASES(:,:,RR)*1000;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0, 40, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0, 40, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0, 40, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0, 40, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWqvap_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0, 40, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([6 18 3 25])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath Qvap (g/kg)');
ylabel('max[updraft mag] (m/s)');





subplot(2,2,4)
for RR = 1:ar
    AA = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWlfcagl_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0, 40, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0, 40, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0, 40, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0, 40, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWlfcagl_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0, 40, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0.2 3 3 25])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath LFC (km agl)');
ylabel('max[updraft mag] (m/s)');




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%  |wID|  vs.  swath thermo  (filt: LFC, area, shallow wIDs)
%%%%%%%%%%%%%%%%%%%%%%%%%%


figure('position',[239,91,1407,745]);
sgtitle('filtered outside of lfc-layer & small area wIDs & shallow wIDs')
subplot(2,2,1) 
for RR = 1:ar
    AA = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWcape_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,10000,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,10000,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,10000,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,10000,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWcape_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,10000,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12); 

axis([500 6000 3 25])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath CAPE (j/kg)');
ylabel('max[updraft mag] (m/s)');



subplot(2,2,2) 
for RR = 1:ar
    AA = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWcin_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-400, 400, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-400, 400, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-400, 400, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-400, 400, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWcin_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-400, 400, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([-40 0 3 25])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])%xlabel('wid''s mesoWswath cin ALLCASES');
xlabel('in-swath CIN (j/kg)');
ylabel('max[updraft mag] (m/s)');





subplot(2,2,3)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWqvap_ALLCASES(:,:,RR)*1000;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0, 40, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0, 40, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0, 40, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0, 40, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWqvap_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0, 40, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([6 18 3 25])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath Qvap (g/kg)');
ylabel('max[updraft mag] (m/s)');





subplot(2,2,4)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,RR),[],2);
    %AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWlfcagl_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0, 40, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0, 40, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0, 40, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0, 40, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_maxmag_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
%AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWlfcagl_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0, 40, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0.2 3 3 25])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath LFC (km agl)');
ylabel('max[updraft mag] (m/s)');










%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%  wID area  vs.  swath thermo  (filt: LFC, area)
%%%%%%%%%%%%%%%%%%%%%%%%%%


figure('position',[239,91,1407,745]);
sgtitle('filtered outside of lfc-layer & small area wIDs')
subplot(2,2,1) 
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWcape_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,10000,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,10000,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,10000,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,10000,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_area_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWcape_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,10000,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12); 

axis([500 6000 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath CAPE (j/kg)');
ylabel('max[updraft circ-equiv radius] (km)');



subplot(2,2,2) 
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWcin_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-400, 400, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-400, 400, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-400, 400, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-400, 400, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_area_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWcin_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-400, 400, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([-40 0 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])%xlabel('wid''s mesoWswath cin ALLCASES');
xlabel('in-swath CIN (j/kg)');
ylabel('max[updraft circ-equiv radius] (km)');





subplot(2,2,3)
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWqvap_ALLCASES(:,:,RR)*1000;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0, 40, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0, 40, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0, 40, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0, 40, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_area_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWqvap_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0, 40, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([6 18 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath Qvap (g/kg)');
ylabel('max[updraft circ-equiv radius] (km)');





subplot(2,2,4)
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWlfcagl_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0, 40, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0, 40, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0, 40, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0, 40, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCAR_profs_area_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWlfcagl_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0, 40, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0.2 3 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath LFC (km agl)');
ylabel('max[updraft circ-equiv radius] (km)');








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%  wID area  vs.  swath thermo  (filt: LFC, area, shallow wIDs)
%%%%%%%%%%%%%%%%%%%%%%%%%%


figure('position',[239,91,1407,745]);
sgtitle('filtered outside of lfc-layer & small area wIDs & shallow wIDs')
subplot(2,2,1) 
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWcape_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,10000,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,10000,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,10000,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,10000,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWcape_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,10000,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12); 

axis([500 6000 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath CAPE (j/kg)');
ylabel('max[updraft circ-equiv radius] (km)');



subplot(2,2,2) 
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWcin_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-400, 400, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-400, 400, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-400, 400, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-400, 400, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWcin_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-400, 400, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([-40 0 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])%xlabel('wid''s mesoWswath cin ALLCASES');
xlabel('in-swath CIN (j/kg)');
ylabel('max[updraft circ-equiv radius] (km)');





subplot(2,2,3)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWqvap_ALLCASES(:,:,RR)*1000;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0, 40, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0, 40, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0, 40, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0, 40, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWqvap_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0, 40, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([6 18 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath Qvap (g/kg)');
ylabel('max[updraft circ-equiv radius] (km)');





subplot(2,2,4)
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWlfcagl_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0, 40, 10);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0, 40, 10);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0, 40, 10);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0, 40, 10);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(widLFCARdeep_profs_area_ALLCASES,[],2);
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWlfcagl_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0, 40, 10);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4), 'FontSize', 12);

axis([0.2 3 -0.1 5])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
title(['Combined popul corcoeff = ', num2str(ccrall) ])
xlabel('in-swath LFC (km agl)');
ylabel('max[updraft circ-equiv radius] (km)');









%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  wID width vs mesoscale swathbox things (filt: lfc layer & small area):
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

figure('position',[239,91,1407,745]);
sgtitle('filtered outside of lfc-layer & small area wIDs')
subplot(2,2,1)
hold on
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan');
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWmeanRHboxaloft_ALLCASES(:,:,RR);   BB(BB==0)= NaN;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,100,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,100,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,100,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,100,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end

AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWmeanRHboxaloft_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,100,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 14);

axis([43 83 0.2 3])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('near-cloud RH mean between 3-5kmagl (%)');
ylabel('max[updraft circ-equiv radius] (km)');





subplot(2,2,2)
hold on
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan');
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,RR);   BB(BB==0)= NaN;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,100,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,100,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,100,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,100,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end

AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,100,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 14);

axis([8 28 0.2 3])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('near-cloud 1-5km asl mag total shear (m/s)');
ylabel('max[updraft circ-equiv radius] (km)');







subplot(2,2,3)
hold on
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan');
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_mesoWeast1to5aslUshear_ALLCASES(:,:,RR);   BB(BB==0)= NaN;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,100,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,100,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,100,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,100,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end

AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_mesoWeast1to5aslUshear_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,100,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')
legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 14);

axis([8 28 0.2 3])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('near-cloud 1-5km asl mag U shear (m/s)');
ylabel('max[updraft circ-equiv radius] (km)');




subplot(2,2,4)
hold on
for RR = 1:ar
    AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan');
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCAR_eastupslopedepthfract_ALLCASES(:,:,RR);   BB(BB==0)= NaN;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,100,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,100,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,100,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,100,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end

AA = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCAR_eastupslopedepthfract_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,100,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')
legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 14);

axis([0.2 1.05 0.2 3])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('eastside upslope depth (fraction pts below SDC top)');
ylabel('max[updraft circ-equiv radius] (km)');





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  wID width vs mesoscale swathbox things (filt: lfc layer & small area & shallow wIDs):
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

figure('position',[239,91,1407,745]);
sgtitle('filtered outside of lfc-layer & small area wIDs & shallow updrafts')
subplot(2,2,1)
hold on
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan');
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES(:,:,RR);   BB(BB==0)= NaN;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,100,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,100,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,100,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,100,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end

AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,100,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 14);

axis([43 83 0.2 3])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('near-cloud RH mean between 3-5kmagl (%)');
ylabel('max[updraft circ-equiv radius] (km)');





subplot(2,2,2)
hold on
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan');
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,RR);   BB(BB==0)= NaN;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,100,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,100,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,100,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,100,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end

AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,100,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')

legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 14);

axis([8 28 0.2 3])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('near-cloud 1-5km asl mag total shear (m/s)');
ylabel('max[updraft circ-equiv radius] (km)');







subplot(2,2,3)
hold on
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan');
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = wid_eastupslopemean_ALLCASES(:,:,RR);   BB(BB==0)= NaN;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-100,100,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-100,100,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-100,100,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-100,100,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end

AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_eastupslopemean_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-100,100,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')
legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 14);

axis([-12 0 0.2 3])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('east-side upslope wind (m/s)');
ylabel('max[updraft circ-equiv radius] (km)');




subplot(2,2,4)
hold on
for RR = 1:ar
    AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,RR),[],2,'omitnan');
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = widLFCARdeep_eastupslopedepthfract_ALLCASES(:,:,RR);   BB(BB==0)= NaN;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r'); hold on
        ccr1 = corrcoef(BB,AA); ccr1 = ccr1(2);
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(0,100,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b'); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(0,100,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(0,100,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(0,100,30);
        yFit4 = polyval(linCo4,xFit4);


    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end

AA = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = widLFCARdeep_eastupslopedepthfract_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

ccrall = corrcoef(BB,AA); ccrall = ccrall(2);
linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(0,100,30);
yFit = polyval(linCo,xFit);
plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit,yFit,'k')
legend( num2str(ccr1),num2str(ccr2),num2str(ccr3),num2str(ccr4) , 'FontSize', 14);

axis([0.2 1.05 0.2 3])
title(['Combined popul corcoeff = ', num2str(ccrall) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('eastside upslope depth (fraction pts below SDC top)');
ylabel('max[updraft circ-equiv radius] (km)');


%}






















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%  existing cell centric analyses that mostly check out with new format
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% plots of w swath properties per day
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% %mean W along SDC at each time
% 
% ff = figure; 
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% hold on
% 
% % sdcmean_mesoWdepth = mean( FullSDC_mesoWdepth_ALLCASES,1,'omitnan' )  ;     sdcmean_mesoWdepth = permute(sdcmean_mesoWdepth,[2 3 1]);
% % timemean_mesoWdepth = mean( FullSDC_mesoWdepth_ALLCASES,2,'omitnan' )  ;   timemean_mesoWdepth = permute(timemean_mesoWdepth,[1 3 2]);
% 
% for r = 1:ar
%     plot(  FullSDC_mesoWdepth_ALLCASES(:,25,r)  )   %  14UTC = t13;   15UTC = t25
%     hold on
% end
% legend(RUNS)


%mean W along  part of SDC at each time

% latN_allcases = [-31.4, -31.5, -31.8, -31.8];  %lat spans per case
% latS_allcases = [-32.8, -32.3, -32.8, -32.8];

ff = figure; 
ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
hold on

sdcmean_mesoWstrength       = mean( FullSDC_mesoWstrength_ALLCASES,1,'omitnan' )  ;     sdcmean_mesoWstrength = permute(sdcmean_mesoWstrength,[2 3 1]);
sdcmean_mesoWwidth          = mean( FullSDC_mesoWwidth_ALLCASES,1,'omitnan' )  ;        sdcmean_mesoWwidth = permute(sdcmean_mesoWwidth,[2 3 1]);
sdcmean_mesoWvmf            = mean( FullSDC_VMfluxSum_ALLCASES,1,'omitnan' )  ;         sdcmean_mesoWvmf = permute(sdcmean_mesoWvmf,[2 3 1]);
sdcmean_mesoWdepthlfcrat    = mean( ((1000*FullSDC_swathtopasl_ALLCASES)./FullSDC_swathtoplfcasl_ALLCASES),1,'omitnan' )  ;     sdcmean_mesoWdepthlfcrat = permute(sdcmean_mesoWdepthlfcrat,[2 3 1]);
sdcmean_mesoWlfc            = mean( (FullSDC_swathtoplfcagl_ALLCASES),1,'omitnan' )  ;     sdcmean_mesoWlfc = permute(sdcmean_mesoWlfc,[2 3 1]);

sdcmean_mesoCMFCmax                   = mean( FullSDC_mesoCMFCmax_ALLCASES,1,'omitnan' )  ;            sdcmean_mesoCMFCmax = permute(sdcmean_mesoCMFCmax,[2 3 1]);
sdcmean_mesoCMCqconvmax               = mean( FullSDC_mesoCMCqconvmax_ALLCASES,1,'omitnan' )  ;        sdcmean_mesoCMCqconvmax = permute(sdcmean_mesoCMCqconvmax,[2 3 1]);
sdcmean_mesoCMCqadvmax                = mean( FullSDC_mesoCMCqadvmax_ALLCASES,1,'omitnan' )  ;         sdcmean_mesoCMCqadvmax = permute(sdcmean_mesoCMCqadvmax,[2 3 1]);
sdcmean_mesoCMFCmean                  = mean( FullSDC_mesoCMFCmean_ALLCASES,1,'omitnan' )  ;           sdcmean_mesoCMFCmean = permute(sdcmean_mesoCMFCmean,[2 3 1]);
sdcmean_mesoCMCqconvmean              = mean( FullSDC_mesoCMCqconvmean_ALLCASES,1,'omitnan' )  ;       sdcmean_mesoCMCqconvmean = permute(sdcmean_mesoCMCqconvmean,[2 3 1]);
sdcmean_mesoCMCqadvmean               = mean( FullSDC_mesoCMCqadvmean_ALLCASES,1,'omitnan' )  ;        sdcmean_mesoCMCqadvmean = permute(sdcmean_mesoCMCqadvmean,[2 3 1]);
sdcmean_mesoCstrength                 = mean( FullSDC_mesoCstrength_ALLCASES,1,'omitnan' )  ;          sdcmean_mesoCstrength = permute(sdcmean_mesoCstrength,[2 3 1]);
sdcmean_mesoCwidth                    = mean( FullSDC_mesoCwidth_ALLCASES,1,'omitnan' )  ;             sdcmean_mesoCwidth = permute(sdcmean_mesoCwidth,[2 3 1]);



%sdcmean_swathcape       = mean( FullSDC_swathmucape_ALLCASES,1,'omitnan' )  ;       sdcmean_swathcape = permute(sdcmean_swathcape,[2 3 1]);
% sdcmean_swathcin        = mean( FullSDC_swathmucin_ALLCASES,1,'omitnan' )  ;               sdcmean_swathcin = permute(sdcmean_swathcin,[2 3 1]);
%     rhzmean =  mean( FullSDC_swathboxaloftRH_ALLCASES,2,'omitnan' )  ;              rhzmean = permute( rhzmean ,[1 3 4 2]);
%sdcmean_RHbox           = mean( rhzmean,1,'omitnan' )  ;   sdcmean_RHbox = permute(sdcmean_RHbox,[2 3 1]);

%old and incorrect/convoluted/overly-complicated way:
% sdcsum_instwcount       = sum(wIDLFCARnum_best_alongsdc,1,'omitnan');               sdcsum_instwcount = permute(sdcsum_instwcount,[2 3 1]);
% sdcsum_instwcount(sdcsum_instwcount==0) = NaN;
% sdcmedian_instwsize       = median(wIDLFCARarea_best_alongsdc,1,'omitnan');          sdcmedian_instwsize = permute(sdcmedian_instwsize,[2 3 1]);
% %sdcmedian_instwsize       = max(wIDLFCARarea_best_alongsdc,[],1,'omitnan');          sdcmedian_instwsize = permute(sdcmedian_instwsize,[2 3 1]);
% sdcmedian_instwsize  = (   sdcmedian_instwsize/3.14159    ).^0.5;

r1renan = sdcmean_mesoWstrength(:,1); r1renan(isnan(r1renan)==0) = 1;
r2renan = sdcmean_mesoWstrength(:,2); r2renan(isnan(r2renan)==0) = 1;
r3renan = sdcmean_mesoWstrength(:,3); r3renan(isnan(r3renan)==0) = 1;
r4renan = sdcmean_mesoWstrength(:,4); r4renan(isnan(r4renan)==0) = 1;
r5renan = sdcmean_mesoWstrength(:,5); r5renan(isnan(r5renan)==0) = 1;
r6renan = sdcmean_mesoWstrength(:,6); r6renan(isnan(r6renan)==0) = 1;
r7renan = sdcmean_mesoWstrength(:,7); r7renan(isnan(r7renan)==0) = 1;

%easier and more straight forward way:
widLFCAR_maxarea =  permute(   max( widLFCAR_profs_area_ALLCASES,[],2,'omitnan')  , [1 3 4 2]  ); 
tbak = 4;
dist = dist_wid_and_swath_ALLCASES(:,:,tbak,:);
dist = permute(dist,[1 2 4 3]);
kill = find(  abs( dist )  >  distswathwid_thresh  );
widLFCAR_maxarea(kill)           = NaN;
%median near-lfc updraft radius at each time and R
sdcmean_instwsize       = mean(widLFCAR_maxarea,1,'omitnan');          sdcmean_instwsize = permute(sdcmean_instwsize,[2 3 1]);
sdcmean_instwsize  = (   sdcmean_instwsize/3.14159    ).^0.5;
for R = 1:wr
    %zero the no updraft nans
    zer = find(  isnan( sdcmean_instwsize(1:maxtime_ALLCASES(R),R) )  )  ;
    sdcmean_instwsize(zer,R) = 0 ;
end

sdcsum_instwcount  = zeros(wt,wr); sdcsum_instwcount(:) = NaN;
for R = 1:wr
    for t = 1:wt
        % R = 3; t = 25;

        sdcsum_instwcount(t,R) = length(find(   isnan(  widLFCAR_maxarea(:,t,R) ) == 0  ));

    end
sdcsum_instwcount(maxtime_ALLCASES(R)+1:end,R)=NaN;  %kill the time tails
end


%{ 

J29_max_area = widLFCAR_maxarea(:,20,6);

%}



% percent changes during day along full SDC:
DT = 12;  %12 time steps = 1hr
%tmean = [13, 31, 25, 13 ];  %array of ~ CI - 1 hr
tmean = [13, 16 , 31 , 2 , 25 , 13 , 25 ]; % roughly 1 hr prior to most of CI:  (t13 = 1400z, t25 = 1500z, t31 = 1530z, )  %
tstart = tmean - 6;  %when to start the calc  (-6  ~=  CI-1.5hr)
tstart(find(tstart <1))=1;
tend = tmean + 12;  % ~ CI-0hr time




%make cell property-space mask to filter cell count in only area of interest (filter not linked to swath measurements):
[tn nn yy] = size(maxdbz_fullcellrecord_ALLCASES) ;
maskMINDUR =  zeros(nn,yy) ;     maskMINDUR(:) = NaN;
maskLOC    =  zeros(nn,yy) ;     maskLOC(:) = NaN;
maskSTATUS =  zeros(nn,yy) ;     maskSTATUS(:) = NaN;
for n = 1:nn
    for y = 1:yy
        %minimum cell dur requirement
        if(   cellfull_duration_UNFILT_ALLCASES(n,y) >= 4      )   
            maskMINDUR(n,y) = 1;
        end
        % cell location requirement
        if(   cellCI_meanlon_ALLCASES(n,y) < -64.7   &   cellCI_meanlon_ALLCASES(n,y) > -64.975  &  ...
              cellCI_meanlat_ALLCASES(n,y) > -32.5   &   cellCI_meanlat_ALLCASES(n,y) < -31.6   )   
            maskLOC(n,y) = 1;
        end
        % cell status requirements (merge/split)
        if(   isnan(cellfull_endmergestatus_ALLCASES(n,y))  &  cellfull_duration_UNFILT_ALLCASES(n,y) >= 7     )   
            maskSTATUS(n,y) = 1;
        end
        if(  maskSTATUS(n,y)==1  &  isnan(cellfull_startsplitstatus_ALLCASES(n,y))    )   
            maskSTATUS(n,y) = 1;
        end

    end
end
fullmaskcell = maskMINDUR .* maskLOC .* maskSTATUS ;
fullmaskcell3d = zeros(tn, nn, yy); fullmaskcell3d(:) = NaN;
for tnt = 1:tn
    fullmaskcell3d(tnt,:,:) = fullmaskcell;
end

%%%% count number of 'deep' or 'strong' cells along SDC:
strongcells = maxdbz_fullcellrecord_ALLCASES .*  fullmaskcell3d;  
deepcells   = eth10_fullcellrecord_ALLCASES  .*  fullmaskcell3d;

%note, this assumes that all days start at 13 UTC and go dt = 5 min. If you
%start later for some days, you need to modify this!!!
LASSOhhmmZ = [1300:5:1355,1400:5:1455,1500:5:1555,1600:5:1655,1700:5:1755,1800:5:1855,1900:5:1955]; 

preCI_killtime      = tmean;      preCI_killtime(:) = NaN;
postCIp2hr_killtime = tmean;      postCIp2hr_killtime(:) = NaN;

% isolate cells within a time window between ~1stCI and ~1stCI + 3  hr
for rr = 1:ar
    preCI_killtime(rr)      = LASSOhhmmZ( tend(rr) - 1 );
    postCIp2hr_killtime(rr) = LASSOhhmmZ( tend(rr) + 36 );  % 12 indices ~ 1 hr.
end
%cell space times
hhmmofday_fullcellrecord_ALLCASES   =   datetime(basetime_fullcellrecord_ALLCASES, 'convertfrom','posixtime','Format','HHmm') ;
%tedious crap to convert date to number. probably can do this more efficiently, but i just dont care:
[qw qe qr] = size(hhmmofday_fullcellrecord_ALLCASES);
hhmmofday = zeros(qw, qe, qr);    hhmmofday(:) = NaN;
parfor rr = 1:qr
    for j = 1:qe
        for i = 1:qw
            if(      isempty(  find( str2num( string(hhmmofday_fullcellrecord_ALLCASES(i,j,rr)) ) >=0  )   ) == 0               )
                hhmmofday(i,j,rr) =   str2num( string(hhmmofday_fullcellrecord_ALLCASES(i,j,rr)) ) ;
            end
        end
    end
end

% hblah = hhmmofday(:,:,1);
% preCI_killtime(1)
% postCIp2hr_killtime(1)
% sblah = strongcells(:,:,1); 

%time window filter application on cell: ht and strength - note: depth/strength filters not yet applied 
for rr = 1:ar
    for i = 1:qw
        for j = 1:qe
            if(   hhmmofday(i,j,rr) < preCI_killtime(rr)  |  hhmmofday(i,j,rr) > postCIp2hr_killtime(rr))
                strongcells(i,j,rr) = NaN;
                deepcells(i,j,rr) = NaN;
            end
        end
    end
end
sblah2 = strongcells(:,:,1); 

% Cell count values for article table: "Num cells ETH10> 6 km, Max dBZ > 45, [all cells
% regardless of depth/str]; nearsdc, nosplit/merge, dur>15min"  (number
% that IS in brackets - all cells even though it's called 'strongecells' in this loop (depth/str filters not yet aplied) )
for y = 1:ar
    disp([ 'run ' , num2str(y)])
    num_allcells_in_twindow   =   length( find(  isnan(min( strongcells(:,:,y) )  )==0    ) )
end

%now apply min depth/str filter:
kills = find( strongcells < 40.0);
strongcells(kills) = NaN;    deepcells(kills) = NaN;
killd = find( deepcells < 6.0);              
strongcells(killd) = NaN;    deepcells(killd) = NaN;

% values for article table: "Num cells ETH10> 6 km, Max dBZ > 45, [all cells
% regardless of depth/str]; nearsdc, nosplit/merge, dur>15min"  (number
% that's not in brackets)
for y = 1:ar
    disp([ 'run ' , num2str(y)])
    num_strongdeepcells_in_twindow   =   length( find(  isnan(min( strongcells(:,:,y) )  )==0    ) )
    %num_strongcells_in_twindow   =   length( find(  isnan(min( strongcells(:,:,y) )  )==0    ) )
end







disp('   ')
disp(' 29 Nov ')
tm = 1;
% percent changes pre/across CI period
swathSTR    = 100 .*( ( sdcmean_mesoWstrength(tend(tm),tm)  -  sdcmean_mesoWstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoWstrength(tend(tm),tm),  sdcmean_mesoWstrength(tstart(tm),tm) ] ) )
swathWIDTH  = 100 .*( ( sdcmean_mesoWwidth(tend(tm),tm)     -  sdcmean_mesoWwidth(tstart(tm),tm) )    ./  mean( [ sdcmean_mesoWwidth(tend(tm),tm),  sdcmean_mesoWwidth(tstart(tm),tm) ] ) )
swathVMF    = 100 .*( ( sdcmean_mesoWvmf(tend(tm),tm)       -  sdcmean_mesoWvmf(tstart(tm),tm) )      ./  mean( [ sdcmean_mesoWvmf(tend(tm),tm),  sdcmean_mesoWvmf(tstart(tm),tm) ] ) )
widAREA     = 100 .*( ( sdcmean_instwsize(tend(tm),tm)    -  sdcmean_instwsize(tstart(tm),tm) )   ./  mean( [ sdcmean_instwsize(tend(tm),tm),  sdcmean_instwsize(tstart(tm),tm) ] ) )
widCNT      = 100 .*( ( sdcsum_instwcount(tend(tm),tm)      -  sdcsum_instwcount(tstart(tm),tm)  )    ./  mean( [ sdcsum_instwcount(tend(tm),tm),  sdcsum_instwcount(tstart(tm),tm) ] ) )    
CswathSTR    = 100 .*( ( sdcmean_mesoCstrength(tend(tm),tm)  -  sdcmean_mesoCstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCstrength(tend(tm),tm),  sdcmean_mesoCstrength(tstart(tm),tm) ] ) )
CswathWIDTH  = 100 .*( ( sdcmean_mesoCwidth(tend(tm),tm)  -  sdcmean_mesoCwidth(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCwidth(tend(tm),tm),  sdcmean_mesoCwidth(tstart(tm),tm) ] ) )
CswathMFCmax = 100 .*( ( sdcmean_mesoCMFCmax(tend(tm),tm)  -  sdcmean_mesoCMFCmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMFCmax(tend(tm),tm),  sdcmean_mesoCMFCmax(tstart(tm),tm) ] ) )
CswathMFCqadvmax = 100 .*( ( sdcmean_mesoCMCqadvmax(tend(tm),tm)  -  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqadvmax(tend(tm),tm),  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ] ) )
CswathMFCqconvmax = 100 .*( ( sdcmean_mesoCMCqconvmax(tend(tm),tm)  -  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqconvmax(tend(tm),tm),  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ] ) )



% values for article table: medians between CI - CI-1hr
MEDswathSTR    = median( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEDswathWIDTH  = median( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidAREA     = median( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidCNT      = median( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )

MEANswathSTR    = mean( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEANswathWIDTH  = mean( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidAREA     = mean( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidCNT      = mean( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )





disp('   ')
disp(' 4 Dec ')
tm = 2;
% percent changes pre/across CI period
swathSTR    = 100 .*( ( sdcmean_mesoWstrength(tend(tm),tm)  -  sdcmean_mesoWstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoWstrength(tend(tm),tm),  sdcmean_mesoWstrength(tstart(tm),tm) ] ) )
swathWIDTH  = 100 .*( ( sdcmean_mesoWwidth(tend(tm),tm)     -  sdcmean_mesoWwidth(tstart(tm),tm) )    ./  mean( [ sdcmean_mesoWwidth(tend(tm),tm),  sdcmean_mesoWwidth(tstart(tm),tm) ] ) )
swathVMF    = 100 .*( ( sdcmean_mesoWvmf(tend(tm),tm)       -  sdcmean_mesoWvmf(tstart(tm),tm) )      ./  mean( [ sdcmean_mesoWvmf(tend(tm),tm),  sdcmean_mesoWvmf(tstart(tm),tm) ] ) )
widAREA     = 100 .*( ( sdcmean_instwsize(tend(tm),tm)    -  sdcmean_instwsize(tstart(tm),tm) )   ./  mean( [ sdcmean_instwsize(tend(tm),tm),  sdcmean_instwsize(tstart(tm),tm) ] ) )
widCNT      = 100 .*( ( sdcsum_instwcount(tend(tm),tm)      -  sdcsum_instwcount(tstart(tm),tm)  )    ./  mean( [ sdcsum_instwcount(tend(tm),tm),  sdcsum_instwcount(tstart(tm),tm) ] ) )    
CswathSTR    = 100 .*( ( sdcmean_mesoCstrength(tend(tm),tm)  -  sdcmean_mesoCstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCstrength(tend(tm),tm),  sdcmean_mesoCstrength(tstart(tm),tm) ] ) )
CswathWIDTH  = 100 .*( ( sdcmean_mesoCwidth(tend(tm),tm)  -  sdcmean_mesoCwidth(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCwidth(tend(tm),tm),  sdcmean_mesoCwidth(tstart(tm),tm) ] ) )
CswathMFCmax = 100 .*( ( sdcmean_mesoCMFCmax(tend(tm),tm)  -  sdcmean_mesoCMFCmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMFCmax(tend(tm),tm),  sdcmean_mesoCMFCmax(tstart(tm),tm) ] ) )
CswathMFCqadvmax = 100 .*( ( sdcmean_mesoCMCqadvmax(tend(tm),tm)  -  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqadvmax(tend(tm),tm),  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ] ) )
CswathMFCqconvmax = 100 .*( ( sdcmean_mesoCMCqconvmax(tend(tm),tm)  -  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqconvmax(tend(tm),tm),  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ] ) )
 

% values for article table: medians between CI - CI-1hr
MEDswathSTR    = median( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEDswathWIDTH  = median( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidAREA     = median( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidCNT      = median( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )

MEANswathSTR    = mean( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEANswathWIDTH  = mean( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidAREA     = mean( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidCNT      = mean( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )




disp('   ')
disp(' 22 Jan ')
tm = 3;
swathSTR    = 100 .*( ( sdcmean_mesoWstrength(tend(tm),tm)  -  sdcmean_mesoWstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoWstrength(tend(tm),tm),  sdcmean_mesoWstrength(tstart(tm),tm) ] ) )
swathWIDTH  = 100 .*( ( sdcmean_mesoWwidth(tend(tm),tm)     -  sdcmean_mesoWwidth(tstart(tm),tm) )    ./  mean( [ sdcmean_mesoWwidth(tend(tm),tm),  sdcmean_mesoWwidth(tstart(tm),tm) ] ) )
swathVMF    = 100 .*( ( sdcmean_mesoWvmf(tend(tm),tm)       -  sdcmean_mesoWvmf(tstart(tm),tm) )      ./  mean( [ sdcmean_mesoWvmf(tend(tm),tm),  sdcmean_mesoWvmf(tstart(tm),tm) ] ) )
widAREA     = 100 .*( ( sdcmean_instwsize(tend(tm),tm)    -  sdcmean_instwsize(tstart(tm),tm) )   ./  mean( [ sdcmean_instwsize(tend(tm),tm),  sdcmean_instwsize(tstart(tm),tm) ] ) )
widCNT      = 100 .*( ( sdcsum_instwcount(tend(tm),tm)      -  sdcsum_instwcount(tstart(tm),tm)  )    ./  mean( [ sdcsum_instwcount(tend(tm),tm),  sdcsum_instwcount(tstart(tm),tm) ] ) )    
CswathSTR    = 100 .*( ( sdcmean_mesoCstrength(tend(tm),tm)  -  sdcmean_mesoCstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCstrength(tend(tm),tm),  sdcmean_mesoCstrength(tstart(tm),tm) ] ) )
CswathWIDTH  = 100 .*( ( sdcmean_mesoCwidth(tend(tm),tm)  -  sdcmean_mesoCwidth(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCwidth(tend(tm),tm),  sdcmean_mesoCwidth(tstart(tm),tm) ] ) )
CswathMFCmax = 100 .*( ( sdcmean_mesoCMFCmax(tend(tm),tm)  -  sdcmean_mesoCMFCmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMFCmax(tend(tm),tm),  sdcmean_mesoCMFCmax(tstart(tm),tm) ] ) )
CswathMFCqadvmax = 100 .*( ( sdcmean_mesoCMCqadvmax(tend(tm),tm)  -  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqadvmax(tend(tm),tm),  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ] ) )
CswathMFCqconvmax = 100 .*( ( sdcmean_mesoCMCqconvmax(tend(tm),tm)  -  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqconvmax(tend(tm),tm),  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ] ) )
 
% values for article table: medians between CI - CI-1hr
MEDswathSTR    = median( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEDswathWIDTH  = median( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidAREA     = median( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidCNT      = median( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )

MEANswathSTR    = mean( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEANswathWIDTH  = mean( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidAREA     = mean( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidCNT      = mean( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )




disp('   ')
disp(' 23 Jan ')
tm = 4;
swathSTR    = 100 .*( ( sdcmean_mesoWstrength(tend(tm),tm)  -  sdcmean_mesoWstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoWstrength(tend(tm),tm),  sdcmean_mesoWstrength(tstart(tm),tm) ] ) )
swathWIDTH  = 100 .*( ( sdcmean_mesoWwidth(tend(tm),tm)     -  sdcmean_mesoWwidth(tstart(tm),tm) )    ./  mean( [ sdcmean_mesoWwidth(tend(tm),tm),  sdcmean_mesoWwidth(tstart(tm),tm) ] ) )
swathVMF    = 100 .*( ( sdcmean_mesoWvmf(tend(tm),tm)       -  sdcmean_mesoWvmf(tstart(tm),tm) )      ./  mean( [ sdcmean_mesoWvmf(tend(tm),tm),  sdcmean_mesoWvmf(tstart(tm),tm) ] ) )
widAREA     = 100 .*( ( sdcmean_instwsize(tend(tm),tm)    -  sdcmean_instwsize(tstart(tm),tm) )   ./  mean( [ sdcmean_instwsize(tend(tm),tm),  sdcmean_instwsize(tstart(tm),tm) ] ) )
widCNT      = 100 .*( ( sdcsum_instwcount(tend(tm),tm)      -  sdcsum_instwcount(tstart(tm),tm)  )    ./  mean( [ sdcsum_instwcount(tend(tm),tm),  sdcsum_instwcount(tstart(tm),tm) ] ) )    
CswathSTR    = 100 .*( ( sdcmean_mesoCstrength(tend(tm),tm)  -  sdcmean_mesoCstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCstrength(tend(tm),tm),  sdcmean_mesoCstrength(tstart(tm),tm) ] ) )
CswathWIDTH  = 100 .*( ( sdcmean_mesoCwidth(tend(tm),tm)  -  sdcmean_mesoCwidth(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCwidth(tend(tm),tm),  sdcmean_mesoCwidth(tstart(tm),tm) ] ) )
CswathMFCmax = 100 .*( ( sdcmean_mesoCMFCmax(tend(tm),tm)  -  sdcmean_mesoCMFCmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMFCmax(tend(tm),tm),  sdcmean_mesoCMFCmax(tstart(tm),tm) ] ) )
CswathMFCqadvmax = 100 .*( ( sdcmean_mesoCMCqadvmax(tend(tm),tm)  -  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqadvmax(tend(tm),tm),  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ] ) )
CswathMFCqconvmax = 100 .*( ( sdcmean_mesoCMCqconvmax(tend(tm),tm)  -  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqconvmax(tend(tm),tm),  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ] ) )
 
% values for article table: medians between CI - CI-1hr
MEDswathSTR    = median( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEDswathWIDTH  = median( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidAREA     = median( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidCNT      = median( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )

MEANswathSTR    = mean( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEANswathWIDTH  = mean( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidAREA     = mean( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidCNT      = mean( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )




disp('   ')
disp(' 25 Jan ')
tm = 5;
swathSTR    = 100 .*( ( sdcmean_mesoWstrength(tend(tm),tm)  -  sdcmean_mesoWstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoWstrength(tend(tm),tm),  sdcmean_mesoWstrength(tstart(tm),tm) ] ) )
swathWIDTH  = 100 .*( ( sdcmean_mesoWwidth(tend(tm),tm)     -  sdcmean_mesoWwidth(tstart(tm),tm) )    ./  mean( [ sdcmean_mesoWwidth(tend(tm),tm),  sdcmean_mesoWwidth(tstart(tm),tm) ] ) )
swathVMF    = 100 .*( ( sdcmean_mesoWvmf(tend(tm),tm)       -  sdcmean_mesoWvmf(tstart(tm),tm) )      ./  mean( [ sdcmean_mesoWvmf(tend(tm),tm),  sdcmean_mesoWvmf(tstart(tm),tm) ] ) )
widAREA     = 100 .*( ( sdcmean_instwsize(tend(tm),tm)    -  sdcmean_instwsize(tstart(tm),tm) )   ./  mean( [ sdcmean_instwsize(tend(tm),tm),  sdcmean_instwsize(tstart(tm),tm) ] ) )
widCNT      = 100 .*( ( sdcsum_instwcount(tend(tm),tm)      -  sdcsum_instwcount(tstart(tm),tm)  )    ./  mean( [ sdcsum_instwcount(tend(tm),tm),  sdcsum_instwcount(tstart(tm),tm) ] ) )    
CswathSTR    = 100 .*( ( sdcmean_mesoCstrength(tend(tm),tm)  -  sdcmean_mesoCstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCstrength(tend(tm),tm),  sdcmean_mesoCstrength(tstart(tm),tm) ] ) )
CswathWIDTH  = 100 .*( ( sdcmean_mesoCwidth(tend(tm),tm)  -  sdcmean_mesoCwidth(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCwidth(tend(tm),tm),  sdcmean_mesoCwidth(tstart(tm),tm) ] ) )
CswathMFCmax = 100 .*( ( sdcmean_mesoCMFCmax(tend(tm),tm)  -  sdcmean_mesoCMFCmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMFCmax(tend(tm),tm),  sdcmean_mesoCMFCmax(tstart(tm),tm) ] ) )
CswathMFCqadvmax = 100 .*( ( sdcmean_mesoCMCqadvmax(tend(tm),tm)  -  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqadvmax(tend(tm),tm),  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ] ) )
CswathMFCqconvmax = 100 .*( ( sdcmean_mesoCMCqconvmax(tend(tm),tm)  -  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqconvmax(tend(tm),tm),  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ] ) )
 
% values for article table: medians between CI - CI-1hr
MEDswathSTR    = median( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEDswathWIDTH  = median( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidAREA     = median( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidCNT      = median( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )

MEANswathSTR    = mean( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEANswathWIDTH  = mean( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidAREA     = mean( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidCNT      = mean( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )



disp('   ')
disp(' 29 Jan ')
tm = 6;
swathSTR    = 100 .*( ( sdcmean_mesoWstrength(tend(tm),tm)  -  sdcmean_mesoWstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoWstrength(tend(tm),tm),  sdcmean_mesoWstrength(tstart(tm),tm) ] ) )
swathWIDTH  = 100 .*( ( sdcmean_mesoWwidth(tend(tm),tm)     -  sdcmean_mesoWwidth(tstart(tm),tm) )    ./  mean( [ sdcmean_mesoWwidth(tend(tm),tm),  sdcmean_mesoWwidth(tstart(tm),tm) ] ) )
swathVMF    = 100 .*( ( sdcmean_mesoWvmf(tend(tm),tm)       -  sdcmean_mesoWvmf(tstart(tm),tm) )      ./  mean( [ sdcmean_mesoWvmf(tend(tm),tm),  sdcmean_mesoWvmf(tstart(tm),tm) ] ) )
widAREA     = 100 .*( ( sdcmean_instwsize(tend(tm),tm)    -  sdcmean_instwsize(tstart(tm),tm) )   ./  mean( [ sdcmean_instwsize(tend(tm),tm),  sdcmean_instwsize(tstart(tm),tm) ] ) )
widCNT      = 100 .*( ( sdcsum_instwcount(tend(tm),tm)      -  sdcsum_instwcount(tstart(tm),tm)  )    ./  mean( [ sdcsum_instwcount(tend(tm),tm),  sdcsum_instwcount(tstart(tm),tm) ] ) )    
CswathSTR    = 100 .*( ( sdcmean_mesoCstrength(tend(tm),tm)  -  sdcmean_mesoCstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCstrength(tend(tm),tm),  sdcmean_mesoCstrength(tstart(tm),tm) ] ) )
CswathWIDTH  = 100 .*( ( sdcmean_mesoCwidth(tend(tm),tm)  -  sdcmean_mesoCwidth(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCwidth(tend(tm),tm),  sdcmean_mesoCwidth(tstart(tm),tm) ] ) )
CswathMFCmax = 100 .*( ( sdcmean_mesoCMFCmax(tend(tm),tm)  -  sdcmean_mesoCMFCmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMFCmax(tend(tm),tm),  sdcmean_mesoCMFCmax(tstart(tm),tm) ] ) )
CswathMFCqadvmax = 100 .*( ( sdcmean_mesoCMCqadvmax(tend(tm),tm)  -  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqadvmax(tend(tm),tm),  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ] ) )
CswathMFCqconvmax = 100 .*( ( sdcmean_mesoCMCqconvmax(tend(tm),tm)  -  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqconvmax(tend(tm),tm),  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ] ) )
 
% values for article table: medians between CI - CI-1hr
MEDswathSTR    = median( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEDswathWIDTH  = median( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidAREA     = median( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidCNT      = median( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )

MEANswathSTR    = mean( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEANswathWIDTH  = mean( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidAREA     = mean( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidCNT      = mean( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )


disp('   ')
disp(' 08 Feb')
tm = 7;
swathSTR    = 100 .*( ( sdcmean_mesoWstrength(tend(tm),tm)  -  sdcmean_mesoWstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoWstrength(tend(tm),tm),  sdcmean_mesoWstrength(tstart(tm),tm) ] ) )
swathWIDTH  = 100 .*( ( sdcmean_mesoWwidth(tend(tm),tm)     -  sdcmean_mesoWwidth(tstart(tm),tm) )    ./  mean( [ sdcmean_mesoWwidth(tend(tm),tm),  sdcmean_mesoWwidth(tstart(tm),tm) ] ) )
swathVMF    = 100 .*( ( sdcmean_mesoWvmf(tend(tm),tm)       -  sdcmean_mesoWvmf(tstart(tm),tm) )      ./  mean( [ sdcmean_mesoWvmf(tend(tm),tm),  sdcmean_mesoWvmf(tstart(tm),tm) ] ) )
widAREA     = 100 .*( ( sdcmean_instwsize(tend(tm),tm)    -  sdcmean_instwsize(tstart(tm),tm) )   ./  mean( [ sdcmean_instwsize(tend(tm),tm),  sdcmean_instwsize(tstart(tm),tm) ] ) )
widCNT      = 100 .*( ( sdcsum_instwcount(tend(tm),tm)      -  sdcsum_instwcount(tstart(tm),tm)  )    ./  mean( [ sdcsum_instwcount(tend(tm),tm),  sdcsum_instwcount(tstart(tm),tm) ] ) )    
CswathSTR    = 100 .*( ( sdcmean_mesoCstrength(tend(tm),tm)  -  sdcmean_mesoCstrength(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCstrength(tend(tm),tm),  sdcmean_mesoCstrength(tstart(tm),tm) ] ) )
CswathWIDTH  = 100 .*( ( sdcmean_mesoCwidth(tend(tm),tm)  -  sdcmean_mesoCwidth(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCwidth(tend(tm),tm),  sdcmean_mesoCwidth(tstart(tm),tm) ] ) )
CswathMFCmax = 100 .*( ( sdcmean_mesoCMFCmax(tend(tm),tm)  -  sdcmean_mesoCMFCmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMFCmax(tend(tm),tm),  sdcmean_mesoCMFCmax(tstart(tm),tm) ] ) )
CswathMFCqadvmax = 100 .*( ( sdcmean_mesoCMCqadvmax(tend(tm),tm)  -  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqadvmax(tend(tm),tm),  sdcmean_mesoCMCqadvmax(tstart(tm),tm) ] ) )
CswathMFCqconvmax = 100 .*( ( sdcmean_mesoCMCqconvmax(tend(tm),tm)  -  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ) ./  mean( [ sdcmean_mesoCMCqconvmax(tend(tm),tm),  sdcmean_mesoCMCqconvmax(tstart(tm),tm) ] ) )
 
% values for article table: medians between CI - CI-1hr
MEDswathSTR    = median( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEDswathWIDTH  = median( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidAREA     = median( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEDwidCNT      = median( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )

MEANswathSTR    = mean( sdcmean_mesoWstrength(tmean(tm):tend(tm),tm),'omitnan'  )
MEANswathWIDTH  = mean( sdcmean_mesoWwidth(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidAREA     = mean( sdcmean_instwsize(tmean(tm):tend(tm),tm),'omitnan'  )
MEANwidCNT      = mean( sdcsum_instwcount(tmean(tm):tend(tm),tm),'omitnan'  )

hourlabel = [13 : 5/60 : 19+(10/60)];










%%%%%%%%%%%%%%%
%%%%% alternate to U,V vs swath str heatmap plots: 
%%%%%%%%%%%%%%%

% FullSDC_TFCbox_westupslopedepth_ALLCASES
% FullSDC_TFCbox_eastupslopedepth_ALLCASES
% FullSDC_TFCbox_eastupslopemean_ALLCASES
% FullSDC_TFCbox_westupslopemean_ALLCASES
% FullSDC_mesoWstrength_ALLCASES
% FullSDC_mesoWwidth_ALLCASES
% FullSDC_swathtoplfcasl_ALLCASES./FullSDC_swathmulfcasl_ALLCASES



%wind metrics
Emean  = mean(FullSDC_TFCbox_eastupslopemean_ALLCASES,1,'omitnan') ;    Emean = permute(Emean,[2 3 1]);
Wmean  = mean(FullSDC_TFCbox_westupslopemean_ALLCASES,1,'omitnan') ;    Wmean = permute(Wmean,[2 3 1]);
Edepth = mean(FullSDC_TFCbox_eastupslopedepth_ALLCASES,1,'omitnan') ;   Edepth = permute(Edepth,[2 3 1]);
Wdepth = mean(FullSDC_TFCbox_westupslopedepth_ALLCASES,1,'omitnan') ;   Wdepth = permute(Wdepth,[2 3 1]);
% could be downward transport of westerly momentum Aloft clashing about east
% upslope, so also look at flow more aloft. I only have an east side 3-4,
% 4-5, but in principle, i wouldnt think flow aloft to be dramatically
% different on west side. maybe make a west side one if you feel it
% necessary in the future. 
Amean = mean(FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES,1,'omitnan');   Amean = permute(Amean,[2 3 1]);
%Amean = mean(FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES,1,'omitnan');   Amean = permute(Amean,[2 3 1]);

%note, these above have too many times. need to chop down to first 75. 
Emean(76:end,:) = [];
Wmean(76:end,:) = []; 
Edepth(76:end,:) = []; 
Wdepth(76:end,:) = []; 
Amean(76:end,:) = []; 

%swath metrics
Magmean = mean( FullSDC_mesoWstrength_ALLCASES,1,'omitnan');  Magmean = permute(Magmean,[2 3 1]);
Widmean = mean( FullSDC_mesoWwidth_ALLCASES,1,'omitnan');     Widmean = permute(Widmean,[2 3 1]);
Topratmean = mean( FullSDC_swathtopasl_ALLCASES ./ (FullSDC_swathtoplfcasl_ALLCASES/1000), 1,'omitnan');   Topratmean = permute(Topratmean,[2 3 1]);
LFCmean = mean( (FullSDC_swathtoplfcasl_ALLCASES/1000), 1,'omitnan');   LFCmean = permute(LFCmean,[2 3 1]);

%time lag the incoming wind from the swath by minus toffset
toffset = 12;  %6;  % 6 = 30min
Amean_os = Amean;  Amean_os(end-(toffset-1):end,:) = []; 
Emean_os = Emean;  Emean_os(end-(toffset-1):end,:) = []; 
Wmean_os = Wmean;  Wmean_os(end-(toffset-1):end,:) = [];
Edepth_os = Emean;  Edepth_os(end-(toffset-1):end,:) = []; 
Wdepth_os = Wmean;  Wdepth_os(end-(toffset-1):end,:) = [];
Magmean_os = Magmean;    Magmean_os(1:toffset,:) = [];
Widmean_os = Widmean;    Widmean_os(1:toffset,:) = [];
Topratmean_os = Topratmean;  Topratmean_os(1:toffset,:) = [];
LFCmean_os = LFCmean;  LFCmean_os(1:toffset,:) = [];




figure('position',[60,564,1319,349]);

subplot(1,3,1)
hold on
for RR = 1:ar

    BB = abs(Emean_os(:,RR) ) ; 
    AA = Magmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Emean_os );
AA = Magmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([1 4 2 6 ])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' |upslope wind _e_a_s_t| (m/s)');
ylabel(' |Orographic ascent| (m/s) ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])




subplot(1,3,2)
hold on
for RR = 1:ar

    BB = abs(Wmean_os(:,RR) ) ; 
    AA = Magmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Wmean_os );
AA = Magmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([0.5 2.5 2 6 ])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' |upslope wind _w_e_s_t| (m/s)');
ylabel(' |Orographic ascent| (m/s) ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])


subplot(1,3,3)
hold on
for RR = 1:ar

    BB = abs(Amean_os(:,RR) ) ; 
    AA = Magmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Amean_os );
AA = Magmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([1 8 2 6 ])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' |cross terr wind aloft| (m/s)');
ylabel(' |Orographic ascent| (m/s) ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])



% %saveas(ff,horzcat(imout2,'/scatter_alldates_LFCRcRsub.png'));
% outlab = horzcat(imout,'/scatter_alldates_Wids','_meth',num2str(meth),'_',DATASET,'.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);








figure('position',[60,564,1319,349]);

subplot(1,3,1)
hold on
for RR = 1:ar

    BB = abs(Emean_os(:,RR) ) ; 
    AA = Widmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Emean_os );
AA = Widmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([1 4 0 3])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' |upslope wind _e_a_s_t| (m/s)');
ylabel(' Orographic ascent width (km) ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])




subplot(1,3,2)
hold on
for RR = 1:ar

    BB = abs(Wmean_os(:,RR) ) ; 
    AA = Widmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Wmean_os );
AA = Widmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([0.5 2.5 0 3])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' |upslope wind _w_e_s_t| (m/s)');
ylabel('  Orographic ascent width (km)  ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])


subplot(1,3,3)
hold on
for RR = 1:ar

    BB = abs(Amean_os(:,RR) ) ; 
    AA = Widmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Amean_os );
AA = Widmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([1 8 0 3])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' |cross terr wind aloft| (m/s)');
ylabel(' Orographic ascent width (km) ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])



% %saveas(ff,horzcat(imout2,'/scatter_alldates_LFCRcRsub.png'));
% outlab = horzcat(imout,'/scatter_alldates_Wids','_meth',num2str(meth),'_',DATASET,'.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);






figure('position',[60,564,1319,349]);

subplot(1,2,1)
hold on
for RR = 1:ar

    BB = abs(Edepth_os(:,RR) ) ; 
    AA = Widmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Edepth_os );
AA = Widmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([1 4 0 3])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' Depth upslope wind _e_a_s_t (km)');
ylabel(' Orographic ascent width (km) ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])




subplot(1,2,2)
hold on
for RR = 1:ar

    BB = abs(Wdepth_os(:,RR) ) ; 
    AA = Widmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Wdepth_os );
AA = Widmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([1 2.5 0 3])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' Depth upslope wind _w_e_s_t (km)');
ylabel('  Orographic ascent width (km)  ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])



% %saveas(ff,horzcat(imout2,'/scatter_alldates_LFCRcRsub.png'));
% outlab = horzcat(imout,'/scatter_alldates_Wids','_meth',num2str(meth),'_',DATASET,'.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);



figure('position',[60,564,1319,349]);

subplot(1,3,1)
hold on
for RR = 1:ar

    BB = abs(Edepth_os(:,RR) ) ; 
    AA = Topratmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Edepth_os );
AA = Topratmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([1 4 0.5 1])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' Depth upslope wind _e_a_s_t (km)');
ylabel(' Orographic ascent depth/LFC (unitless) ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])




subplot(1,3,2)
hold on
for RR = 1:ar

    BB = abs(Wdepth_os(:,RR) ) ; 
    AA = Topratmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( Wdepth_os );
AA = Topratmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([1 2.5 0.5 1])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' Depth upslope wind _w_e_s_t (km)');
ylabel(' Orographic ascent depth/LFC (unitless) ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])





subplot(1,3,3)
hold on
for RR = 1:ar

    BB = abs(LFCmean_os(:,RR) ) ; 
    AA = Topratmean_os(:,RR);

    AA=AA(:);
    BB = BB(:);

    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];

    if(RR==1)
        scatter( BB(:),AA(:)','.r','LineWidth',1.5); hold on
        [ccr1, pval] = corrcoef(BB,AA); ccr1 = ccr1(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo1 = polyfit(BB(:), AA(:), 1);
        xFit1 = linspace(-30,30,30);
        yFit1 = polyval(linCo1,xFit1);

    elseif(RR==2)
        scatter( BB(:),AA(:)','.b','LineWidth',1.5); hold on
        ccr2 = corrcoef(BB,AA); ccr2 = ccr2(2);
        [ccr2, pval] = corrcoef(BB,AA); ccr2 = ccr2(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo2 = polyfit(BB(:), AA(:), 1);
        xFit2 = linspace(-30,30,30);
        yFit2 = polyval(linCo2,xFit2);

    elseif(RR==3)
        scatter( BB(:),AA(:)','.g','LineWidth',1.5); hold on
        ccr3 = corrcoef(BB,AA); ccr3 = ccr3(2);
        [ccr3, pval] = corrcoef(BB,AA); ccr3 = ccr3(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo3 = polyfit(BB(:), AA(:), 1);
        xFit3 = linspace(-30,30,30);
        yFit3 = polyval(linCo3,xFit3);

    elseif(RR==4)
        scatter( BB(:),AA(:)','.c','LineWidth',1.5); hold on
        ccr4 = corrcoef(BB,AA); ccr4 = ccr4(2);
        [ccr4, pval] = corrcoef(BB,AA); ccr4 = ccr4(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo4 = polyfit(BB(:), AA(:), 1);
        xFit4 = linspace(-30,30,30);
        yFit4 = polyval(linCo4,xFit4);

    elseif(RR==5)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0],'MarkerEdgeColor',[1 0.5 0],'LineWidth',1.5); hold on
        ccr5 = corrcoef(BB,AA); ccr5 = ccr5(2);
        [ccr5, pval] = corrcoef(BB,AA); ccr5 = ccr5(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo5 = polyfit(BB(:), AA(:), 1);
        xFit5 = linspace(-30,30,30);
        yFit5 = polyval(linCo5,xFit5);

    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0 0.5 1],'MarkerEdgeColor',[0 0.5 1],'LineWidth',1.5); hold on
        ccr6 = corrcoef(BB,AA); ccr6 = ccr6(2);
        [ccr6, pval] = corrcoef(BB,AA); ccr6 = ccr6(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo6 = polyfit(BB(:), AA(:), 1);
        xFit6 = linspace(-30,30,30);
        yFit6 = polyval(linCo6,xFit6);  

    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.5 0 1],'MarkerEdgeColor',[0.5 0 1],'LineWidth',1.5); hold on
        ccr7 = corrcoef(BB,AA); ccr7 = ccr7(2);
        [ccr7, pval] = corrcoef(BB,AA); ccr7 = ccr7(2); pval = pval(2);
        if(pval < SIGTHRESH)
            disp([num2str(RR),'yes stat sig'])
        else
            disp([num2str(RR),'no stat sig'])
        end
        linCo7 = polyfit(BB(:), AA(:), 1);
        xFit7 = linspace(-30,30,30);
        yFit7 = polyval(linCo7,xFit7);

    end
end

BB = abs( LFCmean_os );
AA = Topratmean_os ;
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];

[ccrall, pval] = corrcoef(BB(:),AA(:)); ccrall = ccrall(2);  pval = pval(2) ;
if(pval < SIGTHRESH)
    disp(['allcases - yes stat sig'])
else
    disp(['allcases - no stat sig'])
end

linCo = polyfit(BB(:), AA(:), 1);
xFit = linspace(-5,30,5);
yFit = polyval(linCo,xFit);

plot(xFit1,yFit1,'r')
plot(xFit2,yFit2,'b')
plot(xFit3,yFit3,'g')
plot(xFit4,yFit4,'c')
plot(xFit5,yFit5,'Color',[1 0.5 0])
plot(xFit6,yFit6,'Color',[0 0.5 1])
plot(xFit7,yFit7,'Color',[0.5 0 1])

plot(xFit,yFit,'k')

legend( num2str(round(ccr1,2)), num2str(round(ccr2,2)), num2str(round(ccr3,2)), num2str(round(ccr4,2)), num2str(round(ccr5,2)), num2str(round(ccr6,2)), num2str(round(ccr7,2)),  'FontSize', 12);
%axis equal
axis([2.5 5.5 0.5 1])
title(['Combined popul corcoeff = ', num2str(round(ccrall,2)) ])

xlabel(' LFC (km)');
ylabel(' Orographic ascent depth/LFC (unitless) ');

sgtitle(['meth=',num2str(meth),';   dataset=',DS])



%%%%%%%
%%%%%%   trying a correlogram approach to time-mean upslope vs swath
%%%%%%   analysis
%%%%%%%


%wind metrics
Emean  = mean(FullSDC_TFCbox_eastupslopemean_ALLCASES,1,'omitnan') ;    Emean = permute(Emean,[2 3 1]);
Wmean  = mean(FullSDC_TFCbox_westupslopemean_ALLCASES,1,'omitnan') ;    Wmean = permute(Wmean,[2 3 1]);
Edepth = mean(FullSDC_TFCbox_eastupslopedepth_ALLCASES,1,'omitnan') ;   Edepth = permute(Edepth,[2 3 1]);
Wdepth = mean(FullSDC_TFCbox_westupslopedepth_ALLCASES,1,'omitnan') ;   Wdepth = permute(Wdepth,[2 3 1]);
% could be downward transport of westerly momentum Aloft clashing about east
% upslope, so also look at flow more aloft. I only have an east side 3-4,
% 4-5, but in principle, i wouldnt think flow aloft to be dramatically
% different on west side. maybe make a west side one if you feel it
% necessary in the future.
Amean = mean(FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES,1,'omitnan');   Amean = permute(Amean,[2 3 1]);
%Amean = mean(FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES,1,'omitnan');   Amean = permute(Amean,[2 3 1]);

%note, these above have too many times. need to chop down to first 75.
Emean(76:end,:) = [];
Wmean(76:end,:) = [];
Edepth(76:end,:) = [];
Wdepth(76:end,:) = [];
Amean(76:end,:) = [];

%swath metrics
Magmean = mean( FullSDC_mesoWstrength_ALLCASES,1,'omitnan');  Magmean = permute(Magmean,[2 3 1]);
Widmean = mean( FullSDC_mesoWwidth_ALLCASES,1,'omitnan');     Widmean = permute(Widmean,[2 3 1]);
Topratmean = mean( FullSDC_swathtopasl_ALLCASES ./ (FullSDC_swathtoplfcasl_ALLCASES/1000), 1,'omitnan');   Topratmean = permute(Topratmean,[2 3 1]);
LFCmean = mean( (FullSDC_swathtoplfcasl_ALLCASES/1000), 1,'omitnan');   LFCmean = permute(LFCmean,[2 3 1]);
VMFLUXmean = mean( (FullSDC_VMfluxSum_ALLCASES), 1,'omitnan');   VMFLUXmean = permute(VMFLUXmean,[2 3 1]);

QVmean = mean( (FullSDC_swathqvap_ALLCASES), 1,'omitnan');           QVmean = permute(QVmean,[2 3 1]);
THEmean = mean( (FullSDC_swaththetaemean_ALLCASES), 1,'omitnan');   THEmean = permute(THEmean,[2 3 1]);
RHAmean = mean( (FullSDC_swathboxaloftRH_ALLCASES(:,1:9,:,:)), 1,'omitnan');   RHAmean = permute(RHAmean,[2 3 4 1]);
    RHAmean = mean( RHAmean, 1,'omitnan');  RHAmean = permute(RHAmean,[2 3 1]);


%time lag the incoming wind from the swath by minus toffset
toffset = 12;  % 6 = 30min;  2 = 10 min

% "upstream" vars
Amean_os = Amean;  Amean_os(end-(toffset-1):end,:) = [];
Emean_os = abs(Emean);  Emean_os(end-(toffset-1):end,:) = [];
Wmean_os = Wmean;  Wmean_os(end-(toffset-1):end,:) = [];
Edepth_os = Emean;  Edepth_os(end-(toffset-1):end,:) = [];
Wdepth_os = Wmean;  Wdepth_os(end-(toffset-1):end,:) = [];

% "in-swath" vars
Magmean_os = Magmean;       Magmean_os(1:toffset,:) = [];
Widmean_os = Widmean;       Widmean_os(1:toffset,:) = [];
Topratmean_os = Topratmean; Topratmean_os(1:toffset,:) = [];
LFCmean_os = LFCmean;       LFCmean_os(1:toffset,:) = [];
QVmean_os  = QVmean;        QVmean_os(1:toffset,:) = [];
THEmean_os = THEmean;       THEmean_os(1:toffset,:) = [];

% %"downstream" vars
% RHAmean_os = RHAmean;


%%%%% per case:
ALL_CORRS = [];
ALL_SIG = [];
num_updrafts = [];

for R = 1:ar

    % R = 4;

    Crosswind_aloft = Amean_os(:,R);
    UpslopeE_mag = Emean_os(:,R);
    UpslopeW_mag = Wmean_os(:,R);
    UpslopeE_depth = Edepth_os(:,R);
    UpslopeW_depth = Wdepth_os(:,R);
    Swath_mag = Magmean_os(:,R);
    Swath_width = Widmean_os(:,R);
    Swath_TopLfcRat = Topratmean_os(:,R);
    Swath_LFC = LFCmean_os(:,R);

    %%%%%%%%%%%%% Use these for Jim sounding code based env metrics:
    
    ALL_vars = {'Swath_mag';
                'Swath_width';
                'Swath_TopLfcRat';

                %'Swath_LFC';
                'UpslopeE_mag';
                'UpslopeW_mag';
                'UpslopeE_depth';
                'UpslopeW_depth';
                'Crosswind_aloft';
    };


    ALL_vars = flipdim(ALL_vars,1) ;

    ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
    ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
    ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;

    SIGTHRESH = 0.05;
    for n = 1:length(ALL_vars)
        for m = 1:length(ALL_vars)
            %  n = 1; m = 3
            AA = char(ALL_vars(n)) ;
            AA = eval(AA);
            BB = char(ALL_vars(m)) ;
            BB = eval(BB);
            kill = isnan(BB);
            BB(kill) = []; AA(kill) = [];
            kill = isnan(AA);
            BB(kill) = []; AA(kill) = [];
            [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
            ALL_corrs(n,m) = corab ;
            ALL_Ps(n,m) = pval;
            if(pval < SIGTHRESH)          %significant
                ALL_statsig(n,m) = NaN;   % marking signif as nan for now (dont remember why - i think matlab couldnt handle 1 and 0 for something at some stage), it will be switched to 1 later for plotting purposes
            else 
                ALL_corrs(n,m) = NaN;   %insig = nan
                ALL_statsig(n,m) = 0; %0;   %insig = 1
            end
        end
    end
    ALL_corrs = single(ALL_corrs);
    isupper = logical(triu(ones(size(ALL_corrs)),1));
    ALL_corrs(isupper) = NaN;
    ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN;

    ALL_statsig = single(ALL_statsig);
    isupper = logical(triu(ones(size(ALL_statsig)),1));
    ALL_statsig(isupper) = NaN;
    ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;


    varlab = {};
    for l = 1:length(ALL_vars)
        asd = char(ALL_vars(l,:) )   ;
        asd(find(asd=='_'))=' '   ;
        varlab = vertcat(varlab,asd);
    end

    %round
    ALL_corrs = round(ALL_corrs,2);

    ALL_CORRS = cat(3,ALL_CORRS,ALL_corrs);
    ALL_SIG = cat(3,ALL_SIG,ALL_statsig);

    dualpol_colmap
    ff = figure('Position',[246,77,1187,900])
    h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['Correlogram - ', Rlab ,' (Filt: LFClayer,small area)  cloud time lag = ',num2str((toffset-1)*5),'min ',RUNS(R,1:8)])

%     saveas(ff, horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.png') );
%     outlab = horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);

end




dualpol_colmap
ff = figure('Position',[246,77,1187,900])
meancorr = mean(ALL_CORRS,3,'omitnan');  
h = heatmap(round(meancorr,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((toffset-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%%% helpful diagnostic plots:

% count blocks with statistical significance:
dualpol_colmap
%ff = figure('Position',[246,77,1187,900])
ALL_SIG(isnan(ALL_SIG)) = 1;   %swap significant marker from nan to 1
SUMSIG = sum(ALL_SIG,3,'omitnan');  
%{
h = heatmap(round(SUMSIG,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['sum of significant cases ',num2str((TIMLG-1)*5)])
%}
% saveas(ff, horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);



% number of blocks with same correlation sign as the ensemble mean :
ALL_COR_SIGN  = sign( ALL_CORRS );
meancorr = mean(ALL_CORRS,3,'omitnan');
MEANCOR = [];
for y = 1:ar  % stitch together for dimension matching. 
    MEANCOR = cat(3,MEANCOR, meancorr);  %note, this is not dicthing values from the mean that dont have the same sign as mean (i.e., the means have both + and - values)
end
MEANCOR_SIGN = sign(MEANCOR);
[ci cj cy] = size(MEANCOR);
MATCHED_SIGNS = MEANCOR_SIGN;   MATCHED_SIGNS(:) = NaN; %array with 1 where case blocks match mean block
match = find(MEANCOR_SIGN == ALL_COR_SIGN);
MATCHED_SIGNS(match) = 1;
SUM_MATCHED_SIGNS = sum(MATCHED_SIGNS,3,'omitnan');



% count blocks with matched sign to mean:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(SUM_MATCHED_SIGNS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['MATCHED SIGNS- ( Filt: LFClayer,small area)  cloud time lag = ',num2str((toffset-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%per-case log of useable confidence
for R = 1:ar

    [asd fgh] = size(ALL_CORRS(:,:,1))
    dayconf = zeros(asd,fgh);    

    good = find( MATCHED_SIGNS(:,:,R) == 1 & ALL_SIG(:,:,R) == 1  ) ; 
    %good = find( ALL_SIG(:,:,R) == 1  ) ; 
    dayconf(good) = 1;

    %{
    figure
    h = heatmap(round(dayconf,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    %h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['matched sign and stat sig for case: ', RUNS(R,:) ])
    %}

end





%%%%%%%% now use this to divide into high, med, low confidence
%%%%%%%% interpretations:

%%% NOTE (21mar2025) - I think the actual mean correlatoin value being plotted is mean of all that are
%%% significant, not mean of just those with a sign consistent with the
%%% mean. You may or may not want to change this in the future

HICONF_MEAN_CORRS = zeros(ci,cj);    HICONF_MEAN_CORRS(:) = NaN; 
MECONF_MEAN_CORRS = zeros(ci,cj);    MECONF_MEAN_CORRS(:) = NaN; 
LOCONF_MEAN_CORRS = zeros(ci,cj);    LOCONF_MEAN_CORRS(:) = NaN; 
for i = 1:ci
    for j = 1:cj
        %  i = 19; j = 18

   
        
        HSIGN = ( SUM_MATCHED_SIGNS(i,j)   >= 5  )   ;
        MSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 5  &  SUM_MATCHED_SIGNS(i,j)   >= 3 );
        LSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 3 );

        HSIG = ( SUMSIG(i,j)   >=  5  )   ;
        MSIG = ( SUMSIG(i,j) < 5  &   SUMSIG(i,j) >= 3 );
        LSIG = ( SUMSIG(i,j) < 3 );        

        %{
        % Hi/Med/Lo breakdown - use for article plot hi & med breakdown using both mean-matched sign and statistical significance counts:
        if( HSIGN==1  &  HSIG==1 & MSIGN==0  &  MSIG==0 & LSIGN==0  & LSIG==0)
            HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==0  &  HSIG==0 & MSIGN==1  &  MSIG==1 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(LSIGN==1  | LSIG==1 )
            LOCONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        end
        %}

        % same but only caring about the statistical significant count
        if(HSIG==1 )

            HICONF_MEAN_CORRS(i,j) = meancorr (i,j);
       
        elseif( MSIG==1 )
            
            MECONF_MEAN_CORRS(i,j) = meancorr(i,j);
       
%         elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%            
%             MECONF_MEAN_CORRS(i,j) = meancorr(i,j);
%        
%         elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = meancorr(i,j);

        elseif(LSIG==1 )
            LOCONF_MEAN_CORRS(i,j) = meancorr (i,j);
        end


    end
end



% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(HICONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
fontsize(ff,14,"points")
title(['HI CONF Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((toffset-1)*5),'min allcasemean'])


% saveas(ff, horzcat(imout,'/widcorrelogram_HIConf_allcasemean_LFCARfilt.png') );
% outlab = horzcat(imout,'/widcorrelogram_HIConf_allcasemean_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(MECONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
fontsize(ff,14,"points")
title(['MED CONF Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((toffset-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/widcorrelogram_MEDConf_allcasemean_LFCARfilt.png') );
% outlab = horzcat(imout,'/widcorrelogram_MEDConf_allcasemean_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(LOCONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['LOW CONF Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((toffset-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/widcorrelogram_LOWConf_allcasemean_LFCARfilt.png') );
% outlab = horzcat(imout,'/widcorrelogram_LOWConf_allcasemean_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% attempt simpler plots of upslope(t)
%%%%%% attempt simpler plots of upslope(t)
%%%%%% attempt simpler plots of upslope(t)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%wind metrics
Emean  = mean(FullSDC_TFCbox_eastupslopemean_ALLCASES,1,'omitnan') ;    Emean = permute(Emean,[2 3 1]);
Wmean  = mean(FullSDC_TFCbox_westupslopemean_ALLCASES,1,'omitnan') ;    Wmean = permute(Wmean,[2 3 1]);
Edepth = mean(FullSDC_TFCbox_eastupslopedepth_ALLCASES,1,'omitnan') ;   Edepth = permute(Edepth,[2 3 1]);
Wdepth = mean(FullSDC_TFCbox_westupslopedepth_ALLCASES,1,'omitnan') ;   Wdepth = permute(Wdepth,[2 3 1]);
% could be downward transport of westerly momentum Aloft clashing about east
% upslope, so also look at flow more aloft. I only have an east side 3-4,
% 4-5, but in principle, i wouldnt think flow aloft to be dramatically
% different on west side. maybe make a west side one if you feel it
% necessary in the future.
Amean45 = mean(FullSDC_TFCbox_eastUmean4to5kmasl_ALLCASES,1,'omitnan');   Amean45 = permute(Amean45,[2 3 1]);
Amean34 = mean(FullSDC_TFCbox_eastUmean3to4kmasl_ALLCASES,1,'omitnan');   Amean34 = permute(Amean34,[2 3 1]);

%note, these above have too many times. need to chop down to first 75.
Emean(76:end,:) = [];
Wmean(76:end,:) = [];
Edepth(76:end,:) = [];
Wdepth(76:end,:) = [];
Amean34(76:end,:) = [];
Amean45(76:end,:) = [];

%swath metrics
Magmean = mean( FullSDC_mesoWstrength_ALLCASES,1,'omitnan');  Magmean = permute(Magmean,[2 3 1]);
Widmean = mean( FullSDC_mesoWwidth_ALLCASES,1,'omitnan');     Widmean = permute(Widmean,[2 3 1]);
Topratmean = mean( FullSDC_swathtopasl_ALLCASES ./ (FullSDC_swathtoplfcasl_ALLCASES/1000), 1,'omitnan');   Topratmean = permute(Topratmean,[2 3 1]);
LFCmean = mean( (FullSDC_swathtoplfcasl_ALLCASES/1000), 1,'omitnan');   LFCmean = permute(LFCmean,[2 3 1]);
VMFLUXmean = mean( (FullSDC_VMfluxSum_ALLCASES), 1,'omitnan');   VMFLUXmean = permute(VMFLUXmean,[2 3 1]);

QVmean = mean( (FullSDC_swathqvap_ALLCASES), 1,'omitnan');           QVmean = permute(QVmean,[2 3 1]);
THEmean = mean( (FullSDC_swaththetaemean_ALLCASES), 1,'omitnan');   THEmean = permute(THEmean,[2 3 1]);

%the set height AGL version:
RHAmean = mean( (FullSDC_swathboxaloftRH_ALLCASES(:,:,:,:)), 1,'omitnan');   RHAmean = permute(RHAmean,[2 3 4 1]);
    RHAmean = mean( RHAmean, 1,'omitnan');  RHAmean = permute(RHAmean,[2 3 1]);
QVAmean = mean( (FullSDC_swathboxaloftQV_ALLCASES(:,:,:,:)), 1,'omitnan');   QVAmean = permute(QVAmean,[2 3 4 1]);
    QVAmean = mean( QVAmean, 1,'omitnan');  QVAmean = permute(QVAmean,[2 3 1]);

%the LFC +/- version:
RHAmeanlfcrel = mean( (FullSDC_swathboxaloftRHlfcrel_ALLCASES(:,:,:,:)), 1,'omitnan');   RHAmeanlfcrel = permute(RHAmeanlfcrel,[2 3 4 1]);
    RHAmeanlfcrel = mean( RHAmeanlfcrel, 1,'omitnan');  RHAmeanlfcrel = permute(RHAmeanlfcrel,[2 3 1]);
QVAmeanlfcrel = mean( (FullSDC_swathboxaloftQVlfcrel_ALLCASES(:,:,:,:)), 1,'omitnan');   QVAmeanlfcrel = permute(QVAmeanlfcrel,[2 3 4 1]);
    QVAmeanlfcrel = mean( QVAmeanlfcrel, 1,'omitnan');  QVAmeanlfcrel = permute(QVAmeanlfcrel,[2 3 1]);





Crosswind_aloft34 = Amean34;
Crosswind_aloft45 = Amean45;
UpslopeE_mag    = Emean;
UpslopeW_mag    = Wmean;
UpslopeE_depth  = Edepth;
UpslopeW_depth  = Wdepth;
Swath_mag       = Magmean;
Swath_width     = Widmean;
Swath_TopLfcRat = Topratmean;
%Swath_LFC       = LFCmean;



% mean mag upslope flow
ff = figure('position',[977,110,581,765]); 

[ha, pos] = tight_subplot(4,1,0.01,[0.05 0.03],[0.1 0.03]) ;   %(4,1,0.02,0.1)

axes(ha(1))
%east side
plot(hourlabel,abs(UpslopeE_mag(:,1)),'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(UpslopeE_mag(:,2)),'g-','LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_mag(:,3)),'b-','LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_mag(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_mag(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_mag(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_mag(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'|mean upslope flow|';'east side (m/s)'})
xticklabels([])
yticks([1:1:4])
axis([13 18.5 1 4 ])
%west side


axes(ha(2))
plot(hourlabel,abs(UpslopeW_mag(:,1)),'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(UpslopeW_mag(:,2)),'g-','LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_mag(:,3)),'b-','LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_mag(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_mag(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_mag(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_mag(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'|mean upslope flow|';'west side (m/s)'})
xticklabels([])
yticks([1:0.5:2.5])
axis([13 18.5 1 2.5 ])



%mean depth upslope:
axes(ha(3))
%east side
plot(hourlabel,abs(UpslopeE_depth(:,1))/1000,'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(UpslopeE_depth(:,2))/1000,'g-','LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_depth(:,3))/1000,'b-','LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_depth(:,4))/1000,'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_depth(:,5))/1000,'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_depth(:,6))/1000,'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeE_depth(:,7))/1000,'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'Depth of upslope flow';'east side (km)'})
xticklabels([])
yticks([0.5:0.5:2.5])
axis([13 18.5 0.5 2.5 ])


%west side
axes(ha(4))
plot(hourlabel,abs(UpslopeW_depth(:,1))/1000,'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(UpslopeW_depth(:,2))/1000,'g-','LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_depth(:,3))/1000,'b-','LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_depth(:,4))/1000,'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_depth(:,5))/1000,'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_depth(:,6))/1000,'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(UpslopeW_depth(:,7))/1000,'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'Depth of upslope flow';'west side (km)'})
xticklabels([])
yticks([0.5:0.5:2.5])
xticklabels([13,14,15,16,17,18])
axis([13 18.5 0.5 2.5 ])




%{

% mean cross flow aloft
ff = figure; 
%east side
plot(hourlabel,abs(Crosswind_aloft34(:,1)),'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(Crosswind_aloft34(:,2)),'g-','LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft34(:,3)),'b-','LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft34(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft34(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft34(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft34(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'Crosswind_aloft 3-4km (m/s)'})
xticklabels([])
yticks([0:1:10])
axis([13 18.5 0 10 ])

ff = figure; 
%east side
plot(hourlabel,abs(Crosswind_aloft45(:,1)),'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(Crosswind_aloft45(:,2)),'g-','LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft45(:,3)),'b-','LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft45(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft45(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft45(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(Crosswind_aloft45(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'Crosswind_aloft 4-5km (m/s)'})
xticklabels([])
yticks([0:1:10])
axis([13 18.5 0 10 ])



ff = figure; 
%east side
plot(hourlabel,abs(QVmean(:,1)),'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(QVmean(:,2)),'g-','LineWidth',1.5)
plot(hourlabel,abs(QVmean(:,3)),'b-','LineWidth',1.5)
plot(hourlabel,abs(QVmean(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(QVmean(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(QVmean(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(QVmean(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'qvapor kg/kg'})
xticklabels([])
yticks([0.005:0.001:0.015])
axis([13 18.5 0.005 0.015 ])

%}


ff = figure; 
%east side
plot(hourlabel,abs(RHAmean(:,1)),'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(RHAmean(:,2)),'g-','LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,3)),'b-','LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'RH 2.5-4km asl'})
%xticklabels([])
yticks([20:5:80])
axis([13 18.5 20 80])


ff = figure; 
%east side
plot(hourlabel,abs(QVAmean(:,1)),'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(QVAmean(:,2)),'g-','LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,3)),'b-','LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'qvapor 2.5-4km asl kg/kg'})
%xticklabels([])
yticks([0.002:0.001:0.011])
axis([13 18.5 0.002 0.011 ])







% ff = figure; 
% 
% subplot(2,2,1)
% yyaxis left
% plot(hourlabel,sdcmean_mesoWstrength(:,1),'r-','LineWidth',3)
% hold on
% plot(hourlabel,sdcmean_mesoWstrength(:,2),'b-','LineWidth',3)
% plot(hourlabel,sdcmean_mesoWstrength(:,3),'g-','LineWidth',3)
% plot(hourlabel,sdcmean_mesoWstrength(:,4),'c-','LineWidth',3)
% ylabel('mean swath |ascent| (m/s)')
% yyaxis right
% plot(hourlabel,sdcmedian_instwsize(:,1),'.r')%, LineWidth',3)
% hold on
% plot(hourlabel,sdcmedian_instwsize(:,2),'.b')%,'LineWidth',3)
% plot(hourlabel,sdcmedian_instwsize(:,3),'.g')%,'LineWidth',3)
% plot(hourlabel,sdcmedian_instwsize(:,4),'.c')%,'LineWidth',3)
% hold on
% plot(hourlabel,sdcmedian_instwsize(:,1),'-r', 'LineWidth',1)
% plot(hourlabel,sdcmedian_instwsize(:,2),'-b','LineWidth',1)
% plot(hourlabel,sdcmedian_instwsize(:,3),'-g','LineWidth',1)
% plot(hourlabel,sdcmedian_instwsize(:,4),'-c','LineWidth',1)
% legend(RUNS)
% axis([13 18.5 300 1200 ])
% ylabel('median cloudy updraft area')
% 
% subplot(2,2,2)
% yyaxis left
% plot(hourlabel,sdcmean_mesoWwidth(:,1),'r-','LineWidth',3)
% hold on
% plot(hourlabel,sdcmean_mesoWwidth(:,2),'b-','LineWidth',3)
% plot(hourlabel,sdcmean_mesoWwidth(:,3),'g-','LineWidth',3)
% plot(hourlabel,sdcmean_mesoWwidth(:,4),'c-','LineWidth',3)
% ylabel('mean swath width (km)')
% axis([13 18.5 0.5 2.5 ])
% yyaxis right
% plot(hourlabel,sdcmedian_instwsize(:,1),'.r')%, LineWidth',3)
% plot(hourlabel,sdcmedian_instwsize(:,2),'.b')%,'LineWidth',3)
% plot(hourlabel,sdcmedian_instwsize(:,3),'.g')%,'LineWidth',3)
% plot(hourlabel,sdcmedian_instwsize(:,4),'.c')%,'LineWidth',3)
% hold on
% plot(hourlabel,sdcmedian_instwsize(:,1),'-r', 'LineWidth',1)
% plot(hourlabel,sdcmedian_instwsize(:,2),'-b','LineWidth',1)
% plot(hourlabel,sdcmedian_instwsize(:,3),'-g','LineWidth',1)
% plot(hourlabel,sdcmedian_instwsize(:,4),'-c','LineWidth',1)
% axis([13 18.5 300 1200 ])
% ylabel('median cloudy updraft area')
% 
% subplot(1,3,3)
% yyaxis left
% plot(sdcmean_mesoWvmf(:,1),'r-','LineWidth',3)
% hold on
% plot(sdcmean_mesoWvmf(:,2),'g-','LineWidth',3)
% plot(sdcmean_mesoWvmf(:,3),'b-','LineWidth',3)
% plot(sdcmean_mesoWvmf(:,4),'k-','LineWidth',3)
% ylabel('mean VMflux')
% yyaxis right
% plot(sdcmedian_instwsize(:,1),'.r')%, LineWidth',3)
% plot(sdcmedian_instwsize(:,2),'.g')%,'LineWidth',3)
% plot(sdcmedian_instwsize(:,3),'.b')%,'LineWidth',3)
% plot(sdcmedian_instwsize(:,4),'.k')%,'LineWidth',3)
% hold on
% plot(sdcmedian_instwsize(:,1),'-r', 'LineWidth',1)
% plot(sdcmedian_instwsize(:,2),'-g','LineWidth',1)
% plot(sdcmedian_instwsize(:,3),'-b','LineWidth',1)
% plot(sdcmedian_instwsize(:,4),'-k','LineWidth',1)
% axis([0 70 0 1500 ])
% ylabel('median cloudy updraft area')



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% article figure: 
%%%%% Evolution of mean swath width/strength ad wID counts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%bring in some data from the froude number calcuations (made with ...LASSO_stuff/FRN_codes/FRN_analysis.m)
load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/processed_ALLCASES/FroudeNumber_dzU_data.mat','FroudeEjt_ALLCASES','FroudeWjt_ALLCASES',...
    'dzpeakU5_vent_ALLCASES', 'dzpeakU8_vent_ALLCASES', 'dzpeakU10_vent_ALLCASES', 'dzpeakU15_vent_ALLCASES', 'dzpeakU20_vent_ALLCASES', ...
    'east_upslope_mean_Fr_ALLCASES', 'west_upslope_mean_Fr_ALLCASES','east_upslope_depth_Fr_ALLCASES','west_upslope_depth_Fr_ALLCASES')

east_upslope_mean_Fr_ALLCASES(find(east_upslope_mean_Fr_ALLCASES==0.0)) = NaN;
west_upslope_mean_Fr_ALLCASES(find(west_upslope_mean_Fr_ALLCASES==0.0)) = NaN;
east_upslope_depth_Fr_ALLCASES(find(east_upslope_depth_Fr_ALLCASES==0.0)) = NaN;
west_upslope_depth_Fr_ALLCASES(find(west_upslope_depth_Fr_ALLCASES==0.0)) = NaN;


ff = figure('position',[977,110,581,765]); 

[ha, pos] = tight_subplot(4,2,0.02,0.1) ;  %(4,1,0.005,0.1)

axes(ha(1))
%subplot(4,1,1)
%yyaxis left

renans = cat(2,r1renan,r2renan,r3renan,r4renan,r5renan,r6renan,r7renan);
sdcmean_mesoWstrength_sm = movmean( sdcmean_mesoWstrength,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoWstrength_sm(:,1),'r-','LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoWstrength_sm(:,2),'g-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWstrength_sm(:,3),'b-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWstrength_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWstrength_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWstrength_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWstrength_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoWstrengthCI = sdcmean_mesoWstrength_sm; 
for R=1:wr
    sdcmean_mesoWstrengthCI(1:tstart(R),R) = NaN;
    sdcmean_mesoWstrengthCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoWstrengthCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoWstrengthCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWstrengthCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWstrengthCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWstrengthCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWstrengthCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWstrengthCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

ylabel('mean swath |ascent| (m/s)')
xticklabels([])
yticks([2:1:6])
axis([13 18.5 2 6 ])



axes(ha(3))
%subplot(4,1,2)
%yyaxis right
sdcmean_mesoWwidth_sm = movmean( sdcmean_mesoWwidth,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoWwidth_sm(:,1),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoWwidth_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWwidth_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWwidth_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWwidth_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWwidth_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWwidth_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoWwidthCI = sdcmean_mesoWwidth_sm; 
for R=1:wr
    sdcmean_mesoWwidthCI(1:tstart(R),R) = NaN;
    sdcmean_mesoWwidthCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoWwidthCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoWwidthCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWwidthCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWwidthCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWwidthCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWwidthCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWwidthCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

xticklabels([])
axis([13 18.5 0.5 3.0])
ylabel('mean swath width')



axes(ha(5))
renans = cat(2,r1renan,r2renan,r3renan,r4renan,r5renan,r6renan,r7renan);
sdcmean_mesoWdepthlfcrat_sm = movmean( sdcmean_mesoWdepthlfcrat,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,1),'r-','LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,2),'g-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,3),'b-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoWdepthCI = sdcmean_mesoWdepthlfcrat_sm; 
for R=1:wr
    sdcmean_mesoWdepthCI(1:tstart(R),R) = NaN;
    sdcmean_mesoWdepthCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoWdepthCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoWdepthCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

ylabel('mean Depth/LFC')
xticklabels([])
yticks([0.5:0.1:1])
axis([13 18.5 0.5 1])


% axes(ha(2))
% plot(hourlabel,abs(UpslopeE_mag(:,1)),'-r', 'LineWidth',1.5)
% hold on
% plot(hourlabel,abs(UpslopeE_mag(:,2)),'-g','LineWidth',1.5)
% plot(hourlabel,abs(UpslopeE_mag(:,3)),'-b','LineWidth',1.5)
% plot(hourlabel,abs(UpslopeE_mag(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
% plot(hourlabel,abs(UpslopeE_mag(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
% plot(hourlabel,abs(UpslopeE_mag(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
% plot(hourlabel,abs(UpslopeE_mag(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)

axes(ha(2))
plot(hourlabel,movmean(  mean( east_upslope_mean_Fr_ALLCASES(:,:,1),1, 'omitnan' ), 3, 'omitnan'),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,movmean(  mean( east_upslope_mean_Fr_ALLCASES(:,:,2),1, 'omitnan' ), 3, 'omitnan'),'-g','LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_mean_Fr_ALLCASES(:,:,3),1, 'omitnan' ), 3, 'omitnan'),'-b','LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_mean_Fr_ALLCASES(:,:,4),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_mean_Fr_ALLCASES(:,:,5),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_mean_Fr_ALLCASES(:,:,6),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_mean_Fr_ALLCASES(:,:,7),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[0.5 0 1],'LineWidth',1.5)
plot(18.5, mean(  mean( west_upslope_mean_Fr_ALLCASES(:,:,1),1, 'omitnan' ), 2, 'omitnan'), 'or','MarkerFaceColor','r')
plot(18.40, mean(  mean( west_upslope_mean_Fr_ALLCASES(:,:,2),1, 'omitnan' ), 2, 'omitnan'), 'og','MarkerFaceColor','g')
plot(18.5, mean(  mean( west_upslope_mean_Fr_ALLCASES(:,:,3),1, 'omitnan' ), 2, 'omitnan'), 'ob','MarkerFaceColor','b')
plot(18.5, mean(  mean( west_upslope_mean_Fr_ALLCASES(:,:,4),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[99/255 0 0],'MarkerFaceColor',[99/255 0 0])
plot(18.5, mean(  mean( west_upslope_mean_Fr_ALLCASES(:,:,5),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[1 0.5 0],'MarkerFaceColor',[1 0.5 0])
plot(18.4, mean(  mean( west_upslope_mean_Fr_ALLCASES(:,:,6),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[0 0.5 1],'MarkerFaceColor',[0 0.5 1])
plot(18.40, mean(  mean( west_upslope_mean_Fr_ALLCASES(:,:,7),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[0.5 0 1],'MarkerFaceColor',[0.5 0 1])


% uCI = abs(UpslopeE_mag); 
% for R=1:wr
%     uCI(1:tstart(R),R) = NaN;
%     uCI(tend(R):end,R) = NaN;
% end
% plot(hourlabel,uCI(:,1),'r-','LineWidth',3)
% hold on
% plot(hourlabel,uCI(:,2),'g-','LineWidth',3)
% plot(hourlabel,uCI(:,3),'b-','LineWidth',3)
% plot(hourlabel,uCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
% plot(hourlabel,uCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
% plot(hourlabel,uCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
% plot(hourlabel,uCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
uCI = movmean(  mean( east_upslope_mean_Fr_ALLCASES(:,:,:),1, 'omitnan' ), 3, 'omitnan'); uCI = permute(uCI,[2 3 1]);
for R=1:wr
    uCI(1:tstart(R),R) = NaN;
    uCI(tend(R):end,R) = NaN;
end
plot(hourlabel,uCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,uCI(:,2),'g-','LineWidth',3)
plot(hourlabel,uCI(:,3),'b-','LineWidth',3)
plot(hourlabel,uCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,uCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,uCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,uCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)


xticklabels([])
axis([13 18.5 1 4.0])
ylabel('mean eastside upsloping U')


FrE = FroudeEjt_ALLCASES(:,:,:);
FrE( find(FrE == 999.9) ) = NaN;
FrE( find(FrE == 0) ) = NaN;
FrW = FroudeWjt_ALLCASES(:,:,:);
FrW(find(FrW == 999.9)) = NaN;
FrW( find(FrW == 0) ) = NaN;

axes(ha(4))
plot(hourlabel,movmean(  mean( FrE(:,:,1),1, 'omitnan' ), 3, 'omitnan'),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,movmean(  mean( FrE(:,:,2),1, 'omitnan' ), 3, 'omitnan'),'-g','LineWidth',1.5)
plot(hourlabel,movmean(  mean( FrE(:,:,3),1, 'omitnan' ), 3, 'omitnan'),'-b','LineWidth',1.5)
plot(hourlabel,movmean(  mean( FrE(:,:,4),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,movmean(  mean( FrE(:,:,5),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,movmean(  mean( FrE(:,:,6),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,movmean(  mean( FrE(:,:,7),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[0.5 0 1],'LineWidth',1.5)

FrECI = movmean(  mean( FrE(:,:,:),1, 'omitnan' ), 3, 'omitnan'); 
for R=1:wr
    FrECI(:,1:tstart(R),R) = NaN;
    FrECI(:,tend(R):end,R) = NaN;
end
plot(hourlabel,FrECI(:,:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,FrECI(:,:,2),'g-','LineWidth',3)
plot(hourlabel,FrECI(:,:,3),'b-','LineWidth',3)
plot(hourlabel,FrECI(:,:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,FrECI(:,:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,FrECI(:,:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,FrECI(:,:,7),'-','Color',[0.5 0 1],'LineWidth',3)

% plot(hourlabel,movmean(  mean( FrW(:,:,1),1, 'omitnan' ), 3, 'omitnan'),'-.r', 'LineWidth',1.5)
% plot(hourlabel,movmean(  mean( FrW(:,:,2),1, 'omitnan' ), 3, 'omitnan'),'-.g','LineWidth',1.5)
% plot(hourlabel,movmean(  mean( FrW(:,:,3),1, 'omitnan' ), 3, 'omitnan'),'-.b','LineWidth',1.5)
% plot(hourlabel,movmean(  mean( FrW(:,:,4),1, 'omitnan' ), 3, 'omitnan'),'-.','Color',[99/255 0 0],'LineWidth',1.5)
% plot(hourlabel,movmean(  mean( FrW(:,:,5),1, 'omitnan' ), 3, 'omitnan'),'-.','Color',[1 0.5 0],'LineWidth',1.5)
% plot(hourlabel,movmean(  mean( FrW(:,:,6),1, 'omitnan' ), 3, 'omitnan'),'-.','Color',[0 0.5 1],'LineWidth',1.5)
% plot(hourlabel,movmean(  mean( FrW(:,:,7),1, 'omitnan' ), 3, 'omitnan'),'-.','Color',[0.5 0 1],'LineWidth',1.5)
plot(18.4, mean(  mean( FrW(:,:,1),1, 'omitnan' ), 2, 'omitnan'), 'or','MarkerFaceColor','r')
plot(18.5, mean(  mean( FrW(:,:,2),1, 'omitnan' ), 2, 'omitnan'), 'og','MarkerFaceColor','g')
plot(18.4, mean(  mean( FrW(:,:,3),1, 'omitnan' ), 2, 'omitnan'), 'ob','MarkerFaceColor','b')
plot(18.3, mean(  mean( FrW(:,:,4),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[99/255 0 0],'MarkerFaceColor',[99/255 0 0])
plot(18.5, mean(  mean( FrW(:,:,5),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[1 0.5 0],'MarkerFaceColor',[1 0.5 0])
plot(18.5, mean(  mean( FrW(:,:,6),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[0 0.5 1],'MarkerFaceColor',[0 0.5 1])
plot(18.5, mean(  mean( FrW(:,:,7),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[0.5 0 1],'MarkerFaceColor',[0.5 0 1])
xticklabels([])
axis([13 18.5 0 3.0])
ylabel('stab/up mean Fr -E :W')

% plot(hourlabel,abs(UpslopeW_mag(:,1)),'-r', 'LineWidth',1.5)
% hold on
% plot(hourlabel,abs(UpslopeW_mag(:,2)),'-g','LineWidth',1.5)
% plot(hourlabel,abs(UpslopeW_mag(:,3)),'-b','LineWidth',1.5)
% plot(hourlabel,abs(UpslopeW_mag(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
% plot(hourlabel,abs(UpslopeW_mag(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
% plot(hourlabel,abs(UpslopeW_mag(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
% plot(hourlabel,abs(UpslopeW_mag(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
% 
% uCI = abs(UpslopeW_mag); 
% for R=1:wr
%     uCI(1:tstart(R),R) = NaN;
%     uCI(tend(R):end,R) = NaN;
% end
% plot(hourlabel,uCI(:,1),'r-','LineWidth',3)
% hold on
% plot(hourlabel,uCI(:,2),'g-','LineWidth',3)
% plot(hourlabel,uCI(:,3),'b-','LineWidth',3)
% plot(hourlabel,uCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
% plot(hourlabel,uCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
% plot(hourlabel,uCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
% plot(hourlabel,uCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
% 
% xticklabels([])
% axis([13 18.5 0.5 2.5])
% ylabel('mean westside upslope')


%{
UnstabneutralJptsE = zeros(75,7);  UnstabneutralJptsE(:) = NaN;
UnstabneutralJptsW = zeros(75,7);  UnstabneutralJptsW(:) = NaN;
FrE = FroudeEjt_ALLCASES(:,:,:);
FrW = FroudeWjt_ALLCASES(:,:,:);
for r = 1:7
    for t = 1:75
        UnstabneutralJptsE(t,r) =  length(find(FrE(:,t,r) == 999.9)) / 1600;
        UnstabneutralJptsW(t,r) =  length(find(FrW(:,t,r) == 999.9)) / 1600;
    end
end
UnstabneutralJptsE(UnstabneutralJptsE==0) = NaN ;
UnstabneutralJptsW(UnstabneutralJptsW==0) = NaN ;
axes(ha(6))
plot(hourlabel,movmean(  UnstabneutralJptsE(:,1), 3, 'omitnan'),'-r','LineWidth',1.5)
hold on
plot(hourlabel,movmean(  UnstabneutralJptsE(:,2), 3, 'omitnan'),'-g','LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsE(:,3), 3, 'omitnan'),'-b','LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsE(:,4), 3, 'omitnan'),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsE(:,5), 3, 'omitnan'),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsE(:,6), 3, 'omitnan'),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsE(:,7), 3, 'omitnan'),'-','Color',[0.5 0 1],'LineWidth',1.5)

plot(hourlabel,movmean(  UnstabneutralJptsW(:,1), 3, 'omitnan'),'-.r','LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsW(:,2), 3, 'omitnan'),'-.g','LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsW(:,3), 3, 'omitnan'),'-.b','LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsW(:,4), 3, 'omitnan'),'-.','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsW(:,5), 3, 'omitnan'),'-.','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsW(:,6), 3, 'omitnan'),'-.','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,movmean(  UnstabneutralJptsW(:,7), 3, 'omitnan'),'-.','Color',[0.5 0 1],'LineWidth',1.5)
xticklabels([])
axis([13 18.5 0 0.8])
ylabel('Fract unst/neu -E :W')
%}



axes(ha(6))
plot(hourlabel,movmean(  mean( east_upslope_depth_Fr_ALLCASES(:,:,1),1, 'omitnan' ), 3, 'omitnan'),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,movmean(  mean( east_upslope_depth_Fr_ALLCASES(:,:,2),1, 'omitnan' ), 3, 'omitnan'),'-g','LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_depth_Fr_ALLCASES(:,:,3),1, 'omitnan' ), 3, 'omitnan'),'-b','LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_depth_Fr_ALLCASES(:,:,4),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_depth_Fr_ALLCASES(:,:,5),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_depth_Fr_ALLCASES(:,:,6),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,movmean(  mean( east_upslope_depth_Fr_ALLCASES(:,:,7),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[0.5 0 1],'LineWidth',1.5)

FrECI = movmean(  mean( east_upslope_depth_Fr_ALLCASES(:,:,:),1, 'omitnan' ), 3, 'omitnan'); 
for R=1:wr
    FrECI(:,1:tstart(R),R) = NaN;
    FrECI(:,tend(R):end,R) = NaN;
end
plot(hourlabel,FrECI(:,:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,FrECI(:,:,2),'g-','LineWidth',3)
plot(hourlabel,FrECI(:,:,3),'b-','LineWidth',3)
plot(hourlabel,FrECI(:,:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,FrECI(:,:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,FrECI(:,:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,FrECI(:,:,7),'-','Color',[0.5 0 1],'LineWidth',3)
plot(18.4, mean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,1),1, 'omitnan' ), 2, 'omitnan'), 'or','MarkerFaceColor','r')
plot(18.4, mean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,2),1, 'omitnan' ), 2, 'omitnan'), 'og','MarkerFaceColor','g')
plot(18.4, mean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,3),1, 'omitnan' ), 2, 'omitnan'), 'ob','MarkerFaceColor','b')
plot(18.3, mean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,4),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[99/255 0 0],'MarkerFaceColor',[99/255 0 0])
plot(18.5, mean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,5),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[1 0.5 0],'MarkerFaceColor',[1 0.5 0])
plot(18.5, mean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,6),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[0 0.5 1],'MarkerFaceColor',[0 0.5 1])
plot(18.5, mean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,7),1, 'omitnan' ), 2, 'omitnan'), 'o','Color',[0.5 0 1],'MarkerFaceColor',[0.5 0 1])
% plot(hourlabel,movmean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,1),1, 'omitnan' ), 3, 'omitnan'),'-r', 'LineWidth',1.5)
% hold on
% plot(hourlabel,movmean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,2),1, 'omitnan' ), 3, 'omitnan'),'-g','LineWidth',1.5)
% plot(hourlabel,movmean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,3),1, 'omitnan' ), 3, 'omitnan'),'-b','LineWidth',1.5)
% plot(hourlabel,movmean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,4),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[99/255 0 0],'LineWidth',1.5)
% plot(hourlabel,movmean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,5),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[1 0.5 0],'LineWidth',1.5)
% plot(hourlabel,movmean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,6),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[0 0.5 1],'LineWidth',1.5)
% plot(hourlabel,movmean(  mean( west_upslope_depth_Fr_ALLCASES(:,:,7),1, 'omitnan' ), 3, 'omitnan'),'-','Color',[0.5 0 1],'LineWidth',1.5)


xticklabels([])
axis([13 18.5 0 1])
ylabel('depth of U / Hsdc ')




axes(ha(7))
%subplot(4,1,3)
%yyaxis left
sdcsum_instwcount_sm = movmean( sdcsum_instwcount,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcsum_instwcount_sm(:,1),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,sdcsum_instwcount_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcsum_instwcount_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcsum_instwcount_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcsum_instwcount_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcsum_instwcount_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcsum_instwcount_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcsum_instwcountCI = sdcsum_instwcount_sm; 
for R=1:wr
    sdcsum_instwcountCI(1:tstart(R),R) = NaN;
    sdcsum_instwcountCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcsum_instwcountCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcsum_instwcountCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcsum_instwcountCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcsum_instwcountCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcsum_instwcountCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcsum_instwcountCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcsum_instwcountCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
ylabel('cloudy updraft count ')
xticklabels([13:1:18])
axis([13 18.5 0 60])




axes(ha(8))
%subplot(4,1,4)
sdcmean_instwsize_sm = movmean( sdcmean_instwsize,3,1,'omitnan') .* renans ;

hold on
plot(hourlabel,sdcmean_instwsize_sm(:,1),'-r', 'LineWidth',1.5)
plot(hourlabel,sdcmean_instwsize_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcmean_instwsize_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcmean_instwsize_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_instwsize_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_instwsize_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_instwsize_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_instwsizeCI = sdcmean_instwsize_sm; 
for R=1:wr
    sdcmean_instwsizeCI(1:tstart(R),R) = NaN;
    sdcmean_instwsizeCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_instwsizeCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_instwsizeCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_instwsizeCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_instwsizeCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_instwsizeCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_instwsizeCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_instwsizeCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

ylabel('mean cloudy radius')
xticks([13:18])
yticks([300:100:800])
yticklabels([300:100:800])
xticklabels([13:1:18])
axis([13 18.5 300 800 ])



saveas(ff,horzcat(imout,'/SwathWid_history.png'));
outlab = horzcat(imout,'/SwathWid_history.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% article figure: 
%%%%% Evolution of mean max{moisture convergence arrays}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

ff = figure('position',[977,110,581,765]); 

[ha, pos] = tight_subplot(4,1,0.02,0.1) ;  %(4,1,0.005,0.1)

% axes(ha(1))
% %subplot(4,1,1)
% %yyaxis left
% 
% renans = cat(2,r1renan,r2renan,r3renan,r4renan,r5renan,r6renan,r7renan);
% sdcmean_mesoCstrength_sm = movmean( sdcmean_mesoCstrength,3,1,'omitnan') .* renans ;
% 
% plot(hourlabel,sdcmean_mesoCstrength_sm(:,1),'r-','LineWidth',1.5)
% hold on
% plot(hourlabel,sdcmean_mesoCstrength_sm(:,2),'g-','LineWidth',1.5)
% plot(hourlabel,sdcmean_mesoCstrength_sm(:,3),'b-','LineWidth',1.5)
% plot(hourlabel,sdcmean_mesoCstrength_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
% plot(hourlabel,sdcmean_mesoCstrength_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
% plot(hourlabel,sdcmean_mesoCstrength_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
% plot(hourlabel,sdcmean_mesoCstrength_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)
% 
% sdcmean_mesoCstrengthCI = sdcmean_mesoCstrength_sm; 
% for R=1:wr
%     sdcmean_mesoCstrengthCI(1:tstart(R),R) = NaN;
%     sdcmean_mesoCstrengthCI(tend(R):end,R) = NaN;
% end
% plot(hourlabel,sdcmean_mesoCstrengthCI(:,1),'r-','LineWidth',3)
% hold on
% plot(hourlabel,sdcmean_mesoCstrengthCI(:,2),'g-','LineWidth',3)
% plot(hourlabel,sdcmean_mesoCstrengthCI(:,3),'b-','LineWidth',3)
% plot(hourlabel,sdcmean_mesoCstrengthCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
% plot(hourlabel,sdcmean_mesoCstrengthCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
% plot(hourlabel,sdcmean_mesoCstrengthCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
% plot(hourlabel,sdcmean_mesoCstrengthCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
% 
% ylabel('mean swath |max conv| (1/s)')
% %title('mean swath |max conv| (1/s)')
% xticklabels([])
% yticks([0.01 :0.005: 0.025])
% axis([13 18.5 0.01 0.025])



axes(ha(4))
%subplot(4,1,2)
%yyaxis right
sdcmean_mesoCMFCmax_sm = movmean( sdcmean_mesoCMFCmax,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoCMFCmax_sm(:,1),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoCMFCmax_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmax_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmax_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmax_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmax_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmax_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoCMFCmaxCI = sdcmean_mesoCMFCmax_sm; 
for R=1:wr
    sdcmean_mesoCMFCmaxCI(1:tstart(R),R) = NaN;
    sdcmean_mesoCMFCmaxCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoCMFCmaxCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoCMFCmaxCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmaxCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmaxCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmaxCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmaxCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmaxCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

xticklabels([])
axis([13 18.5 0.00005 0.00035])
ylabel('mean max{total MFC}')
%title('mean max{total MFC}')







%{

ff = figure; 
%east side
plot(hourlabel,abs(RHAmean(:,1)),'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(RHAmean(:,2)),'g-','LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,3)),'b-','LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'RH 2.5-4km asl'})
%xticklabels([])
yticks([20:5:80])
axis([13 18.5 20 80])


ff = figure; 
%east side
plot(hourlabel,abs(QVAmean(:,1)),'r-','LineWidth',1.5)
hold on
plot(hourlabel,abs(QVAmean(:,2)),'g-','LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,3)),'b-','LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)
ylabel({'qvapor 2.5-4km asl kg/kg'})
%xticklabels([])
yticks([0.002:0.001:0.011])
axis([13 18.5 0.002 0.011 ])
%}

%{
axes(ha(3))

plot(hourlabel,abs(RHAmeanlfcrel(:,1)),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,abs(RHAmeanlfcrel(:,2)),'-g','LineWidth',1.5)
plot(hourlabel,abs(RHAmeanlfcrel(:,3)),'-b','LineWidth',1.5)
plot(hourlabel,abs(RHAmeanlfcrel(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(RHAmeanlfcrel(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(RHAmeanlfcrel(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(RHAmeanlfcrel(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)

rhCI = RHAmeanlfcrel; 
for R=1:wr
    rhCI(1:tstart(R),R) = NaN;
    rhCI(tend(R):end,R) = NaN;
end
plot(hourlabel,rhCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,rhCI(:,2),'g-','LineWidth',3)
plot(hourlabel,rhCI(:,3),'b-','LineWidth',3)
plot(hourlabel,rhCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,rhCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,rhCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,rhCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
ylabel('mean{ RH }')
%title('mean{ RH }')
xticklabels([])
axis([13 18.5 20 80])



axes(ha(2))

plot(hourlabel,abs(QVAmeanlfcrel(:,1)),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,abs(QVAmeanlfcrel(:,2)),'-g','LineWidth',1.5)
plot(hourlabel,abs(QVAmeanlfcrel(:,3)),'-b','LineWidth',1.5)
plot(hourlabel,abs(QVAmeanlfcrel(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(QVAmeanlfcrel(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(QVAmeanlfcrel(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(QVAmeanlfcrel(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)

qvCI = QVAmeanlfcrel; 
for R=1:wr
    qvCI(1:tstart(R),R) = NaN;
    qvCI(tend(R):end,R) = NaN;
end
plot(hourlabel,qvCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,qvCI(:,2),'g-','LineWidth',3)
plot(hourlabel,qvCI(:,3),'b-','LineWidth',3)
plot(hourlabel,qvCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,qvCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,qvCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,qvCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
ylabel(' mean{ max qv } ')
%title(' mean{ max q-adv } ')
xticklabels([])
axis([13 18.5 0.004 0.014])
%}



axes(ha(3))

plot(hourlabel,abs(RHAmean(:,1)),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,abs(RHAmean(:,2)),'-g','LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,3)),'-b','LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(RHAmean(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)

rhCI = RHAmean; 
for R=1:wr
    rhCI(1:tstart(R),R) = NaN;
    rhCI(tend(R):end,R) = NaN;
end
plot(hourlabel,rhCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,rhCI(:,2),'g-','LineWidth',3)
plot(hourlabel,rhCI(:,3),'b-','LineWidth',3)
plot(hourlabel,rhCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,rhCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,rhCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,rhCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
ylabel('mean{ RH }')
%title('mean{ RH }')
xticklabels([])
axis([13 18.5 35 80])



axes(ha(2))

plot(hourlabel,abs(QVAmean(:,1)),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,abs(QVAmean(:,2)),'-g','LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,3)),'-b','LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,4)),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,5)),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,6)),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,abs(QVAmean(:,7)),'-','Color',[0.5 0 1],'LineWidth',1.5)

qvCI = QVAmean; 
for R=1:wr
    qvCI(1:tstart(R),R) = NaN;
    qvCI(tend(R):end,R) = NaN;
end
plot(hourlabel,qvCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,qvCI(:,2),'g-','LineWidth',3)
plot(hourlabel,qvCI(:,3),'b-','LineWidth',3)
plot(hourlabel,qvCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,qvCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,qvCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,qvCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
ylabel(' mean{ max qv } ')
%title(' mean{ max q-adv } ')
xticklabels([])
axis([13 18.5 0.004 0.014])





axes(ha(1))

renans = cat(2,r1renan,r2renan,r3renan,r4renan,r5renan,r6renan,r7renan);
sdcmean_mesoWlfc_sm = (movmean( sdcmean_mesoWlfc,3,1,'omitnan') .* renans)/1000 ;

plot(hourlabel,sdcmean_mesoWlfc_sm(:,1),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoWlfc_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoWlfcCI = sdcmean_mesoWlfc_sm; 
for R=1:wr
    sdcmean_mesoWlfcCI(1:tstart(R),R) = NaN;
    sdcmean_mesoWlfcCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoWlfcCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoWlfcCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

ylabel('in-swath LFC')
xticklabels(13:18)
yticks([0.5:0.5:4])
axis([13 18.5 0 4])






saveas(ff,horzcat(imout,'/Swaththermo_history.png'));
outlab = horzcat(imout,'/Swaththermo_history.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);



%{

axes(ha(3))
%subplot(4,1,3)
%yyaxis left
sdcmean_mesoCMCqconvmax_sm = movmean( sdcmean_mesoCMCqconvmax,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoCMCqconvmax_sm(:,1),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoCMCqconvmax_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmax_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmax_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmax_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmax_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmax_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoCMCqconvmaxCI = sdcmean_mesoCMCqconvmax_sm; 
for R=1:wr
    sdcmean_mesoCMCqconvmaxCI(1:tstart(R),R) = NaN;
    sdcmean_mesoCMCqconvmaxCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoCMCqconvmaxCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoCMCqconvmaxCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmaxCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmaxCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmaxCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmaxCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmaxCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
ylabel('mean{max q*conv}')
title('mean{max q*conv}')
xticklabels([])
axis([13 18.5 0.00005 0.00035])



axes(ha(4))
%subplot(4,1,3)
%yyaxis left
sdcmean_mesoCMCqadvmax_sm = movmean( sdcmean_mesoCMCqadvmax,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoCMCqadvmax_sm(:,1),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoCMCqadvmax_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmax_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmax_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmax_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmax_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmax_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoCMCqadvmaxCI = sdcmean_mesoCMCqadvmax_sm; 
for R=1:wr
    sdcmean_mesoCMCqadvmaxCI(1:tstart(R),R) = NaN;
    sdcmean_mesoCMCqadvmaxCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoCMCqadvmaxCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoCMCqadvmaxCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmaxCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmaxCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmaxCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmaxCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmaxCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
ylabel(' mean{ max q-adv } ')
title(' mean{ max q-adv } ')
xticklabels([13:1: 18])
axis([13 18.5 0.000005 0.00008])
axis([13 18.5 0.00000 0.00035])

saveas(ff,horzcat(imout,'/SwathMFC_history.png'));
outlab = horzcat(imout,'/SwathMFC_history.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);
%}










%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% article figure: 
%%%%% Evolution of mean mean{moisture convergence arrays}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

ff = figure('position',[977,110,581,765]); 

[ha, pos] = tight_subplot(4,1,0.02,0.1) ;  %(4,1,0.005,0.1)

axes(ha(1))
%subplot(4,1,1)
%yyaxis left

renans = cat(2,r1renan,r2renan,r3renan,r4renan,r5renan,r6renan,r7renan);
sdcmean_mesoCstrength_sm = movmean( sdcmean_mesoCstrength,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoCstrength_sm(:,1),'r-','LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoCstrength_sm(:,2),'g-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCstrength_sm(:,3),'b-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCstrength_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCstrength_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCstrength_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCstrength_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoCstrengthCI = sdcmean_mesoCstrength_sm; 
for R=1:wr
    sdcmean_mesoCstrengthCI(1:tstart(R),R) = NaN;
    sdcmean_mesoCstrengthCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoCstrengthCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoCstrengthCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCstrengthCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCstrengthCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCstrengthCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCstrengthCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCstrengthCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

ylabel('mean swath |max conv| (1/s)')
title('mean swath |max conv| (1/s)')
xticklabels([])
yticks([0.01 :0.005: 0.025])
axis([13 18.5 0.01 0.025])



axes(ha(2))
%subplot(4,1,2)
%yyaxis right
sdcmean_mesoCMFCmean_sm = movmean( sdcmean_mesoCMFCmean,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoCMFCmean_sm(:,1),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoCMFCmean_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmean_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmean_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmean_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmean_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMFCmean_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoCMFCmeanCI = sdcmean_mesoCMFCmean_sm; 
for R=1:wr
    sdcmean_mesoCMFCmeanCI(1:tstart(R),R) = NaN;
    sdcmean_mesoCMFCmeanCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoCMFCmeanCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoCMFCmeanCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmeanCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmeanCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmeanCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmeanCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMFCmeanCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

xticklabels([])
axis([13 18.5 0.00002 0.0001])
ylabel('mean mean[total MFC]')
title('mean mean[total MFC]')



axes(ha(3))
%subplot(4,1,3)
%yyaxis left
sdcmean_mesoCMCqconvmean_sm = movmean( sdcmean_mesoCMCqconvmean,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoCMCqconvmean_sm(:,1),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoCMCqconvmean_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmean_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmean_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmean_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmean_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqconvmean_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoCMCqconvmeanCI = sdcmean_mesoCMCqconvmean_sm; 
for R=1:wr
    sdcmean_mesoCMCqconvmeanCI(1:tstart(R),R) = NaN;
    sdcmean_mesoCMCqconvmeanCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoCMCqconvmeanCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoCMCqconvmeanCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmeanCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmeanCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmeanCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmeanCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqconvmeanCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
ylabel('mean [mean q*conv]')
title('mean [mean q*conv]')
xticklabels([])
axis([13 18.5 0.00002 0.0001])



axes(ha(4))
%subplot(4,1,3)
%yyaxis left
sdcmean_mesoCMCqadvmean_sm = movmean( sdcmean_mesoCMCqadvmean,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoCMCqadvmean_sm(:,1),'-r', 'LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoCMCqadvmean_sm(:,2),'-g','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmean_sm(:,3),'-b','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmean_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmean_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmean_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoCMCqadvmean_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoCMCqadvmeanCI = sdcmean_mesoCMCqadvmean_sm; 
for R=1:wr
    sdcmean_mesoCMCqadvmeanCI(1:tstart(R),R) = NaN;
    sdcmean_mesoCMCqadvmeanCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoCMCqadvmeanCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoCMCqadvmeanCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmeanCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmeanCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmeanCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmeanCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoCMCqadvmeanCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)
ylabel(' mean{ mean q-adv } ')
title(' mean{ mean q-adv } ')
xticklabels([13:1: 18])
yticks([-0.000006 : 0.000001 : 0.000001])
axis([13 18.5 -0.000006 0.000001])

saveas(ff,horzcat(imout,'/SwathMFC_history.png'));
outlab = horzcat(imout,'/SwathMFC_history.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);














%{
%  sdcmean_mesoWdepthlfcrat

figure

renans = cat(2,r1renan,r2renan,r3renan,r4renan,r5renan,r6renan,r7renan);
sdcmean_mesoWdepthlfcrat_sm = movmean( sdcmean_mesoWdepthlfcrat,3,1,'omitnan') .* renans ;

plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,1),'r-','LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,2),'g-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,3),'b-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWdepthlfcrat_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoWdepthCI = sdcmean_mesoWdepthlfcrat_sm; 
for R=1:wr
    sdcmean_mesoWdepthCI(1:tstart(R),R) = NaN;
    sdcmean_mesoWdepthCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoWdepthCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoWdepthCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWdepthCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

ylabel('mean Depth/LFC')
xticklabels(13:18)
yticks([0.5:0.1:1])
axis([13 18.5 0.5 1])

%}


%{
figure

renans = cat(2,r1renan,r2renan,r3renan,r4renan,r5renan,r6renan,r7renan);
sdcmean_mesoWlfc_sm = (movmean( sdcmean_mesoWlfc,3,1,'omitnan') .* renans)/1000 ;

plot(hourlabel,sdcmean_mesoWlfc_sm(:,1),'r-','LineWidth',1.5)
hold on
plot(hourlabel,sdcmean_mesoWlfc_sm(:,2),'g-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,3),'b-','LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,4),'-','Color',[99/255 0 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,5),'-','Color',[1 0.5 0],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,6),'-','Color',[0 0.5 1],'LineWidth',1.5)
plot(hourlabel,sdcmean_mesoWlfc_sm(:,7),'-','Color',[0.5 0 1],'LineWidth',1.5)

sdcmean_mesoWlfcCI = sdcmean_mesoWlfc_sm; 
for R=1:wr
    sdcmean_mesoWlfcCI(1:tstart(R),R) = NaN;
    sdcmean_mesoWlfcCI(tend(R):end,R) = NaN;
end
plot(hourlabel,sdcmean_mesoWlfcCI(:,1),'r-','LineWidth',3)
hold on
plot(hourlabel,sdcmean_mesoWlfcCI(:,2),'g-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,3),'b-','LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,4),'-','Color',[99/255 0 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,5),'-','Color',[1 0.5 0],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,6),'-','Color',[0 0.5 1],'LineWidth',3)
plot(hourlabel,sdcmean_mesoWlfcCI(:,7),'-','Color',[0.5 0 1],'LineWidth',3)

ylabel('in-swath LFC')
xticklabels(13:18)
yticks([0.5:0.5:4])
axis([13 18.5 0 4])

%}





%{

ff = figure; 
[ha, pos] = tight_subplot(4,1,0.005,0.1) ;

axes(ha(1))

%subplot(1,3,1)
yyaxis left
plot(sdcmean_mesoWstrength(:,1),'r-','LineWidth',3)
hold on
plot(sdcmean_mesoWstrength(:,2),'g-','LineWidth',3)
plot(sdcmean_mesoWstrength(:,3),'b-','LineWidth',3)
plot(sdcmean_mesoWstrength(:,4),'k-','LineWidth',3)
ylabel('mean swath |ascent| (m/s)')
yyaxis right
plot(sdcsum_instwcount(:,1),'.r')
hold on
plot(sdcsum_instwcount(:,2),'.g')
plot(sdcsum_instwcount(:,3),'.b')
plot(sdcsum_instwcount(:,4),'.k')
plot(sdcsum_instwcount(:,1),'-r','LineWidth',1)
hold on
plot(sdcsum_instwcount(:,2),'-g','LineWidth',1)
plot(sdcsum_instwcount(:,3),'-b','LineWidth',1)
plot(sdcsum_instwcount(:,4),'-k','LineWidth',1)
legend(RUNS)
ylabel('instantaneous updraft count')

axes(ha(2))
%subplot(1,3,2)
yyaxis left
plot(sdcmean_mesoWwidth(:,1),'r-','LineWidth',3)
hold on
plot(sdcmean_mesoWwidth(:,2),'g-','LineWidth',3)
plot(sdcmean_mesoWwidth(:,3),'b-','LineWidth',3)
plot(sdcmean_mesoWwidth(:,4),'k-','LineWidth',3)
ylabel('mean swath width (km)')
yyaxis right
plot(sdcsum_instwcount(:,1),'.r','LineWidth',1)
hold on
plot(sdcsum_instwcount(:,2),'.g','LineWidth',1)
plot(sdcsum_instwcount(:,3),'.b','LineWidth',1)
plot(sdcsum_instwcount(:,4),'.k','LineWidth',1)
plot(sdcsum_instwcount(:,1),'-r','LineWidth',1)
hold on
plot(sdcsum_instwcount(:,2),'-g','LineWidth',1)
plot(sdcsum_instwcount(:,3),'-b','LineWidth',1)
plot(sdcsum_instwcount(:,4),'-k','LineWidth',1)
ylabel('instantaneous updraft count')

axes(ha(3))
%subplot(1,3,3)
yyaxis left
plot(sdcmean_mesoWvmf(:,1),'r-','LineWidth',3)
hold on
plot(sdcmean_mesoWvmf(:,2),'g-','LineWidth',3)
plot(sdcmean_mesoWvmf(:,3),'b-','LineWidth',3)
plot(sdcmean_mesoWvmf(:,4),'k-','LineWidth',3)
ylabel('mean VMflux')
yyaxis right
plot(sdcsum_instwcount(:,1),'-r','LineWidth',1)
hold on
plot(sdcsum_instwcount(:,2),'-g','LineWidth',1)
plot(sdcsum_instwcount(:,3),'-b','LineWidth',1)
plot(sdcsum_instwcount(:,4),'-k','LineWidth',1)
plot(sdcsum_instwcount(:,1),'.r')
hold on
plot(sdcsum_instwcount(:,2),'.g')
plot(sdcsum_instwcount(:,3),'.b')
plot(sdcsum_instwcount(:,4),'.k')
ylabel('instantaneous updraft count')
%}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% histograms of swath width, depth, str for CI events vs. null:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% % note for Null - they are logged as times of day rather than times before
% % non-CI events, so I will have to pic a semi-educated time window from
% % when CI did or 'should have' happened. Using the histogram of CI times
% % above, it may be worth considering a 1-hr period on each day? e.g.,
% % 1430-1530? :
% 
% %some sample windows. Maybe need to have this vary by case?
% % nullt1400_1500 = [ 9:13 ];
% % nullt1500_1600 = [ 13:17 ];
% nullt1430_1600 = [ 11:17 ];
% 
% ff = figure; 
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% 
% BB = prepost_mesoWwidth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% edges = [0:0.125:5];
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% hold on
% plot(mean(mean( BB(:),'omitnan' )),70 ,'kv','MarkerFaceColor',[0 0.4 0.8],'MarkerSize',15 )
% clear BB
% BB = mesoWwidth_nullmean_ALLCASES(nullt1430_1600,:); 
% histogram(BB(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% view(0,90)
% title('Width of w swath')
% xlabel(' W swath width (km) ')
% ylabel(' Number of CI events ')
% axis([0 edges(end) 0 75])
% plot(mean(mean( BB(:) )),65 ,'kv','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',15 )
% 
% 
% subplot(1,3,2)
% 
% BB = prepost_mesoWstrength_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% edges = [0:0.125:5];
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% hold on
% plot(mean(mean( BB(:),'omitnan' )),70 ,'kv','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',15 )
% clear BB
% BB = mesoWstrength_nullmean_ALLCASES(nullt1430_1600,:); 
% histogram(BB(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% view(0,90)
% title('Magnitude of w in swath')
% xlabel(' W swath magnitude (m/s) ')
% ylabel(' Number of CI events ')
% axis([0 edges(end) 0 75])
% plot(mean(mean( BB(:) )),65 ,'kv','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',15 )
% 
% 
% 
% subplot(1,3,3)
% 
% BB = prepost_mesoWdepth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% edges = [0:0.125:5];
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% hold on
% plot(mean(mean( BB(:),'omitnan' )),70 ,'kv','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',15 )
% clear BB
% BB = mesoWdepth_nullmean_ALLCASES(nullt1430_1600,:); 
% histogram(BB(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% view(0,90)
% title('Depth of w swath')
% xlabel(' W swath depth (km) ')
% ylabel(' Number of CI events ')
% axis([0 3.5 0 75])
% plot(mean(mean( BB(:) )),65 ,'kv','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',15 )
% 
% 
% 
% 
% 
% 
% %%%% ALTERNATIVE NULL SAMPLING (max within time window): 
% 
% nullt1430_1600 = [ 11:17 ];
% 
% ff = figure; 
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% 
% 
% subplot(1,3,1)
% 
% BB = prepost_mesoWwidth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% edges = [0:0.125:5];
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% hold on
% plot(mean(mean( BB(:),'omitnan' )),70 ,'kv','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',15 )
% clear BB
% BB = max(mesoWwidth_nullmean_ALLCASES(nullt1430_1600,:),[], 1)  ; 
% histogram(BB(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% view(0,90)
% title('Width of w swath')
% xlabel(' W swath width (km) ')
% ylabel(' Number of CI events ')
% axis([0 edges(end) 0 75])
% plot(mean(mean( BB(:) )),65 ,'kv','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',15 )
% 
% 
% 
% 
% subplot(1,3,2)
% 
% BB = prepost_mesoWstrength_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% edges = [0:0.125:5];
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% hold on
% plot(mean(mean( BB(:),'omitnan' )),70 ,'kv','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',15 )
% clear BB
% 
% BB = max(mesoWstrength_nullmean_ALLCASES(nullt1430_1600,:),[], 1)  ;  
% histogram(BB(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% view(0,90)
% title('Magnitude of w in swath')
% xlabel(' W swath magnitude (m/s) ')
% ylabel(' Number of CI events ')
% axis([0 edges(end) 0 75])
% plot(mean(mean( BB(:) )),65 ,'kv','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',15 )
% 
% 
% 
% subplot(1,3,3)
% 
% BB = prepost_mesoWdepth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% edges = [0:0.125:5];
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% hold on
% plot(mean(mean( BB(:),'omitnan' )),70 ,'kv','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',15 )
% clear BB
% 
% BB = max(mesoWdepth_nullmean_ALLCASES(nullt1430_1600,:),[], 1)  ; 
% histogram(BB(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% view(0,90)
% title('Depth of w swath')
% xlabel(' W swath depth (km) ')
% ylabel(' Number of CI events ')
% axis([0 3.5 0 75])
% plot(mean(mean( BB(:) )),65 ,'kv','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',15 )
% 
% 
% 
% 
% 
% 
% % one final sampling method: all null points along the SDC in a time
% % window:
% 
% 
% nullt1430_1600 = [ 11:17 ];
% 
% ff = figure; 
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% yyaxis left
% AA = mesoWwidth_nullfullsdc_ALLCASES(:,nullt1430_1600,:) ; 
% edges = [0:0.125:5];
% histogram(AA(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% hold on
% axis([0 edges(end) 0 3000])
% ax = gca
% ax.YColor = [0.7 0.1 0];
% ylabel(' Num NULL samples ')
% 
% yyaxis right
% BB = prepost_mesoWwidth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% axis([0 edges(end) 0 100])
% plot(mean(mean( AA(:),'omitnan' )), 100 ,'ko','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(mean(mean( BB(:),'omitnan' )), 100 ,'ko','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% plot(median( AA(:),'omitnan' ), 100 ,'kd','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(median( BB(:),'omitnan' ), 100 ,'kd','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% ax = gca
% ax.YColor = [0. 0.2 0.6];
% 
% title(' Width of w swath ')
% xlabel(' Width (km) ')
% ylabel(' Num CI samples ')
% 
% 
% 
% subplot(1,3,2)
% 
% yyaxis left
% AA = mesoWstrength_nullfullsdc_ALLCASES(:,nullt1430_1600,:) ; 
% edges = [0:0.125:5];
% histogram(AA(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% hold on
% axis([0 edges(end) 0 2000])
% ax = gca
% ax.YColor = [0.7 0.1 0];
% ylabel(' Num NULL samples ')
% 
% yyaxis right
% BB = prepost_mesoWstrength_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% axis([0 edges(end) 0 60])
% plot(mean(mean( AA(:),'omitnan' )), 60 ,'ko','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(mean(mean( BB(:),'omitnan' )), 60 ,'ko','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% plot(median( AA(:),'omitnan' ), 60 ,'kd','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(median( BB(:),'omitnan' ), 60 ,'kd','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% ax = gca
% ax.YColor = [0. 0.2 0.6];
% 
% title(' Strength of w swath')
% xlabel(' |w| (m/s) ')
% ylabel(' Num CI samples ')
% 
% 
% 
% subplot(1,3,3)
% 
% yyaxis left
% AA = mesoWdepth_nullfullsdc_ALLCASES(:,nullt1430_1600,:) ; 
% edges = [0:0.125:5];
% histogram(AA(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% hold on
% axis([0 edges(end) 0 3000])
% ax = gca
% ax.YColor = [0.7 0.1 0];
% ylabel(' Num NULL samples ')
% 
% yyaxis right
% BB = prepost_mesoWdepth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% axis([0 edges(end) 0 100])
% plot(mean(mean( AA(:),'omitnan' )),100 ,'ko','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(mean(mean( BB(:),'omitnan' )), 100 ,'ko','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% plot(median( AA(:),'omitnan' ), 100 ,'kd','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(median( BB(:),'omitnan' ), 100 ,'kd','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% ax = gca
% ax.YColor = [0.0 0.2 0.6];
% 
% title(' Depth of w swath')
% xlabel(' Depth (km) ')
% ylabel(' Num CI samples ')
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% % one final sampling method: all null points along the SDC in a time
% % window:
% 
% 
% nullt1430_1600 = [ 11:17 ];
% 
% ff = figure; 
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% yyaxis left
% AA = mesoWqvapca_nullfullsdc_ALLCASES(:,nullt1430_1600,:) ; 
% edges = [0:0.0005:.020];
% histogram(AA(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% hold on
% axis([0 edges(end) 0 3000])
% ax = gca
% ax.YColor = [0.7 0.1 0];
% ylabel(' Num NULL samples ')
% 
% yyaxis right
% BB = prepost_mesoWqvapca_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% axis([0 edges(end) 0 100])
% plot(mean(mean( AA(:),'omitnan' )), 100 ,'ko','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(mean(mean( BB(:),'omitnan' )), 100 ,'ko','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% plot(median( AA(:),'omitnan' ), 100 ,'kd','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(median( BB(:),'omitnan' ), 100 ,'kd','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% ax = gca
% ax.YColor = [0. 0.2 0.6];
% 
% title(' Vapor mixing ratio in w swath ')
% xlabel(' Qvapor (kg/kg) ')
% ylabel(' Num CI samples ')
% 
% 
% 
% 
% 
% subplot(1,3,2)
% 
% yyaxis left
% AA = mesoWthetaca_nullfullsdc_ALLCASES(:,nullt1430_1600,:) ; 
% edges = [298:0.5:320];
% histogram(AA(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% hold on
% axis([edges(1) edges(end) 0 3000])
% ax = gca
% ax.YColor = [0.7 0.1 0];
% ylabel(' Num NULL samples ')
% 
% yyaxis right
% BB = prepost_mesoWthetaca_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% axis([edges(1) edges(end) 0 100])
% plot(mean(mean( AA(:),'omitnan' )), 60 ,'ko','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(mean(mean( BB(:),'omitnan' )), 60 ,'ko','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% plot(median( AA(:),'omitnan' ), 60 ,'kd','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(median( BB(:),'omitnan' ), 60 ,'kd','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% ax = gca
% ax.YColor = [0. 0.2 0.6];
% 
% title(' Potential temperature in w swath ')
% xlabel(' Theta (K) ')
% ylabel(' Num CI samples ')
% 
% 
% 
% 
% subplot(1,3,3)
% 
% yyaxis left
% AA = mesoWthetaeca_nullfullsdc_ALLCASES(:,nullt1430_1600,:) ; 
% edges = [310:1:365];
% histogram(AA(:),'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
% hold on
% axis([edges(1) edges(end) 0 2000])
% ax = gca
% ax.YColor = [0.7 0.1 0];
% ylabel(' Num NULL samples ')
% 
% yyaxis right
% BB = prepost_mesoWthetaeca_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% histogram(BB(:),'BinEdges',edges,'FaceColor',[0 0.4 0.8]) %'CDataMode','auto','FaceColor','interp');
% axis([edges(1) edges(end) 0 100])
% plot(mean(mean( AA(:),'omitnan' )), 60 ,'ko','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(mean(mean( BB(:),'omitnan' )), 60 ,'ko','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% plot(median( AA(:),'omitnan' ), 60 ,'kd','MarkerFaceColor',[0.9 0.2 0],'MarkerSize',10 )
% plot(median( BB(:),'omitnan' ), 60 ,'kd','MarkerFaceColor',[0. 0.4 0.8],'MarkerSize',10 )
% ax = gca
% ax.YColor = [0. 0.2 0.6];
% 
% title(' Equiv. potential temperature in w swath ')
% xlabel(' Theta-e (K) ')
% ylabel(' Num CI samples ')



%%%%%% histograms of CI swath properties minus Null swath properties


%%%% in-swath kinematic differences broken across all cases:
tci = 3;     % (5) = CI time;      (1) = CI - 60 min

ff = figure('position',[204,436,1415,585]) ;
subplot(1,3,1)
BB =  prepost_localnull_mesoWwidth_ALLCASES(tci,:,:) ; BB = BB(:); 
AA =  prepost_mesoWwidth_ALLCASES(tci,:,:) ; AA = AA(:);
edges = [-1.05:0.1:1.05];
plot([0 0],[0 100],'k-','LineWidth',3)
hold on
plot([0 0],[0 100],'k-')
histogram(AA-BB,'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
hold on
ax = gca
ax.FontSize = 15
plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[1 0 0],'MarkerSize',15 )
plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[1 0 0],'MarkerSize',15 )
axis([edges(1) edges(end) 0 20])
ylabel(' # cell samples ')
xlabel(' Difference in w-swath width [km] ')

subplot(1,3,2)
% BB =  prepost_localnull_mesoWdepth_ALLCASES(tci,:,:) ; BB = BB(:); 
% AA =  prepost_mesoWdepth_ALLCASES(tci,:,:) ; AA = AA(:);
BB =  prepost_localnull_mesoWtopasl_ALLCASES(tci,:,:) ./ prepost_localnull_mesoWlfcasl_ALLCASES(tci,:,:) ;        BB = BB(:); 
AA =  prepost_mesoWtopasl_ALLCASES(tci,:,:) ./ prepost_mesoWlfcasl_ALLCASES(tci,:,:)   ;       AA = AA(:);
edges = [-0.55:0.05:0.55];
plot([0 0],[0 100],'k-','LineWidth',3)
hold on
plot([0 0],[0 100],'k-')
histogram(AA-BB,'BinEdges',edges,'FaceColor',[0 0.8 0]) %'CDataMode','auto','FaceColor','interp');
hold on
plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[0 0.8 0],'MarkerSize',15 )
plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[0 0.8 0],'MarkerSize',15 )
axis([edges(1) edges(end) 0 50])
ax = gca
ax.FontSize = 15
ylabel(' # cell samples ')
xlabel(' Difference in w-swath depth/LFC [km] ')

title(' Mean of cell portion  *minus*  mean of non-cell portion ')


subplot(1,3,3)
BB =  prepost_localnull_mesoWstrength_ALLCASES(tci,:,:) ; BB = BB(:); 
AA =  prepost_mesoWstrength_ALLCASES(tci,:,:) ; AA = AA(:);
edges = [-1.25:0.1:1.25];
plot([0 0],[0 100],'k-','LineWidth',3)
hold on
plot([0 0],[0 100],'k-')
histogram(AA-BB,'BinEdges',edges,'FaceColor',[0 0 1]) %'CDataMode','auto','FaceColor','interp');
hold on
plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[0 0 1],'MarkerSize',15 )
plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[0 0 1],'MarkerSize',15 )
axis([edges(1) edges(end) 0 20])
ax = gca
ax.FontSize = 15
ylabel(' # cell samples ')
xlabel(' Difference in swath w_m_a_x [m/s] ')
   


% saveas(ff,horzcat(imout,'/Cell-Null_swathhist_t',num2str(tci),'.png'));
% outlab = horzcat(imout,'/Cell-Null_swathhist_t',num2str(tci),'.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);









%%%% in-swath kinematic differences broken down by case:
ff = figure('position',[204,20,1450,1001]) ;
for R = 1:ar
    
    tci = 1;     % (5) = CI time;      (1) = CI - 60 min
    
    %ff = figure('position',[204,436,1415,585]) ;
    
    subplot(ar,3,(R*3)-2)
    BB =  prepost_localnull_mesoWwidth_ALLCASES(tci,:,R) ; BB = BB(:);
    AA =  prepost_mesoWwidth_ALLCASES(tci,:,R) ; AA = AA(:);
    edges = [-1.05:0.1:1.05];
    plot([0 0],[0 100],'k-','LineWidth',3)
    hold on
    plot([0 0],[0 100],'k-')
    histogram(AA-BB,'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
    hold on
    ax = gca
    ax.FontSize = 15
    plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[1 0 0],'MarkerSize',15,'MarkerEdgeColor','w') 
    plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[1 0 0],'MarkerSize',15,'MarkerEdgeColor','w' )
    axis([edges(1) edges(end) 0 8])
    if(R < ar)
        set(gca,'xticklabel',{[]})
    end
    yticks([0:2:8])
    text(-1,6,RUNS(R,1:20))
%     ylabel(' # cell samples ')
%     xlabel(' Difference in w-swath width [km] ')
    if(R==ar)
        xlabel(' Difference in w-swath width [km] ')
    end 

    subplot(ar,3,(R*3)-1)
%     BB =  prepost_localnull_mesoWdepth_ALLCASES(tci,:,R) ; BB = BB(:);
%     AA =  prepost_mesoWdepth_ALLCASES(tci,:,R) ; AA = AA(:);
    BB = prepost_localnull_mesoWtopasl_ALLCASES(tci,:,R) ./ prepost_localnull_mesoWlfcasl_ALLCASES(tci,:,R);        BB = BB(:); 
    AA = prepost_mesoWtopasl_ALLCASES(tci,:,R) ./ prepost_mesoWlfcasl_ALLCASES(tci,:,R);       AA = AA(:);
    edges = [-0.55:0.05:0.55];
    plot([0 0],[0 100],'k-','LineWidth',3)
    hold on
    plot([0 0],[0 100],'k-')
    histogram(AA-BB,'BinEdges',edges,'FaceColor',[0 0.8 0]) %'CDataMode','auto','FaceColor','interp');
    hold on
    plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[0 0.8 0],'MarkerSize',15,'MarkerEdgeColor','w') 
    plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[0 0.8 0],'MarkerSize',15,'MarkerEdgeColor','w' )
    axis([edges(1) edges(end) 0 8])
    ax = gca
    ax.FontSize = 15
    if(R<ar)
        set(gca,'xticklabel',{[]})
    end
    set(gca,'yticklabel',{[]})
%     ylabel(' # cell samples ')
%     xlabel(' Difference in w-swath depth [km] ')
    if(R==ar)
        xlabel(' Difference in w-swath depth [km] ')
    end 

    subplot(ar,3,(R*3)-0)
    BB =  prepost_localnull_mesoWstrength_ALLCASES(tci,:,R) ; BB = BB(:);
    AA =  prepost_mesoWstrength_ALLCASES(tci,:,R) ; AA = AA(:);
    edges = [-1.25:0.1:1.25];
    plot([0 0],[0 100],'k-','LineWidth',3)
    hold on
    plot([0 0],[0 100],'k-')
    histogram(AA-BB,'BinEdges',edges,'FaceColor',[0 0 1]) %'CDataMode','auto','FaceColor','interp');
    hold on
    plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[0 0 1],'MarkerSize',15,'MarkerEdgeColor','w'  )
    plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[0 0 1],'MarkerSize',15,'MarkerEdgeColor','w' )
    axis([edges(1) edges(end) 0 8])
    ax = gca
    ax.FontSize = 15
    if(R<ar)
        set(gca,'xticklabel',{[]})
    end
    set(gca,'yticklabel',{[]})
%     ylabel(' # cell samples ')
    if(R==ar)
        xlabel(' Difference in swath w_m_a_x [m/s] ')
    end 
    %suptitle(' Mean of cell portion  *minus*  mean of non-cell portion ')
    
end

% saveas(ff,horzcat(imout,'/Cell-Null_swathhist_bycase_t',num2str(tci),'.png'));
% outlab = horzcat(imout,'/Cell-Null_swathhist_bycase_t',num2str(tci),'.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


















%%%% in-swath thermo differences across all cases:

tci = 5;

ff = figure('position',[121,405,1340,610]);


subplot(2,3,1)
BB =  prepost_localnull_mesoWqvap_ALLCASES(tci,:,:)*1000 ; BB = BB(:); 
AA =  prepost_mesoWqvap_ALLCASES(tci,:,:)*1000 ; AA = AA(:);
edges = [-1.05:0.1:1.05];
plot([0 0],[0 100],'k-')
hold on
histogram(AA-BB,'BinEdges',edges,'FaceColor',[0.8 0 1]) %'CDataMode','auto','FaceColor','interp');
hold on
%plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[0.8 0 1],'MarkerSize',15 )
plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[0.8 0 1],'MarkerSize',15 )
plot([0 0],[0 100],'k-','LineWidth',3)
axis([edges(1) edges(end) 0 30])
ax=gca;
ax.FontSize = 15;
%title(['Swath water vapor'])
ylabel(' # cell samples ')
xlabel(' Water vapor difference [g/kg] ')



subplot(2,3,2)
BB =  prepost_localnull_mesoWtheta_ALLCASES(tci,:,:) ; BB = BB(:);     %BB =  prepost_localnull_mesoWthetaca_ALLCASES(tci,:,:) ; BB = BB(:); 
AA =  prepost_mesoWtheta_ALLCASES(tci,:,:) ; AA = AA(:);             %AA =  prepost_mesoWthetaca_ALLCASES(tci,:,:) ; AA = AA(:);
edges = [-1.425:0.15:1.425];
plot([0 0],[0 100],'k-','LineWidth',3)
hold on
histogram(AA-BB,'BinEdges',edges,'FaceColor',[0.8 0.5 0]) %'CDataMode','auto','FaceColor','interp');
hold on
%plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[0.8 0.5 0],'MarkerSize',15 )
plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[0.8 0.5 0],'MarkerSize',15 )
plot([0 0],[0 100],'k-')
axis([edges(1) edges(end) 0 30])
ax=gca;
ax.FontSize = 15;
%title(['Swath Potential Temperature'])
ylabel(' # cell samples ')
xlabel(' Potential temperature difference [K] ')

title([' Mean of cell portion  *minus*  mean of non-cell portion'])

%timrel = [-1:0.25:3];


subplot(2,3,3)
BB =  prepost_localnull_mesoWcape_ALLCASES(tci,:,:) ; BB = BB(:); 
AA =  prepost_mesoWcape_ALLCASES(tci,:,:) ; AA = AA(:);
edges = [-500.05:40:500.05];
plot([0 0],[0 500],'k-','LineWidth',3)
hold on
histogram(AA-BB,'BinEdges',edges,'FaceColor',[1 0 0]) %'CDataMode','auto','FaceColor','interp');
hold on
%plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[1 0 0],'MarkerSize',10 )
plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[1 0 0],'MarkerSize',15 )
plot([0 0],[0 500],'k-')
axis([edges(1) edges(end) 0 30])
ax=gca;
ax.FontSize = 15;
%title(['Swath MU CAPE'])
ylabel(' # cell samples ')
xlabel(' MUCAPE difference [J/kg] ')



subplot(2,3,4)
BB =  prepost_localnull_mesoWcin_ALLCASES(tci,:,:) ; BB = BB(:); 
AA =  prepost_mesoWcin_ALLCASES(tci,:,:) ; AA = AA(:);
edges = [-31.25:2.5:31.25];
plot([0 0],[0 100],'k-','LineWidth',3)
hold on
histogram(AA-BB,'BinEdges',edges,'FaceColor',[0 0.8 0]) %'CDataMode','auto','FaceColor','interp');
hold on
%plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[0 0.8 0],'MarkerSize',10 )
plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[0 0.8 0],'MarkerSize',15 )
plot([0 0],[0 100],'k-')
axis([edges(1) edges(end) 0 30])
ax=gca;
ax.FontSize = 15;
%title(['Swath MU CIN'])
ylabel(' Num cell samples ')
xlabel(' MUCIN difference[J/kg] ')


%%%%%%%%%%%%% NOTE: YOU NEED TO SET cell and null swath LFCs to agl or asl after this point
%%%%%%%%%%%%% NOTE: YOU NEED TO SET cell and null swath LFCs to agl or asl after this point
%%%%%%%%%%%%% NOTE: YOU NEED TO SET cell and null swath LFCs to agl or asl after this point


subplot(2,3,5)
BB =  prepost_localnull_mesoWlfcasl_ALLCASES(tci,:,:) ; BB = BB(:); 
AA =  prepost_mesoWlfcasl_ALLCASES(tci,:,:) ; AA = AA(:);
edges = [-1.05:0.1:1.05];
plot([0 0],[0 100],'k-','LineWidth',3)
hold on
histogram(AA-BB,'BinEdges',edges,'FaceColor',[0 0 1]) %'CDataMode','auto','FaceColor','interp');
hold on
%plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[0 0 1],'MarkerSize',10 )
plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[0 0 1],'MarkerSize',15 )
plot([0 0],[0 100],'k-')
ax=gca;
ax.FontSize = 15;
axis([edges(1) edges(end) 0 30])
%title(['Swath LFC'])
ylabel(' Num cell samples ')
xlabel(' MULFC(asl) difference [km]')
   

% subplot(2,3,6)
% BB =  prepost_localnull_mesoWlfc_ALLCASES(tci,:,:) - prepost_localnull_mesoWtopasl_ALLCASES(tci,:,:)           ; BB = BB(:); 
% AA =  prepost_mesoWlfc_ALLCASES(tci,:,:) - prepost_mesoWtopasl_ALLCASES(tci,:,:)                     ; AA = AA(:);
% edges = [-1.575:0.15:1.575];
% plot([0 0],[0 100],'k-','LineWidth',3)
% hold on
% histogram(AA-BB,'BinEdges',edges,'FaceColor',[1 1 0]) %'CDataMode','auto','FaceColor','interp');
% hold on
% %plot(mean(mean( AA-BB,'omitnan' )), 0 ,'ko','MarkerFaceColor',[1 1 0],'MarkerSize',10 )
% plot(median( AA-BB,'omitnan' ), 0 ,'kd','MarkerFaceColor',[1 1 0],'MarkerSize',15 )
% plot([0 0],[0 100],'k-')
% ax=gca;
% ax.FontSize = 15;
% axis([edges(1) edges(end) 0 30])
% %title(['Swath W-top/LFC'])
% ylabel(' Num cell samples ')
% xlabel(' MULFC minus w-swath top difference [km] ')


timrel = [-1:0.25:3];


% saveas(ff,horzcat(imout,'/Cell-Null_swathTHERMOhist_t',num2str(tci),'.png'));
% outlab = horzcat(imout,'/Cell-Null_swathTHERMOhist_t',num2str(tci),'.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);





% % side test for fft/ifft filtering, which didn't go anywhere yet
% xdxd = [1:0.05:10];
% test0 = sin(xdxd) .* cos(xdxd/0.1);
% figure; plot(test0) 
% 
% fft0 = fft(test0) ;
% P2 = abs(fft0/length(xdxd));
% P1 = P2(1 : length(xdxd)/2 -0.5);
% figure;
% plot(P1)










%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% compare meso w swath properties to cell properties @ CI TIME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% ctop = 10;
% 
% dualpol_colmap
% 
% 
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%  swath width vs ... 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% 
% 
% % ... vs. cell core area
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% 
% AA = cellCI_corearea_ALLCASES;
% BB = prepost_mesoWwidth_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath width (km) ')
% axis([0 70 0 3])
% 
% 
% 
% subplot(1,3,2)
% AA = cellCI_corearea_ALLCASES;
% BB = prepost_mesoWwidth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = [];  
% histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath width (km) ')
% axis([0 70 0 3])
% 
% 
% subplot(1,3,3)
% AA = cellCI_corearea_ALLCASES;
% BB = prepost_mesoWwidth_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath width (km) ')
% axis([0 70 0 3])
% 
% suptitle([' Orographic updraft swath width (cross-terrain direction) vs max cell core area (during cell CI period) '])
% 





%%%% ... vs.  cell depth
% 
% dualpol_colmap
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellCI_maxETH10_ALLCASES(:);
% BB = prepost_mesoWwidth_ALLCASES(5,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath width (km) ')
% axis([2 16 0 3])
% 
% 
% subplot(1,3,2)
% AA = cellCI_maxETH10_ALLCASES(:);
% BB = prepost_mesoWwidth_ALLCASES(3,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath width (km) ')
% axis([2 16 0 3])
% 
% 
% subplot(1,3,3)
% AA = cellCI_maxETH10_ALLCASES(:);
% BB = prepost_mesoWwidth_ALLCASES(1,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath width (km) ')
% axis([2 16 0 3])
%
%suptitle([' Orographic swath width (cross-terrain direction) vs max cell depth (during cell CI period) '])




% %%%% ... vs. cell strength
% 
% dualpol_colmap
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellCI_maxdbz_ALLCASES(:); 
% BB = prepost_mesoWwidth_ALLCASES(5,:)'  ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[2.5,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath width (km) ')
% axis([30 70 0 3])
% 
% subplot(1,3,2)
% AA = cellCI_maxdbz_ALLCASES(:); 
% BB = prepost_mesoWwidth_ALLCASES(3,:)'  ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[2.5,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath width (km) ')
% axis([30 70 0 3])
% 
% subplot(1,3,3)
% AA = cellCI_maxdbz_ALLCASES(:); 
% BB = prepost_mesoWwidth_ALLCASES(1,:)'  ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[2.5,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath width (km) ')
% axis([30 70 0 3])
% 
% suptitle([' Orographic swath width (cross-terrain direction) vs max cell reflectivity (during cell CI period) '])






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%% swath depth       vs...
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%% ... vs.   cell area

% 
% dualpol_colmap
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% % set(gca,'xtick',[]); set(gca,'ytick',[])
% % ax1 = axes; ax2 = axes; linkaxes([ax1,ax2],'xy')
% % dirt = polyshape([-80 -80 80 80],[80 -80 -80 80]); plot(ax1,dirt,'FaceColor',[0.4 0.4 1])
% 
% AA = cellCI_corearea_ALLCASES;
% %BB = prepost_mesoWdepth_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% BB = prepost_mesoWtopasl_ALLCASES(5,:,:)  ./ prepost_mesoWlfcasl_ALLCASES(5,:,:);         BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.025],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% %histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% % cb = colorbar(ax2)
% % agr=get(cb); %gets properties of colorbar
% % aa = agr.Position; %gets the positon and size of the color bar
% % set(cb,'Position',[aa(1)+0.05 aa(2) aa(3) aa(4)])
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath depth (km) ')
% % set(ax2,'Color','None')       %p
% % set(ax2, 'visible', 'off');   %p
% axis([0 70 0.5 1])
% 
% 
% subplot(1,3,2)
% % set(gca,'xtick',[]); set(gca,'ytick',[])
% % ax1 = axes; ax2 = axes; linkaxes([ax1,ax2],'xy')
% % dirt = polyshape([-80 -80 80 80],[80 -80 -80 80]); plot(ax1,dirt,'FaceColor',[0.4 0.4 1])
% AA = cellCI_corearea_ALLCASES;
% %BB = prepost_mesoWdepth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% BB = prepost_mesoWtopasl_ALLCASES(3,:,:)  ./ prepost_mesoWlfcasl_ALLCASES(3,:,:);         BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.025],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% %histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% % cb = colorbar(ax2)
% % agr=get(cb); %gets properties of colorbar
% % aa = agr.Position; %gets the positon and size of the color bar
% % set(cb,'Position',[aa(1)+0.05 aa(2) aa(3) aa(4)])
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath depth (km) ')
% % set(ax2,'Color','None')       %p
% % set(ax2, 'visible', 'off');   %p
% axis([0 70 0.5 1])
% 
% 
% subplot(1,3,3)
% % set(gca,'xtick',[]); set(gca,'ytick',[])
% % ax1 = axes; ax2 = axes; linkaxes([ax1,ax2],'xy')
% % dirt = polyshape([-80 -80 80 80],[80 -80 -80 80]); plot(ax1,dirt,'FaceColor',[0.4 0.4 1])
% AA = cellCI_corearea_ALLCASES;
% %BB = prepost_mesoWdepth_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% BB = prepost_mesoWtopasl_ALLCASES(1,:,:)  ./ prepost_mesoWlfcasl_ALLCASES(1,:,:);         BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.025],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% %histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% % cb = colorbar(ax2)
% % agr=get(cb); %gets properties of colorbar
% % aa = agr.Position; %gets the positon and size of the color bar
% % set(cb,'Position',[aa(1)+0.05 aa(2) aa(3) aa(4)])
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath depth (km) ')
% % set(ax2,'Color','None')       %p
% % set(ax2, 'visible', 'off');   %p
% axis([0 70 0.5 1])
% 
% suptitle([' Orographic swath depth (cross-terrain direction) vs max cell core area (during cell CI period) '])
% 
% 
% 
% 
% %%%% ... vs. cell depth 
% 
% 
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellCI_maxETH10_ALLCASES(:)';
% %BB = prepost_mesoWdepth_ALLCASES(5,:)' ;
% BB = prepost_mesoWtopasl_ALLCASES(5,:,:)  ./ prepost_mesoWlfcasl_ALLCASES(5,:,:);         BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% %histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% histogram2(AA(:),BB(:),'BinWidth',[1,0.02],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath depth (km) ')
% axis([2 15 0.5 1])
% 
% subplot(1,3,2)
% AA = cellCI_maxETH10_ALLCASES(:)';
% %BB = prepost_mesoWdepth_ALLCASES(3,:)' ;
% BB = prepost_mesoWtopasl_ALLCASES(3,:,:)  ./ prepost_mesoWlfcasl_ALLCASES(3,:,:);         BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% %histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% histogram2(AA(:),BB(:),'BinWidth',[1,0.02],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath depth (km) ')
% axis([2 15 0.5 1])
% 
% subplot(1,3,3)
% AA = cellCI_maxETH10_ALLCASES(:)';
% %BB = prepost_mesoWdepth_ALLCASES(1,:)' ;
% BB = prepost_mesoWtopasl_ALLCASES(1,:,:)  ./ prepost_mesoWlfcasl_ALLCASES(1,:,:);         BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% %histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% histogram2(AA(:),BB(:),'BinWidth',[1,0.02],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath depth (km) ')
% axis([2 15 0.5 1])
% 
% suptitle([' Orographic swath depth vs max cell depth (during cell CI period) '])
% 
% 
% 
% 
% %%%% ... vs. cell strength
% 
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellCI_maxdbz_ALLCASES(:);
% BB = prepost_mesoWtopasl_ALLCASES(5,:,:)  ./ prepost_mesoWlfcasl_ALLCASES(5,:,:);         BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% %histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% histogram2(AA(:),BB(:),'BinWidth',[1,0.02],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath depth (km) ')
% axis([30 70 0.5 1])
% 
% subplot(1,3,2)
% AA = cellCI_maxdbz_ALLCASES(:);
% BB = prepost_mesoWtopasl_ALLCASES(3,:,:)  ./ prepost_mesoWlfcasl_ALLCASES(3,:,:);         BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% %histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% histogram2(AA(:),BB(:),'BinWidth',[1,0.02],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath depth (km) ')
% axis([30 70 0.5 1])
% 
% subplot(1,3,3)
% AA = cellCI_maxdbz_ALLCASES(:);
% BB = prepost_mesoWtopasl_ALLCASES(1,:,:)  ./ prepost_mesoWlfcasl_ALLCASES(1,:,:);         BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% %histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% histogram2(AA(:),BB(:),'BinWidth',[1,0.02],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath depth (km) ')
% axis([30 70 0.5 1])
% 
% suptitle([' Orographic swath depth vs max cell reflectivity (during cell CI period) '])
% 
% 
% 
% 
% 
% 
% 
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%% swath strength     vs...         
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% % .... vs. cell area
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellCI_corearea_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath w strength (m/s) ')
% axis([0 70 1 5])
% 
% 
% subplot(1,3,2)
% AA = cellCI_corearea_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI  - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([0 70 1 5])
% 
% 
% subplot(1,3,3)
% AA = cellCI_corearea_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([0 70 1 5])
% 
% suptitle([' Orographic swath w strength vs max cell core area (during cell CI period) '])
% 
% 
% 
% % .... vs. cell depth
% 
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellCI_maxETH10_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[1,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([2 15 1 5])
% 
% subplot(1,3,2)
% AA = cellCI_maxETH10_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[1,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([2 15 1 5])
% 
% subplot(1,3,3)
% AA = cellCI_maxETH10_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[1,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([2 15 1 5])
% 
% suptitle([' Orographic swath updraft strength vs max cell depth (during cell CI period) '])
% 
% 
% 
% 
% %%%% ... vs. cell strength
% 
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellCI_maxdbz_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[2.55,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([30 70 1 5])
% 
% subplot(1,3,2)
% AA = cellCI_maxdbz_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[2.55,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([30 70 1 5])
% 
% subplot(1,3,3)
% AA = cellCI_maxdbz_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[2.55,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([30 70 1 5])
% 
% suptitle([' Orographic swath updraft strength vs max cell reflectivity (during cell CI period)             '])











% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % compare meso w swath properties to cell properties DURING FULL CELL LIFETIME
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% ctop = 10;
% 
% dualpol_colmap
% 
% 
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%  swath width vs ...
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% 
% % ... vs. & cell core area
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_corearea_ALLCASES;
% BB = prepost_mesoWwidth_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath width (km) ')
% axis([0 70 0 3])
% 
% subplot(1,3,2)
% AA = cellfull_corearea_ALLCASES;
% BB = prepost_mesoWwidth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath width (km) ')
% axis([0 70 0 3])
% 
% subplot(1,3,3)
% AA = cellfull_corearea_ALLCASES;
% BB = prepost_mesoWwidth_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath width (km) ')
% axis([0 70 0 3])
% 
% suptitle([' Orographic updraft swath width (cross-terrain direction) vs max cell core area (during full cell lifetime)        '])
% 
% 
% 
% 
% %%%% ... vs. cell depth
% 
% dualpol_colmap
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_maxETH10_ALLCASES(:);
% BB = prepost_mesoWwidth_ALLCASES(5,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath width (km) ')
% axis([2 16 0 3])
% 
% subplot(1,3,2)
% AA = cellfull_maxETH10_ALLCASES(:);
% BB = prepost_mesoWwidth_ALLCASES(3,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath width (km) ')
% axis([2 16 0 3])
% 
% subplot(1,3,3)
% AA = cellfull_maxETH10_ALLCASES(:);
% BB = prepost_mesoWwidth_ALLCASES(1,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath width (km) ')
% axis([2 16 0 3])
% 
% suptitle([' Orographic swath width (cross-terrain direction) vs max cell depth (during full cell lifetime)        '])
% 
% 
% 
% 
% 
% %%%% ... vs.  cell strength
% dualpol_colmap
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_maxdbz_ALLCASES(:); 
% BB = prepost_mesoWwidth_ALLCASES(5,:)'  ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[2.5,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath width (km) ')
% axis([30 70 0 3])
% 
% subplot(1,3,2)
% AA = cellfull_maxdbz_ALLCASES(:); 
% BB = prepost_mesoWwidth_ALLCASES(3,:)'  ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[2.5,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath width (km) ')
% axis([30 70 0 3])
% 
% subplot(1,3,3)
% AA = cellfull_maxdbz_ALLCASES(:); 
% BB = prepost_mesoWwidth_ALLCASES(1,:)'  ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[2.5,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath width (km) ')
% axis([30 70 0 3])
% 
% suptitle([' Orographic swath width (cross-terrain direction) vs max cell reflectivity (during full cell lifetime)             '])
% 
% 
% 
% 
% 
% % ... vs. cell duration:
% 
% 
% dualpol_colmap
% 
% %%%% ...vs . cell duration
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_duration_ALLCASES(:) * 15;
% BB = prepost_mesoWwidth_ALLCASES(5,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[15,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(peppermint2)
% caxis([0 ctop+5])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' duration (min) ')
% ylabel(' Swath width (km) ')
% axis([0 180 0 3])
% 
% subplot(1,3,2)
% AA = cellfull_duration_ALLCASES(:)* 15;
% BB = prepost_mesoWwidth_ALLCASES(3,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[15,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(peppermint2)
% caxis([0 ctop+5])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' duration (min) ')
% ylabel(' Swath width (km) ')
% axis([0 180 0 3])
% 
% subplot(1,3,3)
% AA = cellfull_duration_ALLCASES(:)* 15;
% BB = prepost_mesoWwidth_ALLCASES(1,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[15,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(peppermint2)
% caxis([0 ctop+5])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' duration (min) ')
% ylabel(' Swath width (km) ')
% axis([0 180 0 3])
% 
% suptitle([' Orographic swath width vs cell duration        '])
% 
% 
% 
% 
% 
% 
% 
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%    swath depth        
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% 
% % ... vs. cell area
% dualpol_colmap
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% % set(gca,'xtick',[]); set(gca,'ytick',[])
% % ax1 = axes; ax2 = axes; linkaxes([ax1,ax2],'xy')
% % dirt = polyshape([-80 -80 80 80],[80 -80 -80 80]); plot(ax1,dirt,'FaceColor',[0.4 0.4 1])
% AA = cellfull_corearea_ALLCASES;
% BB = prepost_mesoWdepth_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% % cb = colorbar(ax2)
% % agr=get(cb); %gets properties of colorbar
% % aa = agr.Position; %gets the positon and size of the color bar
% % set(cb,'Position',[aa(1)+0.05 aa(2) aa(3) aa(4)])
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath depth (km) ')
% % set(ax2,'Color','None')       %p
% % set(ax2, 'visible', 'off');   %p
% axis([0 70 0 3])
% 
% 
% subplot(1,3,2)
% % set(gca,'xtick',[]); set(gca,'ytick',[])
% % ax1 = axes; ax2 = axes; linkaxes([ax1,ax2],'xy')
% % dirt = polyshape([-80 -80 80 80],[80 -80 -80 80]); plot(ax1,dirt,'FaceColor',[0.4 0.4 1])
% AA = cellfull_corearea_ALLCASES;
% BB = prepost_mesoWdepth_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% % cb = colorbar(ax2)
% % agr=get(cb); %gets properties of colorbar
% % aa = agr.Position; %gets the positon and size of the color bar
% % set(cb,'Position',[aa(1)+0.05 aa(2) aa(3) aa(4)])
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath depth (km) ')
% % set(ax2,'Color','None')       %p
% % set(ax2, 'visible', 'off');   %p
% axis([0 70 0 3])
% 
% subplot(1,3,3)
% % set(gca,'xtick',[]); set(gca,'ytick',[])
% % ax1 = axes; ax2 = axes; linkaxes([ax1,ax2],'xy')
% % dirt = polyshape([-80 -80 80 80],[80 -80 -80 80]); plot(ax1,dirt,'FaceColor',[0.4 0.4 1])
% AA = cellfull_corearea_ALLCASES;
% BB = prepost_mesoWdepth_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.125],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% % cb = colorbar(ax2)
% % agr=get(cb); %gets properties of colorbar
% % aa = agr.Position; %gets the positon and size of the color bar
% % set(cb,'Position',[aa(1)+0.05 aa(2) aa(3) aa(4)])
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath depth (km) ')
% % set(ax2,'Color','None')       %p
% % set(ax2, 'visible', 'off');   %p
% axis([0 70 0 3])
% 
% suptitle([' Orographic swath depth (cross-terrain direction) vs max cell core area (during full cell lifetime)        '])
% 
% 
% 
% 
% %%%% ... vs. cell depth 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_maxETH10_ALLCASES(:);
% BB = prepost_mesoWdepth_ALLCASES(5,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath depth (km) ')
% axis([2 16 0 3])
% 
% subplot(1,3,2)
% AA = cellfull_maxETH10_ALLCASES(:);
% BB = prepost_mesoWdepth_ALLCASES(3,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath depth (km) ')
% axis([2 16 0 3])
% 
% subplot(1,3,3)
% AA = cellfull_maxETH10_ALLCASES(:);
% BB = prepost_mesoWdepth_ALLCASES(1,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[1,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath depth (km) ')
% axis([2 16 0 3])
% 
% suptitle([' Orographic swath depth vs max cell depth (during full cell lifetime)        '])
% 
% 
% 
% 
% %%%% ...vs . cell strength
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_maxdbz_ALLCASES(:);
% BB = prepost_mesoWdepth_ALLCASES(5,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[2.5,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath depth (km) ')
% axis([30 70 0 3])
% 
% subplot(1,3,2)
% AA = cellfull_maxdbz_ALLCASES(:);
% BB = prepost_mesoWdepth_ALLCASES(3,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[2.5,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath depth (km) ')
% axis([30 70 0 3])
% 
% subplot(1,3,3)
% AA = cellfull_maxdbz_ALLCASES(:);
% BB = prepost_mesoWdepth_ALLCASES(1,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[2.5,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath depth (km) ')
% axis([30 70 0 3])
% 
% suptitle([' Orographic swath depth vs max cell reflectivity (during full cell lifetime)        '])
% 
% 
% 
% 
% % ... vs. cell duration:
% 
% 
% dualpol_colmap
% 
% %%%% ...vs . cell duration
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_duration_ALLCASES(:) * 15;
% BB = prepost_mesoWdepth_ALLCASES(5,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[15,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(peppermint2)
% caxis([0 ctop+5])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' duration (min) ')
% ylabel(' Swath depth (km) ')
% axis([0 180 0 3])
% 
% subplot(1,3,2)
% AA = cellfull_duration_ALLCASES(:)* 15;
% BB = prepost_mesoWdepth_ALLCASES(3,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[15,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(peppermint2)
% caxis([0 ctop+5])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' duration (min) ')
% ylabel(' Swath depth (km) ')
% axis([0 180 0 3])
% 
% subplot(1,3,3)
% AA = cellfull_duration_ALLCASES(:)* 15;
% BB = prepost_mesoWdepth_ALLCASES(1,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[15,0.175],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(peppermint2)
% caxis([0 ctop+5])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' duration (min) ')
% ylabel(' Swath depth (km) ')
% axis([0 180 0 3])
% 
% suptitle([' Orographic swath depth vs cell duration        '])
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%% swath strength  vs...         
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% % .... vs. cell area
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_corearea_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath w strength (m/s) ')
% axis([0 70 1 5])
% 
% subplot(1,3,2)
% AA = cellfull_corearea_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([0 70 1 5])
% 
% subplot(1,3,3)
% AA = cellfull_corearea_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[5,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(flipud(creamsicle2))
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max core area - km^2 ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([0 70 1 5])
% 
% suptitle([' Orographic swath w strength vs max cell core area (during full cell lifetime)        '])
% 
% 
% 
% % .... vs. cell depth
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_maxETH10_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[1,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([2 16 1 5])
% 
% subplot(1,3,2)
% AA = cellfull_maxETH10_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[1,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([2 16 1 5])
% 
% subplot(1,3,3)
% AA = cellfull_maxETH10_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[1,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(greeny2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max ETH10 - km ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([2 16 1 5])
% 
% suptitle([' Orographic swath updraft strength vs max cell depth (during full cell lifetime)       '])
% 
% 
% 
% %%%% ... vs. cell strength
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_maxdbz_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(5,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[2.55,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([30 70 1 5])
% 
% subplot(1,3,2)
% AA = cellfull_maxdbz_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(3,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[2.55,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([30 70 1 5])
% 
% subplot(1,3,3)
% AA = cellfull_maxdbz_ALLCASES;
% BB = prepost_mesoWstrength_ALLCASES(1,:,:); BB = permute(BB,[2 3 1]);
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA(:),BB(:),'BinWidth',[2.55,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(purpley2)
% caxis([0 ctop])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' max refl - dBZ ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([30 70 1 5])
% 
% suptitle([' Orographic swath updraft strength vs max cell reflectivity (during full cell lifetime)             '])
% 
% 
% 
% 
% 
% 
% 
% 
% 
% 
% % ... vs. cell duration:
% 
% 
% dualpol_colmap
% 
% 
% ff = figure  
% ff.Position = [166.9156895252448,76.10000000000002,1495.0743029389615,415.6500000000002];
% 
% subplot(1,3,1)
% AA = cellfull_duration_ALLCASES(:) * 15;
% BB = prepost_mesoWstrength_ALLCASES(5,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[15,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(peppermint2)
% caxis([0 ctop+5])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' duration (min) ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([0 180 1 5])
% 
% subplot(1,3,2)
% AA = cellfull_duration_ALLCASES(:)* 15;
% BB = prepost_mesoWstrength_ALLCASES(3,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[15,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(peppermint2)
% caxis([0 ctop+5])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI -30 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' duration (min) ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([0 180 1 5])
% 
% 
% subplot(1,3,3)
% AA = cellfull_duration_ALLCASES(:)* 15;
% BB = prepost_mesoWstrength_ALLCASES(1,:)' ;
% AA(AA==0) = NaN; BB(BB==0) = NaN;   AA(isnan(BB)) = NaN;  BB(isnan(AA)) = NaN;    AA(isnan(AA)) = []; BB(isnan(BB)) = []; 
% histogram2(AA,BB,'BinWidth',[15,0.25],'FaceColor','flat', 'LineStyle','none') %'CDataMode','auto','FaceColor','interp');
% colormap(peppermint2)
% caxis([0 ctop+5])
% colorbar
% view(0,90)
% ccr = corrcoef(AA,BB); ccr = ccr(2);
% title('Swath @ CI - 60 min') 
% subtitle( ['N = ', num2str(length(AA)) ,' ccr = ', num2str(ccr) ] )
% xlabel(' duration (min) ')
% ylabel(' Swath w magnitude (m/s) ')
% axis([0 180 1 5])
% 
% 
% suptitle([' Orographic swath strength vs cell duration        '])






%{

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
% %  Correlate swath & cell metrics  PER CASE:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% % swath width vs cell stuff:
% CORCOEFs = zeros(3,3,ar,3);    % intended dimenions: (cell metric [area,dep,str] , swath metric [wid,dep,str] , Case,  T_CIrel[-60,-30,0]   )
% RMSEs = zeros(3,3,ar,3); 

f4 = figure('position',[744,571,1066,478]);
hold on

tci = 5

var1 = 'prepost_mesoWwidth_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
[ corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(1,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end
legend([RUNS(:,:)])
legend('AutoUpdate','off')


var1 = 'prepost_mesoWwidth_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(2,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'prepost_mesoWwidth_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(3,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end


% swath depth vs cell stuff"
var1 = 'prepost_mesoWtopasl_ALLCASES ./ prepost_mesoWlfcasl_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
%var1 = 'prepost_mesoWdepth_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(4,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'prepost_mesoWtopasl_ALLCASES ./ prepost_mesoWlfcasl_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
%var1 = 'prepost_mesoWdepth_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(5,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'prepost_mesoWtopasl_ALLCASES ./ prepost_mesoWlfcasl_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
%var1 = 'prepost_mesoWdepth_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(6,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end



% swath strength vs cell stuff:
var1 = 'prepost_mesoWstrength_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(7,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'prepost_mesoWstrength_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(8,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'prepost_mesoWstrength_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(9,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end


%legend('AutoUpdate','off')
% legend([RUNS(:,:)])
% legend(labels,'AutoUpdate','off')
plot([0, 10],[0.33, 0.33],'k:')
plot([0 ,10],[0.66, 0.66],'k--')
plot([0 ,10],[-0.33,-0.33],'k:')
plot([0 ,10],[-0.66,-0.66],'k--')
plot([0 ,10],[0 0],'k-','LineWidth',3)
axis([0.5 9.5 -1.0 1.0 ])

title(['Correlation (simple lin. regr.) by case'])
ylabel('Correlation coeff.')
xlabel('vs.    orographic swath width                                 |                              vs.   orographic swath depth/lfc                                         |                                     vs.   orographic swath updraft')
      
xticklabels({'Cell area';'Cell depth';'Cell refl';'Cell area';'Cell depth';'Cell refl';'Cell area';'Cell depth';'Cell refl'})


saveas(f4,horzcat(imout,'/Cell_swathtci',num2str(tci),'_correlations',num2str(r),'.png'));
outlab = horzcat(imout,'/Cell_swathtci',num2str(tci),'_correlations',num2str(r),'.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
% %  Correlate CI-swath distance & cell metrics  PER CASE:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% % swath width vs cell stuff:
% CORCOEFs = zeros(3,3,ar,3);    % intended dimenions: (cell metric [area,dep,str] , swath metric [wid,dep,str] , Case,  T_CIrel[-60,-30,0]   )
% RMSEs = zeros(3,3,ar,3); 

f4 = figure('position',[992,240,569,490]);
hold on

tci = 1

var1 = 'dist_cell_and_swath';  var2 = 'cellCI_corearea_ALLCASES';
[ corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(1,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end
legend([RUNS(:,:)])
legend('AutoUpdate','off')

var1 = 'dist_cell_and_swath';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(2,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'dist_cell_and_swath';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(3,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

%legend('AutoUpdate','off')
% legend([RUNS(:,:)])
% legend(labels,'AutoUpdate','off')
plot([0, 10],[0.33, 0.33],'k:')
plot([0 ,10],[0.66, 0.66],'k--')
plot([0 ,10],[-0.33,-0.33],'k:')
plot([0 ,10],[-0.66,-0.66],'k--')
plot([0 ,10],[0 0],'k-','LineWidth',3)
axis([0.5 3.5 -1.0 1.0 ])

title(['Correlation (simple lin. regr.) by case'])
ylabel('Correlation coeff.')
%xlabel('vs.    orographic swath width                                 |                                 vs.   orographic swath depth                                         |                                     vs.   orographic swath updraft')
xticks([1:1:3]) 
xticklabels({'Cell area';'Cell depth';'Cell refl'})




saveas(f4,horzcat(imout,'/Cell_swathtci',num2str(tci),'_dist_correlations',num2str(r),'.png'));
outlab = horzcat(imout,'/Cell_swathtci',num2str(tci),'_dist_correlations',num2str(r),'.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%}





% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Theil-Sen, RANSAC, and Huber
% % %  Correlate swath & cell metrics  PER CASE:
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% 
% % % swath width vs cell stuff:
% % CORCOEFs = zeros(3,3,ar,3);    % intended dimenions: (cell metric [area,dep,str] , swath metric [wid,dep,str] , Case,  T_CIrel[-60,-30,0]   )
% % RMSEs = zeros(3,3,ar,3); 
% tci = 5;
% f4 = figure;
% hold on
% 
% var1 = 'prepost_mesoWwidth_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
% [ corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% keeps = [];
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         keeps = vertcat(keeps,r);
%         plot(1,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% legend([RUNS(keeps,:)])
% legend('AutoUpdate','off')
% %
% 
% 
% var1 = 'prepost_mesoWwidth_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
% clear corcoefs rmses
% [corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         plot(2,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% var1 = 'prepost_mesoWwidth_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
% clear corcoefs rmses
% [corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         plot(3,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% % swath depth vs cell stuff"
% var1 = 'prepost_mesoWdepth_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
% clear corcoefs rmses
% [corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         plot(4,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% var1 = 'prepost_mesoWdepth_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
% clear corcoefs rmses
% [corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         plot(5,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% var1 = 'prepost_mesoWdepth_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
% clear corcoefs rmses
% [corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         plot(6,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% 
% 
% % swath strength vs cell stuff:
% var1 = 'prepost_mesoWstrength_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
% [corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         plot(7,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% var1 = 'prepost_mesoWstrength_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
% clear corcoefs rmses
% [corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         plot(8,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% var1 = 'prepost_mesoWstrength_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
% clear corcoefs rmses
% [corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         plot(9,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% % 
% plot([0, 10],[0.33, 0.33],'k:')
% plot([0 ,10],[0.66, 0.66],'k--')
% plot([0 ,10],[-0.33,-0.33],'k:')
% plot([0 ,10],[-0.66,-0.66],'k--')
% plot([0 ,10],[0 0],'k-','LineWidth',3)
% axis([0.5 9.5 -1.0 1.0 ])
% 
% title(['Correlation (simple lin. regr.) by case @ CI ', num2str(timrel(tci))  ,' hrs'])
% ylabel('Correlation coeff.')
% xlabel('vs.    orographic swath width                                 |                                 vs.   orographic swath depth                                         |                                     vs.   orographic swath updraft')
% 
% yticks([-1,-0.66,-0.33,0,0.33,0.66,1])
% xticklabels({'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl'})





%{


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Theil-Sen, RANSAC, and Huber
% %  Correlate swath & cell metrics  PER CASE:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% % swath width vs cell stuff:
% CORCOEFs = zeros(3,3,ar,3);    % intended dimenions: (cell metric [area,dep,str] , swath metric [wid,dep,str] , Case,  T_CIrel[-60,-30,0]   )
% RMSEs = zeros(3,3,ar,3); 
tci = 3;   % I have confirmed that 

f4 = figure('position',[187,604,1061,403]);
hold on

%tci applied to var1, var2 assumed to be cell property @ CI period

var1 = 'preCIandCI_rh_acbl_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
[ corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
keeps = [];
for r = 1:ar
    if(isnan(corcoefs(r))==0)
        keeps = vertcat(keeps,r);
        plot(1,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
    end
end

legend('AutoUpdate','off')
legend([RUNS(keeps,:)])

var1 = 'preCIandCI_rh_acbl_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    if(isnan(corcoefs(r))==0)
        plot(2,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
    end
end

var1 = 'preCIandCI_rh_acbl_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    if(isnan(corcoefs(r))==0)
        plot(3,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
    end
end


preCIandCI_ABSucrel_acbl_ALLCASES = abs(preCIandCI_ucrel_acbl_ALLCASES);

var1 = 'preCIandCI_ABSucrel_acbl_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
%var1 = 'preCIandCI_ucrel_acbl_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
[ corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    if(isnan(corcoefs(r))==0)
        plot(4,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
    end
end

var1 = 'preCIandCI_ABSucrel_acbl_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
%var1 = 'preCIandCI_ucrel_acbl_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    if(isnan(corcoefs(r))==0)
        plot(5,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
    end
end

var1 = 'preCIandCI_ABSucrel_acbl_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
%var1 = 'preCIandCI_ucrel_acbl_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    if(isnan(corcoefs(r))==0)
        plot(6,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
    end
end


% legend(labels,'AutoUpdate','off')
plot([0, 10],[0.33, 0.33],'k:')
plot([0 ,10],[0.66, 0.66],'k--')
plot([0 ,10],[-0.33,-0.33],'k:')
plot([0 ,10],[-0.66,-0.66],'k--')
plot([0 ,10],[0 0],'k-','LineWidth',3)
axis([0.5 6.5 -1.0 1.0 ])

title(['Correlation (simple lin. regr.) by case.  @ CI ', num2str(timrel(tci))  ,' hrs'])
ylabel('Correlation coeff.')
xlabel('         vs.    near-cloud ACBL RH                                                        |                                 vs.   near-cloud ACBL cloud-rel |U wind|                     ')
      
yticks([-1, -0.66, -0.33, 0, 0.33, 0.66, 1])
xticklabels( {'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl'} )


saveas(f4,horzcat(imout,'/Cell_nearcellenv_tci',num2str(tci),'_correlations',num2str(r),'.png'));
outlab = horzcat(imout,'/Cell_nearcellenv_tci',num2str(tci),'_correlations',num2str(r),'.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%}





% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Theil-Sen, RANSAC, and Huber
% % %  Correlate swath & cell metrics  PER CASE:
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% 
% % % swath width vs cell stuff:
% % CORCOEFs = zeros(3,3,ar,3);    % intended dimenions: (cell metric [area,dep,str] , swath metric [wid,dep,str] , Case,  T_CIrel[-60,-30,0]   )
% % RMSEs = zeros(3,3,ar,3); 
% tci = 5;   % I have confirmed that 
% 
% f4 = figure;
% hold on
% 
% var1 = 'preCIandCI_rh_acbl_ALLCASES';  var2 = 'preCIandCI_ucrel_acbl_ALLCASES';
% [ corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% keeps = [];
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         keeps = vertcat(keeps,r);
%         plot(1,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% var1 = 'preCIandCI_rh_acbl_ALLCASES';  var2 = 'preCIandCI_ucrel_acbl_ALLCASES';
% clear corcoefs rmses
% [corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
% for r = 1:ar
%     if(isnan(corcoefs(r))==0)
%         plot(2,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
%     end
% end
% 
% % legend(labels,'AutoUpdate','off')
% % %legend([RUNS(keeps,:)])
% % % legend(labels,'AutoUpdate','off')
% plot([0, 10],[0.33, 0.33],'k:')
% plot([0 ,10],[0.66, 0.66],'k--')
% plot([0 ,10],[-0.33,-0.33],'k:')
% plot([0 ,10],[-0.66,-0.66],'k--')
% plot([0 ,10],[0 0],'k-','LineWidth',3)
% axis([0.5 6.5 -1.0 1.0 ])
% 
% title(['Correlation (simple lin. regr.) by case.  @ CI ', num2str(timrel(tci))  ,' hrs'])
% ylabel('Correlation coeff.')
% xlabel('         vs.    near-cloud ACBL RH                                                        |                                 vs.   near-cloud ACBL clour-rel |U wind|                     ')
%       
% yticks([-1, -0.66, -0.33, 0, 0.33, 0.66, 1])
% xticklabels( {'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl'} )
% 
% 
















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%    plots to compre cell proerties to just the near-cloud env params:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%{

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
% %  Correlate swath & cell metrics  PER CASE:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% % swath width vs cell stuff:
% CORCOEFs = zeros(3,3,ar,3);    % intended dimenions: (cell metric [area,dep,str] , swath metric [wid,dep,str] , Case,  T_CIrel[-60,-30,0]   )
% RMSEs = zeros(3,3,ar,3); 

f4 =   figure('position',[187,574,1491,433]);
hold on

tci = 3;  

var1 = 'preCIandCI_cape_acbl_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
 [ corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(1,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

legend([RUNS(:,:)])
legend('AutoUpdate','off')

var1 = 'preCIandCI_cape_acbl_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(2,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_cape_acbl_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(3,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end



% swath strength vs cell stuff:
var1 = 'preCIandCI_mucin_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(4,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_mucin_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(5,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_mucin_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(6,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end



% swath strength vs cell stuff:
var1 = 'preCIandCI_mulfc_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(7,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_mulfc_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(8,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_mulfc_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(9,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end




% swath strength vs cell stuff:
var1 = 'preCIandCI_mulcl_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(10,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_mulcl_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(11,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_mulcl_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(12,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end


%legend('AutoUpdate','off')
%legend([RUNS(:,:)])
% legend(labels,'AutoUpdate','off')
plot([0, 20],[0.33, 0.33],'k:')
plot([0 , 20],[0.66, 0.66],'k--')
plot([0 , 20],[-0.33,-0.33],'k:')
plot([0 , 20],[-0.66,-0.66],'k--')
plot([0 , 20],[0 0],'k-','LineWidth',3)

plot([3.5 3.5],[-3 3],'k-','LineWidth',1.0)
plot([6.5 6.5],[-3 3],'k-','LineWidth',1.0)
plot([9.5 9.5],[-3 3],'k-','LineWidth',1.0)

axis([0.5 12.5 -1.0 1.0 ])

title(['Correlation (simple lin. regr.) by case @ CI ', num2str(timrel(tci))  ,' hrs'])
ylabel('Correlation coeff.')
xlabel('vs.  MU CAPE in ACBL                    |                   vs.   MU CIN                     |               vs.   LFC                |                vs.   LCL')

xticklabels({'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl'})

saveas(f4,horzcat(imout,'/Cell_nearcellenv2_tci',num2str(tci),'_correlations',num2str(r),'.png'));
outlab = horzcat(imout,'/Cell_nearcellenv2_tci',num2str(tci),'_correlations',num2str(r),'.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%}


%{

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
% %  Correlate  near-cloud properties & cell metrics  PER CASE:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% % swath width vs cell stuff:
% CORCOEFs = zeros(3,3,ar,3);    % intended dimenions: (cell metric [area,dep,str] , swath metric [wid,dep,str] , Case,  T_CIrel[-60,-30,0]   )
% RMSEs = zeros(3,3,ar,3); 

f4 =   figure('position',[187,574,1491,433]);
hold on


tci = 3;  

var1 = 'preCIandCI_cape_deep_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
 [ corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(1,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

legend([RUNS(:,:)])
legend('AutoUpdate','off')

var1 = 'preCIandCI_cape_deep_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(2,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_cape_deep_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(3,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end



var1 = 'preCIandCI_rh_acbl_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(4,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_rh_acbl_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(5,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_rh_acbl_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(6,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end



var1 = 'preCIandCI_shear06_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
 [ corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(7,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_shear06_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(8,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_shear06_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(9,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end



preCIandCI_ABSucrel_acbl_ALLCASES = abs(preCIandCI_ucrel_acbl_ALLCASES);

% swath strength vs cell stuff:
var1 = 'preCIandCI_ABSucrel_acbl_ALLCASES';  var2 = 'cellCI_corearea_ALLCASES';
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(10,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_ABSucrel_acbl_ALLCASES';  var2 = 'cellCI_maxETH10_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(11,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end

var1 = 'preCIandCI_ABSucrel_acbl_ALLCASES';  var2 = 'cellCI_maxdbz_ALLCASES';
clear corcoefs rmses
[corcoefs, rmses] = plotlrbycase(tci, ar , RUNS,  var1, var2, eval(var1) , eval(var2))
for r = 1:ar
    plot(12,corcoefs(r),'ok','MarkerSize',10,'MarkerFaceColor',colorpic(r))
end


%legend('AutoUpdate','off')
% legend([RUNS(:,:)])
% legend(labels,'AutoUpdate','off')
plot([0, 13],[0.33, 0.33],'k:')
plot([0 ,13],[0.66, 0.66],'k--')
plot([0 ,13],[-0.33,-0.33],'k:')
plot([0 ,13],[-0.66,-0.66],'k--')
plot([0 ,13],[0 0],'k-','LineWidth',3)

plot([3.5 3.5],[-3 3],'k-','LineWidth',1.0)
plot([6.5 6.5],[-3 3],'k-','LineWidth',1.0)
plot([9.5 9.5],[-3 3],'k-','LineWidth',1.0)
plot([12.5 12.5],[-3 3],'k-','LineWidth',1.0)

axis([0.5 12.5 -1.0 1.0 ])
xticks([1:12])  
title(['Correlation (simple lin. regr.) by case @ CI ', num2str(timrel(tci))  ,' hrs'])
ylabel('Correlation coeff.')
xlabel('vs.  deep MU cape          |    vs.  RH in ACBL                |               vs.  0-6 km bulk shear            |       vs.   cloud-rel |U| in ACBL')
      
xticklabels({'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl';'Cell area';'Cell ETH';'Cell refl'  })


saveas(f4,horzcat(imout,'/Cell_nearcellenv3_tci',num2str(tci),'_correlations',num2str(r),'.png'));
outlab = horzcat(imout,'/Cell_nearcellenv3_tci',num2str(tci),'_correlations',num2str(r),'.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);


%}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%   Swath-BOX aloft evolution RH(z):   AS OF 20DEC23, THIS IS
%%%%%%%%%%%%   RHca, set in the previous [WswathThermo].m script. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
dualpol_colmap
% size(swathboxaloft_RH_ALLCASES)

alongSDCmean_swathboxaloft_RHprofs_ALLCASES = mean( FullSDC_swathboxaloftRH_ALLCASES,1,'omitnan' ) ;     
alongSDCmean_swathboxaloft_RHprofs_ALLCASES=permute(alongSDCmean_swathboxaloft_RHprofs_ALLCASES,[2 3 4 1]);

% Wswathboxaloft_Zasl = [2500:200:4900] ;

ff = figure; hold on;

for R = 1:ar
    
    %R = 1
    
    %figure; hold on;
    %for t = 1:4:25
    
    subplot(2,4,R)

    
    colororder(rainbow(1:3:end,:))
    %plot(  alongSDCmean_swathboxaloft_RH_ALLCASES(:,[1:4:25],R)  ,swathboxaloft_Zasl/1000 )
    plot(  alongSDCmean_swathboxaloft_RHprofs_ALLCASES(1:length(Wswathboxaloft_Zasl),[1:4:25],R)  , Wswathboxaloft_Zasl/1000 )
    %legend
    %end
    title([RUNS(R,:)])
    axis([0 100 2.5 5])
  
end

saveas(ff,horzcat(imout,'/RHbox_aloft_allcases.png'));
outlab = horzcat(imout,'/RHbox_aloft_allcases.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);

%swathboxaloft_RH_ALLCASES(:,:,5,1)








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%
%%%%%%   29Feb2024: You've only reconciled new 500m->100m 
%%%%%%               format code up to here
%%%%%%              
%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%   Overall cell population vs swath vert mass flux:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%   CumCellPopAlongSDC_ALLCASES

%  FullSDC_VMfluxSum_ALLCASES;   FullSDC_mesoWstrength_ALLCASES;
%  FullSDC_mesoWdepth_ALLCASES;   FullSDC_mesoWwidth_ALLCASES;

%  lat_alongSDC   

%times: 1=1200, 5=1300,  9 = 1400,  13=1500,  17=1600,   21=1700,   25=1800,   29=1900,   33=2000  

timestart = 5;
timefinal = 21 ;

FullSDC_mesoWstrength_timemean_ALLCASES = mean(FullSDC_mesoWstrength_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ;
FullSDC_mesoWdepth_timemean_ALLCASES    = mean(FullSDC_mesoWdepth_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ;
FullSDC_mesoWwidth_timemean_ALLCASES    = mean(FullSDC_mesoWwidth_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ;

FullSDC_VMfluxSum_calc_ALLCASES   = sum(FullSDC_VMfluxSum_ALLCASES(:,1:timefinal,:),2,'omitnan') ;
FullSDC_swathmucin_calc_ALLCASES  = mean(FullSDC_swathmucin_ALLCASES(:,5:13,:),2,'omitnan') ;  ; 
FullSDC_swathmucape_calc_ALLCASES = mean(FullSDC_swathmucape_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ;
FullSDC_swathmulfcasl_calc_ALLCASES  = mean(FullSDC_swathmulfcasl_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  
FullSDC_swathqvap_calc_ALLCASES   = mean(FullSDC_swathqvap_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ; 
FullSDC_swathtopasl_calc_ALLCASES = mean(FullSDC_swathtopasl_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  

Diff_lfc_wtop = ( FullSDC_swathmulfcasl_ALLCASES - FullSDC_swathtopasl_ALLCASES );

WIN = 9;
for r = 1:ar
    
   %  r = 1;
   % t = 20;
    
%     figure;
%     plot( lat_alongSDC, FullSDC_VMfluxSum_ALLCASES(1:360,t,r) ) 
    

    ff = figure('position',[77,296,708,637]) 
    
    subplot(4,1,1)
    plot( lat_alongSDC, CumCellPopAlongSDC_ALLCASES(1:sdclength,timefinal,r),'k','LineWidth',2 )
    title('time cumul. unique cell count')
    
    subplot(4,1,2)
    plot( lat_alongSDC, max(Terr(150:300,:)),'LineWidth',3,'Color',[0.7 0.5 0]  )  
    title('max ridgeline ht asl')
    
    subplot(4,1,3)
    plot( lat_alongSDC, FullSDC_VMfluxSum_calc_ALLCASES(1:sdclength,r),'m','LineWidth',3 ) 
    title('time cumul. swath vert mass flux ')
    
    
    
    subplot(4,1,4)

    var1   = Diff_lfc_wtop(:,5,r);    
    var = movmean(var1,WIN,1,'omitnan');    var = movmean(var,WIN,1,'omitnan');  %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(:,r),'Color',[0.7 0.8 1],'LineWidth',1.5 ) ;   hold on
    
    var1   = Diff_lfc_wtop(:,9,:);  
    var = movmean(var1,WIN,1,'omitnan');    var = movmean(var,WIN,1,'omitnan');   %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(:,r),'Color',[0.4 0.55 1],'LineWidth',1.5 ) ;   hold on
    
    var1   = Diff_lfc_wtop(:,13,:); 
    var = movmean(var1,WIN,1,'omitnan');    var = movmean(var,WIN,1,'omitnan');   %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(:,r),'Color',[0.1 0.0 0.8],'LineWidth',1.5 ) ;   hold on    
  
    var1   = Diff_lfc_wtop(:,17,:);  
    var = movmean(var1,WIN,1,'omitnan');    var = movmean(var,WIN,1,'omitnan');   %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(:,r),'Color',[0.0 0 0.6],'LineWidth',1.5 ) ;   hold on      
    
    axis([-33.2 -31.4 -2 4])
    
    legend('13utc','14utc','15utc','16utc')
    legend('AutoUpdate','off')
    title(' LFC - top of w-swath ')   
    
    sgtitle(RUNS(r,:))
    
    
    saveas(ff,horzcat(imout,'/AlongSwath1_case',num2str(r),'.png'));
    outlab = horzcat(imout,'/AlongSwath1_case',num2str(r),'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);




    
    
    
    
    
    
    ff = figure('position',[1247,202,744,690])
    
    subplot(5,1,1)
    plot( lat_alongSDC, CumCellPopAlongSDC_ALLCASES(1:360,timefinal,r),'k','LineWidth',2 )
    title('time cumul. unique cell count')

    subplot(5,1,2)
    var1     = mean( swathboxaloft_RH_ALLCASES(:,:,5,:),2,'omitnan' ) ; var1 = permute(var1,[1 4 2 3]);
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[0.8 1 0],'LineWidth',1.5 ); hold on
    
    var1     = mean( swathboxaloft_RH_ALLCASES(:,:,9,:),2,'omitnan' ) ; var1 = permute(var1,[1 4 2 3]);
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[0.4 1 0],'LineWidth',1.5 ); hold on
    
    var1     = mean( swathboxaloft_RH_ALLCASES(:,:,13,:),2,'omitnan' ) ; var1 = permute(var1,[1 4 2 3]);
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[0.0 0.75 0],'LineWidth',1.5 ); hold on
    
    var1     = mean( swathboxaloft_RH_ALLCASES(:,:,17,:),2,'omitnan' ) ; var1 = permute(var1,[1 4 2 3]);
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[0.0 0.4 0],'LineWidth',1.5 ); hold on
    
    title(' mean 2.5-5 km msl RH ')
    legend('13utc','14utc','15utc','16utc')
    legend('AutoUpdate','off')
    
    
    
    
    subplot(5,1,3)
    var1 =    FullSDC_swathqvap_ALLCASES(:,5,:);
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[250/255 170/255 255/255],'LineWidth',1.5 ); hold on
    
    var1     =  FullSDC_swathqvap_ALLCASES(:,9,:);
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[220/255 40/255 225/255],'LineWidth',1.5 ); hold on
    
    var1     = FullSDC_swathqvap_ALLCASES(:,13,:);
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[140/255 40/255 180/255],'LineWidth',1.5 ); hold on
    
    var1     = FullSDC_swathqvap_ALLCASES(:,17,:);
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[70/255 0/255 120/255],'LineWidth',1.5 ); hold on
    
    title(' mean q_v_a_p in w-swath ')
    legend('13utc','14utc','15utc','16utc')
    legend('AutoUpdate','off')   
    
    
    
    
    
    
    subplot(5,1,4)
    var1     = FullSDC_swathmucape_ALLCASES(:,5,:) ;
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[1 0.8 0],'LineWidth',1.5 ); hold on
    
    var1     = FullSDC_swathmucape_ALLCASES(:,9,:) ; 
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[1 0.4 0],'LineWidth',1.5 ); hold on
    
    var1     = FullSDC_swathmucape_ALLCASES(:,13,:) ; 
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[0.75 0 0],'LineWidth',1.5 ); hold on
    
    var1     = FullSDC_swathmucape_ALLCASES(:,17,:) ; 
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[0.4 0 0],'LineWidth',1.5 ); hold on
    
    title(' MU CAPE')
    legend('13utc','14utc','15utc','16utc')
    
    
    
    
    
    subplot(5,1,5)
    var1     = FullSDC_swathmucin_ALLCASES(:,5,:) ; %var1 = var;
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[0/255 220/255 250/255],'LineWidth',1.5 ); hold on
    
    var1     = FullSDC_swathmucin_ALLCASES(:,9,:) ; 
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[0/255 170/255 235/255],'LineWidth',1.5 ); hold on
    
    var1     = FullSDC_swathmucin_ALLCASES(:,13,:) ; 
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[0/255 90/255 230/255],'LineWidth',1.5 ); hold on
    
    var1     = FullSDC_swathmucin_ALLCASES(:,17,:) ; 
    var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;
    plot( lat_alongSDC, var(1:360,r),'Color',[5/255 50/255 140/255],'LineWidth',1.5 ); hold on
    
    title(' MU CIN')
    legend('13utc','14utc','15utc','16utc') 

    xlabel('latitude')
    
    saveas(ff,horzcat(imout,'/AlongSwath2_case',num2str(r),'.png'));
    outlab = horzcat(imout,'/AlongSwath2_case',num2str(r),'.eps');
    EPSprint = horzcat('print -painters -depsc ',outlab);
    eval([EPSprint]);
    
    sgtitle(RUNS(r,:))
    
end





%{

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % Do broad means to compare across cases:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
WIN = 9;

timestart = 5;
timefinal = 13 ;

FullSDC_mesoWstrength_timemean_ALLCASES = mean(FullSDC_mesoWstrength_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ;
FullSDC_mesoWdepth_timemean_ALLCASES    = mean(FullSDC_mesoWdepth_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ;
FullSDC_mesoWwidth_timemean_ALLCASES    = mean(FullSDC_mesoWwidth_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ;

FullSDC_VMfluxSum_calc_ALLCASES   = sum(FullSDC_VMfluxSum_ALLCASES(:,1:timefinal,:),2,'omitnan') ;
FullSDC_swathmucin_calc_ALLCASES  = mean(FullSDC_swathmucin_ALLCASES(:,5:13,:),2,'omitnan') ;  ; 
FullSDC_swathmucape_calc_ALLCASES = mean(FullSDC_swathmucape_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ;
FullSDC_swathmulfcasl_calc_ALLCASES  = mean(FullSDC_swathmulfcasl_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ;
FullSDC_swathqvap_calc_ALLCASES   = mean(FullSDC_swathqvap_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  ; 
FullSDC_swathtopasl_calc_ALLCASES = mean(FullSDC_swathtopasl_ALLCASES(:,timestart:timefinal,:),2,'omitnan') ;  

Diff_lfc_wtop = ( FullSDC_swathmulfcasl_ALLCASES - FullSDC_swathtopasl_ALLCASES );





ff = figure('position',[74,255,1245,673])


FullSDC_VMfluxSum_calc_ALLCASES   = sum(FullSDC_VMfluxSum_ALLCASES(:,1:timefinal,:),2,'omitnan') ;


subplot(1,4,1)
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,1); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, length(allcells),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,2); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, length(allcells),'ko','MarkerFaceColor','r','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,3); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, length(allcells),'ko','MarkerFaceColor','g','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,4); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, length(allcells),'ko','MarkerFaceColor','k','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,5); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, length(allcells),'ko','MarkerFaceColor','m','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,6); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, length(allcells),'ko','MarkerFaceColor','c','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,7); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, length(allcells),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 0 10])
xlabel(' cumul # cells ')



subplot(1,4,2)
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,1); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_corearea_UNFILT_ALLCASES(allcells,1),'omitnan'),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,2); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, mean(cellCI_corearea_UNFILT_ALLCASES(allcells,2),'omitnan'),'ko','MarkerFaceColor','r','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,3); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_corearea_UNFILT_ALLCASES(allcells,3),'omitnan'),'ko','MarkerFaceColor','g','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,4); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, mean(cellCI_corearea_UNFILT_ALLCASES(allcells,4),'omitnan'),'ko','MarkerFaceColor','k','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,5); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_corearea_UNFILT_ALLCASES(allcells,5),'omitnan'),'ko','MarkerFaceColor','m','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,6); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, mean(cellCI_corearea_UNFILT_ALLCASES(allcells,6),'omitnan'),'ko','MarkerFaceColor','c','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,7); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_corearea_UNFILT_ALLCASES(allcells,7),'omitnan'),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 5 30])
xlabel(' mean of max core area during CI [km^2]')



subplot(1,4,3)
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,1); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_maxdbz_UNFILT_ALLCASES(allcells,1),'omitnan'),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,2); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, mean(cellCI_maxdbz_UNFILT_ALLCASES(allcells,2),'omitnan'),'ko','MarkerFaceColor','r','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,3); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_maxdbz_UNFILT_ALLCASES(allcells,3),'omitnan'),'ko','MarkerFaceColor','g','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,4); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, mean(cellCI_maxdbz_UNFILT_ALLCASES(allcells,4),'omitnan'),'ko','MarkerFaceColor','k','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,5); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_maxdbz_UNFILT_ALLCASES(allcells,5),'omitnan'),'ko','MarkerFaceColor','m','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,6); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, mean(cellCI_maxdbz_UNFILT_ALLCASES(allcells,6),'omitnan'),'ko','MarkerFaceColor','c','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,7); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_maxdbz_UNFILT_ALLCASES(allcells,7),'omitnan'),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 40 60])
xlabel(' mean of max cell refl during CI [dbz]')





subplot(1,4,4)
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,1); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_maxETH10_UNFILT_ALLCASES(allcells,1),'omitnan'),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,2); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, mean(cellCI_maxETH10_UNFILT_ALLCASES(allcells,2),'omitnan'),'ko','MarkerFaceColor','r','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,3); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_maxETH10_UNFILT_ALLCASES(allcells,3),'omitnan'),'ko','MarkerFaceColor','g','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,4); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, mean(cellCI_maxETH10_UNFILT_ALLCASES(allcells,4),'omitnan'),'ko','MarkerFaceColor','k','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,5); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_maxETH10_UNFILT_ALLCASES(allcells,5),'omitnan'),'ko','MarkerFaceColor','m','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,6); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1.1, mean(cellCI_maxETH10_UNFILT_ALLCASES(allcells,6),'omitnan'),'ko','MarkerFaceColor','c','MarkerSize',10 )
allcells = CellPopEachTime_ALLCASES(:,1:timefinal,7); allcells = unique(allcells);  allcells(isnan(allcells)) = [];
plot( 1, mean(cellCI_maxETH10_UNFILT_ALLCASES(allcells,7),'omitnan'),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 5 9])
xlabel(' mean of max ETH10 during CI [km]')


%%%%%%%%%%%%%%

ff = figure('position',[74,255,1245,673])

subplot(1,6,1)
var1 =    FullSDC_VMfluxSum_calc_ALLCASES(:,:);
var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');

js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,1) > 0) ;      
plot( 1, mean(var(js_with_cells,1),'omitnan'),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,2) > 0) ;  
plot( 1.1, mean(var(js_with_cells,2),'omitnan'),'ko','MarkerFaceColor','r','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,3) > 0) ;  
plot( 0.9, mean(var(js_with_cells,3),'omitnan'),'ko','MarkerFaceColor','g','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,4) > 0) ;  
plot( 1.1, mean(var(js_with_cells,4),'omitnan'),'ko','MarkerFaceColor','k','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,5) > 0) ;  
plot( 1, mean(var(js_with_cells,5),'omitnan'),'ko','MarkerFaceColor','m','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,6) > 0) ;  
plot( 1.1, mean(var(js_with_cells,6),'omitnan'),'ko','MarkerFaceColor','c','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,7) > 0) ;  
plot( 1, mean(var(js_with_cells,7),'omitnan'),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 0 8*10^8])
xlabel('mean cumul swath vert mass flux [kg/m^2]')



subplot(1,6,2)
var1   = -1*Diff_lfc_wtop(:,timefinal,:);
var = movmean(var1,WIN,1,'omitnan');    var = movmean(var,WIN,1,'omitnan'); 
    
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,1) > 0) ; 
plot( 1, mean(var(js_with_cells,1),'omitnan'),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,2) > 0) ; 
plot( 1, mean(var(js_with_cells,2),'omitnan'),'ko','MarkerFaceColor','r','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,3) > 0) ; 
plot( 1, mean(var(js_with_cells,3),'omitnan'),'ko','MarkerFaceColor','g','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,4) > 0) ; 
plot( 1, mean(var(js_with_cells,4),'omitnan'),'ko','MarkerFaceColor','k','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,5) > 0) ; 
plot( 1, mean(var(js_with_cells,5),'omitnan'),'ko','MarkerFaceColor','m','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,6) > 0) ; 
plot( 1, mean(var(js_with_cells,6),'omitnan'),'ko','MarkerFaceColor','c','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,7) > 0) ; 
plot( 1, mean(var(js_with_cells,7),'omitnan'),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 -0.5 0.5])
xlabel(' swath top - LFC[km]')




subplot(1,6,3)
var1     = mean( swathboxaloft_RH_ALLCASES(:,:,timefinal,:),2,'omitnan' ) ; var1 = permute(var1,[1 4 2 3]);
var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');    
    
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,1) > 0) ;
plot( 1, mean(var(js_with_cells,1),'omitnan'),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,2) > 0) ;
plot( 1, mean(var(js_with_cells,2),'omitnan'),'ko','MarkerFaceColor','r','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,3) > 0) ;
plot( 1, mean(var(js_with_cells,3),'omitnan'),'ko','MarkerFaceColor','g','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,4) > 0) ;
plot( 1, mean(var(js_with_cells,4),'omitnan'),'ko','MarkerFaceColor','k','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,5) > 0) ;
plot( 1, mean(var(js_with_cells,5),'omitnan'),'ko','MarkerFaceColor','m','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,6) > 0) ;
plot( 1, mean(var(js_with_cells,6),'omitnan'),'ko','MarkerFaceColor','c','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,7) > 0) ;
plot( 1, mean(var(js_with_cells,7),'omitnan'),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 30 90])
xlabel(' mean RH from z=2.5-5km [%]')




subplot(1,6,4)
var1 =    FullSDC_swathqvap_ALLCASES(:,timefinal,:);   var1 = permute(var1,[1 3 2]); 
var = movmean(var1,WIN,1,'omitnan');   var = movmean(var,WIN,1,'omitnan');   
    
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,1) > 0) ;
plot( 1, 1000*mean(var(js_with_cells,1),'omitnan'),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,2) > 0) ;
plot( 1, 1000*mean(var(js_with_cells,2),'omitnan'),'ko','MarkerFaceColor','r','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,3) > 0) ;
plot( 1, 1000*mean(var(js_with_cells,3),'omitnan'),'ko','MarkerFaceColor','g','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,4) > 0) ;
plot( 1, 1000*mean(var(js_with_cells,4),'omitnan'),'ko','MarkerFaceColor','k','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,5) > 0) ;
plot( 1, 1000*mean(var(js_with_cells,5),'omitnan'),'ko','MarkerFaceColor','m','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,6) > 0) ;
plot( 1, 1000*mean(var(js_with_cells,6),'omitnan'),'ko','MarkerFaceColor','c','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,7) > 0) ;
plot( 1, 1000*mean(var(js_with_cells,7),'omitnan'),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 5 17])
xlabel(' Q_v_a_p [g/kg]')




subplot(1,6,5)
var1     = FullSDC_swathmucape_ALLCASES(:,timefinal,:) ;
var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;

js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,1) > 0) ;
plot( 1, mean(var(js_with_cells,1),'omitnan'),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,2) > 0) ;
plot( 1, mean(var(js_with_cells,2),'omitnan'),'ko','MarkerFaceColor','r','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,3) > 0) ;
plot( 1, mean(var(js_with_cells,3),'omitnan'),'ko','MarkerFaceColor','g','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,4) > 0) ;
plot( 1, mean(var(js_with_cells,4),'omitnan'),'ko','MarkerFaceColor','k','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,5) > 0) ;
plot( 1, mean(var(js_with_cells,5),'omitnan'),'ko','MarkerFaceColor','m','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,6) > 0) ;
plot( 1, mean(var(js_with_cells,6),'omitnan'),'ko','MarkerFaceColor','c','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,7) > 0) ;
plot( 1, mean(var(js_with_cells,7),'omitnan'),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 0 3500])
xlabel(' MUCAPE [J/kg]')



subplot(1,6,6)
var1     = FullSDC_swathmucin_ALLCASES(:,timefinal,:) ;
var = movmean(var1,WIN,1,'omitnan');       var = movmean(var,WIN,1,'omitnan');     %var(isnan(var1)) = NaN;

js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,1) > 0) ;
plot( 1, mean(var(js_with_cells,1),'omitnan'),'ko','MarkerFaceColor','b','MarkerSize',10 )
hold on
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,2) > 0) ;
plot( 1, mean(var(js_with_cells,2),'omitnan'),'ko','MarkerFaceColor','r','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,3) > 0) ;
plot( 1, mean(var(js_with_cells,3),'omitnan'),'ko','MarkerFaceColor','g','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,4) > 0) ;
plot( 1, mean(var(js_with_cells,4),'omitnan'),'ko','MarkerFaceColor','k','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,5) > 0) ;
plot( 1, mean(var(js_with_cells,5),'omitnan'),'ko','MarkerFaceColor','m','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,6) > 0) ;
plot( 1, mean(var(js_with_cells,6),'omitnan'),'ko','MarkerFaceColor','c','MarkerSize',10 )
js_with_cells = find(CumCellPopAlongSDC_ALLCASES(:,timefinal,7) > 0) ;
plot( 1, mean(var(js_with_cells,7),'omitnan'),'ko','MarkerFaceColor',[0.9 0.5 0],'MarkerSize',10 )
axis([0 2 -10 0])
xlabel(' MUCIN [J/kg]')





axis([-33.2 -31.4 -2 4])

legend('13utc','14utc','15utc','16utc')
legend('AutoUpdate','off')


suptitle(RUNS(r,:))


%}




% plot distance between cell and swath per case:

%mask out the unwanted cells
dist_cell_and_swath_filt = dist_cell_and_swath .* cellkeeper_mask3dtracks_ALLCASES ;

% just plot distance between cell centroid and swath:
figure
hold on
for R = 1:ar
    plot(dist_cell_and_swath_filt(1,:,R),'ok')
end


% now calc edge of cell from swath:

CI_R = ( cellCI_cellarea_ALLCASES/3.14159 ).^ 0.5;

distT1 = permute(dist_cell_and_swath_filt(1,:,:),[2 3 1]) ;

dist_Rfactoredin = abs(distT1) - 0.5 - CI_R ;

figure
hold on
plot(dist_Rfactoredin,'ok')







%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%            Wid-swath matchup stats
%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%filter out small wIDs? 

%{

preserve_wid_profs_area_ALLCASES = wid_profs_area_ALLCASES; 
preserve_wid_profs_centHTagl_ALLCASES =  wid_profs_centHTagl_ALLCASES;
preserve_wid_profs_centlat_ALLCASES =  wid_profs_centlat_ALLCASES;
preserve_wid_profs_centlon_ALLCASES =  wid_profs_centlon_ALLCASES;
preserve_wid_profs_massflux_ALLCASES =  wid_profs_massflux_ALLCASES;
preserve_wid_profs_maxmag_ALLCASES =  wid_profs_maxmag_ALLCASES;

preserve_wid_mesoWcape_ALLCASES = wid_mesoWcape_ALLCASES;
preserve_wid_mesoWcin_ALLCASES = wid_mesoWcin_ALLCASES;
preserve_wid_mesoWdepth_ALLCASES = wid_mesoWdepth_ALLCASES;
preserve_wid_mesoWdepthrat_ALLCASES = wid_mesoWdepthrat_ALLCASES;
preserve_wid_mesoWlfcagl_ALLCASES = wid_mesoWlfcagl_ALLCASES;
preserve_wid_mesoWlfcasl_ALLCASES = wid_mesoWlfcasl_ALLCASES;
preserve_wid_mesoWqvap_ALLCASES = wid_mesoWqvap_ALLCASES;
preserve_wid_mesoWstrength_ALLCASES = wid_mesoWstrength_ALLCASES;
preserve_wid_mesoWtheta_ALLCASES = wid_mesoWtheta_ALLCASES;
preserve_wid_mesoWthetae_ALLCASES = wid_mesoWthetae_ALLCASES;
preserve_wid_mesoWtopagl_ALLCASES = wid_mesoWtopagl_ALLCASES;
preserve_wid_mesoWtopasl_ALLCASES = wid_mesoWtopasl_ALLCASES;
preserve_wid_mesoWvmsum_ALLCASES = wid_mesoWvmsum_ALLCASES;
preserve_wid_mesoWwidth_ALLCASES = wid_mesoWwidth_ALLCASES;

%}

%{ 

wid_profs_area_ALLCASES = preserve_wid_profs_area_ALLCASES; 
wid_profs_centHTagl_ALLCASES =  preserve_wid_profs_centHTagl_ALLCASES; 
wid_profs_centlat_ALLCASES =  preserve_wid_profs_centlat_ALLCASES; 
wid_profs_centlon_ALLCASES =  preserve_wid_profs_centlon_ALLCASES; 
wid_profs_massflux_ALLCASES =  preserve_wid_profs_massflux_ALLCASES; 
wid_profs_maxmag_ALLCASES =  preserve_wid_profs_maxmag_ALLCASES;
wid_mesoWcape_ALLCASES = preserve_wid_mesoWcape_ALLCASES; 
wid_mesoWcin_ALLCASES = preserve_wid_mesoWcin_ALLCASES; 
wid_mesoWdepth_ALLCASES = preserve_wid_mesoWdepth_ALLCASES; 
wid_mesoWdepthrat_ALLCASES = preserve_wid_mesoWdepthrat_ALLCASES;
wid_mesoWlfcagl_ALLCASES = preserve_wid_mesoWlfcagl_ALLCASES;
wid_mesoWlfcasl_ALLCASES = preserve_wid_mesoWlfcasl_ALLCASES; 
wid_mesoWqvap_ALLCASES = preserve_wid_mesoWqvap_ALLCASES;
wid_mesoWstrength_ALLCASES = preserve_wid_mesoWstrength_ALLCASES;
wid_mesoWtheta_ALLCASES = preserve_wid_mesoWtheta_ALLCASES;
wid_mesoWthetae_ALLCASES = preserve_wid_mesoWthetae_ALLCASES;
wid_mesoWtopagl_ALLCASES = preserve_wid_mesoWtopagl_ALLCASES;
wid_mesoWtopasl_ALLCASES = preserve_wid_mesoWtopasl_ALLCASES;
wid_mesoWvmsum_ALLCASES = preserve_wid_mesoWvmsum_ALLCASES;
wid_mesoWwidth_ALLCASES = preserve_wid_mesoWwidth_ALLCASES;

%}



%{
%filter out small updraft wIDs? 
[numwid,numk,Tvcsa,ar] = size(wid_profs_area_ALLCASES)  ;
nkill = zeros(numwid,Tvcsa,ar) ;
for n = 1:numwid
    for t = 1:Tvcsa
        for RR = 1:ar
% 
% RR = 6; t = 30; n = 10;

            maxarea =  max( wid_profs_area_ALLCASES(n,:,t,RR),[],2 );

            if(maxarea < 1767145.0)    % r=500m: 785000;    r=750m:1767145 
                nkill(n,t,RR) = 1;

                wid_profs_area_ALLCASES(n,:,t,RR) = NaN  ;
                wid_profs_centHTagl_ALLCASES(n,:,t,RR) = NaN  ;
                wid_profs_centlat_ALLCASES(n,:,t,RR) = NaN  ;
                wid_profs_centlon_ALLCASES(n,:,t,RR) = NaN  ;
                wid_profs_massflux_ALLCASES(n,:,t,RR) = NaN  ;
                wid_profs_maxmag_ALLCASES(n,:,t,RR) = NaN  ;
                wid_profs_northj_ALLCASES(n,:,t,RR) = NaN  ;
                wid_profs_southj_ALLCASES(n,:,t,RR) = NaN  ;

                wid_mesoWcape_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWcin_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWdepth_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWdepthrat_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWlfcagl_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWlfcasl_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWqvap_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWstrength_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWtheta_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWthetae_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWtopagl_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWtopasl_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWvmsum_ALLCASES(n,t,RR) = NaN  ;
                wid_mesoWwidth_ALLCASES(n,t,RR) = NaN  ;

            end

        end
    end
end





%%% kill data outside of an LFC layer in wid prof vars. This replaces filtering that you did
%%% in the previous .m script (ktop,kbot layer vars) if you made that loop go from LFC 
%%% to a really tall height (was necessary in some cases where apparently the lfc was like really high?) 

layerdepth = 3000;   %meters - how high above the wid's lfc you want to still be elidgable for analysis
for n = 1:numwid
    for t = 1:Tvcsa
        for RR = 1:ar

            klfcagl = wid_profs_klfcagl_ALLCASES(n,t,RR);
            if(isnan(klfcagl)==0)
                lfcagl = updraftLFCLAYprofs_zagl(klfcagl);  %meters
                toplayer = lfcagl + layerdepth;
                ktoplayer = find( abs(updraftLFCLAYprofs_zagl-toplayer) == min(abs(updraftLFCLAYprofs_zagl-toplayer))   );
                if(ktoplayer > length(updraftLFCLAYprofs_zagl)-1 )
                    ktoplayer = length(updraftLFCLAYprofs_zagl)-1;
                end

                %kill whats above lfc layer
                wid_profs_area_ALLCASES(n,ktoplayer+1:end,t,RR) = NaN  ;
                wid_profs_centHTagl_ALLCASES(n,ktoplayer+1:end,t,RR) = NaN  ;
                wid_profs_centlat_ALLCASES(n,ktoplayer+1:end,t,RR) = NaN  ;
                wid_profs_centlon_ALLCASES(n,ktoplayer+1:end,t,RR) = NaN  ;
                wid_profs_massflux_ALLCASES(n,ktoplayer+1:end,t,RR) = NaN  ;
                wid_profs_maxmag_ALLCASES(n,ktoplayer+1:end,t,RR) = NaN  ;
                wid_profs_northj_ALLCASES(n,ktoplayer+1:end,t,RR) = NaN  ;
                wid_profs_southj_ALLCASES(n,ktoplayer+1:end,t,RR) = NaN  ;
                %kill whats below lfc layer (should already be dead, killed in first .m script)
                wid_profs_area_ALLCASES(n,1:klfcagl-1,t,RR) = NaN  ;
                wid_profs_centHTagl_ALLCASES(n,1:klfcagl-1,t,RR) = NaN  ;
                wid_profs_centlat_ALLCASES(n,1:klfcagl-1,t,RR) = NaN  ;
                wid_profs_centlon_ALLCASES(n,1:klfcagl-1,t,RR) = NaN  ;
                wid_profs_massflux_ALLCASES(n,1:klfcagl-1,t,RR) = NaN  ;
                wid_profs_maxmag_ALLCASES(n,1:klfcagl-1,t,RR) = NaN  ;
                wid_profs_northj_ALLCASES(n,1:klfcagl-1,t,RR) = NaN  ;
                wid_profs_southj_ALLCASES(n,1:klfcagl-1,t,RR) = NaN  ;
            end
        end
    end
end

%}



%%% general histograms of wid stats per case  note: 
% 
% YOU'RE USING UNFILTERED wid_PROF FIELDS!


%%% histogram of max up area in each ups profile all cases and times
BB = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
BB = permute(BB,[1 3 4 2]);
CC =  ( BB/3.14159 ) .^0.5 ;
figure
edges = [0:0.1:5];
histogram(CC(:)/1000,'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title(' Updraft circ-equiv radius (km) for all cases & times ' )
xlabel(' circ-equiv rad (km) ')
ylabel(' Number of updrafts')
axis([0 5 0 1800])


%%% histogram of max up mag in each ups profile all cases and times
BB = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
BB = permute(BB,[1 3 4 2]);
figure
edges = [2.5:0.25:15];
histogram(BB(:) ,'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title(' |Updraft|_max for all cases & times ' )
xlabel(' (m/s) ')
ylabel(' Number of updrafts')
axis([2.5 15 0 700])



%%% histogram of max up area in each ups profile all cases and times
BB = max(wid_profs_massflux_ALLCASES(:,:,:,:),[],2); 
BB = permute(BB,[1 3 4 2]); BB(BB==0) = NaN;
figure
edges = [0:200000:15000000];
histogram(BB(:),'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
view(0,90)
title(' vert mass flux for all cases & times ' )
xlabel(' (flux units) ')
ylabel(' Number of updrafts')
axis([edges(1) edges(end) 0 1600])



%%% stacked bar graph style histo of max up area in each ups profile all cases and times
%not presently working
% edges = [0:0.1:5];
% 
% BB = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
% BB = permute(BB,[1 3 4 2]);
% CC =  (( BB/3.14159 ) .^0.5 )/1000 ;
% C1 = CC(:,:,1); C2 = CC(:,:,2); C3 = CC(:,:,3); C4 = CC(:,:,4); C5 = CC(:,:,5); C6 = CC(:,:,6); C7 = CC(:,:,7);
% DD = [ C1(:); C2(:); C3(:); C4(:); C5(:); C6(:); C7(:) ];
% for k = 1:size(DD,1)
%     counts(k,:) = histc(DD(k,:), edges);
% end
% 
% figure
% %histogram(CC(:)/1000,'BinEdges',edges) %'CDataMode','auto','FaceColor','interp');
% bar(counts,edges,'stacked')
% view(0,90)
% title(' Updraft circ-equiv radius (km) for all cases & times ' )
% xlabel(' circ-equiv rad (km) ')
% ylabel(' Number of updrafts')
% axis([0 5 0 1800])

% example
% 
% v1 = randi(9,1,50);
% v2 = randi(9,1,50);
% v3 = randi(9,1,50);
% v4 = randi(9,1,50);
% v5 = randi(9,1,50);
% v6 = randi(9,1,50);
% vm = [v1; v2; v3; v4; v5; v6];
% binrng = 1:9;
% for k = 1:size(vm,1)
%     countss(k,:) = histc(vm(k,:), binrng);
% end
% 
% figure
% bar(binrng,countss,'stacked')
% grid














%{

%wID width vs mesoscale swath properties:

figure('position',[642,91,678,866]);

subplot(4,2,1)
for RR = 1:ar
    AA = max(wid_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = wid_mesoWstrength_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r' ); hold on
    elseif(RR==2)
        scatter( BB(:),AA(:)','.b' ); hold on
    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWstrength_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--k')
axis([0 15 0 7])
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('swath strength (m/s)');
ylabel('max[updraft circ-equiv radius] (km)');


subplot(4,2,2)
for RR = 1:ar
    AA = max(wid_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = wid_mesoWwidth_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r' ); hold on
    elseif(RR==2)
        scatter( BB(:),AA(:)','.b' ); hold on
    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWwidth_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--k')
axis([0 10 0 7])
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath width ALLCASES');
xlabel('swath width (km)');
ylabel('max[updraft circ-equiv radius] (km)');


subplot(4,2,3)
for RR = 1:ar
    AA = max(wid_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = wid_mesoWvmsum_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r' ); hold on
    elseif(RR==2)
        scatter( BB(:),AA(:)','.b' ); hold on
    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWvmsum_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--k')
axis([0 1000000000. 0 7])
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath accumVMF ALLCASES');
xlabel('swath vert mass flux');
ylabel('max[updraft circ-equiv radius] (km)');



subplot(4,2,4)
for RR = 1:ar
    AA = max(wid_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = wid_mesoWtoplfcaslRAT_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r' ); hold on
    elseif(RR==2)
        scatter( BB(:),AA(:)','.b' ); hold on
    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWtoplfcaslRAT_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--k')
title(['corcoeff = ', num2str(ccr) ])
axis([0.3 1 0 7])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
xlabel('swath depth (ratio swath top/LFC)');
ylabel('max[updraft circ-equiv radius] (km)');



subplot(4,2,5)
for RR = 1:ar
    AA = max(wid_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = wid_mesoWcape_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r' ); hold on
    elseif(RR==2)
        scatter( BB(:),AA(:)','.b' ); hold on
    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWcape_ALLCASES ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--k')
axis([0 5000 0 7])
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath cape ALLCASES');
xlabel('in-swath CAPE (j/kg)');
ylabel('max[updraft circ-equiv radius] (km)');


subplot(4,2,6)
for RR = 1:ar
    AA = max(wid_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = wid_mesoWcin_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r' ); hold on
    elseif(RR==2)
        scatter( BB(:),AA(:)','.b' ); hold on
    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWcin_ALLCASES ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--k')
axis([-50 0 0 7])
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath cin ALLCASES');
xlabel('in-swath CIN (j/kg)');
ylabel('max[updraft circ-equiv radius] (km)');


subplot(4,2,7)
for RR = 1:ar
    AA = max(wid_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = wid_mesoWqvap_ALLCASES(:,:,RR)*1000;
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r' ); hold on
    elseif(RR==2)
        scatter( BB(:),AA(:)','.b' ); hold on
    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWqvap_ALLCASES*1000 ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--k')
axis([4 19 0 7])
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath Qvap ALLCASES');
xlabel('in-swath Qvap (g/kg)');
ylabel('max[updraft circ-equiv radius] (km)');


subplot(4,2,8)
for RR = 1:ar
    AA = max(wid_profs_area_ALLCASES(:,:,:,RR),[],2);
    %AA = permute(AA,[1 3 4 2]);
    AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
    BB = wid_mesoWlfcagl_ALLCASES(:,:,RR);
    kill = isnan(BB);
    BB(kill) = []; AA(kill) = [];
    kill = isnan(AA);
    BB(kill) = []; AA(kill) = [];
    if(RR==1)
        scatter( BB(:),AA(:)','.r' ); hold on
    elseif(RR==2)
        scatter( BB(:),AA(:)','.b' ); hold on
    elseif(RR==3)
        scatter( BB(:),AA(:)','.g' ); hold on
    elseif(RR==4)
        scatter( BB(:),AA(:)','.c' ); hold on
    elseif(RR==5)
        scatter( BB(:),AA(:)','.m' ); hold on
    elseif(RR==6)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    elseif(RR==7)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[1 0.5 0] ); hold on
    elseif(RR==8)
        scatter( BB(:),AA(:)','.','MarkerFaceColor',[0.1 0.5 1] ); hold on
    end
end
AA = max(wid_profs_area_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWlfcagl_ALLCASES ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
%scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--k')
axis([0 4 0 7])
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath LFCagl ALLCASES');
xlabel('in-swath LFC (km agl)');
ylabel('max[updraft circ-equiv radius] (km)');


















%%%% wID max mag vs swath:

figure('position',[642,91,678,866]);

subplot(4,2,1)
AA = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
% AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWstrength_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--')
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath strength ALLCASES');
xlabel('swath strength (m/s)');
ylabel('max[updraft magnitude] (m/s)');

subplot(4,2,2)
AA = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
% AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWwidth_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--')
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath width ALLCASES');
xlabel('swath width (km)');
ylabel('max[updraft magnitude] (m/s)');

subplot(4,2,3)
AA = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
% AA =  ( ( AA/3.14159 ) .^0.5) ./1000 ;
BB = wid_mesoWvmsum_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--')
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath accumVMF ALLCASES');
xlabel('swath vert mass flux');
ylabel('max[updraft magnitude] (m/s)');

subplot(4,2,4)
AA = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
BB = wid_mesoWtoplfcaslRAT_ALLCASES; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--')
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath top/LFC ALLCASES');
xlabel('swath depth (ratio swath top/LFC)');
ylabel('max[updraft magnitude] (m/s)');

subplot(4,2,5)
AA = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
BB = wid_mesoWcape_ALLCASES ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--')
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath cape ALLCASES');
xlabel('in-swath CAPE (j/kg)');
ylabel('max[updraft magnitude] (m/s)');

subplot(4,2,6)
AA = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
BB = wid_mesoWcin_ALLCASES ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--')
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath cin ALLCASES');
xlabel('in-swath CIN (j/kg)');
ylabel('max[updraft magnitude] (m/s)');

subplot(4,2,7)
AA = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
BB = wid_mesoWqvap_ALLCASES*1000 ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--')
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath Qvap ALLCASES');
xlabel('in-swath Qvap (g/kg)');
ylabel('max[updraft magnitude] (m/s)');


subplot(4,2,8)
AA = max(wid_profs_maxmag_ALLCASES(:,:,:,:),[],2); 
AA = permute(AA,[1 3 4 2]);
BB = wid_mesoWlfcagl_ALLCASES ; 
kill = isnan(BB);
BB(kill) = []; AA(kill) = [];
kill = isnan(AA);
BB(kill) = []; AA(kill) = [];
scatter( BB(:),AA(:)','.k' ); hold on
ccr = corrcoef(BB,AA); ccr = ccr(2);
X = [ ones(length(BB'),1) BB'];
b = X\AA'; yCalc2 = X*b;
plot(BB,yCalc2,'--')
title(['corcoeff = ', num2str(ccr) ])
%xlabel('wid''s mesoWswath LFCagl ALLCASES');
xlabel('in-swath LFC (km agl)');
ylabel('max[updraft magnitude] (m/s)');

%}





% sample plot of WIDs along terrain

%{
run = '/Volumes/LaCie/LASSO_runs/cacti/lasso/les/20190208/eda03/morr/d3/NEW_SwathObjectOutput_wID_qcldice0.0001_dbz10_run_20190208_eda03_morr_d3.mat';
% run = strcat(rootdir,'/20190129_gefs11_base_d4/old/wID_ObjectOutput_NSj_100m5min_qcld0.0001_dbz10_tt025_150000_29Jan100m_20190129_gefs11_base_les_subset_d4.mat');
load(run,'Wll_2d_masks')
metf = '/Volumes/LaCie/LASSO_runs/cacti/lasso/les/20190208/eda03/morr/d3/corlasso.methagl.2019020800eda03d3.morr.M1.m1.20190208.150000.nc';
Terr = ncread(metf,'HGT');
Lat = ncread(metf,'XLAT');
Lon = ncread(metf,'XLONG');
%}

% run = '//Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/wID_swathID_files/20190125_eda07_base__d4/widmasks/wID_ObjectOutput_NSj_100m5min_qcld0.0001_dbz10_tt034_154500_25Jan100m_20190125_eda07_base_les_subset_d4.mat';
% load(run,'wIDprofs_2d_masks','Terr','Lat','Lon')
% wmask_lat = Lat;   wmask_lon = Lon;      wmask_terr = Terr; 


% i1 = 150;   i2 = 441;  %401
% j1 = 200;   j2 = 561;  %601
% 
% Terr(i2:end,:) = [];   Terr(:,j2:end) = [] ;
% Terr(1:i1,:) = [];   Terr(:,1:j1) = [] ;
% 
% Lon(i2:end,:) = [];   Lon(:,j2:end) = [] ;
% Lon(1:i1,:) = [];   Lon(:,1:j1) = [] ;
% 
% Lat(i2:end,:) = [];   Lat(:,j2:end) = [] ;
% Lat(1:i1,:) = [];   Lat(:,1:j1) = [] ;


wIDprofs_2d_masks(wIDprofs_2d_masks==0) = NaN;

bbllhh = max(wIDprofs_2d_masks(:,:,:),[],3,'omitnan');
bbb = unique(bbllhh);  bbb(isnan(bbb))=[];
lb = length(bbb) ;
for n = 1:lb
    bbb(n)
    bbllhh( find( bbllhh == bbb(n) ) ) = randi(200);
end

pool = [0 1];
% 
% pool = [  [1,    0.5,  0];
%         [1,    0,    0];
%         [1,    0,  0.5];
%         [0,    1,    1];
%         [1,    1,    0];
%         [0,    1,    0];
%         [0.5,  1,    0];
%         [0,    1,    0.5];
%         [0,    0,    1];
%         [0.5,  0,    1]  ];

specklemap = [];
for l = 1:120
    specklemap = vertcat(specklemap,[ pool(randi(length(pool))) pool(randi(length(pool))) pool(randi(length(pool))) ])    ;
end


figure;
hold on
colormap(specklemap)
contour(Lon,Lat,(Terr/10),[1500:250:2500]/10,'-k')   %contour(Lon,Lat,(Terr/10),[1500:250:2500]/10,'-k')

%{

Ttt = 20   %34;
J25_ex_wobjT = J25_ex_wobj(:,:,:,Ttt) ;
J25_ex_convobjT = J25_ex_convobj(:,:,:,Ttt) ;
contourf(Lon', Lat', max(J25_ex_wobjT,[],3,'omitnan') , [0.99 0.99] , 'LineColor', 'none', 'FaceColor', [0.3 0.3 0.3])

%}
contourf(Lon,Lat,bbllhh,'EdgeColor','k');   %contourf(Lon,Lat, bbllhh  );


axis([-65 -64.6 -32.6 -31.7])

saveas(h, horzcat(imout,'/CWid_snapshot_ex.png') );
outlab = horzcat(imout,'/CWid_snapshot_ex.eps') ;
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);




save('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/finalcorelogB_checkpt.mat')

% clear; load('/Users/marq789/Documents/PROJECTS/ICLASS/LASSO_stuff/finalcorelogB_checkpt.mat')




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% %same as the W vs env correlograms near
% %%%%%%%%%% near the top of the analysis part of the script,
% %%%%%%%%%% but NOW JUST THE DEEP ONES and the Wmax layer rather than Wlfc layer.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%% per case:
ALL_CORRS = [];
ALL_SIG = [];
num_updrafts = [];

for R = 1:ar

    % R = 1;

    %pick the swath time rel to cloudy time:
    TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; 1=0offset, 2:swath -5min back, 3:swath -10min back, 4:swath -15min back, 7 = -30min back

    %%%% all cases together
    CLDupdraft_area = max(widMAX1ARdeep_profs_area_ALLCASES(:,:,:,R),[],2) ;
         CLDupdraft_area = permute(CLDupdraft_area,[1 3 4 2]);
    CLDupdraft_VertMassFlux = max(widMAX1ARdeep_profs_massflux_ALLCASES(:,:,:,R),[],2) ;
         CLDupdraft_VertMassFlux = permute(CLDupdraft_VertMassFlux,[1 3 4 2]);
    CLDupdraft_MaxMagnitude = max(widMAX1ARdeep_profs_maxmag_ALLCASES(:,:,:,R),[],2) ;
         CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);

             % dont know if I need this extra filter because wid_maxk_topasl is a raw unfiltered field? ... I think yes if I'm including in correlationss between cloud top and env vars:
       cht_mask = CLDupdraft_area;   cht_mask( isnan(CLDupdraft_area)==0 )=1;   
    CLDupdraft_topZasl      =   wid_maxk_topasl_ALLCASES(:,:,R)    .* cht_mask;


    num_updrafts = vertcat( num_updrafts, length(find(isnan(CLDupdraft_MaxMagnitude)==0)) ); 

    %         %CLDupdraft_topZasl      = permute(CLDupdraft_topZasl,[1 3 4 2]);
    % CLDupdraft_bulkXtilt    = abs(widLFCAR_bulk_xcenttilt_ALLCASES);
    %         CLDupdraft_bulkXtilt    = permute(CLDupdraft_bulkXtilt,[1 3 4 2]);
    % CLDupdraft_bulkMAGtilt  = (widLFCAR_bulk_xcenttilt_ALLCASES.*widLFCAR_bulk_xcenttilt_ALLCASES +  widLFCAR_bulk_ycenttilt_ALLCASES.*widLFCAR_bulk_ycenttilt_ALLCASES ).^0.5 ;
    %         CLDupdraft_bulkMAGtilt  = permute(CLDupdraft_bulkMAGtilt,[1 3 4 2]);

    MesoAscent_Wmagnitude           = widLFCARdeep_mesoWstrength_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_Wmagnitude = permute(MesoAscent_Wmagnitude,[1 2 4 3]);
    MesoAscent_width                = widLFCARdeep_mesoWwidth_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
    MesoAscent_VertMassFlux         = widLFCARdeep_mesoWvmsum_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_VertMassFlux = permute(MesoAscent_VertMassFlux,[1 2 4 3]);
    MesoAscent_DepthPerLfc          = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_DepthPerLfc = permute(MesoAscent_DepthPerLfc,[1 2 4 3]);
    MesoAscent_LFCzagl              = widLFCARdeep_mesoWlfcagl_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_LFCzagl = permute(MesoAscent_LFCzagl,[1 2 4 3]);
    MesoAscent_CAPE                 = widLFCARdeep_mesoWcape_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_CAPE = permute(MesoAscent_CAPE, [1 2 4 3]);
    MesoAscent_CIN                  = widLFCARdeep_mesoWcin_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_CIN = permute(MesoAscent_CIN, [1 2 4 3]);
    MesoAscent_Theta                = widLFCARdeep_mesoWtheta_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_Theta = permute(MesoAscent_Theta, [1 2 4 3]);
    MesoAscent_Qvapor               = widLFCARdeep_mesoWqvap_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_Qvapor = permute(MesoAscent_Qvapor, [1 2 4 3]);
    MesoAscent_RHaloft              = widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_RHaloft = permute(MesoAscent_RHaloft, [1 2 4 3]);
    MesoAscent_1to5kmaslBulkShear   = widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_1to5kmaslBulkShear = permute(MesoAscent_1to5kmaslBulkShear, [1 2 4 3]);
    MesoAscent_1to9kmaslBulkShear   = widLFCARdeep_mesoWeast1to9aslTOTMAGshear_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_1to9kmaslBulkShear = permute(MesoAscent_1to9kmaslBulkShear, [1 2 4 3]);
    MesoAscent_InCloudBulkUShear    = widLFCARdeep_bulkUshearinupdraft_ALLCASES(:,:,TIMLG,R) ;
    %MesoAscent_InCloudBulkUShear = permute(MesoAscent_InCloudBulkUShear, [1 2 4 3]);

    MesoAscent_EastUpslopeMag            = abs(widLFCARdeep_eastupslopemean_ALLCASES(:,:,TIMLG,R));   %note: mean of just the layer with upslope present, not some static ht layer
    MesoAscent_EastUpslopeDepthFract     = widLFCARdeep_eastupslopedepthfract_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeMag            = widLFCARdeep_westupslopemean_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeDepthFract     = widLFCARdeep_westupslopedepthfract_ALLCASES(:,:,TIMLG,R) ;

    MesoAscent_EastUpslopeDepth          = widLFCARdeep_eastupslopedepth_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_WestUpslopeDepth          = widLFCARdeep_westupslopedepth_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_EastUpslopeTopHt          = widLFCARdeep_eastupslopetophtasl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeTopHt          = widLFCARdeep_westupslopetophtasl_ALLCASES(:,:,TIMLG,R);

    MesoAscent_EastUpslopeMag2500            = abs(widLFCARdeep_eastupslopemean2500masl_ALLCASES(:,:,TIMLG,R));
    MesoAscent_EastUpslopeDepthFract2500     = widLFCARdeep_eastupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeMag2500            = widLFCARdeep_westupslopemean2500masl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeDepthFract2500     = widLFCARdeep_westupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,R);

    MesoAscent_EastUpslopeMag1500            = abs(widLFCARdeep_eastupslopemean1500magl_ALLCASES(:,:,TIMLG,R));
    MesoAscent_EastUpslopeDepthFract1500     = widLFCARdeep_eastupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeMag1500            = widLFCARdeep_westupslopemean1500magl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeDepthFract1500     = widLFCARdeep_westupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,R);

    MesoAscent_eastUmean3to4kmasl    = widLFCARdeep_eastUmean3to4kmasl_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_eastUmean4to5kmasl    = widLFCARdeep_eastUmean4to5kmasl_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_eastUmean5to6kmasl    = widLFCARdeep_eastUmean5to6kmasl_ALLCASES(:,:,TIMLG,R) ;

    %note, these already are time-offset from wID time by -15 min:  dont
    %think you really need the cht_mask here because were only looking at
    %correl between updrafts and their env, which will already be hit by
    %cht_mask via cloudy updraft vars
    nearupdaft_0to3kmaglBulkShear   =   FwID_shear_mag_bulk_0to3km_ALLCASES(:,:,R) .* cht_mask; 
    nearupdaft_0to6kmaglBulkShear   =   FwID_shear_mag_bulk_0to6km_ALLCASES(:,:,R) .* cht_mask; 
    nearupdaft_0to9kmaglBulkShear   =   FwID_shear_mag_bulk_0to9km_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_mean_ACBL_RH         =   FwID_RH_mean_ACBL_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_MUCAPE               =   FwID_MUCAPE_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_MUCIN                =   FwID_MUCIN_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_MU_ACBL_CAPE         =   FwID_MUACBLCAPE_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_MUEL                 =   FwID_MUEL_ALLCASES(:,:,R) .* cht_mask;
    %nearupdaft_MUvap                =   FwID_MUvap_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_MUthetae                =   FwID_MUthetae_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_MULFC                =   FwID_MULFC_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_MULCL                =   FwID_MULCL_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_ACBLthetae           =   FwID_thetae_mean_ACBL_mu_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_upslopemean             =   abs(FwID_upslope_mean_ALLCASES(:,:,R)) .* cht_mask;
    nearupdaft_upslopemax              =   abs(FwID_upslope_max_ALLCASES(:,:,R)) .* cht_mask;
    nearupdaft_upslopedepth            =   FwID_upslope_depth_ALLCASES(:,:,R) .* cht_mask;
    nearupdaft_upslopefract            =   FwID_upslope_fract_ALLCASES(:,:,R) .* cht_mask;


%    %diag
%    aa = CLDupdraft_area(:)/1000000;  aa = CLDupdraft_topZasl(:)/1000;   
%    bb = MesoAscent_CAPE(:);  bb = nearupdaft_MUCAPE(:);
%    kill = find(isnan(aa));  aa(kill) = [];  bb(kill) = [];   kill = find(isnan(bb));  aa(kill) = [];  bb(kill) = [];
%    [cc,p] = corrcoef(aa,bb)
%    figure; plot(aa,bb,'o')


    % filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
    %just kill the mesoascent fields so that we can still compare cldy
    %updrafts to near-cloud sounding metrics
    kill = find(  abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,R) )  >  distswathwid_thresh  );
    CLDupdraft_area(kill) = NaN;
    CLDupdraft_VertMassFlux(kill) = NaN;
    CLDupdraft_MaxMagnitude(kill) = NaN;
    CLDupdraft_topZasl(kill) = NaN;
    % CLDupdraft_bulkXtilt(kill) = NaN;
    % CLDupdraft_bulkMAGtilt(kill) = NaN;
    MesoAscent_Wmagnitude(kill)           = NaN;
    MesoAscent_width(kill)                = NaN;
    MesoAscent_VertMassFlux(kill)         = NaN;
    MesoAscent_DepthPerLfc(kill)          = NaN;
    MesoAscent_LFCzagl(kill)              = NaN;
    % MesoAscent_CAPE                 = NaN;
    % MesoAscent_CIN                  = NaN;
    % MesoAscent_Theta                = NaN;
    % MesoAscent_Qvapor               = NaN;
    % MesoAscent_RHaloft              = NaN;
    MesoAscent_EastUpslopeMag(kill)       = NaN;
    MesoAscent_EastUpslopeDepth(kill)     = NaN;
    MesoAscent_WestUpslopeMag(kill)       = NaN;
    MesoAscent_WestUpslopeDepth(kill)     = NaN;
    % MesoAscent_1to5kmaslBulkShear   = NaN;
    % MesoAscent_1to9kmaslBulkShear   = NaN;
    % MesoAscent_InCloudBulkUShear    = NaN;



    %%%%%%%%%%%%% Use these for Jim sounding code based env metrics:
    
    %%%%%%%%%%%%% Use these for Jim sounding code based env metrics:
    
    ALL_vars = {'CLDupdraft_area';
    'CLDupdraft_VertMassFlux';
    'CLDupdraft_MaxMagnitude';
    'CLDupdraft_topZasl';
    
    'MesoAscent_Wmagnitude';
    'MesoAscent_width';
    'MesoAscent_VertMassFlux';
    'MesoAscent_DepthPerLfc';
    
    % 'MesoAscent_1to9kmaslBulkShear';
    % 'MesoAscent_1to5kmaslBulkShear';
    
    'nearupdaft_0to3kmaglBulkShear';
    'nearupdaft_0to6kmaglBulkShear';
    'nearupdaft_0to9kmaglBulkShear';
    
%     'nearupdaft_upslopefract';
%     'nearupdaft_upslopemax';
    'MesoAscent_EastUpslopeDepth';
    'MesoAscent_WestUpslopeDepth';
    'MesoAscent_EastUpslopeMag';
    'MesoAscent_WestUpslopeMag';
    
%     'MesoAscent_LFCzagl';
%     'MesoAscent_CIN';
%     % 'MesoAscent_Theta';
%     % 'MesoAscent_Qvapor';
%     'MesoAscent_RHaloft'
%     'MesoAscent_CAPE';

    %'nearupdaft_MUthetae'
    'nearupdaft_ACBLthetae';
    'nearupdaft_mean_ACBL_RH';

    %'nearupdaft_MUthetae';  
    %'nearupdaft_MUvap';
    'nearupdaft_MULCL';
    'nearupdaft_MULFC';
    'nearupdaft_MUCIN';
    'nearupdaft_MU_ACBL_CAPE';
    'nearupdaft_MUCAPE';
    };


    ALL_vars = flipdim(ALL_vars,1) ;

    ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
    ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
    ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;

    SIGTHRESH = 0.05;
    for n = 1:length(ALL_vars)
        for m = 1:length(ALL_vars)
            %  n = 1; m = 3
            AA = char(ALL_vars(n)) ;
            AA = eval(AA);
            BB = char(ALL_vars(m)) ;
            BB = eval(BB);
            kill = isnan(BB);
            BB(kill) = []; AA(kill) = [];
            kill = isnan(AA);
            BB(kill) = []; AA(kill) = [];
            [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
            ALL_corrs(n,m) = corab ;
            ALL_Ps(n,m) = pval;
            if(pval < SIGTHRESH)          %significant
                ALL_statsig(n,m) = NaN;   % marking signif as nan for now (dont remember why - i think matlab couldnt handle 1 and 0 for something at some stage), it will be switched to 1 later for plotting purposes
            else 
                ALL_corrs(n,m) = NaN;
                ALL_statsig(n,m) = 0; %0;   
            end
        end
    end
    ALL_corrs = single(ALL_corrs);
    isupper = logical(triu(ones(size(ALL_corrs)),1));
    ALL_corrs(isupper) = NaN;
    ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN;

    ALL_statsig = single(ALL_statsig);
    isupper = logical(triu(ones(size(ALL_statsig)),1));
    ALL_statsig(isupper) = NaN;
    ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;


    varlab = {};
    for l = 1:length(ALL_vars)
        asd = char(ALL_vars(l,:) )   ;
        asd(find(asd=='_'))=' '   ;
        varlab = vertcat(varlab,asd);
    end

    %round
    ALL_corrs = round(ALL_corrs,2);

    ALL_CORRS = cat(3,ALL_CORRS,ALL_corrs);
    ALL_SIG = cat(3,ALL_SIG,ALL_statsig);

    dualpol_colmap
    ff = figure('Position',[246,77,1187,900])
    h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['Correlogram - ', Rlab ,' (Filt: LFClayer,small area,deeponly)  cloud time lag = ',num2str((TIMLG-1)*5),'min ',RUNS(R,1:8)])

%     saveas(ff, horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.png') );
%     outlab = horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);

end




dualpol_colmap
ff = figure('Position',[246,77,1187,900])
meancorr = mean(ALL_CORRS,3,'omitnan');  
h = heatmap(round(meancorr,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['Correlogram - (Filt: LFClayer,small area,deeponly)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%%% helpful diagnostic plots:

% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
ALL_SIG(isnan(ALL_SIG)) = 1;   %swap significant marker from nan to 1
SUMSIG = sum(ALL_SIG,3,'omitnan');  
h = heatmap(round(SUMSIG,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['deeponly; sum of significant cases ',num2str((TIMLG-1)*5)])

% saveas(ff, horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


% number of blocks with same correlation sign as the ensemble mean :
ALL_COR_SIGN  = sign( ALL_CORRS );
meancorr = mean(ALL_CORRS,3,'omitnan');
MEANCOR = [];
for y = 1:ar  % stitch together for dimension matching. 
    MEANCOR = cat(3,MEANCOR, meancorr);
end
MEANCOR_SIGN = sign(MEANCOR);
[ci cj cy] = size(MEANCOR);
MATCHED_SIGNS = MEANCOR_SIGN;   MATCHED_SIGNS(:) = NaN; %array with 1 where case blocks match mean block
match = find(MEANCOR_SIGN == ALL_COR_SIGN);
MATCHED_SIGNS(match) = 1;
SUM_MATCHED_SIGNS = sum(MATCHED_SIGNS,3,'omitnan');



% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(SUM_MATCHED_SIGNS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['sum signs matched to mean (Filt: LFClayer,small area,deeponly) '])

% saveas(ff, horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);

%{
%diagnostic per-case log of useable confidence/significance
for R = 1:ar

    [asd fgh] = size(ALL_CORRS(:,:,1))
    dayconf = zeros(asd,fgh);    

    %good = find( MATCHED_SIGNS(:,:,R) == 1 & ALL_SIG(:,:,R) == 1  ) ; 
    good = find( ALL_SIG(:,:,R) == 1  ) ; 
    dayconf(good) = 1;

    figure
    h = heatmap(round(dayconf,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    %h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['deeponly, matched sign and stat sig for case: ', RUNS(R,:) ])

end
%}


%%%%%%%% now use this to divide into high, med, low confidence
%%%%%%%% interpretations:

HICONF_MEAN_CORRS = zeros(ci,cj);    HICONF_MEAN_CORRS(:) = NaN; 
MECONF_MEAN_CORRS = zeros(ci,cj);    MECONF_MEAN_CORRS(:) = NaN; 
LOCONF_MEAN_CORRS = zeros(ci,cj);    LOCONF_MEAN_CORRS(:) = NaN; 
for i = 1:ci
    for j = 1:cj
        %  i = 19; j = 18

        %use for article plot hi & med breakdown:
        %{
        HSIGN = ( SUM_MATCHED_SIGNS(i,j)   >= 5  )   ;
        MSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 5  &  SUM_MATCHED_SIGNS(i,j)   >= 3 );
        LSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 3 );

        HSIG = ( SUMSIG(i,j)   >=  5  )   ;
        MSIG = ( SUMSIG(i,j) < 5  &   SUMSIG(i,j) >= 3 );
        LSIG = ( SUMSIG(i,j) < 3 );        

        if( HSIGN==1  &  HSIG==1 & MSIGN==0  &  MSIG==0 & LSIGN==0  & LSIG==0)
            HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==0  &  HSIG==0 & MSIGN==1  &  MSIG==1 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
            MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(LSIGN==1  | LSIG==1 )
            LOCONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        end
        %}


        %use for ppt presentations simplified:
        HSIGN = ( SUM_MATCHED_SIGNS(i,j)   >= 4  )   ;
%         MSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 5  &  SUM_MATCHED_SIGNS(i,j)   >= 3 );
        LSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 3 );

        HSIG = ( SUMSIG(i,j)   >=  4  )   ;
        %MSIG = ( SUMSIG(i,j) < 5  &   SUMSIG(i,j) >= 3 );
        LSIG = ( SUMSIG(i,j) < 3 );        

%         if( HSIGN==1  &  HSIG==1 & MSIGN==0  &  MSIG==0 & LSIGN==0  & LSIG==0)
%             HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        if( HSIGN==1  &  HSIG==1 )
            HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==0  &  HSIG==0 & MSIGN==1  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        elseif(LSIGN==1  | LSIG==1 )
            LOCONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
        end    
    end
end



% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(HICONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['HI CONF Correlogram - (Filt: LFClayer,small area,deeponly)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

saveas(ff, horzcat(imout,'/widcorrelogram_HIConf_allcasemean_MAX1ARdeepfilt.png') );
outlab = horzcat(imout,'/widcorrelogram_HIConf_allcasemean_MAX1ARdeepfilt.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);


% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(MECONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['MED CONF Correlogram - (Filt: LFClayer,small area,deeponly)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

saveas(ff, horzcat(imout,'/widcorrelogram_MEDConf_allcasemean_MAX1ARdeepfilt.png') );
outlab = horzcat(imout,'/widcorrelogram_MEDConf_allcasemean_MAX1ARdeepfilt.eps');
EPSprint = horzcat('print -painters -depsc ',outlab);
eval([EPSprint]);


% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(LOCONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['LOW CONF Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])































%%%%%%%%
%%%%%%%%
%%%%%%%%
%%%%%%%%          correlograms to comapre with obs:
%%%%%%%%
%%%%%%%%
%%%%%%%%







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% 1)  For OBS cells, use script:
%%%%%%%%%
%%%%%%%%%  ...Projects/ICLASS/CACTI-CI/TRackedEnvironment/FunMetrics_REVIVEforLASSOcomparison.m
%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%  2) For simulated wIDs 
%%%%
%%%%   This is a mix of FULLSDC space and sounding-based metrics
%%%%     
%%%%   shallow + deep updrafts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%pick the swath time rel to cloudy time:
TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; 1=0offset, 2:swath -5min back, 3:swath -10min back, 4:swath -15min back, 7 = -30min back

%%%% all cases together
CLDupdraft_area = max(widLFCAR_profs_area_ALLCASES(:,:,:,:),[],2) ;       
        CLDupdraft_area = permute(CLDupdraft_area,[1 3 4 2]);
CLDupdraft_VertMassFlux = max(widLFCAR_profs_massflux_ALLCASES(:,:,:,:),[],2) ;
        CLDupdraft_VertMassFlux = permute(CLDupdraft_VertMassFlux,[1 3 4 2]);
CLDupdraft_MaxMagnitude = max(widLFCAR_profs_maxmag_ALLCASES(:,:,:,:),[],2) ;
        CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);

%CLDupdraft_topZasl      =   wid_maxk_topasl_ALLCASES;
cht_mask = CLDupdraft_area;   cht_mask( isnan(CLDupdraft_area)==0 )=1;   
    CLDupdraft_topZasl      =   wid_maxk_topasl_ALLCASES(:,:,R)    .* cht_mask;


MesoAscent_Wmagnitude           = widLFCAR_mesoWstrength_ALLCASES(:,:,TIMLG,:);  
    MesoAscent_Wmagnitude = permute(MesoAscent_Wmagnitude,[1 2 4 3]);
MesoAscent_width                = widLFCAR_mesoWwidth_ALLCASES(:,:,TIMLG,:);
    MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
%MesoAscent_VertMassFlux         = widLFCAR_mesoWvmsum_ALLCASES(:,:,TIMLG,:);
%MesoAscent_VertMassFlux         = widLFCAR_mesoWvmsumHSUM_ALLCASES(:,:,TIMLG,:);
    MesoAscent_VertMassFlux = permute(MesoAscent_VertMassFlux,[1 2 4 3]);
MesoAscent_DepthPerLfc          = widLFCAR_mesoWtoplfcaslRAT_ALLCASES(:,:,TIMLG,:);
    MesoAscent_DepthPerLfc = permute(MesoAscent_DepthPerLfc,[1 2 4 3]);

MesoAscent_LFCzagl              = widLFCAR_mesoWlfcagl_ALLCASES(:,:,TIMLG,:);
    MesoAscent_LFCzagl = permute(MesoAscent_LFCzagl,[1 2 4 3]);
MesoAscent_CAPE                 = widLFCAR_mesoWcape_ALLCASES(:,:,TIMLG,:);
    MesoAscent_CAPE = permute(MesoAscent_CAPE, [1 2 4 3]);
MesoAscent_CIN                  = widLFCAR_mesoWcin_ALLCASES(:,:,TIMLG,:);
    MesoAscent_CIN = permute(MesoAscent_CIN, [1 2 4 3]);
MesoAscent_Theta                = widLFCAR_mesoWtheta_ALLCASES(:,:,TIMLG,:);
    MesoAscent_Theta = permute(MesoAscent_Theta, [1 2 4 3]);
MesoAscent_Qvapor               = widLFCAR_mesoWqvap_ALLCASES(:,:,TIMLG,:);
    MesoAscent_Qvapor = permute(MesoAscent_Qvapor, [1 2 4 3]);
MesoAscent_RHaloft              = widLFCAR_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,:);
    MesoAscent_RHaloft = permute(MesoAscent_RHaloft, [1 2 4 3]);

MesoAscent_EastUpslopeMag       = abs(widLFCAR_eastupslopemean_ALLCASES(:,:,TIMLG,:));
    MesoAscent_EastUpslopeMag = permute(MesoAscent_EastUpslopeMag, [1 2 4 3]);
MesoAscent_EastUpslopeDepthFract     = widLFCAR_eastupslopedepthfract_ALLCASES(:,:,TIMLG,:);
    MesoAscent_EastUpslopeDepthFract = permute(MesoAscent_EastUpslopeDepthFract, [1 2 4 3]);
% MesoAscent_WestUpslopeMag       = widLFCAR_westupslopemean_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeMag = permute(MesoAscent_WestUpslopeMag, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract     = widLFCAR_westupslopedepthfract_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract = permute(MesoAscent_WestUpslopeDepthFract, [1 2 4 3]);    

MesoAscent_EastUpslopeDepth       = abs(widLFCAR_eastupslopedepth_ALLCASES(:,:,TIMLG,:));
    MesoAscent_EastUpslopeDepth = permute(MesoAscent_EastUpslopeDepth, [1 2 4 3]); 
% MesoAscent_WestUpslopeDepth       = abs(widLFCAR_westupslopedepth_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeDepth = permute(MesoAscent_WestUpslopeDepth, [1 2 4 3]);

% MesoAscent_EastUpslopeTopHt       = abs(widLFCAR_eastupslopetophtasl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeTopHt = permute(MesoAscent_EastUpslopeTopHt, [1 2 4 3]); 
% MesoAscent_WestUpslopeTopHt       = abs(widLFCAR_westupslopetophtasl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeTopHt = permute(MesoAscent_WestUpslopeDepth, [1 2 4 3]);

% MesoAscent_EastUpslopeMag2500       = abs(widLFCAR_eastupslopemean2500masl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeMag2500 = permute(MesoAscent_EastUpslopeMag2500, [1 2 4 3]);
% MesoAscent_EastUpslopeDepthFract2500     = widLFCAR_eastupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_EastUpslopeDepthFract2500 = permute(MesoAscent_EastUpslopeDepthFract2500, [1 2 4 3]);
% MesoAscent_WestUpslopeMag2500       = abs(widLFCAR_westupslopemean2500masl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeMag2500 = permute(MesoAscent_WestUpslopeMag2500, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract2500     = widLFCAR_westupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract2500 = permute(MesoAscent_WestUpslopeDepthFract2500, [1 2 4 3]);    

% MesoAscent_EastUpslopeMag1500       = abs(widLFCAR_eastupslopemean1500magl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeMag1500 = permute(MesoAscent_EastUpslopeMag1500, [1 2 4 3]);
% MesoAscent_EastUpslopeDepthFract1500     = widLFCAR_eastupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_EastUpslopeDepthFract1500 = permute(MesoAscent_EastUpslopeDepthFract1500, [1 2 4 3]);
% MesoAscent_WestUpslopeMag1500       = abs(widLFCAR_westupslopemean1500magl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeMag1500 = permute(MesoAscent_WestUpslopeMag1500, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract1500     = widLFCAR_westupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract1500 = permute(MesoAscent_WestUpslopeDepthFract1500, [1 2 4 3]);    

% MesoAscent_1to5kmaslBulkShear   = widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_1to5kmaslBulkShear = permute(MesoAscent_1to5kmaslBulkShear, [1 2 4 3]);
% MesoAscent_1to9kmaslBulkShear   = widLFCAR_mesoWeast1to9aslTOTMAGshear_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_1to9kmaslBulkShear = permute(MesoAscent_1to9kmaslBulkShear, [1 2 4 3]);
% MesoAscent_InCloudBulkUShear    = widLFCAR_bulkUshearinupdraft_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_InCloudBulkUShear = permute(MesoAscent_InCloudBulkUShear, [1 2 4 3]);

% MesoAscent_eastUmean3to4kmasl    = widLFCAR_eastUmean3to4kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean3to4kmasl = permute(MesoAscent_eastUmean3to4kmasl, [1 2 4 3]);
% MesoAscent_eastUmean4to5kmasl    = widLFCAR_eastUmean4to5kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean4to5kmasl = permute(MesoAscent_eastUmean4to5kmasl, [1 2 4 3]);
% MesoAscent_eastUmean5to6kmasl    = widLFCAR_eastUmean5to6kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean5to6kmasl = permute(MesoAscent_eastUmean5to6kmasl, [1 2 4 3]);

nearupdaft_0to3kmaglBulkShear   =   FwID_shear_mag_bulk_0to3km_ALLCASES;
nearupdaft_0to6kmaglBulkShear   =   FwID_shear_mag_bulk_0to6km_ALLCASES;
nearupdaft_0to9kmaglBulkShear   =   FwID_shear_mag_bulk_0to9km_ALLCASES;
nearupdaft_mean_ACBL_RH         =   FwID_RH_mean_ACBL_ALLCASES;
nearupdaft_MUCAPE               =   FwID_MUCAPE_ALLCASES;
nearupdaft_MUCIN                =   FwID_MUCIN_ALLCASES;
nearupdaft_MU_ACBL_CAPE         =   FwID_MUACBLCAPE_ALLCASES;
nearupdaft_MUEL                 =   FwID_MUEL_ALLCASES;
nearupdaft_MULFC                =   FwID_MULFC_ALLCASES;
nearupdaft_MULCL                =   FwID_MULCL_ALLCASES;
nearupdaft_ACBLthetae           =   FwID_thetae_mean_ACBL_mu_ALLCASES;

% nearupdaft_upslopemean             =   abs(FwID_upslope_mean_ALLCASES(:));
% nearupdaft_upslopemax              =   abs(FwID_upslope_max_ALLCASES(:));
% nearupdaft_upslopedepth            =   FwID_upslope_depth_ALLCASES(:);
% nearupdaft_upslopefract            =   FwID_upslope_fract_ALLCASES(:);


% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
kill = find(  abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,:) )  >  distswathwid_thresh  ); 
CLDupdraft_area(kill) = NaN;
CLDupdraft_VertMassFlux(kill) = NaN;
CLDupdraft_MaxMagnitude(kill) = NaN;       
CLDupdraft_topZasl(kill) = NaN;
CLDupdraft_bulkXtilt(kill) = NaN;
CLDupdraft_bulkMAGtilt(kill) = NaN;
MesoAscent_Wmagnitude(kill)           = NaN;
MesoAscent_width(kill)                = NaN;
MesoAscent_VertMassFlux(kill)         = NaN;
MesoAscent_DepthPerLfc(kill)          = NaN;
MesoAscent_LFCzagl(kill)              = NaN;
% MesoAscent_CAPE                 = NaN;
% MesoAscent_CIN                  = NaN;
% MesoAscent_Theta                = NaN;
% MesoAscent_Qvapor               = NaN;
% MesoAscent_RHaloft              = NaN;
% MesoAscent_EastUpslopeMag       = NaN;
% MesoAscent_EastUpslopeDepth     = NaN;
% MesoAscent_WestUpslopeMag       = NaN;
% MesoAscent_1to5kmaslBulkShear   = NaN;
% MesoAscent_1to9kmaslBulkShear   = NaN;
% MesoAscent_InCloudBulkUShear    = NaN;


%Implement env masks:
mask_cape = cht_mask; mask_cape(:) = NaN;
mask_cin = cht_mask;  mask_cin(:) = NaN;
mask_el = cht_mask;   mask_el(:) = NaN;
[as df gh] = size(nearupdaft_MUCAPE)
for i = 1:as
    for j = 1:df
        for g = 1:gh
            if( nearupdaft_MUCAPE(i,j,g) > 100. )
                mask_cape(i,j,g) = 1;
            end
            if( nearupdaft_MUCIN(i,j,g) > -10. )
                mask_cin(i,j,g) = 1;
            end
            if( nearupdaft_MUEL(i,j,g) > 5000. )
                mask_el(i,j,g) = 1;
            end          
        end
    end
end
allmask = mask_cape .* mask_cin .* mask_el .* cht_mask ;

%apply masks:
CLDupdraft_area             = CLDupdraft_area .* allmask;
CLDupdraft_VertMassFlux     = CLDupdraft_VertMassFlux .* allmask;
CLDupdraft_MaxMagnitude     = CLDupdraft_MaxMagnitude .* allmask;
CLDupdraft_topZasl          = CLDupdraft_topZasl .* allmask;
MesoAscent_Wmagnitude       = MesoAscent_Wmagnitude .* allmask;
MesoAscent_width            = MesoAscent_width .* allmask; 
MesoAscent_VertMassFlux     = MesoAscent_VertMassFlux .* allmask;
MesoAscent_DepthPerLfc      = MesoAscent_DepthPerLfc .* allmask;
MesoAscent_LFCzagl          = MesoAscent_LFCzagl .* allmask;
MesoAscent_CAPE             = MesoAscent_CAPE .* allmask;
MesoAscent_CIN              = MesoAscent_CIN .* allmask; 
MesoAscent_Theta            = MesoAscent_Theta .* allmask;
MesoAscent_Qvapor           = MesoAscent_Qvapor .* allmask;
MesoAscent_RHaloft          = MesoAscent_RHaloft .* allmask;
MesoAscent_EastUpslopeMag         =  MesoAscent_EastUpslopeMag .* allmask;
MesoAscent_EastUpslopeDepthFract        =  MesoAscent_EastUpslopeDepthFract .* allmask;
nearupdaft_0to3kmaglBulkShear   =   nearupdaft_0to3kmaglBulkShear .* allmask;
nearupdaft_0to6kmaglBulkShear   =   nearupdaft_0to6kmaglBulkShear .* allmask;   
nearupdaft_0to9kmaglBulkShear   =   nearupdaft_0to9kmaglBulkShear .* allmask;   
nearupdaft_mean_ACBL_RH         =   nearupdaft_mean_ACBL_RH .* allmask;  
nearupdaft_MUCAPE               =   nearupdaft_MUCAPE .* allmask; 
nearupdaft_MUCIN                =   nearupdaft_MUCIN .* allmask; 
nearupdaft_MU_ACBL_CAPE         =   nearupdaft_MU_ACBL_CAPE .* allmask; 
nearupdaft_MUEL                 =   nearupdaft_MUEL .* allmask; 
nearupdaft_MULFC                =   nearupdaft_MULFC .* allmask; 
nearupdaft_MULCL                =   nearupdaft_MULCL .* allmask; 
nearupdaft_ACBLthetae           =   nearupdaft_ACBLthetae .* allmask; 






% ALL_vars = {'Cell_area' ;
%     'Cell_max_dBZ'  ;
%     'Cell_ETH' ;
%     'Bulk_shear_0to3km';
%     'Bulk_shear_0to6km';
%     'Bulk_shear_0to9km';  
%     'UpslopeEast_depth';     
%     'UpslopeEast_mean_magnitude';
%     'Thetae_mean_ACBL';
%     'ACBL_mean_RH';
%     'MULCL_height';     
%     'MULFC_height';    
%     'MUCIN';    
%     'ACBL_MUCAPE';
%     'MUCAPE';
%     };

ALL_vars = {'CLDupdraft_area'; 
'CLDupdraft_MaxMagnitude';
'CLDupdraft_topZasl';

'nearupdaft_0to3kmaglBulkShear';   
'nearupdaft_0to6kmaglBulkShear';
'nearupdaft_0to9kmaglBulkShear';
'MesoAscent_EastUpslopeDepth';
'MesoAscent_EastUpslopeMag';

'nearupdaft_ACBLthetae';
'nearupdaft_mean_ACBL_RH';
'nearupdaft_MULCL';
'nearupdaft_MULFC';
'nearupdaft_MUCIN';
'nearupdaft_MU_ACBL_CAPE';
'nearupdaft_MUCAPE';
};



num_samples = [ length(find(isnan(nearupdaft_MULCL)==0)), length(find(isnan(CLDupdraft_area)==0)), ...
    length(find(isnan(nearupdaft_0to6kmaglBulkShear)==0)), length(find(isnan(MesoAscent_EastUpslopeMag)==0)) ]  ;

num_samples = min(num_samples)




ALL_vars = flipdim(ALL_vars,1) ;

ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;
SIGTHRESH = 0.05;
for n = 1:length(ALL_vars)
    for m = 1:length(ALL_vars)
        %  n = 1; m = 3
        AA = char(ALL_vars(n)) ; 
        AA = eval(AA);
        BB = char(ALL_vars(m)) ;  
        BB = eval(BB);
        kill = isnan(BB);
        BB(kill) = []; AA(kill) = [];
        kill = isnan(AA);
        BB(kill) = []; AA(kill) = [];
        [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
        ALL_corrs(n,m) = corab ;
        ALL_Ps(n,m) = pval;
        if(pval < SIGTHRESH)
            ALL_statsig(n,m) = NaN;
        else
            ALL_corrs(n,m) = NaN;
            ALL_statsig(n,m) = 0; %0;    
        end
    end
end
ALL_corrs = single(ALL_corrs);
isupper = logical(triu(ones(size(ALL_corrs)),1));
ALL_corrs(isupper) = NaN;
ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN;

ALL_statsig = single(ALL_statsig);
isupper = logical(triu(ones(size(ALL_statsig)),1));
ALL_statsig(isupper) = NaN;
ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;

varlab = {};
for l = 1:length(ALL_vars)
   asd = char(ALL_vars(l,:) )   ;
   asd(find(asd=='_'))=' '   ;
   varlab = vertcat(varlab,asd);
end

%round 
ALL_corrs = round(ALL_corrs,2);

dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
title(['wID-lasso Correlogram - all cases combined[n=',num2str(num_samples),']  (Filt: LFClayer,small area),  cloud time lag = ',num2str((TIMLG-1)*5),'min'])

% saveas(h, horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt_forboscompare.png') );
% outlab = horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt_forboscompare.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%  2b) For simulated wIDs 
%%%%
%%%%   This is a mix of FULLSDC space and sounding-based metrics
%%%%     
%%%%   only deep updrafts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%pick the swath time rel to cloudy time:
TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; 1=0offset, 2:swath -5min back, 3:swath -10min back, 4:swath -15min back, 7 = -30min back

%%%% all cases together
CLDupdraft_area = max(widLFCARdeep_profs_area_ALLCASES(:,:,:,:),[],2) ;       
        CLDupdraft_area = permute(CLDupdraft_area,[1 3 4 2]);
CLDupdraft_VertMassFlux = max(widLFCARdeep_profs_massflux_ALLCASES(:,:,:,:),[],2) ;
        CLDupdraft_VertMassFlux = permute(CLDupdraft_VertMassFlux,[1 3 4 2]);
CLDupdraft_MaxMagnitude = max(widLFCARdeep_profs_maxmag_ALLCASES(:,:,:,:),[],2) ;
        CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);

%CLDupdraft_topZasl      =   wid_maxk_topasl_ALLCASES;
cht_mask = CLDupdraft_area;   cht_mask( isnan(CLDupdraft_area)==0 )=1;   
    CLDupdraft_topZasl      =   wid_maxk_topasl_ALLCASES(:,:,R)    .* cht_mask;


MesoAscent_Wmagnitude           = widLFCARdeep_mesoWstrength_ALLCASES(:,:,TIMLG,:);  
    MesoAscent_Wmagnitude = permute(MesoAscent_Wmagnitude,[1 2 4 3]);
MesoAscent_width                = widLFCARdeep_mesoWwidth_ALLCASES(:,:,TIMLG,:);
    MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
%MesoAscent_VertMassFlux         = widLFCARdeep_mesoWvmsum_ALLCASES(:,:,TIMLG,:);
%MesoAscent_VertMassFlux         = widLFCARdeep_mesoWvmsumHSUM_ALLCASES(:,:,TIMLG,:);
    MesoAscent_VertMassFlux = permute(MesoAscent_VertMassFlux,[1 2 4 3]);
MesoAscent_DepthPerLfc          = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(:,:,TIMLG,:);
    MesoAscent_DepthPerLfc = permute(MesoAscent_DepthPerLfc,[1 2 4 3]);

MesoAscent_LFCzagl              = widLFCARdeep_mesoWlfcagl_ALLCASES(:,:,TIMLG,:);
    MesoAscent_LFCzagl = permute(MesoAscent_LFCzagl,[1 2 4 3]);
MesoAscent_CAPE                 = widLFCARdeep_mesoWcape_ALLCASES(:,:,TIMLG,:);
    MesoAscent_CAPE = permute(MesoAscent_CAPE, [1 2 4 3]);
MesoAscent_CIN                  = widLFCARdeep_mesoWcin_ALLCASES(:,:,TIMLG,:);
    MesoAscent_CIN = permute(MesoAscent_CIN, [1 2 4 3]);
MesoAscent_Theta                = widLFCARdeep_mesoWtheta_ALLCASES(:,:,TIMLG,:);
    MesoAscent_Theta = permute(MesoAscent_Theta, [1 2 4 3]);
MesoAscent_Qvapor               = widLFCARdeep_mesoWqvap_ALLCASES(:,:,TIMLG,:);
    MesoAscent_Qvapor = permute(MesoAscent_Qvapor, [1 2 4 3]);
MesoAscent_RHaloft              = widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,:);
    MesoAscent_RHaloft = permute(MesoAscent_RHaloft, [1 2 4 3]);

MesoAscent_EastUpslopeMag       = abs(widLFCARdeep_eastupslopemean_ALLCASES(:,:,TIMLG,:));
    MesoAscent_EastUpslopeMag = permute(MesoAscent_EastUpslopeMag, [1 2 4 3]);
MesoAscent_EastUpslopeDepthFract     = widLFCARdeep_eastupslopedepthfract_ALLCASES(:,:,TIMLG,:);
    MesoAscent_EastUpslopeDepthFract = permute(MesoAscent_EastUpslopeDepthFract, [1 2 4 3]);
% MesoAscent_WestUpslopeMag       = widLFCAR_westupslopemean_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeMag = permute(MesoAscent_WestUpslopeMag, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract     = widLFCAR_westupslopedepthfract_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract = permute(MesoAscent_WestUpslopeDepthFract, [1 2 4 3]);    

MesoAscent_EastUpslopeDepth       = abs(widLFCARdeep_eastupslopedepth_ALLCASES(:,:,TIMLG,:));
    MesoAscent_EastUpslopeDepth = permute(MesoAscent_EastUpslopeDepth, [1 2 4 3]); 
% MesoAscent_WestUpslopeDepth       = abs(widLFCAR_westupslopedepth_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeDepth = permute(MesoAscent_WestUpslopeDepth, [1 2 4 3]);

% MesoAscent_EastUpslopeTopHt       = abs(widLFCAR_eastupslopetophtasl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeTopHt = permute(MesoAscent_EastUpslopeTopHt, [1 2 4 3]); 
% MesoAscent_WestUpslopeTopHt       = abs(widLFCAR_westupslopetophtasl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeTopHt = permute(MesoAscent_WestUpslopeDepth, [1 2 4 3]);

% MesoAscent_EastUpslopeMag2500       = abs(widLFCAR_eastupslopemean2500masl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeMag2500 = permute(MesoAscent_EastUpslopeMag2500, [1 2 4 3]);
% MesoAscent_EastUpslopeDepthFract2500     = widLFCAR_eastupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_EastUpslopeDepthFract2500 = permute(MesoAscent_EastUpslopeDepthFract2500, [1 2 4 3]);
% MesoAscent_WestUpslopeMag2500       = abs(widLFCAR_westupslopemean2500masl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeMag2500 = permute(MesoAscent_WestUpslopeMag2500, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract2500     = widLFCAR_westupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract2500 = permute(MesoAscent_WestUpslopeDepthFract2500, [1 2 4 3]);    

% MesoAscent_EastUpslopeMag1500       = abs(widLFCAR_eastupslopemean1500magl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeMag1500 = permute(MesoAscent_EastUpslopeMag1500, [1 2 4 3]);
% MesoAscent_EastUpslopeDepthFract1500     = widLFCAR_eastupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_EastUpslopeDepthFract1500 = permute(MesoAscent_EastUpslopeDepthFract1500, [1 2 4 3]);
% MesoAscent_WestUpslopeMag1500       = abs(widLFCAR_westupslopemean1500magl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeMag1500 = permute(MesoAscent_WestUpslopeMag1500, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract1500     = widLFCAR_westupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract1500 = permute(MesoAscent_WestUpslopeDepthFract1500, [1 2 4 3]);    

% MesoAscent_1to5kmaslBulkShear   = widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_1to5kmaslBulkShear = permute(MesoAscent_1to5kmaslBulkShear, [1 2 4 3]);
% MesoAscent_1to9kmaslBulkShear   = widLFCAR_mesoWeast1to9aslTOTMAGshear_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_1to9kmaslBulkShear = permute(MesoAscent_1to9kmaslBulkShear, [1 2 4 3]);
% MesoAscent_InCloudBulkUShear    = widLFCAR_bulkUshearinupdraft_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_InCloudBulkUShear = permute(MesoAscent_InCloudBulkUShear, [1 2 4 3]);

% MesoAscent_eastUmean3to4kmasl    = widLFCAR_eastUmean3to4kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean3to4kmasl = permute(MesoAscent_eastUmean3to4kmasl, [1 2 4 3]);
% MesoAscent_eastUmean4to5kmasl    = widLFCAR_eastUmean4to5kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean4to5kmasl = permute(MesoAscent_eastUmean4to5kmasl, [1 2 4 3]);
% MesoAscent_eastUmean5to6kmasl    = widLFCAR_eastUmean5to6kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean5to6kmasl = permute(MesoAscent_eastUmean5to6kmasl, [1 2 4 3]);

nearupdaft_0to3kmaglBulkShear   =   FwID_shear_mag_bulk_0to3km_ALLCASES;
nearupdaft_0to6kmaglBulkShear   =   FwID_shear_mag_bulk_0to6km_ALLCASES;
nearupdaft_0to9kmaglBulkShear   =   FwID_shear_mag_bulk_0to9km_ALLCASES;
nearupdaft_mean_ACBL_RH         =   FwID_RH_mean_ACBL_ALLCASES;
nearupdaft_MUCAPE               =   FwID_MUCAPE_ALLCASES;
nearupdaft_MUCIN                =   FwID_MUCIN_ALLCASES;
nearupdaft_MU_ACBL_CAPE         =   FwID_MUACBLCAPE_ALLCASES;
nearupdaft_MUEL                 =   FwID_MUEL_ALLCASES;
nearupdaft_MULFC                =   FwID_MULFC_ALLCASES;
nearupdaft_MULCL                =   FwID_MULCL_ALLCASES;
nearupdaft_ACBLthetae           =   FwID_thetae_mean_ACBL_mu_ALLCASES;

% nearupdaft_upslopemean             =   abs(FwID_upslope_mean_ALLCASES(:));
% nearupdaft_upslopemax              =   abs(FwID_upslope_max_ALLCASES(:));
% nearupdaft_upslopedepth            =   FwID_upslope_depth_ALLCASES(:);
% nearupdaft_upslopefract            =   FwID_upslope_fract_ALLCASES(:);


% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
kill = find(  abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,:) )  > distswathwid_thresh ); 
CLDupdraft_area(kill) = NaN;
CLDupdraft_VertMassFlux(kill) = NaN;
CLDupdraft_MaxMagnitude(kill) = NaN;       
CLDupdraft_topZasl(kill) = NaN;
CLDupdraft_bulkXtilt(kill) = NaN;
CLDupdraft_bulkMAGtilt(kill) = NaN;
MesoAscent_Wmagnitude(kill)           = NaN;
MesoAscent_width(kill)                = NaN;
MesoAscent_VertMassFlux(kill)         = NaN;
MesoAscent_DepthPerLfc(kill)          = NaN;
MesoAscent_LFCzagl(kill)              = NaN;
% MesoAscent_CAPE                 = NaN;
% MesoAscent_CIN                  = NaN;
% MesoAscent_Theta                = NaN;
% MesoAscent_Qvapor               = NaN;
% MesoAscent_RHaloft              = NaN;
% MesoAscent_EastUpslopeMag       = NaN;
% MesoAscent_EastUpslopeDepth     = NaN;
% MesoAscent_WestUpslopeMag       = NaN;
% MesoAscent_1to5kmaslBulkShear   = NaN;
% MesoAscent_1to9kmaslBulkShear   = NaN;
% MesoAscent_InCloudBulkUShear    = NaN;


%Implement env masks:
mask_cape = cht_mask; mask_cape(:) = NaN;
mask_cin = cht_mask;  mask_cin(:) = NaN;
mask_el = cht_mask;   mask_el(:) = NaN;
[as df gh] = size(nearupdaft_MUCAPE)
for i = 1:as
    for j = 1:df
        for g = 1:gh
            if( nearupdaft_MUCAPE(i,j,g) > 100. )
                mask_cape(i,j,g) = 1;
            end
            if( nearupdaft_MUCIN(i,j,g) > -10. )
                mask_cin(i,j,g) = 1;
            end
            if( nearupdaft_MUEL(i,j,g) > 5000. )
                mask_el(i,j,g) = 1;
            end          
        end
    end
end
allmask = mask_cape .* mask_cin .* mask_el .* cht_mask ;
%apply masks:
CLDupdraft_area             = CLDupdraft_area .* allmask;
CLDupdraft_VertMassFlux     = CLDupdraft_VertMassFlux .* allmask;
CLDupdraft_MaxMagnitude     = CLDupdraft_MaxMagnitude .* allmask;
CLDupdraft_topZasl          = CLDupdraft_topZasl .* allmask;
MesoAscent_Wmagnitude       = MesoAscent_Wmagnitude .* allmask;
MesoAscent_width            = MesoAscent_width .* allmask; 
MesoAscent_VertMassFlux     = MesoAscent_VertMassFlux .* allmask;
MesoAscent_DepthPerLfc      = MesoAscent_DepthPerLfc .* allmask;
MesoAscent_LFCzagl          = MesoAscent_LFCzagl .* allmask;
MesoAscent_CAPE             = MesoAscent_CAPE .* allmask;
MesoAscent_CIN              = MesoAscent_CIN .* allmask; 
MesoAscent_Theta            = MesoAscent_Theta .* allmask;
MesoAscent_Qvapor           = MesoAscent_Qvapor .* allmask;
MesoAscent_RHaloft          = MesoAscent_RHaloft .* allmask;
MesoAscent_EastUpslopeMag         =  MesoAscent_EastUpslopeMag .* allmask;
MesoAscent_EastUpslopeDepthFract        =  MesoAscent_EastUpslopeDepthFract .* allmask;
nearupdaft_0to3kmaglBulkShear   =   nearupdaft_0to3kmaglBulkShear .* allmask;
nearupdaft_0to6kmaglBulkShear   =   nearupdaft_0to6kmaglBulkShear .* allmask;   
nearupdaft_0to9kmaglBulkShear   =   nearupdaft_0to9kmaglBulkShear .* allmask;   
nearupdaft_mean_ACBL_RH         =   nearupdaft_mean_ACBL_RH .* allmask;  
nearupdaft_MUCAPE               =   nearupdaft_MUCAPE .* allmask; 
nearupdaft_MUCIN                =   nearupdaft_MUCIN .* allmask; 
nearupdaft_MU_ACBL_CAPE         =   nearupdaft_MU_ACBL_CAPE .* allmask; 
nearupdaft_MUEL                 =   nearupdaft_MUEL .* allmask; 
nearupdaft_MULFC                =   nearupdaft_MULFC .* allmask; 
nearupdaft_MULCL                =   nearupdaft_MULCL .* allmask; 
nearupdaft_ACBLthetae           =   nearupdaft_ACBLthetae .* allmask; 



% ALL_vars = {'Cell_area' ;
%     'Cell_max_dBZ'  ;
%     'Cell_ETH' ;
%     'Bulk_shear_0to3km';
%     'Bulk_shear_0to6km';
%     'Bulk_shear_0to9km';  
%     'UpslopeEast_depth';     
%     'UpslopeEast_mean_magnitude';
%     'Thetae_mean_ACBL';
%     'ACBL_mean_RH';
%     'MULCL_height';     
%     'MULFC_height';    
%     'MUCIN';    
%     'ACBL_MUCAPE';
%     'MUCAPE';
%     };

ALL_vars = {'CLDupdraft_area'; 
'CLDupdraft_MaxMagnitude';
'CLDupdraft_topZasl';

'nearupdaft_0to3kmaglBulkShear';   
'nearupdaft_0to6kmaglBulkShear';
'nearupdaft_0to9kmaglBulkShear';
'MesoAscent_EastUpslopeDepth';
'MesoAscent_EastUpslopeMag';

'nearupdaft_ACBLthetae';
'nearupdaft_mean_ACBL_RH';
'nearupdaft_MULCL';
'nearupdaft_MULFC';
'nearupdaft_MUCIN';
'nearupdaft_MU_ACBL_CAPE';
'nearupdaft_MUCAPE';
};


num_samples = [ length(find(isnan(nearupdaft_MULCL)==0)), length(find(isnan(CLDupdraft_area)==0)), ...
    length(find(isnan(nearupdaft_0to6kmaglBulkShear)==0)), length(find(isnan(MesoAscent_EastUpslopeMag)==0)) ]  ;

num_samples = min(num_samples)


ALL_vars = flipdim(ALL_vars,1) ;

ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;
SIGTHRESH = 0.05;
for n = 1:length(ALL_vars)
    for m = 1:length(ALL_vars)
        %  n = 1; m = 3
        AA = char(ALL_vars(n)) ; 
        AA = eval(AA);
        BB = char(ALL_vars(m)) ;  
        BB = eval(BB);
        kill = isnan(BB);
        BB(kill) = []; AA(kill) = [];
        kill = isnan(AA);
        BB(kill) = []; AA(kill) = [];
        [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
        ALL_corrs(n,m) = corab ;
        ALL_Ps(n,m) = pval;
        if(pval < SIGTHRESH)
            ALL_statsig(n,m) = NaN;
        else
            ALL_corrs(n,m) = NaN;
            ALL_statsig(n,m) = 0; %0;    
        end
    end
end
ALL_corrs = single(ALL_corrs);
isupper = logical(triu(ones(size(ALL_corrs)),1));
ALL_corrs(isupper) = NaN;
ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN;

ALL_statsig = single(ALL_statsig);
isupper = logical(triu(ones(size(ALL_statsig)),1));
ALL_statsig(isupper) = NaN;
ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;

varlab = {};
for l = 1:length(ALL_vars)
   asd = char(ALL_vars(l,:) )   ;
   asd(find(asd=='_'))=' '   ;
   varlab = vertcat(varlab,asd);
end

%round 
ALL_corrs = round(ALL_corrs,2);

dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
title(['wID-lasso Correlogram - all cases combined [n=',num2str(num_samples),']  (Filt: LFClayer,small area, deep only),  cloud time lag = ',num2str((TIMLG-1)*5),'min'])

% saveas(h, horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt_forboscompare.png') );
% outlab = horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt_forboscompare.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);










%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%  2c) For simulated wIDs 
%%%%
%%%%   This is a mix of FULLSDC space and sounding-based metrics
%%%%     
%%%%   only deep updrafts, looking at Wmax updraft layer area/mag, not to LFC layer
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%pick the swath time rel to cloudy time:
TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; 1=0offset, 2:swath -5min back, 3:swath -10min back, 4:swath -15min back, 7 = -30min back


% widMAX1AR_profs_area_ALLCASES            = widMAX1_profs_area_ALLCASES;
% widMAX1AR_profs_massflux_ALLCASES        = widMAX1_profs_massflux_ALLCASES;
% widMAX1AR_profs_maxmag_ALLCASES          = widMAX1_profs_maxmag_ALLCASES;


%%%% all cases together
CLDupdraft_area = max(widMAX1ARdeep_profs_area_ALLCASES(:,:,:,:),[],2) ;       
        CLDupdraft_area = permute(CLDupdraft_area,[1 3 4 2]);
CLDupdraft_VertMassFlux = max(widMAX1ARdeep_profs_massflux_ALLCASES(:,:,:,:),[],2) ;
        CLDupdraft_VertMassFlux = permute(CLDupdraft_VertMassFlux,[1 3 4 2]);
CLDupdraft_MaxMagnitude = max(widMAX1ARdeep_profs_maxmag_ALLCASES(:,:,:,:),[],2) ;
        CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);

%using full updraft depth profile:
cht_mask = CLDupdraft_area;   cht_mask( isnan(CLDupdraft_area)==0 )=1;   
    CLDupdraft_topZasl      =   wid_maxk_topasl_ALLCASES(:,:,R)    .* cht_mask;

%these 3 already filtered in the MAX1ARdeep loops above
MesoAscent_Wmagnitude           = widMAX1ARdeep_mesoWstrength_ALLCASES(:,:,TIMLG,:);  
    MesoAscent_Wmagnitude = permute(MesoAscent_Wmagnitude,[1 2 4 3]);
MesoAscent_width                = widMAX1ARdeep_mesoWwidth_ALLCASES(:,:,TIMLG,:);
    MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
%MesoAscent_VertMassFlux         = widMAX1ARdeep_mesoWvmsum_ALLCASES(:,:,TIMLG,:);
%MesoAscent_VertMassFlux         = widMAX1ARdeep_mesoWvmsumHSUM_ALLCASES(:,:,TIMLG,:);
    MesoAscent_VertMassFlux = permute(MesoAscent_VertMassFlux,[1 2 4 3]);

%these not yet filtered:
MesoAscent_DepthPerLfc          = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(:,:,TIMLG,:);
    MesoAscent_DepthPerLfc = permute(MesoAscent_DepthPerLfc,[1 2 4 3]) .* cht_mask;

MesoAscent_LFCzagl              = widLFCARdeep_mesoWlfcagl_ALLCASES(:,:,TIMLG,:);
    MesoAscent_LFCzagl = permute(MesoAscent_LFCzagl,[1 2 4 3]) .* cht_mask;
MesoAscent_CAPE                 = widLFCARdeep_mesoWcape_ALLCASES(:,:,TIMLG,:);
    MesoAscent_CAPE = permute(MesoAscent_CAPE, [1 2 4 3]) .* cht_mask;
MesoAscent_CIN                  = widLFCARdeep_mesoWcin_ALLCASES(:,:,TIMLG,:);
    MesoAscent_CIN = permute(MesoAscent_CIN, [1 2 4 3]) .* cht_mask;
MesoAscent_Theta                = widLFCARdeep_mesoWtheta_ALLCASES(:,:,TIMLG,:);
    MesoAscent_Theta = permute(MesoAscent_Theta, [1 2 4 3]) .* cht_mask;
MesoAscent_Qvapor               = widLFCARdeep_mesoWqvap_ALLCASES(:,:,TIMLG,:);
    MesoAscent_Qvapor = permute(MesoAscent_Qvapor, [1 2 4 3]) .* cht_mask;
MesoAscent_RHaloft              = widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,:);
    MesoAscent_RHaloft = permute(MesoAscent_RHaloft, [1 2 4 3]) .* cht_mask;

MesoAscent_EastUpslopeMag       = abs(wid_eastupslopemean_ALLCASES(:,:,TIMLG,:));
    MesoAscent_EastUpslopeMag = permute(MesoAscent_EastUpslopeMag, [1 2 4 3]) .* cht_mask;
MesoAscent_EastUpslopeDepthFract     = wid_eastupslopedepthfract_ALLCASES(:,:,TIMLG,:);
    MesoAscent_EastUpslopeDepthFract = permute(MesoAscent_EastUpslopeDepthFract, [1 2 4 3]) .* cht_mask;
% MesoAscent_WestUpslopeMag       = widLFCAR_westupslopemean_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeMag = permute(MesoAscent_WestUpslopeMag, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract     = widLFCAR_westupslopedepthfract_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract = permute(MesoAscent_WestUpslopeDepthFract, [1 2 4 3]);    

MesoAscent_EastUpslopeDepth       = abs(wid_eastupslopedepth_ALLCASES(:,:,TIMLG,:));
    MesoAscent_EastUpslopeDepth = permute(MesoAscent_EastUpslopeDepth, [1 2 4 3]) .* cht_mask; 
% MesoAscent_WestUpslopeDepth       = abs(widLFCAR_westupslopedepth_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeDepth = permute(MesoAscent_WestUpslopeDepth, [1 2 4 3]);

% MesoAscent_EastUpslopeTopHt       = abs(widLFCAR_eastupslopetophtasl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeTopHt = permute(MesoAscent_EastUpslopeTopHt, [1 2 4 3]); 
% MesoAscent_WestUpslopeTopHt       = abs(widLFCAR_westupslopetophtasl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeTopHt = permute(MesoAscent_WestUpslopeDepth, [1 2 4 3]);

% MesoAscent_EastUpslopeMag2500       = abs(widLFCAR_eastupslopemean2500masl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeMag2500 = permute(MesoAscent_EastUpslopeMag2500, [1 2 4 3]);
% MesoAscent_EastUpslopeDepthFract2500     = widLFCAR_eastupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_EastUpslopeDepthFract2500 = permute(MesoAscent_EastUpslopeDepthFract2500, [1 2 4 3]);
% MesoAscent_WestUpslopeMag2500       = abs(widLFCAR_westupslopemean2500masl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeMag2500 = permute(MesoAscent_WestUpslopeMag2500, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract2500     = widLFCAR_westupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract2500 = permute(MesoAscent_WestUpslopeDepthFract2500, [1 2 4 3]);    

% MesoAscent_EastUpslopeMag1500       = abs(widLFCAR_eastupslopemean1500magl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_EastUpslopeMag1500 = permute(MesoAscent_EastUpslopeMag1500, [1 2 4 3]);
% MesoAscent_EastUpslopeDepthFract1500     = widLFCAR_eastupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_EastUpslopeDepthFract1500 = permute(MesoAscent_EastUpslopeDepthFract1500, [1 2 4 3]);
% MesoAscent_WestUpslopeMag1500       = abs(widLFCAR_westupslopemean1500magl_ALLCASES(:,:,TIMLG,:));
%     MesoAscent_WestUpslopeMag1500 = permute(MesoAscent_WestUpslopeMag1500, [1 2 4 3]);
% MesoAscent_WestUpslopeDepthFract1500     = widLFCAR_westupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_WestUpslopeDepthFract1500 = permute(MesoAscent_WestUpslopeDepthFract1500, [1 2 4 3]);    

% MesoAscent_1to5kmaslBulkShear   = widLFCAR_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_1to5kmaslBulkShear = permute(MesoAscent_1to5kmaslBulkShear, [1 2 4 3]);
% MesoAscent_1to9kmaslBulkShear   = widLFCAR_mesoWeast1to9aslTOTMAGshear_ALLCASES(:,:,TIMLG,:);
%     MesoAscent_1to9kmaslBulkShear = permute(MesoAscent_1to9kmaslBulkShear, [1 2 4 3]);
% MesoAscent_InCloudBulkUShear    = widLFCAR_bulkUshearinupdraft_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_InCloudBulkUShear = permute(MesoAscent_InCloudBulkUShear, [1 2 4 3]);

% MesoAscent_eastUmean3to4kmasl    = widLFCAR_eastUmean3to4kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean3to4kmasl = permute(MesoAscent_eastUmean3to4kmasl, [1 2 4 3]);
% MesoAscent_eastUmean4to5kmasl    = widLFCAR_eastUmean4to5kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean4to5kmasl = permute(MesoAscent_eastUmean4to5kmasl, [1 2 4 3]);
% MesoAscent_eastUmean5to6kmasl    = widLFCAR_eastUmean5to6kmasl_ALLCASES(:,:,TIMLG,:) ;
%     MesoAscent_eastUmean5to6kmasl = permute(MesoAscent_eastUmean5to6kmasl, [1 2 4 3]);

nearupdaft_0to3kmaglBulkShear   =   FwID_shear_mag_bulk_0to3km_ALLCASES;
nearupdaft_0to6kmaglBulkShear   =   FwID_shear_mag_bulk_0to6km_ALLCASES;
nearupdaft_0to9kmaglBulkShear   =   FwID_shear_mag_bulk_0to9km_ALLCASES;
nearupdaft_mean_ACBL_RH         =   FwID_RH_mean_ACBL_ALLCASES;
nearupdaft_MUCAPE               =   FwID_MUCAPE_ALLCASES;
nearupdaft_MUCIN                =   FwID_MUCIN_ALLCASES;
nearupdaft_MU_ACBL_CAPE         =   FwID_MUACBLCAPE_ALLCASES;
nearupdaft_MUEL                 =   FwID_MUEL_ALLCASES;
nearupdaft_MULFC                =   FwID_MULFC_ALLCASES;
nearupdaft_MULCL                =   FwID_MULCL_ALLCASES;
nearupdaft_ACBLthetae           =   FwID_thetae_mean_ACBL_mu_ALLCASES;

% nearupdaft_upslopemean             =   abs(FwID_upslope_mean_ALLCASES(:));
% nearupdaft_upslopemax              =   abs(FwID_upslope_max_ALLCASES(:));
% nearupdaft_upslopedepth            =   FwID_upslope_depth_ALLCASES(:);
% nearupdaft_upslopefract            =   FwID_upslope_fract_ALLCASES(:);


% filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
kill = find(  abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,:) )  > distswathwid_thresh ); 
CLDupdraft_area(kill) = NaN;
CLDupdraft_VertMassFlux(kill) = NaN;
CLDupdraft_MaxMagnitude(kill) = NaN;       
CLDupdraft_topZasl(kill) = NaN;
CLDupdraft_bulkXtilt(kill) = NaN;
CLDupdraft_bulkMAGtilt(kill) = NaN;
MesoAscent_Wmagnitude(kill)           = NaN;
MesoAscent_width(kill)                = NaN;
MesoAscent_VertMassFlux(kill)         = NaN;
MesoAscent_DepthPerLfc(kill)          = NaN;
MesoAscent_LFCzagl(kill)              = NaN;
% MesoAscent_CAPE                 = NaN;
% MesoAscent_CIN                  = NaN;
% MesoAscent_Theta                = NaN;
% MesoAscent_Qvapor               = NaN;
% MesoAscent_RHaloft              = NaN;
% MesoAscent_EastUpslopeMag       = NaN;
% MesoAscent_EastUpslopeDepth     = NaN;
% MesoAscent_WestUpslopeMag       = NaN;
% MesoAscent_1to5kmaslBulkShear   = NaN;
% MesoAscent_1to9kmaslBulkShear   = NaN;
% MesoAscent_InCloudBulkUShear    = NaN;


%Implement env masks:
mask_cape = cht_mask; mask_cape(:) = NaN;
mask_cin = cht_mask;  mask_cin(:) = NaN;
mask_el = cht_mask;   mask_el(:) = NaN;
[as df gh] = size(nearupdaft_MUCAPE)
for i = 1:as
    for j = 1:df
        for g = 1:gh
            if( nearupdaft_MUCAPE(i,j,g) > 100. )
                mask_cape(i,j,g) = 1;
            end
            if( nearupdaft_MUCIN(i,j,g) > -10. )
                mask_cin(i,j,g) = 1;
            end
            if( nearupdaft_MUEL(i,j,g) > 5000. )
                mask_el(i,j,g) = 1;
            end          
        end
    end
end
allmask = mask_cape .* mask_cin .* mask_el .* cht_mask ;
%apply masks:
CLDupdraft_area             = CLDupdraft_area .* allmask;
CLDupdraft_VertMassFlux     = CLDupdraft_VertMassFlux .* allmask;
CLDupdraft_MaxMagnitude     = CLDupdraft_MaxMagnitude .* allmask;
CLDupdraft_topZasl          = CLDupdraft_topZasl .* allmask;
MesoAscent_Wmagnitude       = MesoAscent_Wmagnitude .* allmask;
MesoAscent_width            = MesoAscent_width .* allmask; 
MesoAscent_VertMassFlux     = MesoAscent_VertMassFlux .* allmask;
MesoAscent_DepthPerLfc      = MesoAscent_DepthPerLfc .* allmask;
MesoAscent_LFCzagl          = MesoAscent_LFCzagl .* allmask;
MesoAscent_CAPE             = MesoAscent_CAPE .* allmask;
MesoAscent_CIN              = MesoAscent_CIN .* allmask; 
MesoAscent_Theta            = MesoAscent_Theta .* allmask;
MesoAscent_Qvapor           = MesoAscent_Qvapor .* allmask;
MesoAscent_RHaloft          = MesoAscent_RHaloft .* allmask;
MesoAscent_EastUpslopeMag         =  MesoAscent_EastUpslopeMag .* allmask;
MesoAscent_EastUpslopeDepthFract        =  MesoAscent_EastUpslopeDepthFract .* allmask;
nearupdaft_0to3kmaglBulkShear   =   nearupdaft_0to3kmaglBulkShear .* allmask;
nearupdaft_0to6kmaglBulkShear   =   nearupdaft_0to6kmaglBulkShear .* allmask;   
nearupdaft_0to9kmaglBulkShear   =   nearupdaft_0to9kmaglBulkShear .* allmask;   
nearupdaft_mean_ACBL_RH         =   nearupdaft_mean_ACBL_RH .* allmask;  
nearupdaft_MUCAPE               =   nearupdaft_MUCAPE .* allmask; 
nearupdaft_MUCIN                =   nearupdaft_MUCIN .* allmask; 
nearupdaft_MU_ACBL_CAPE         =   nearupdaft_MU_ACBL_CAPE .* allmask; 
nearupdaft_MUEL                 =   nearupdaft_MUEL .* allmask; 
nearupdaft_MULFC                =   nearupdaft_MULFC .* allmask; 
nearupdaft_MULCL                =   nearupdaft_MULCL .* allmask; 
nearupdaft_ACBLthetae           =   nearupdaft_ACBLthetae .* allmask; 



% ALL_vars = {'Cell_area' ;
%     'Cell_max_dBZ'  ;
%     'Cell_ETH' ;
%     'Bulk_shear_0to3km';
%     'Bulk_shear_0to6km';
%     'Bulk_shear_0to9km';  
%     'UpslopeEast_depth';     
%     'UpslopeEast_mean_magnitude';
%     'Thetae_mean_ACBL';
%     'ACBL_mean_RH';
%     'MULCL_height';     
%     'MULFC_height';    
%     'MUCIN';    
%     'ACBL_MUCAPE';
%     'MUCAPE';
%     };

ALL_vars = {'CLDupdraft_area'; 
'CLDupdraft_MaxMagnitude';
'CLDupdraft_topZasl';

'nearupdaft_0to3kmaglBulkShear';   
'nearupdaft_0to6kmaglBulkShear';
'nearupdaft_0to9kmaglBulkShear';
'MesoAscent_EastUpslopeDepth';
'MesoAscent_EastUpslopeMag';

'nearupdaft_ACBLthetae';
'nearupdaft_mean_ACBL_RH';
'nearupdaft_MULCL';
'nearupdaft_MULFC';
'nearupdaft_MUCIN';
'nearupdaft_MU_ACBL_CAPE';
'nearupdaft_MUCAPE';
};

num_samples = [ length(find(isnan(nearupdaft_MULCL)==0)), length(find(isnan(CLDupdraft_area)==0)), ...
    length(find(isnan(nearupdaft_0to6kmaglBulkShear)==0)), length(find(isnan(MesoAscent_EastUpslopeMag)==0)) ]  ;

num_samples = min(num_samples)


ALL_vars = flipdim(ALL_vars,1) ;

ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;
SIGTHRESH = 0.05;
for n = 1:length(ALL_vars)
    for m = 1:length(ALL_vars)
        %  n = 1; m = 3
        AA = char(ALL_vars(n)) ; 
        AA = eval(AA);
        BB = char(ALL_vars(m)) ;  
        BB = eval(BB);
        kill = isnan(BB);
        BB(kill) = []; AA(kill) = [];
        kill = isnan(AA);
        BB(kill) = []; AA(kill) = [];
        [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
        ALL_corrs(n,m) = corab ;
        ALL_Ps(n,m) = pval;
        if(pval < SIGTHRESH)
            ALL_statsig(n,m) = NaN;
        else
            ALL_corrs(n,m) = NaN;
            ALL_statsig(n,m) = 0; %0;    
        end
    end
end
ALL_corrs = single(ALL_corrs);
isupper = logical(triu(ones(size(ALL_corrs)),1));
ALL_corrs(isupper) = NaN;
ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN;

ALL_statsig = single(ALL_statsig);
isupper = logical(triu(ones(size(ALL_statsig)),1));
ALL_statsig(isupper) = NaN;
ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;

varlab = {};
for l = 1:length(ALL_vars)
   asd = char(ALL_vars(l,:) )   ;
   asd(find(asd=='_'))=' '   ;
   varlab = vertcat(varlab,asd);
end

%round 
ALL_corrs = round(ALL_corrs,2);

dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
title(['wID-lasso Correlogram - all cases combined [n=',num2str(num_samples),']  (Filt: WMAXlayer,small area, deep only),  cloud time lag = ',num2str((TIMLG-1)*5),'min'])




% saveas(h, horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt_forboscompare.png') );
% outlab = horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt_forboscompare.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);









%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%  2d) For simulated wIDs 
%%%%
%%%%   This is a mix of FULLSDC space and sounding-based metrics
%%%%     
%%%%   only deep updrafts, looking at Wmax updraft layer area/mag, not to
%%%%   LFC layer;  doing Hi-Med confidence breakdown
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% per case:
ALL_CORRS = [];
ALL_SIG = [];
num_updrafts = zeros(ar,4);

for R = 1:ar

    % R = 4;

    %pick the swath time rel to cloudy time:
    TIMLG = 4;  % 1 to match cloudy time with concurrent swath time; 1=0offset, 2:swath -5min back, 3:swath -10min back, 4:swath -15min back, 7 = -30min back

    %%%% all cases together
    CLDupdraft_area = max(widMAX1AR_profs_area_ALLCASES(:,:,:,R),[],2) ;
         CLDupdraft_area = permute(CLDupdraft_area,[1 3 4 2]);
    CLDupdraft_VertMassFlux = max(widMAX1AR_profs_massflux_ALLCASES(:,:,:,R),[],2) ;
         CLDupdraft_VertMassFlux = permute(CLDupdraft_VertMassFlux,[1 3 4 2]);
    CLDupdraft_MaxMagnitude = max(widMAX1AR_profs_maxmag_ALLCASES(:,:,:,R),[],2) ;
         CLDupdraft_MaxMagnitude = permute(CLDupdraft_MaxMagnitude,[1 3 4 2]);
    
    % dont know if I need this extra filter... I think yes if I'm including in correlationss between cloud top and env vars:
       cht_mask = CLDupdraft_area;   cht_mask( isnan(CLDupdraft_area)==0 )=1;   
    CLDupdraft_topZasl      =   wid_maxk_topasl_ALLCASES(:,:,R)    .* cht_mask;


    %         %CLDupdraft_topZasl      = permute(CLDupdraft_topZasl,[1 3 4 2]);
    % CLDupdraft_bulkXtilt    = abs(widLFCAR_bulk_xcenttilt_ALLCASES);
    %         CLDupdraft_bulkXtilt    = permute(CLDupdraft_bulkXtilt,[1 3 4 2]);
    % CLDupdraft_bulkMAGtilt  = (widLFCAR_bulk_xcenttilt_ALLCASES.*widLFCAR_bulk_xcenttilt_ALLCASES +  widLFCAR_bulk_ycenttilt_ALLCASES.*widLFCAR_bulk_ycenttilt_ALLCASES ).^0.5 ;
    %         CLDupdraft_bulkMAGtilt  = permute(CLDupdraft_bulkMAGtilt,[1 3 4 2]);

    MesoAscent_Wmagnitude           = widLFCARdeep_mesoWstrength_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_Wmagnitude = permute(MesoAscent_Wmagnitude,[1 2 4 3]);
    MesoAscent_width                = widLFCARdeep_mesoWwidth_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_width = permute(MesoAscent_width,[1 2 4 3]);
    %%MesoAscent_VertMassFlux         = widLFCARdeep_mesoWvmsum_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_VertMassFlux         = widLFCARdeep_mesoWvmsumHSUM_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_VertMassFlux = permute(MesoAscent_VertMassFlux,[1 2 4 3]);
    MesoAscent_DepthPerLfc          = widLFCARdeep_mesoWtoplfcaslRAT_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_DepthPerLfc = permute(MesoAscent_DepthPerLfc,[1 2 4 3]);
    MesoAscent_LFCzagl              = widLFCARdeep_mesoWlfcagl_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_LFCzagl = permute(MesoAscent_LFCzagl,[1 2 4 3]);
    MesoAscent_CAPE                 = widLFCARdeep_mesoWcape_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_CAPE = permute(MesoAscent_CAPE, [1 2 4 3]);
    MesoAscent_CIN                  = widLFCARdeep_mesoWcin_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_CIN = permute(MesoAscent_CIN, [1 2 4 3]);
    MesoAscent_Theta                = widLFCARdeep_mesoWtheta_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_Theta = permute(MesoAscent_Theta, [1 2 4 3]);
    MesoAscent_Qvapor               = widLFCARdeep_mesoWqvap_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_Qvapor = permute(MesoAscent_Qvapor, [1 2 4 3]);
    MesoAscent_RHaloft              = widLFCARdeep_mesoWmeanRHboxaloft_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_RHaloft = permute(MesoAscent_RHaloft, [1 2 4 3]);
    MesoAscent_1to5kmaslBulkShear   = widLFCARdeep_mesoWeast1to5aslTOTMAGshear_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_1to5kmaslBulkShear = permute(MesoAscent_1to5kmaslBulkShear, [1 2 4 3]);
    MesoAscent_1to9kmaslBulkShear   = widLFCARdeep_mesoWeast1to9aslTOTMAGshear_ALLCASES(:,:,TIMLG,R);
    %MesoAscent_1to9kmaslBulkShear = permute(MesoAscent_1to9kmaslBulkShear, [1 2 4 3]);
    MesoAscent_InCloudBulkUShear    = widLFCARdeep_bulkUshearinupdraft_ALLCASES(:,:,TIMLG,R) ;
    %MesoAscent_InCloudBulkUShear = permute(MesoAscent_InCloudBulkUShear, [1 2 4 3]);

    MesoAscent_EastUpslopeMag            = abs(wid_eastupslopemean_ALLCASES(:,:,TIMLG,R));   %note: mean of just the layer with upslope present, not some static ht layer
    MesoAscent_EastUpslopeDepthFract     = wid_eastupslopedepthfract_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeMag            = wid_westupslopemean_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeDepthFract     = wid_westupslopedepthfract_ALLCASES(:,:,TIMLG,R) ;

    MesoAscent_EastUpslopeDepth          = wid_eastupslopedepth_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_WestUpslopeDepth          = wid_westupslopedepth_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_EastUpslopeTopHt          = wid_eastupslopetophtasl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeTopHt          = wid_westupslopetophtasl_ALLCASES(:,:,TIMLG,R);

    MesoAscent_EastUpslopeMag2500            = abs(wid_eastupslopemean2500masl_ALLCASES(:,:,TIMLG,R));
    MesoAscent_EastUpslopeDepthFract2500     = wid_eastupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeMag2500            = wid_westupslopemean2500masl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeDepthFract2500     = wid_westupslopedepthfract2500masl_ALLCASES(:,:,TIMLG,R);

    MesoAscent_EastUpslopeMag1500            = abs(wid_eastupslopemean1500magl_ALLCASES(:,:,TIMLG,R));
    MesoAscent_EastUpslopeDepthFract1500     = wid_eastupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeMag1500            = wid_westupslopemean1500magl_ALLCASES(:,:,TIMLG,R);
    MesoAscent_WestUpslopeDepthFract1500     = wid_westupslopedepthfract1500magl_ALLCASES(:,:,TIMLG,R);

    MesoAscent_eastUmean3to4kmasl    = wid_eastUmean3to4kmasl_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_eastUmean4to5kmasl    = wid_eastUmean4to5kmasl_ALLCASES(:,:,TIMLG,R) ;
    MesoAscent_eastUmean5to6kmasl    = wid_eastUmean5to6kmasl_ALLCASES(:,:,TIMLG,R) ;

    %note, these already are time-offset from wID time by -15 min:
    nearupdaft_0to3kmaglBulkShear   =   FwID_shear_mag_bulk_0to3km_ALLCASES(:,:,R);
    nearupdaft_0to6kmaglBulkShear   =   FwID_shear_mag_bulk_0to6km_ALLCASES(:,:,R);
    nearupdaft_0to9kmaglBulkShear   =   FwID_shear_mag_bulk_0to9km_ALLCASES(:,:,R);
    nearupdaft_mean_ACBL_RH         =   FwID_RH_mean_ACBL_ALLCASES(:,:,R);
    nearupdaft_MUCAPE               =   FwID_MUCAPE_ALLCASES(:,:,R);
    nearupdaft_MUCIN                =   FwID_MUCIN_ALLCASES(:,:,R);
    nearupdaft_MU_ACBL_CAPE         =   FwID_MUACBLCAPE_ALLCASES(:,:,R);
    nearupdaft_MUEL                 =   FwID_MUEL_ALLCASES(:,:,R);
    %nearupdaft_MUvap                =   FwID_MUvap_ALLCASES(:,:,R);
    %nearupdaft_MUthetae              =   FwID_MUthetae_ALLCASES(:,:,R);
    nearupdaft_MULFC                =   FwID_MULFC_ALLCASES(:,:,R);
    nearupdaft_MULCL                =   FwID_MULCL_ALLCASES(:,:,R);
    nearupdaft_ACBLthetae           =   FwID_thetae_mean_ACBL_mu_ALLCASES(:,:,R);
    nearupdaft_upslopemean             =   abs(FwID_upslope_mean_ALLCASES(:,:,R));
    nearupdaft_upslopemax              =   abs(FwID_upslope_max_ALLCASES(:,:,R));
    nearupdaft_upslopedepth            =   FwID_upslope_depth_ALLCASES(:,:,R);
    nearupdaft_upslopefract            =   FwID_upslope_fract_ALLCASES(:,:,R);


    % filter select fields on distance from the swath to try to compensate for not adjusting by meridional flow
    %just kill the mesoascent fields so that we can still compare cldy
    %updrafts to near-cloud sounding metrics
    kill = find(  abs( dist_wid_and_swath_ALLCASES(:,:,TIMLG,R) )  >  distswathwid_thresh  );
    CLDupdraft_area(kill) = NaN;
    CLDupdraft_VertMassFlux(kill) = NaN;
    CLDupdraft_MaxMagnitude(kill) = NaN;
    CLDupdraft_topZasl(kill) = NaN;
%     CLDupdraft_bulkXtilt(kill) = NaN;
%     CLDupdraft_bulkMAGtilt(kill) = NaN;
    MesoAscent_Wmagnitude(kill)           = NaN;
    MesoAscent_width(kill)                = NaN;
    MesoAscent_VertMassFlux(kill)         = NaN;
    MesoAscent_DepthPerLfc(kill)          = NaN;
    MesoAscent_LFCzagl(kill)              = NaN;
    % MesoAscent_CAPE                 = NaN;
    % MesoAscent_CIN                  = NaN;
    % MesoAscent_Theta                = NaN;
    % MesoAscent_Qvapor               = NaN;
    % MesoAscent_RHaloft              = NaN;
    MesoAscent_EastUpslopeMag(kill)       = NaN;
    MesoAscent_EastUpslopeDepth(kill)     = NaN;
    MesoAscent_WestUpslopeMag(kill)       = NaN;
    MesoAscent_WestUpslopeDepth(kill)     = NaN;
    % MesoAscent_1to5kmaslBulkShear   = NaN;
    % MesoAscent_1to9kmaslBulkShear   = NaN;
    % MesoAscent_InCloudBulkUShear    = NaN;



%Implement env masks:
mask_cape = cht_mask; mask_cape(:) = NaN;
mask_cin = cht_mask;  mask_cin(:) = NaN;
mask_el = cht_mask;   mask_el(:) = NaN;
[as df gh] = size(nearupdaft_MUCAPE)
for i = 1:as
    for j = 1:df
        for g = 1:gh
            if( nearupdaft_MUCAPE(i,j,g) > 100. )
                mask_cape(i,j,g) = 1;
            end
            if( nearupdaft_MUCIN(i,j,g) > -10. )
                mask_cin(i,j,g) = 1;
            end
            if( nearupdaft_MUEL(i,j,g) > 5000. )
                mask_el(i,j,g) = 1;
            end          
        end
    end
end
allmask = mask_cape .* mask_cin .* mask_el .* cht_mask ;
%apply masks:
CLDupdraft_area             = CLDupdraft_area .* allmask;
CLDupdraft_VertMassFlux     = CLDupdraft_VertMassFlux .* allmask;
CLDupdraft_MaxMagnitude     = CLDupdraft_MaxMagnitude .* allmask;
CLDupdraft_topZasl          = CLDupdraft_topZasl .* allmask;
MesoAscent_Wmagnitude       = MesoAscent_Wmagnitude .* allmask;
MesoAscent_width            = MesoAscent_width .* allmask; 
MesoAscent_VertMassFlux     = MesoAscent_VertMassFlux .* allmask;
MesoAscent_DepthPerLfc      = MesoAscent_DepthPerLfc .* allmask;
MesoAscent_LFCzagl          = MesoAscent_LFCzagl .* allmask;
MesoAscent_CAPE             = MesoAscent_CAPE .* allmask;
MesoAscent_CIN              = MesoAscent_CIN .* allmask; 
MesoAscent_Theta            = MesoAscent_Theta .* allmask;
MesoAscent_Qvapor           = MesoAscent_Qvapor .* allmask;
MesoAscent_RHaloft          = MesoAscent_RHaloft .* allmask;
MesoAscent_EastUpslopeMag         =  MesoAscent_EastUpslopeMag .* allmask;
MesoAscent_EastUpslopeDepthFract        =  MesoAscent_EastUpslopeDepthFract .* allmask;
nearupdaft_0to3kmaglBulkShear   =   nearupdaft_0to3kmaglBulkShear .* allmask;
nearupdaft_0to6kmaglBulkShear   =   nearupdaft_0to6kmaglBulkShear .* allmask;   
nearupdaft_0to9kmaglBulkShear   =   nearupdaft_0to9kmaglBulkShear .* allmask;   
nearupdaft_mean_ACBL_RH         =   nearupdaft_mean_ACBL_RH .* allmask;  
nearupdaft_MUCAPE               =   nearupdaft_MUCAPE .* allmask; 
nearupdaft_MUCIN                =   nearupdaft_MUCIN .* allmask; 
nearupdaft_MU_ACBL_CAPE         =   nearupdaft_MU_ACBL_CAPE .* allmask; 
nearupdaft_MUEL                 =   nearupdaft_MUEL .* allmask; 
nearupdaft_MULFC                =   nearupdaft_MULFC .* allmask; 
nearupdaft_MULCL                =   nearupdaft_MULCL .* allmask; 
nearupdaft_ACBLthetae           =   nearupdaft_ACBLthetae .* allmask; 





   %%%%%%%%%%%%% Use these for Jim sounding code based env metrics:
    
 ALL_vars = {'CLDupdraft_area'; 
'CLDupdraft_MaxMagnitude';
'CLDupdraft_topZasl';

'nearupdaft_0to3kmaglBulkShear';   
'nearupdaft_0to6kmaglBulkShear';
'nearupdaft_0to9kmaglBulkShear';
'MesoAscent_EastUpslopeDepth';
'MesoAscent_EastUpslopeMag';

'nearupdaft_ACBLthetae';
'nearupdaft_mean_ACBL_RH';
'nearupdaft_MULCL';
'nearupdaft_MULFC';
'nearupdaft_MUCIN';
'nearupdaft_MU_ACBL_CAPE';
'nearupdaft_MUCAPE';
};



    num_updrafts(R,1) =  length(find(isnan(CLDupdraft_area)==0)) ; 
    num_updrafts(R,2) =  length(find(isnan(nearupdaft_0to3kmaglBulkShear)==0)) ; 
    num_updrafts(R,3) =  length(find(isnan(nearupdaft_MULCL)==0)) ; 
    num_updrafts(R,4) =  length(find(isnan(MesoAscent_EastUpslopeMag)==0)) ; 

    ALL_vars = flipdim(ALL_vars,1) ;

    ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
    ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
    ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;

    SIGTHRESH = 0.05;
    for n = 1:length(ALL_vars)
        for m = 1:length(ALL_vars)
            %  n = 1; m = 3
            AA = char(ALL_vars(n)) ;
            AA = eval(AA);
            BB = char(ALL_vars(m)) ;
            BB = eval(BB);
            kill = isnan(BB);
            BB(kill) = []; AA(kill) = [];
            kill = isnan(AA);
            BB(kill) = []; AA(kill) = [];
            [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
            ALL_corrs(n,m) = corab ;
            ALL_Ps(n,m) = pval;
            if(pval < SIGTHRESH)          %significant
                ALL_statsig(n,m) = NaN;   % marking signif as nan for now (dont remember why - i think matlab couldnt handle 1 and 0 for something at some stage), it will be switched to 1 later for plotting purposes
            else 
                ALL_corrs(n,m) = NaN;
                ALL_statsig(n,m) = 0; %0;   
            end
        end
    end
    ALL_corrs = single(ALL_corrs);
    isupper = logical(triu(ones(size(ALL_corrs)),1));
    ALL_corrs(isupper) = NaN;
    ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN;

    ALL_statsig = single(ALL_statsig);
    isupper = logical(triu(ones(size(ALL_statsig)),1));
    ALL_statsig(isupper) = NaN;
    ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;


    varlab = {};
    for l = 1:length(ALL_vars)
        asd = char(ALL_vars(l,:) )   ;
        asd(find(asd=='_'))=' '   ;
        varlab = vertcat(varlab,asd);
    end

    %round
    ALL_corrs = round(ALL_corrs,2);

    ALL_CORRS = cat(3,ALL_CORRS,ALL_corrs);
    ALL_SIG = cat(3,ALL_SIG,ALL_statsig);

    dualpol_colmap
    ff = figure('Position',[246,77,1187,900])
    h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['Correlogram - ', Rlab ,' (Filt: LFClayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min ',RUNS(R,1:8)])

%     saveas(ff, horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.png') );
%     outlab = horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);

end

num_updrafts = min(num_updrafts,[],2,'omitnan');
%num_updrafts = sum(num_updrafts)


dualpol_colmap
ff = figure('Position',[246,77,1187,900])
meancorr = mean(ALL_CORRS,3,'omitnan');  
h = heatmap(round(meancorr,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%%% helpful diagnostic plots:

% count blocks with statistical significance:
dualpol_colmap
%ff = figure('Position',[246,77,1187,900])
ALL_SIG(isnan(ALL_SIG)) = 1;   %swap significant marker from nan to 1
SUMSIG = sum(ALL_SIG,3,'omitnan');  
%{
h = heatmap(round(SUMSIG,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['sum of significant cases ',num2str((TIMLG-1)*5)])
%}
% saveas(ff, horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


% number of blocks with same correlation sign as the ensemble mean :
ALL_COR_SIGN  = sign( ALL_CORRS );
meancorr = mean(ALL_CORRS,3,'omitnan');
MEANCOR = [];
for y = 1:ar  % stitch together for dimension matching. 
    MEANCOR = cat(3,MEANCOR, meancorr);
end
MEANCOR_SIGN = sign(MEANCOR);
[ci cj cy] = size(MEANCOR);
MATCHED_SIGNS = MEANCOR_SIGN;   MATCHED_SIGNS(:) = NaN; %array with 1 where case blocks match mean block
match = find(MEANCOR_SIGN == ALL_COR_SIGN);
MATCHED_SIGNS(match) = 1;
SUM_MATCHED_SIGNS = sum(MATCHED_SIGNS,3,'omitnan');



% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(SUM_MATCHED_SIGNS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%per-case log of useable confidence
for R = 1:ar

    [asd fgh] = size(ALL_CORRS(:,:,1))
    dayconf = zeros(asd,fgh);    

    %good = find( MATCHED_SIGNS(:,:,R) == 1 & ALL_SIG(:,:,R) == 1  ) ; 
    good = find( ALL_SIG(:,:,R) == 1  ) ; 
    dayconf(good) = 1;

    %{
    figure
    h = heatmap(round(dayconf,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    %h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['matched sign and stat sig for case: ', RUNS(R,:) ])
    %}
end



%%%%%%%% now use this to divide into high, med, low confidence
%%%%%%%% interpretations:

HICONF_MEAN_CORRS = zeros(ci,cj);    HICONF_MEAN_CORRS(:) = NaN; 
MECONF_MEAN_CORRS = zeros(ci,cj);    MECONF_MEAN_CORRS(:) = NaN; 
LOCONF_MEAN_CORRS = zeros(ci,cj);    LOCONF_MEAN_CORRS(:) = NaN; 
for i = 1:ci
    for j = 1:cj
        %  i = 19; j = 18

        HSIGN = ( SUM_MATCHED_SIGNS(i,j)   > 3  )   ;
%         MSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 5  &  SUM_MATCHED_SIGNS(i,j)   >= 3 );
        LSIGN = ( SUM_MATCHED_SIGNS(i,j)   <= 3 );

        HSIG = ( SUMSIG(i,j)   >  3  )   ;
%         MSIG = ( SUMSIG(i,j) < 5  &   SUMSIG(i,j) >= 3 );
        LSIG = ( SUMSIG(i,j) <= 3 );        

        if( HSIGN==1  &  HSIG==1 & LSIGN==0  & LSIG==0)
            HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);

%         if( HSIGN==1  &  HSIG==1 & MSIGN==0  &  MSIG==0 & LSIGN==0  & LSIG==0)
%             HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%
%         elseif(  HSIGN==0  &  HSIG==0 & MSIGN==1  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
% 
%         elseif(LSIGN==1  | LSIG==1 )
%             LOCONF_MEAN_CORRS(i,j) = MEANCOR(i,j);

        end
    end
end



% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(HICONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['HI/MED CONF wIDlasso Correlogram - (Filt: WMAXlayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

disp(' STILL NEED TO FIGURE OUT WHAT TO DO WITH SAMPLE NUMBERS WHEN YOU HIT THEM WITH STAT-SIG & CONFIDENCE MARKERS BECAUSE THESE WILL VARY PER VARIBLE TESTED')

% saveas(h, horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt_forboscompare.png') );
% outlab = horzcat(imout,'/Correlgram_widlasso_Allcasestogether_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt_forboscompare.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);







































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% 3a) simlulated CELLs & env, read in from pyflextrkr output but sub'ing
%%%% upslope vars from soundings -> LASSO/FULLSDC space
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% make masks to filter LASSO cell population akin to the way I did the CSAPR obs set

%first make environemntal masks:
maskMINCAPE  =  preCIandCI_cape_deep_ALLCASES;       maskMINCAPE(:) = NaN;   
maskMAXCIN   =  preCIandCI_mucin_ALLCASES;           maskMAXCIN(:) = NaN; 
maskMINEL    =  preCIandCI_cape_deep_ALLCASES;       maskMINEL(:) = NaN;  
[tt nn yy] = size(preCIandCI_cape_deep_ALLCASES);
for n = 1:nn
    for y = 1:yy
        %minimum cape requirement
        if(   mean(preCIandCI_cape_deep_UNFILT_ALLCASES(3:7,n,y),'omitnan') > 100.0       )   %look at CI-10min to CI - 30min
            maskMINCAPE(:,n,y) = 1;
        end
        %maximum cin requirement
        if(   mean(preCIandCI_mucin_UNFILT_ALLCASES(3:7,n,y),'omitnan') > -10.0       )  %look at CI-10min to CI - 30min
            maskMAXCIN(:,n,y) = 1;
        end
        %minimum cape requirement
        if(   mean(preCIandCI_muel_UNFILT_ALLCASES(3:7,n,y),'omitnan') > 6000.0       )   %look at CI-10min to CI - 30min
            maskMINEL(:,n,y) = 1;
        end
    end
end

%next make cell property-space masks:
CItime =  permute(  hhmmofday_fullcellrecord_ALLCASES(1,:,:),  [2 3 1])  ;

maskCITIMEenv     =  preCIandCI_cape_deep_ALLCASES ;           maskCITIMEenv(:) = NaN; 
maskCITIME        =  cellfull_duration_UNFILT_ALLCASES ;       maskCITIME(:) = NaN;
maskMINDURenv     =  preCIandCI_cape_deep_ALLCASES ;           maskMINDURenv(:) = NaN; 
maskMINDUR        =  cellfull_duration_UNFILT_ALLCASES ;       maskMINDUR(:) = NaN;
maskLOCenv        =  preCIandCI_cape_deep_ALLCASES ;           maskLOCenv(:) = NaN; 
maskLOC           =  cellfull_duration_UNFILT_ALLCASES ;       maskLOC(:) = NaN;
maskMERGEenv      =  preCIandCI_cape_deep_ALLCASES ;          maskMERGEenv(:) = NaN; 
maskMERGE        =  cellfull_duration_UNFILT_ALLCASES ;       maskMERGE(:) = NaN;
maskMERGE2env      =  preCIandCI_cape_deep_ALLCASES ;          maskMERGEenv(:) = NaN; 
maskMERGE2        =  cellfull_duration_UNFILT_ALLCASES ;       maskMERGE(:) = NaN;
maskSPLITenv      =  preCIandCI_cape_deep_ALLCASES ;          maskSPLITenv(:) = NaN; 
maskSPLIT        =  cellfull_duration_UNFILT_ALLCASES ;       maskSPLIT(:) = NaN;
[nn yy] = size(cellfull_duration_UNFILT_ALLCASES) ;
for n = 1:nn
    for y = 1:yy

        %CI time requirement
        hr = char( CItime(n,y) ) ;  hr = str2num( hr(1:2) ); 
        if(   hr < 20 & hr > 11 )   
            maskCITIME(n,y) = 1;
            maskCITIMEenv(:,n,y) = 1;
        end

        %minimum cell dur requirement
        if(   cellfull_duration_UNFILT_ALLCASES(n,y) >= 3     )   
            maskMINDUR(n,y) = 1;
            maskMINDURenv(:,n,y) = 1;
        end

        % cell location requirement
        if(   cellCI_meanlon_ALLCASES(n,y) < -64.7   &   cellCI_meanlon_ALLCASES(n,y) > -64.975  &  ...
              cellCI_meanlat_ALLCASES(n,y) > -32.5   &   cellCI_meanlat_ALLCASES(n,y) < -31.6   )   
            maskLOC(n,y) = 1;
            maskLOCenv(:,n,y) = 1;
        end

        % cell status requirements
        %keep the nosplit start cells
        if( isnan(cellfull_startsplitstatus_ALLCASES(n,y))    )   
            maskSPLIT(n,y) = 1;
            maskSPLITenv(:,n,y) = 1;
        end
    
        %keep cells that dont end in merger at all
        if( isnan(cellfull_endmergestatus_ALLCASES(n,y))   )  % &  cellfull_duration_UNFILT_ALLCASES(n,y) >= 7     )   
            maskMERGE(n,y) = 1;
            maskMERGEenv(:,n,y) = 1;
        end

        %keep end in mergers as long a they 
        if( isnan(cellfull_endmergestatus_ALLCASES(n,y)==0)   &  cellfull_duration_UNFILT_ALLCASES(n,y) >= 7     )   
            maskMERGE2(n,y) = 1;
            maskMERGE2env(:,n,y) = 1;
        end
        
%         if(  maskSTATUS(n,y)==1  &  isnan(cellfull_startsplitstatus_ALLCASES(n,y))    )   
%             maskSTATUS(n,y) = 1;
%             maskSTATUSenv(:,n,y) = 1;
%         end

    end
end

maskSTATUSenv   = maskSPLITenv .* maskMERGEenv .* maskMERGE2env ; 
maskSTATUS      = maskSPLIT    .* maskMERGE    .* maskMERGE2 ;

length(find(  isnan(maskMINCAPE(1,:,:))==0  ))
length(find(  isnan(maskMAXCIN(1,:,:))==0   ))
length(find(  isnan(maskMINEL(1,:,:))==0   ))
length(find(  isnan(maskMINDURenv(1,:,:))==0   ))
length(find(  isnan(maskLOCenv(1,:,:))==0  ))
length(find(  isnan(maskSTATUSenv(1,:,:))==0   ))

%  length(find(  isnan(maskMINCAPE(1,:,:).*maskMAXCIN(1,:,:).*maskMINEL(1,:,:)  )==0     ))
%  length(find(  isnan(maskMINDURenv(1,:,:).*maskLOCenv(1,:,:).*maskSTATUSenv(1,:,:)  )==0     ))

fullmaskenv = maskMINCAPE .* maskMAXCIN .* maskMINEL .* maskMINDURenv .* maskLOCenv .* maskSTATUSenv .*  maskCITIMEenv  ;
fullmaskcell = maskMINDUR .* maskLOC .* maskSTATUS .*  maskCITIME ;


%  length(find(  isnan( fullmaskenv(1,:,:))==0 )  )

%cellkeeper_mask_ALLCASE: 
CItind = 4;

% raw cell stats .* cellkeeper_mask_ALLCASE
cell_at_CI_cellarea   = cellCI_cellarea_UNFILT_ALLCASES(:) ;% .* fullmaskcell(:);
cell_at_CI_corearea   = cellCI_corearea_UNFILT_ALLCASES(:) ;% .* fullmaskcell(:);
cell_at_CI_maxdbz     = cellCI_maxdbz_UNFILT_ALLCASES(:)   ;% .* fullmaskcell(:);
cell_at_CI_maxETH10   = cellCI_maxETH10_UNFILT_ALLCASES(:) ;% .* fullmaskcell(:);
%  length(find(  isnan( cell_at_CI_cellarea)==0 )  )
% %raw cell stats
% cellCI_cellarea_UNFILT_ALLCASES
% cellCI_corearea_UNFILT_ALLCASES
% cellCI_maxdbz_UNFILT_ALLCASES
% cellCI_maxETH10_UNFILT_ALLCASES

nearcell_ucrel_acbl         =  preCIandCI_ucrel_acbl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);     nearcell_ucrel_acbl = permute(nearcell_ucrel_acbl ,[2 3 1]);
nearcell_rh_acbl            =  preCIandCI_rh_acbl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);        nearcell_rh_acbl  = permute(nearcell_rh_acbl ,[2 3 1]); 
nearcell_thetae_acbl        =  preCIandCI_thetae_acbl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);    nearcell_thetae_acbl = permute(nearcell_thetae_acbl ,[2 3 1]); 
nearcell_cape_acbl          =  preCIandCI_cape_acbl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);      nearcell_cape_acbl  = permute(nearcell_cape_acbl  ,[2 3 1]); 
nearcell_mucin              =  preCIandCI_mucin_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);          nearcell_mucin  = permute(nearcell_mucin  ,[2 3 1]); 
nearcell_mulcl              =  preCIandCI_mulcl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);          nearcell_mulcl  = permute(nearcell_mulcl  ,[2 3 1]); 
nearcell_mulfc              =  preCIandCI_mulfc_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);          nearcell_mulfc  = permute(nearcell_mulfc  ,[2 3 1]); 
nearcell_shear03            =  preCIandCI_shear03_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);        nearcell_shear03  = permute(nearcell_shear03  ,[2 3 1]); 
nearcell_shear06            =  preCIandCI_shear06_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);        nearcell_shear06  = permute(nearcell_shear06  ,[2 3 1]); 
nearcell_shear09            =  preCIandCI_shear09_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);        nearcell_shear09  = permute(nearcell_shear09  ,[2 3 1]); 
nearcell_cape_deep          =  preCIandCI_cape_deep_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);      nearcell_cape_deep  = permute(nearcell_cape_deep  ,[2 3 1]); 
nearcell_ucrel_mu           =  preCIandCI_ucrel_mu_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);       nearcell_ucrel_mu  = permute(nearcell_ucrel_mu  ,[2 3 1]); 
nearcell_vcrel_mu           =  preCIandCI_vcrel_mu_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);       nearcell_vcrel_mu = permute( nearcell_vcrel_mu ,[2 3 1]); 
nearcell_upslopemag         =  preCIandCI_upslopemax_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);      nearcell_upslopemag  = permute(nearcell_upslopemag  ,[2 3 1]);  
nearcell_upslopedepthfract  =  preCIandCI_upslopefract_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:);    nearcell_upslopedepthfract  = permute(nearcell_upslopedepthfract  ,[2 3 1]); 
%  length(find(  isnan( nearcell_cape_deep )==0 )  )

nearcell_ucrel_acbl  =  nearcell_ucrel_acbl(:) ;
nearcell_rh_acbl     =  nearcell_rh_acbl(:);
nearcell_thetae_acbl =  nearcell_thetae_acbl(:);
nearcell_cape_acbl   =  nearcell_cape_acbl(:);
nearcell_mucin       =  nearcell_mucin(:);
nearcell_mulcl       =  nearcell_mulcl(:); 
nearcell_mulfc       =  nearcell_mulfc(:);
nearcell_shear03     =  nearcell_shear03(:);
nearcell_shear06     =  nearcell_shear06(:);
nearcell_shear09     =  nearcell_shear09(:);
nearcell_cape_deep   =  nearcell_cape_deep(:);
nearcell_ucrel_mu    =  nearcell_ucrel_mu(:); 
nearcell_vcrel_mu    =  nearcell_vcrel_mu(:);
nearcell_upslopemag           =  abs(nearcell_upslopemag(:));
nearcell_upslopedepthfract    =  nearcell_upslopedepthfract(:);


MesoAscent_Wmagnitude   =  permute(prepost_mesoWstrength_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoAscent_width        =  permute(prepost_mesoWwidth_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoAscent_VertMassFlux =  permute(prepost_mesoWvmf_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoAscent_DepthPerLfc  =  permute(prepost_mesoWtopasl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1])   ./   permute( prepost_mesoWtoplfcasl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);

%{
MesoTFCbox_eastupslopedepth                 =  permute(prepost_mesoWTFCbox_eastupslopedepth_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopemean                  =  permute(prepost_mesoWTFCbox_eastupslopemean_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopedepthfract            =  permute(prepost_mesoWTFCbox_eastupslopedepthfract_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopetophtasl              =  permute(prepost_mesoWTFCbox_eastupslopetophtasl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopedepthfract2500masl    =  permute(prepost_mesoWTFCbox_eastupslopedepthfract2500masl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopemean2500masl          =  permute(prepost_mesoWTFCbox_eastupslopemean2500masl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopedepthfract1500magl    =  permute(prepost_mesoWTFCbox_eastupslopedepthfract1500magl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopemean1500magl          =  permute(prepost_mesoWTFCbox_eastupslopemean1500magl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastUmean3to4kmasl               =  permute(prepost_mesoWTFCbox_eastUmean3to4kmasl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastUmean4to5kmasl               =  permute(prepost_mesoWTFCbox_eastUmean4to5kmasl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastUmean5to6kmasl               =  permute(prepost_mesoWTFCbox_eastUmean5to6kmasl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopedepthfract            =  permute(prepost_mesoWTFCbox_westupslopedepthfract_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopetophtasl              =  permute(prepost_mesoWTFCbox_westupslopetophtasl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopedepthfract2500masl    =  permute(prepost_mesoWTFCbox_westupslopedepthfract2500masl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopemean2500masl          =  permute(prepost_mesoWTFCbox_westupslopemean2500masl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopedepthfract1500magl    =  permute(prepost_mesoWTFCbox_westupslopedepthfract1500magl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopemean1500magl          =  permute(prepost_mesoWTFCbox_westupslopemean1500magl_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]); 
%}

MesoTFCbox_eastupslopedepth                 =  permute(prepost_TFCbox_eastupslopedepth_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopemean                  =  permute(prepost_TFCbox_eastupslopemean_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopedepthfract            =  permute(prepost_TFCbox_eastupslopedepthfract_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopetophtasl              =  permute(prepost_TFCbox_eastupslopetophtasl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopedepthfract2500masl    =  permute(prepost_TFCbox_eastupslopedepthfract2500masl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopemean2500masl          =  permute(prepost_TFCbox_eastupslopemean2500masl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopedepthfract1500magl    =  permute(prepost_TFCbox_eastupslopedepthfract1500magl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastupslopemean1500magl          =  permute(prepost_TFCbox_eastupslopemean1500magl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastUmean3to4kmasl               =  permute(prepost_TFCbox_eastUmean3to4kmasl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastUmean4to5kmasl               =  permute(prepost_TFCbox_eastUmean4to5kmasl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_eastUmean5to6kmasl               =  permute(prepost_TFCbox_eastUmean5to6kmasl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopedepthfract            =  permute(prepost_TFCbox_westupslopedepthfract_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopetophtasl              =  permute(prepost_TFCbox_westupslopetophtasl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopedepthfract2500masl    =  permute(prepost_TFCbox_westupslopedepthfract2500masl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopemean2500masl          =  permute(prepost_TFCbox_westupslopemean2500masl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopedepthfract1500magl    =  permute(prepost_TFCbox_westupslopedepthfract1500magl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]);
MesoTFCbox_westupslopemean1500magl          =  permute(prepost_TFCbox_westupslopemean1500magl_UNFILT_ALLCASES(CItind,:,:) .* fullmaskenv(CItind,:,:), [2 3 1]); 


MesoAscent_Wmagnitude                       =  MesoAscent_Wmagnitude(:);
MesoAscent_width                            =  MesoAscent_width(:);
MesoAscent_VertMassFlux                     =  MesoAscent_VertMassFlux(:);
MesoAscent_DepthPerLfc                      =  MesoAscent_DepthPerLfc(:);
MesoTFCbox_eastupslopedepth                 =  MesoTFCbox_eastupslopedepth(:);   
MesoTFCbox_eastupslopemean                  =  MesoTFCbox_eastupslopemean(:);   
MesoTFCbox_eastupslopedepthfract            =  MesoTFCbox_eastupslopedepthfract(:);     
MesoTFCbox_eastupslopetophtasl              =  MesoTFCbox_eastupslopetophtasl(:);     
MesoTFCbox_eastupslopedepthfract2500masl    =  MesoTFCbox_eastupslopedepthfract2500masl(:);     
MesoTFCbox_eastupslopemean2500masl          =  MesoTFCbox_eastupslopemean2500masl(:);     
MesoTFCbox_eastupslopedepthfract1500magl    =  MesoTFCbox_eastupslopedepthfract1500magl(:);     
MesoTFCbox_eastupslopemean1500magl          =  MesoTFCbox_eastupslopemean1500magl(:);     
MesoTFCbox_eastUmean3to4kmasl               =  MesoTFCbox_eastUmean3to4kmasl(:);     
MesoTFCbox_eastUmean4to5kmasl               =  MesoTFCbox_eastUmean4to5kmasl(:);     
MesoTFCbox_eastUmean5to6kmasl               =  MesoTFCbox_eastUmean5to6kmasl(:);     
MesoTFCbox_westupslopedepthfract            =  MesoTFCbox_westupslopedepthfract(:);     
MesoTFCbox_westupslopetophtasl              =  MesoTFCbox_westupslopetophtasl(:);     
MesoTFCbox_westupslopedepthfract2500masl    =  MesoTFCbox_westupslopedepthfract2500masl(:);      
MesoTFCbox_westupslopemean2500masl          =  MesoTFCbox_westupslopemean2500masl(:);     
MesoTFCbox_westupslopedepthfract1500magl    =  MesoTFCbox_westupslopedepthfract1500magl(:);
MesoTFCbox_westupslopemean1500magl          =  MesoTFCbox_westupslopemean1500magl(:);


ALL_vars = {'cell_at_CI_cellarea'; 
'cell_at_CI_maxdbz';
'cell_at_CI_maxETH10';
'nearcell_shear03';
'nearcell_shear06';
'nearcell_shear09';
% 'nearcell_upslopedepthfract';
% 'nearcell_upslopemag';
'MesoTFCbox_eastupslopedepthfract';
'MesoTFCbox_eastupslopemean';
'nearcell_thetae_acbl';
'nearcell_rh_acbl';
'nearcell_mulcl';
'nearcell_mulfc';
'nearcell_mucin';
'nearcell_cape_acbl';
'nearcell_cape_deep';
};

ALL_vars = flipdim(ALL_vars,1) ;


num_samples = [ length(find(isnan(cell_at_CI_cellarea)==0)), ...
                length(find(isnan(nearcell_shear06)==0)), ...
                length(find(isnan(nearcell_mulcl)==0)), ...
                length(find(isnan(nearcell_upslopemag)==0)), ...
                length(find(isnan(MesoTFCbox_eastupslopemean)==0)) ]       ;

num_samples = min(num_samples)


% ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
% for n = 1:length(ALL_vars)
%     for m = 1:length(ALL_vars)
%         AA = char(ALL_vars(n)) ; 
%         AA = eval(AA);
%         BB = char(ALL_vars(m)) ;  
%         BB = eval(BB);
%         kill = isnan(BB);
%         BB(kill) = []; AA(kill) = [];
%         kill = isnan(AA);
%         BB(kill) = []; AA(kill) = [];
%         corab = corrcoef(AA(:),BB(:)); corab = corab(2);
%         ALL_corrs(n,m) = corab ;
%     end
% end

ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));   ALL_statsig(:) = NaN;
SIGTHRESH = 0.05;
for n = 1:length(ALL_vars)
    for m = 1:length(ALL_vars)
        %  n = 8; m = 1
        AA = char(ALL_vars(n)) ; 
        AA = eval(AA);
        BB = char(ALL_vars(m)) ;  
        BB = eval(BB);
        kill = isnan(BB);
        BB(kill) = []; AA(kill) = [];
        kill = isnan(AA);
        BB(kill) = []; AA(kill) = [];
        [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
        ALL_corrs(n,m) = corab ;
        ALL_Ps(n,m) = pval;
        if(pval < SIGTHRESH)
            ALL_statsig(n,m) = NaN;
        else
           ALL_corrs(n,m) = NaN;
           ALL_statsig(n,m) = 0; %0;    
        end
    end
end
ALL_corrs = single(ALL_corrs);
isupper = logical(triu(ones(size(ALL_corrs)),1));
ALL_corrs(isupper) = NaN;
ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN

varlab = {};
for l = 1:length(ALL_vars)
   asd = char(ALL_vars(l,:) )   ;
   asd(find(asd=='_'))=' '   ;
   varlab = vertcat(varlab,asd);
end

%round 
ALL_corrs = round(ALL_corrs,2);

dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
title(['Correlogram - cells lasso - all cases combined  (Filt: LFClayer,small area),  cloud time lag = ',num2str((CItind-1)*5),'min'])




disp(' STILL NEED TO FIGURE OUT WHAT TO DO WITH SAMPLE NUMBERS WHEN YOU HIT THEM WITH STAT-SIG & CONFIDENCE MARKERS BECAUSE THESE WILL VARY PER VARIBLE TESTED')



% saveas(h, horzcat(imout,'/Correlgram_cellslasso_Allcases_swathlag',num2str((CItind-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/Correlgram_cellslasso_Allcases_swathlag',num2str((CItind-1)*5),'min_LFCARfilt.eps') ;
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);









%%% Because so few cells per day after filtering, pretty much all relationships are statsistically
%%% insignifcant!
%{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%  3b) For simulated cells 
%%%%
%%%%   This is a mix of FULLSDC space and sounding-based metrics
%%%%     
%%%%    doing Hi-Med vs lo confidence breakdown
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%first make environemntal masks:
maskMINCAPE  =  preCIandCI_cape_deep_ALLCASES;       maskMINCAPE(:) = NaN;   
maskMAXCIN   =  preCIandCI_mucin_ALLCASES;           maskMAXCIN(:) = NaN; 
maskMINEL    =  preCIandCI_cape_deep_ALLCASES;       maskMINEL(:) = NaN;  
[tt nn yy] = size(preCIandCI_cape_deep_ALLCASES);
for n = 1:nn
    for y = 1:yy
        %minimum cape requirement
        if(   mean(preCIandCI_cape_deep_UNFILT_ALLCASES(3:7,n,y),'omitnan') > 100.0       )   %look at CI-10min to CI - 30min
            maskMINCAPE(:,n,y) = 1;
        end
        %maximum cin requirement
        if(   mean(preCIandCI_mucin_UNFILT_ALLCASES(3:7,n,y),'omitnan') > -10.0       )  %look at CI-10min to CI - 30min
            maskMAXCIN(:,n,y) = 1;
        end
        %minimum cape requirement
        if(   mean(preCIandCI_muel_UNFILT_ALLCASES(3:7,n,y),'omitnan') > 6000.0       )   %look at CI-10min to CI - 30min
            maskMINEL(:,n,y) = 1;
        end
    end
end

%next make cell property-space masks:
maskMINDURenv     =  preCIandCI_cape_deep_ALLCASES ;       maskMINDURenv(:) = NaN; 
maskMINDUR        =  cellfull_duration_UNFILT_ALLCASES ;          maskMINDUR(:) = NaN;
maskLOCenv        =  preCIandCI_cape_deep_ALLCASES ;       maskLOCenv(:) = NaN; 
maskLOC           =  cellfull_duration_UNFILT_ALLCASES ;          maskLOC(:) = NaN;
maskSTATUSenv     =  preCIandCI_cape_deep_ALLCASES ;    maskSTATUSenv(:) = NaN; 
maskSTATUS        =  cellfull_duration_UNFILT_ALLCASES ;       maskSTATUS(:) = NaN;
[nn yy] = size(cellfull_duration_UNFILT_ALLCASES) ;
for n = 1:nn
    for y = 1:yy

        %minimum cell dur requirement
        if(   cellfull_duration_UNFILT_ALLCASES(n,y) >= 4      )   
            maskMINDUR(n,y) = 1;
            maskMINDURenv(:,n,y) = 1;
        end

        % cell location requirement
        if(   cellCI_meanlon_ALLCASES(n,y) < -64.7   &   cellCI_meanlon_ALLCASES(n,y) > -64.975  &  ...
              cellCI_meanlat_ALLCASES(n,y) > -32.5   &   cellCI_meanlat_ALLCASES(n,y) < -31.6   )   
            maskLOC(n,y) = 1;
            maskLOCenv(:,n,y) = 1;
        end

        % cell status requirements
        if(   isnan(cellfull_endmergestatus_ALLCASES(n,y))  &  cellfull_duration_UNFILT_ALLCASES(n,y) >= 7     )   
            maskSTATUS(n,y) = 1;
            maskSTATUSenv(:,n,y) = 1;
        end
        if(  maskSTATUS(n,y)==1  &  isnan(cellfull_startsplitstatus_ALLCASES(n,y))    )   
            maskSTATUS(n,y) = 1;
            maskSTATUSenv(:,n,y) = 1;
        end

    end
end

length(find(  isnan(maskMINCAPE(1,:,:))==0  ))
length(find(  isnan(maskMAXCIN(1,:,:))==0   ))
length(find(  isnan(maskMINEL(1,:,:))==0   ))
length(find(  isnan(maskMINDURenv(1,:,:))==0   ))
length(find(  isnan(maskLOCenv(1,:,:))==0  ))
length(find(  isnan(maskSTATUSenv(1,:,:))==0   ))

%  length(find(  isnan(maskMINCAPE(1,:,:).*maskMAXCIN(1,:,:).*maskMINEL(1,:,:)  )==0     ))
%  length(find(  isnan(maskMINDURenv(1,:,:).*maskLOCenv(1,:,:).*maskSTATUSenv(1,:,:)  )==0     ))

fullmaskenv = maskMINCAPE .* maskMAXCIN .* maskMINEL .* maskMINDURenv .* maskLOCenv .* maskSTATUSenv ;
fullmaskcell = maskMINDUR .* maskLOC .* maskSTATUS ;


%%%%% per case:
ALL_CORRS = [];
ALL_SIG = [];
num_cells = [];

for R = 1:ar

    % R = 4;

    % raw cell stats .* cellkeeper_mask_ALLCASE
    cell_at_CI_cellarea   = cellCI_cellarea_UNFILT_ALLCASES(:,R) .* fullmaskcell(:,R);
    cell_at_CI_corearea   = cellCI_corearea_UNFILT_ALLCASES(:,R) .* fullmaskcell(:,R);
    cell_at_CI_maxdbz     = cellCI_maxdbz_UNFILT_ALLCASES(:,R)   .* fullmaskcell(:,R);
    cell_at_CI_maxETH10   = cellCI_maxETH10_UNFILT_ALLCASES(:,R) .* fullmaskcell(:,R);

    num_cells = vertcat(   num_cells, length(find(isnan(cell_at_CI_cellarea)==0))    ); 

    CItind =  4; %4 = -15min

    nearcell_ucrel_acbl         =  preCIandCI_ucrel_acbl_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);     nearcell_ucrel_acbl = permute(nearcell_ucrel_acbl ,[2 1]);
    nearcell_rh_acbl            =  preCIandCI_rh_acbl_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);        nearcell_rh_acbl  = permute(nearcell_rh_acbl ,[2 1]);
    nearcell_thetae_acbl        =  preCIandCI_thetae_acbl_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);    nearcell_thetae_acbl = permute(nearcell_thetae_acbl ,[2 1]);
    nearcell_cape_acbl          =  preCIandCI_cape_acbl_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);      nearcell_cape_acbl  = permute(nearcell_cape_acbl  ,[2 1]);
    nearcell_mucin              =  preCIandCI_mucin_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);          nearcell_mucin  = permute(nearcell_mucin  ,[2 1]);
    nearcell_mulcl              =  preCIandCI_mulcl_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);          nearcell_mulcl  = permute(nearcell_mulcl  ,[2 1]);
    nearcell_mulfc              =  preCIandCI_mulfc_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);          nearcell_mulfc  = permute(nearcell_mulfc  ,[2 1]);
    nearcell_shear03            =  preCIandCI_shear03_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);        nearcell_shear03  = permute(nearcell_shear03  ,[2 1]);
    nearcell_shear06            =  preCIandCI_shear06_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);        nearcell_shear06  = permute(nearcell_shear06  ,[2 1]);
    nearcell_shear09            =  preCIandCI_shear09_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);        nearcell_shear09  = permute(nearcell_shear09  ,[2 1]);
    nearcell_cape_deep          =  preCIandCI_cape_deep_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);      nearcell_cape_deep  = permute(nearcell_cape_deep  ,[2 1]);
    nearcell_ucrel_mu           =  preCIandCI_ucrel_mu_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);       nearcell_ucrel_mu  = permute(nearcell_ucrel_mu  ,[2 1]);
    nearcell_vcrel_mu           =  preCIandCI_vcrel_mu_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);       nearcell_vcrel_mu = permute( nearcell_vcrel_mu ,[2 1]);
    nearcell_upslopemag         =  preCIandCI_upslopemax_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);      nearcell_upslopemag  = permute(nearcell_upslopemag  ,[2 1]);
    nearcell_upslopedepthfract  =  preCIandCI_upslopefract_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);    nearcell_upslopedepthfract  = permute(nearcell_upslopedepthfract  ,[2 1]);

    MesoAscent_Wmagnitude   =  prepost_mesoWstrength_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);  MesoAscent_Wmagnitude = permute(MesoAscent_Wmagnitude,[2 1]);
    MesoAscent_width        =  prepost_mesoWwidth_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);     MesoAscent_width = permute(MesoAscent_width,[2 1]);
    MesoAscent_VertMassFlux =  prepost_mesoWvmf_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R);       MesoAscent_VertMassFlux = permute(MesoAscent_VertMassFlux,[2 1]);
    MesoAscent_DepthPerLfc  =  permute( prepost_mesoWtopasl_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R), [2 3 1])   ./   permute( prepost_mesoWtoplfcasl_UNFILT_ALLCASES(CItind,:,R) .* fullmaskenv(CItind,:,R), [2 3 1]);
    


   %%%%%%%%%%%%% Use these for Jim sounding code based env metrics:
   ALL_vars = {'cell_at_CI_cellarea';
       'cell_at_CI_maxdbz';
       'cell_at_CI_maxETH10';
       'nearcell_shear03';
       'nearcell_shear06';
       'nearcell_shear09';
       'nearcell_upslopedepthfract';
       'nearcell_upslopemag';
       'nearcell_thetae_acbl';
       'nearcell_rh_acbl';
       'nearcell_mulcl';
       'nearcell_mulfc';
       'nearcell_mucin';
       'nearcell_cape_acbl';
       'nearcell_cape_deep';
       };

    ALL_vars = flipdim(ALL_vars,1) ;

    ALL_corrs = zeros(length(ALL_vars),length(ALL_vars));     ALL_corrs(:) = NaN;
    ALL_Ps = zeros(length(ALL_vars),length(ALL_vars));        ALL_Ps(:) = NaN;
    ALL_statsig = zeros(length(ALL_vars),length(ALL_vars));        ALL_statsig(:) = NaN;

    SIGTHRESH = 0.05;
    for n = 1:length(ALL_vars)
        for m = 1:length(ALL_vars)
            %  n = 1; m = 3
            AA = char(ALL_vars(n)) ;
            AA = eval(AA);
            BB = char(ALL_vars(m)) ;
            BB = eval(BB);
            kill = isnan(BB);
            BB(kill) = []; AA(kill) = [];
            kill = isnan(AA);
            BB(kill) = []; AA(kill) = [];
            [corab, pval] = corrcoef(AA(:),BB(:)); corab = corab(2); pval = pval(2);
            ALL_corrs(n,m) = corab ;
            ALL_Ps(n,m) = pval;
            if(pval < SIGTHRESH)          %significant
                ALL_statsig(n,m) = NaN;   % marking signif as nan for now (dont remember why - i think matlab couldnt handle 1 and 0 for something at some stage), it will be switched to 1 later for plotting purposes
            else 
              %  ALL_corrs(n,m) = NaN;
                ALL_statsig(n,m) = 0; %0;   
            end
        end
    end
    ALL_corrs = single(ALL_corrs);
    isupper = logical(triu(ones(size(ALL_corrs)),1));
    ALL_corrs(isupper) = NaN;
    ALL_corrs(ALL_corrs >= 0.99999999999999999999999) = NaN;

    ALL_statsig = single(ALL_statsig);
    isupper = logical(triu(ones(size(ALL_statsig)),1));
    ALL_statsig(isupper) = NaN;
    ALL_statsig(ALL_statsig >= 0.99999999999999999999999) = NaN;


    varlab = {};
    for l = 1:length(ALL_vars)
        asd = char(ALL_vars(l,:) )   ;
        asd(find(asd=='_'))=' '   ;
        varlab = vertcat(varlab,asd);
    end

    %round
    ALL_corrs = round(ALL_corrs,2);

    ALL_CORRS = cat(3,ALL_CORRS,ALL_corrs);
    ALL_SIG = cat(3,ALL_SIG,ALL_statsig);

    dualpol_colmap
    ff = figure('Position',[246,77,1187,900])
    h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['Correlogram - ', Rlab ,' (Filt: LFClayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min ',RUNS(R,1:8)])

%     saveas(ff, horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.png') );
%     outlab = horzcat(imout,'/Correlgram_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt',RUNS(R,1:8),'.eps');
%     EPSprint = horzcat('print -painters -depsc ',outlab);
%     eval([EPSprint]);

end




dualpol_colmap
ff = figure('Position',[246,77,1187,900])
meancorr = mean(ALL_CORRS,3,'omitnan');  
h = heatmap(round(meancorr,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['Correlogram lasso cells  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/Correlgram_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%%% helpful diagnostic plots:

% count blocks with statistical significance:
dualpol_colmap
%ff = figure('Position',[246,77,1187,900])
ALL_SIG(isnan(ALL_SIG)) = 1;   %swap significant marker from nan to 1
SUMSIG = sum(ALL_SIG,3,'omitnan');  
%{
h = heatmap(round(SUMSIG,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['sum of significant cases ',num2str((TIMLG-1)*5)])
%}
% saveas(ff, horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/SignifCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


% number of blocks with same correlation sign as the ensemble mean :
ALL_COR_SIGN  = sign( ALL_CORRS );
meancorr = mean(ALL_CORRS,3,'omitnan');
MEANCOR = [];
for y = 1:ar  % stitch together for dimension matching. 
    MEANCOR = cat(3,MEANCOR, meancorr);
end
MEANCOR_SIGN = sign(MEANCOR);
[ci cj cy] = size(MEANCOR);
MATCHED_SIGNS = MEANCOR_SIGN;   MATCHED_SIGNS(:) = NaN; %array with 1 where case blocks match mean block
match = find(MEANCOR_SIGN == ALL_COR_SIGN);
MATCHED_SIGNS(match) = 1;
SUM_MATCHED_SIGNS = sum(MATCHED_SIGNS,3,'omitnan');



% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(SUM_MATCHED_SIGNS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([0 ar])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['Correlogram - (Filt: LFClayer,small area)  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])

% saveas(ff, horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.png') );
% outlab = horzcat(imout,'/matchmeanCount_allcasemean_',Rlab(1:8),'_swathlag',num2str((TIMLG-1)*5),'min_LFCARfilt.eps');
% EPSprint = horzcat('print -painters -depsc ',outlab);
% eval([EPSprint]);


%per-case log of useable confidence
for R = 1:ar

    [asd fgh] = size(ALL_CORRS(:,:,1))
    dayconf = zeros(asd,fgh);    

    %good = find( MATCHED_SIGNS(:,:,R) == 1 & ALL_SIG(:,:,R) == 1  ) ; 
    good = find( ALL_SIG(:,:,R) == 1  ) ; 
    dayconf(good) = 1;

    %{
    figure
    h = heatmap(round(dayconf,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    %h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
    h.NodeChildren(3).YDir='normal';
    colormap(flipud(pepsi2))
    caxis([-1 1])
    h.XDisplayLabels = varlab;
    h.YDisplayLabels = varlab;
    ax = gca;
    axp = struct(ax);       %you will get a warning
    axp.Axes.XAxisLocation = 'top';
    Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
    title(['matched sign and stat sig for case: ', RUNS(R,:) ])
    %}
end



%%%%%%%% now use this to divide into high, med, low confidence
%%%%%%%% interpretations:

HICONF_MEAN_CORRS = zeros(ci,cj);    HICONF_MEAN_CORRS(:) = NaN; 
MECONF_MEAN_CORRS = zeros(ci,cj);    MECONF_MEAN_CORRS(:) = NaN; 
LOCONF_MEAN_CORRS = zeros(ci,cj);    LOCONF_MEAN_CORRS(:) = NaN; 
for i = 1:ci
    for j = 1:cj
        %  i = 19; j = 18

        HSIGN = ( SUM_MATCHED_SIGNS(i,j)   > 3  )   ;
%         MSIGN = ( SUM_MATCHED_SIGNS(i,j)   < 5  &  SUM_MATCHED_SIGNS(i,j)   >= 3 );
        LSIGN = ( SUM_MATCHED_SIGNS(i,j)   <= 3 );

        HSIG = ( SUMSIG(i,j)   >  3  )   ;
%         MSIG = ( SUMSIG(i,j) < 5  &   SUMSIG(i,j) >= 3 );
        LSIG = ( SUMSIG(i,j) <= 3 );        

        if( HSIGN==1  &  HSIG==1 & LSIGN==0  & LSIG==0)
            HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);

%         if( HSIGN==1  &  HSIG==1 & MSIGN==0  &  MSIG==0 & LSIGN==0  & LSIG==0)
%             HICONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%
%         elseif(  HSIGN==0  &  HSIG==0 & MSIGN==1  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==1  &  HSIG==0 & MSIGN==0  &  MSIG==1 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
%         elseif(  HSIGN==0  &  HSIG==1 & MSIGN==1  &  MSIG==0 & LSIGN==0  & LSIG==0 )
%             MECONF_MEAN_CORRS(i,j) = MEANCOR(i,j);
% 
%         elseif(LSIGN==1  | LSIG==1 )
%             LOCONF_MEAN_CORRS(i,j) = MEANCOR(i,j);

        end
    end
end



% count blocks with statistical significance:
dualpol_colmap
ff = figure('Position',[246,77,1187,900])
h = heatmap(round(HICONF_MEAN_CORRS,2),'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
%h = heatmap(ALL_corrs,'MissingDataColor',[1 1 1]);  %[0.4 0.8 0.4]);
h.NodeChildren(3).YDir='normal';
colormap(flipud(pepsi2))
caxis([-1 1])
h.XDisplayLabels = varlab;
h.YDisplayLabels = varlab;
ax = gca;
axp = struct(ax);       %you will get a warning
axp.Axes.XAxisLocation = 'top';
Rlab = RUNS(R,:);  Rlab(Rlab=='_')=' ';
title(['HI/MED CONF CElllasso Correlogram -  cloud time lag = ',num2str((TIMLG-1)*5),'min allcasemean'])
%}


